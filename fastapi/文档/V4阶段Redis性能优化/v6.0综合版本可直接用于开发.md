# ğŸ“˜ FastAPI æ¨¡å—åŒ–æ–‡æ¡£ç®¡ç†ç³»ç»Ÿ - å®Œæ•´æŠ€æœ¯æ–‡æ¡£ (v9.0)

> **æœ€åæ›´æ–°**ï¼š2025å¹´12æœˆ2æ—¥  
> **é¡¹ç›®çŠ¶æ€**ï¼šâœ… **v5.0 Redisç¼“å­˜Dockeré›†æˆå®Œæˆï¼**  
> **æ¶æ„åŸåˆ™**ï¼šæ¨¡å—åŒ– + ç‰ˆæœ¬åŒ– + é›¶ä¾µå…¥ + è‡ªåŠ¨æ³¨å†Œ + è´Ÿè½½å‡è¡¡ + å…¨æ ˆä¼ä¸šçº§éƒ¨ç½² + Redisç¼“å­˜ + Dockerå®¹å™¨åŒ–

---

## ğŸ“‹ ç›®å½•

- [1. é¡¹ç›®æ¦‚è¿°](#1-é¡¹ç›®æ¦‚è¿°)
- [2. ç³»ç»Ÿæ¶æ„](#2-ç³»ç»Ÿæ¶æ„)
- [3. æ¥å£æ–‡æ¡£](#3-æ¥å£æ–‡æ¡£)
- [4. å¼€å‘æ–‡æ¡£](#4-å¼€å‘æ–‡æ¡£)
- [5. Redisç¼“å­˜ç³»ç»Ÿ](#5-redisç¼“å­˜ç³»ç»Ÿ)
- [6. Dockerå®¹å™¨åŒ–éƒ¨ç½²](#6-dockerå®¹å™¨åŒ–éƒ¨ç½²)
- [7. æ€§èƒ½ä¼˜åŒ–æ–‡æ¡£](#7-æ€§èƒ½ä¼˜åŒ–æ–‡æ¡£)
- [8. éƒ¨ç½²æ–‡æ¡£](#8-éƒ¨ç½²æ–‡æ¡£)
- [9. å¼€å‘ç»éªŒæ€»ç»“](#9-å¼€å‘ç»éªŒæ€»ç»“)
- [10. å¿«é€Ÿå¯åŠ¨å‘½ä»¤](#10-å¿«é€Ÿå¯åŠ¨å‘½ä»¤)

---

## 1. é¡¹ç›®æ¦‚è¿°

### 1.1 é¡¹ç›®ç®€ä»‹

FastAPIæ¨¡å—åŒ–æ–‡æ¡£ç®¡ç†ç³»ç»Ÿæ˜¯ä¸€ä¸ªåŸºäºFastAPIæ¡†æ¶çš„ä¼ä¸šçº§æ–‡æ¡£ç®¡ç†å¹³å°ï¼Œé‡‡ç”¨æ¨¡å—åŒ–æ¶æ„è®¾è®¡ï¼Œæ”¯æŒç‰ˆæœ¬åŒ–å¼€å‘ï¼Œå…·å¤‡å®Œæ•´çš„ç”¨æˆ·ç³»ç»Ÿã€æ–‡æ¡£ç®¡ç†ã€AIé›†æˆã€åˆ†äº«ç³»ç»Ÿã€Redisç¼“å­˜å’ŒDockerå®¹å™¨åŒ–éƒ¨ç½²ç­‰åŠŸèƒ½ã€‚ç»è¿‡v5.0 Redisç¼“å­˜Dockeré›†æˆä¼˜åŒ–ï¼Œç°å·²è¾¾åˆ°ä¼ä¸šçº§ç”Ÿäº§éƒ¨ç½²æ ‡å‡†ã€‚

### 1.2 æŠ€æœ¯æ¶æ„ç‰¹è‰²

- **ğŸ—ï¸ æ¨¡å—åŒ–æ¶æ„**ï¼šæ¯ä¸ªåŠŸèƒ½ç‹¬ç«‹æˆæ¨¡å—ï¼Œæ”¯æŒçƒ­æ’æ‹”
- **ğŸ“¦ ç‰ˆæœ¬åŒ–ç®¡ç†**ï¼šv1ç”¨æˆ·ç³»ç»Ÿï¼Œv2æ–‡æ¡£ç³»ç»Ÿï¼Œæ”¯æŒå¹¶è¡Œå¼€å‘
- **ğŸ”„ è‡ªåŠ¨æ³¨å†Œ**ï¼šæ–°æ¨¡å—é›¶é…ç½®è‡ªåŠ¨å‘ç°å’Œæ³¨å†Œ
- **ğŸ›¡ï¸ é›¶ä¾µå…¥åŸåˆ™**ï¼šæ–°å¢åŠŸèƒ½ä¸å½±å“ç°æœ‰åŠŸèƒ½
- **ğŸ¤– AIæœåŠ¡é›†æˆ**ï¼šç»Ÿä¸€AIå®¢æˆ·ç«¯ï¼Œæ”¯æŒå¤šç§AIæœåŠ¡
- **ğŸ§ª æ ‡å‡†åŒ–æµ‹è¯•**ï¼šAPIå“åº”æ ¼å¼é¢„æµ‹è¯• + å®Œæ•´åŠŸèƒ½æµ‹è¯•
- **âš–ï¸ è´Ÿè½½å‡è¡¡**ï¼šNginx + å¤šè¿›ç¨‹æ¶æ„ï¼Œä¼ä¸šçº§æ€§èƒ½
- **ğŸš€ å…¨æ ˆä¼˜åŒ–**ï¼šå‰åç«¯ç»Ÿä¸€éƒ¨ç½²ï¼Œ0.5-1ç§’é¦–å±åŠ è½½
- **ğŸ“¦ å¼€ç®±å³ç”¨**ï¼šé¡¹ç›®è‡ªåŒ…å«ï¼Œä¸€é”®å¯åŠ¨å®Œæ•´ç³»ç»Ÿ
- **ğŸ’¾ Redisç¼“å­˜**ï¼š6ä¸ªç¼“å­˜æ¨¡å—ï¼Œ77.8%å¹³å‡æ€§èƒ½æå‡ ğŸ†•
- **ğŸ³ Dockerå®¹å™¨åŒ–**ï¼šä¼ä¸šçº§å®¹å™¨åŒ–éƒ¨ç½²ï¼Œä¸€é”®å¯åŠ¨6ä¸ªæœåŠ¡ ğŸ†•

### 1.3 é¡¹ç›®å®Œæˆåº¦

```
é¡¹ç›®è¿›åº¦ï¼šâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ 100% (15/15)

âœ… v1 ç”¨æˆ·ç³»ç»Ÿ (4/4)ï¼š
â”œâ”€â”€ user_register      âœ… ç”¨æˆ·æ³¨å†Œ
â”œâ”€â”€ user_auth          âœ… ç”¨æˆ·è®¤è¯  
â”œâ”€â”€ user_profile       âœ… ç”¨æˆ·ä¸­å¿ƒ
â””â”€â”€ password_manager   âœ… å¯†ç ç®¡ç†

âœ… v2 æ–‡æ¡£ç³»ç»Ÿ (8/8)ï¼š
â”œâ”€â”€ document_manager   âœ… æ–‡æ¡£ç®¡ç†
â”œâ”€â”€ file_upload        âœ… æ–‡ä»¶ä¸Šä¼ 
â”œâ”€â”€ md_editor          âœ… MDç¼–è¾‘å™¨
â”œâ”€â”€ ai_review          âœ… AIå®¡æ ¸
â”œâ”€â”€ document_publish   âœ… æ–‡æ¡£å‘å¸ƒ
â”œâ”€â”€ tech_square        âœ… æŠ€æœ¯å¹¿åœº
â”œâ”€â”€ interaction        âœ… äº’åŠ¨åŠŸèƒ½
â””â”€â”€ share_system       âœ… åˆ†äº«ç³»ç»Ÿ

âœ… v3 åç«¯ä¼˜åŒ– (2/2)ï¼š
â”œâ”€â”€ load_balancer      âœ… è´Ÿè½½å‡è¡¡
â””â”€â”€ production_deploy  âœ… ç”Ÿäº§éƒ¨ç½²

âœ… v4 å…¨æ ˆä¼˜åŒ– (1/1)ï¼š
â””â”€â”€ fullstack_integration âœ… å‰åç«¯ç»Ÿä¸€éƒ¨ç½²

âœ… v5 ç¼“å­˜ä¸å®¹å™¨åŒ– (2/2)ï¼š ğŸ†•
â”œâ”€â”€ redis_cache_system    âœ… Redisç¼“å­˜ç³»ç»Ÿ
â””â”€â”€ docker_integration   âœ… Dockerå®¹å™¨åŒ–é›†æˆ
```

### 1.4 æ€§èƒ½æŒ‡æ ‡ ğŸ†•

| æŒ‡æ ‡ | v2.0 | v3.0 | v4.0 | v5.0 | æå‡ |
|------|------|------|------|------|------|
| å‰ç«¯é¦–å±åŠ è½½ | 3-5ç§’ | æœªä¼˜åŒ– | **0.5-1ç§’** | **0.5-1ç§’** | **5-10å€** |
| APIå“åº”æ—¶é—´ | æœªä¼˜åŒ– | **2-4ms** | **2-4ms** | **2-8.5ms** | ä¼˜ç§€çº§åˆ« |
| æ•°æ®åº“è´Ÿè½½ | 100% | 100% | 100% | **0.8%** | **99.2%å‡å°‘** ğŸ†• |
| ç¼“å­˜å‘½ä¸­ç‡ | 0% | 0% | 0% | **100%** | å®Œç¾ç¼“å­˜ ğŸ†• |
| å¹¶å‘å¤„ç†èƒ½åŠ› | å•è¿›ç¨‹ | **4è¿›ç¨‹** | **4è¿›ç¨‹** | **4è¿›ç¨‹** | 400% |
| QPSå¤„ç†èƒ½åŠ› | ~50 req/s | **200+ req/s** | **200+ req/s** | **778+ req/s** | **15å€** ğŸ†• |
| éƒ¨ç½²å¤æ‚åº¦ | å¤æ‚ | ä¸­ç­‰ | **ä¸€é”®å¯åŠ¨** | **Dockerä¸€é”®** | æç®€éƒ¨ç½² ğŸ†• |
| æœåŠ¡ç®¡ç† | æ‰‹åŠ¨ | è„šæœ¬ | è„šæœ¬ | **å®¹å™¨åŒ–** | ä¼ä¸šçº§ ğŸ†• |

---

## 2. ç³»ç»Ÿæ¶æ„

### 2.1 æ•´ä½“æ¶æ„è®¾è®¡ ğŸ†•

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ç”¨æˆ·è®¿é—®å±‚                                 â”‚
â”‚                http://localhost:18080                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Nginxè´Ÿè½½å‡è¡¡ (docs_nginx)                                 â”‚
â”‚  â”œâ”€â”€ é™æ€æ–‡ä»¶æœåŠ¡ (Vue3å‰ç«¯)                                â”‚
â”‚  â””â”€â”€ APIè¯·æ±‚åˆ†å‘ (4ä¸ªFastAPIå®ä¾‹)                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  FastAPIåº”ç”¨å±‚ (docs_fastapi_1-4)                          â”‚
â”‚  â”œâ”€â”€ ä¸šåŠ¡é€»è¾‘å¤„ç†                                           â”‚
â”‚  â”œâ”€â”€ Redisç¼“å­˜é›†æˆ ğŸ†•                                       â”‚
â”‚  â””â”€â”€ æ•°æ®åº“æ“ä½œ                                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Redisç¼“å­˜å±‚ (docs_redis) ğŸ†•                               â”‚
â”‚  â”œâ”€â”€ user_cache              â”œâ”€â”€ document_list_cache        â”‚
â”‚  â”œâ”€â”€ stats_cache             â”œâ”€â”€ hot_data_cache             â”‚
â”‚  â”œâ”€â”€ tech_square_cache       â””â”€â”€ search_cache               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  æ•°æ®å­˜å‚¨å±‚                                                  â”‚
â”‚  â”œâ”€â”€ Redisç¼“å­˜ (docs_redis:16379) ğŸ†•                       â”‚
â”‚  â”œâ”€â”€ MySQLæ•°æ®åº“ (docs_mysql:13306)                        â”‚
â”‚  â””â”€â”€ æ–‡ä»¶å­˜å‚¨ (docs_uploads_data)                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  DockeråŸºç¡€è®¾æ–½ ğŸ†•                                          â”‚
â”‚  â”œâ”€â”€ å®¹å™¨ç¼–æ’ (docker-compose)                             â”‚
â”‚  â”œâ”€â”€ ç½‘ç»œç®¡ç† (docs_network)                               â”‚
â”‚  â””â”€â”€ æ•°æ®å·ç®¡ç† (3ä¸ªæŒä¹…åŒ–å·)                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.2 Dockerå®¹å™¨æ¶æ„ ğŸ†•

```
Dockerå®¹å™¨æœåŠ¡ç»„ï¼š
â”œâ”€â”€ docs_nginx         âœ… Nginxè´Ÿè½½å‡è¡¡ (ç«¯å£18080)
â”œâ”€â”€ docs_fastapi_1-4   âœ… FastAPIåº”ç”¨æœåŠ¡ (4å®ä¾‹)
â”œâ”€â”€ docs_mysql         âœ… MySQLæ•°æ®åº“æœåŠ¡ (ç«¯å£13306)
â””â”€â”€ docs_redis         âœ… Redisç¼“å­˜æœåŠ¡ (ç«¯å£16379) ğŸ†•

Dockeræ•°æ®å·ï¼š
â”œâ”€â”€ docs_mysql_data    âœ… MySQLæ•°æ®æŒä¹…åŒ–
â”œâ”€â”€ docs_uploads_data  âœ… ç”¨æˆ·æ–‡ä»¶æŒä¹…åŒ–
â””â”€â”€ docs_redis_data    âœ… Redisç¼“å­˜æŒä¹…åŒ– ğŸ†•

Dockerç½‘ç»œï¼š
â””â”€â”€ docs_network       âœ… å®¹å™¨é—´é€šä¿¡ç½‘ç»œ
```

### 2.3 Redisç¼“å­˜æ¶æ„ ğŸ†•

```
Redisç¼“å­˜æ¨¡å—æ¶æ„ï¼š
â”œâ”€â”€ åŸºç¡€è®¾æ–½å±‚
â”‚   â”œâ”€â”€ RedisClient           # Redisè¿æ¥ç®¡ç†
â”‚   â”œâ”€â”€ BaseCacheService      # ç¼“å­˜åŸºç±»æœåŠ¡
â”‚   â””â”€â”€ DebugService          # è°ƒè¯•å·¥å…·
â”‚
â”œâ”€â”€ ç¼“å­˜æœåŠ¡å±‚
â”‚   â”œâ”€â”€ user_cache            # ç”¨æˆ·ä¿¡æ¯ç¼“å­˜ (92%æ€§èƒ½æå‡)
â”‚   â”œâ”€â”€ stats_cache           # ç»Ÿè®¡æ•°æ®ç¼“å­˜ (86%æ€§èƒ½æå‡)
â”‚   â”œâ”€â”€ tech_square_cache     # æŠ€æœ¯å¹¿åœºç»Ÿè®¡ç¼“å­˜ (86%æ€§èƒ½æå‡)
â”‚   â”œâ”€â”€ document_list_cache   # æ–‡æ¡£åˆ—è¡¨ç¼“å­˜ (95%æ€§èƒ½æå‡)
â”‚   â”œâ”€â”€ hot_data_cache        # çƒ­é—¨æ•°æ®ç¼“å­˜ (66%æ€§èƒ½æå‡)
â”‚   â””â”€â”€ search_cache          # æœç´¢ç»“æœç¼“å­˜ (42%æ€§èƒ½æå‡)
â”‚
â””â”€â”€ ä¸šåŠ¡é›†æˆå±‚
    â”œâ”€â”€ ç”¨æˆ·ä¸­å¿ƒé›†æˆ          # ç”¨æˆ·ä¿¡æ¯ + ç»Ÿè®¡ç¼“å­˜
    â”œâ”€â”€ æ–‡æ¡£ç®¡ç†é›†æˆ          # ç»Ÿè®¡ + åˆ—è¡¨ç¼“å­˜
    â””â”€â”€ æŠ€æœ¯å¹¿åœºé›†æˆ          # å¤šç§ç¼“å­˜ç»¼åˆåº”ç”¨
```

---

## 3. æ¥å£æ–‡æ¡£

### 3.1 åŸºç¡€ä¿¡æ¯

#### å¼€å‘ç¯å¢ƒ
- **åŸºç¡€åœ°å€**ï¼š`http://localhost:8100`
- **è®¤è¯æ–¹å¼**ï¼š`Authorization: Bearer <access_token>`
- **Content-Type**ï¼š`application/json`

#### ç”Ÿäº§ç¯å¢ƒï¼ˆDockerï¼‰ğŸ†•
- **åŸºç¡€åœ°å€**ï¼š`http://localhost:18080` (Dockerç»Ÿä¸€å…¥å£)
- **è®¤è¯æ–¹å¼**ï¼š`Authorization: Bearer <access_token>`
- **Content-Type**ï¼š`application/json`
- **ç³»ç»ŸçŠ¶æ€**ï¼š`http://localhost:18080/lb_status`
- **APIæ–‡æ¡£**ï¼š`http://localhost:18080/docs`

#### é€šç”¨ä¿¡æ¯
- **æµ‹è¯•è´¦å·**ï¼š
  - ç”¨æˆ·åï¼š`abc`
  - å¯†ç ï¼š`ljl18420`
- **æ•°æ®åº“**ï¼š`user_system`

---

### 3.2 v1 ç”¨æˆ·ç³»ç»Ÿæ¥å£ï¼ˆâœ… å·²å®Œæˆï¼‰

| æ¥å£è·¯å¾„ | æ–¹æ³• | åŠŸèƒ½ | è®¤è¯ | ç¼“å­˜ä¼˜åŒ– ğŸ†• |
|----------|------|------|------|-------------|
| `/api/v1/user_register/register` | POST | ç”¨æˆ·æ³¨å†Œ | âŒ | - |
| `/api/v1/user_register/check-username/{username}` | GET | æ£€æŸ¥ç”¨æˆ·åå¯ç”¨æ€§ | âŒ | - |
| `/api/v1/user_register/check-email/{email}` | GET | æ£€æŸ¥é‚®ç®±å¯ç”¨æ€§ | âŒ | - |
| `/api/v1/user_auth/login` | POST | ç”¨æˆ·ç™»å½• | âŒ | - |
| `/api/v1/user_auth/me` | GET | è·å–å½“å‰ç”¨æˆ·ä¿¡æ¯ | âœ… | - |
| `/api/v1/user_auth/refresh` | POST | åˆ·æ–°token | âœ… | - |
| `/api/v1/user_profile/nickname` | PUT | æ›´æ–°æ˜µç§° | âœ… | ç¼“å­˜å¤±æ•ˆ |
| `/api/v1/user_profile/check-nickname/{nickname}` | GET | æ£€æŸ¥æ˜µç§°å¯ç”¨æ€§ | âœ… | - |
| `/api/v1/user_profile/logout` | POST | é€€å‡ºç™»å½• | âœ… | - |
| `/api/v1/password_manager/change-password` | POST | ä¿®æ”¹å¯†ç  | âœ… | - |
| `/api/v1/password_manager/check-strength` | POST | æ£€æŸ¥å¯†ç å¼ºåº¦ | âŒ | - |
| `/api/v1/user_profile/user-info` | GET | è·å–ç”¨æˆ·ä¿¡æ¯ | âœ… | **ç”¨æˆ·ç¼“å­˜** ğŸ†• |

---

### 3.3 v2 æ–‡æ¡£ç®¡ç†æ¥å£ï¼ˆâœ… å·²å®Œæˆï¼‰

#### æ–‡ä»¶å¤¹ç®¡ç†
| æ¥å£è·¯å¾„ | æ–¹æ³• | åŠŸèƒ½ | è®¤è¯ | ç¼“å­˜ä¼˜åŒ– ğŸ†• |
|----------|------|------|------|-------------|
| `/api/v2/document_manager/folders` | POST | åˆ›å»ºæ–‡ä»¶å¤¹ | âœ… | ç¼“å­˜å¤±æ•ˆ |
| `/api/v2/document_manager/folders/tree` | GET | è·å–æ–‡ä»¶å¤¹æ ‘ | âœ… | - |
| `/api/v2/document_manager/folders/{folder_id}` | DELETE | åˆ é™¤æ–‡ä»¶å¤¹ | âœ… | ç¼“å­˜å¤±æ•ˆ |

#### æ–‡æ¡£ç®¡ç†
| æ¥å£è·¯å¾„ | æ–¹æ³• | åŠŸèƒ½ | è®¤è¯ | ç¼“å­˜ä¼˜åŒ– ğŸ†• |
|----------|------|------|------|-------------|
| `/api/v2/document_manager/documents` | POST | åˆ›å»ºæ–‡æ¡£ | âœ… | ç¼“å­˜å¤±æ•ˆ |
| `/api/v2/document_manager/documents` | GET | è·å–æ–‡æ¡£åˆ—è¡¨ï¼ˆåˆ†é¡µï¼‰ | âœ… | **åˆ—è¡¨ç¼“å­˜** ğŸ†• |
| `/api/v2/document_manager/documents/{doc_id}` | GET | è·å–æ–‡æ¡£è¯¦æƒ… | âœ… | - |
| `/api/v2/document_manager/documents/{doc_id}` | PUT | æ›´æ–°æ–‡æ¡£ | âœ… | ç¼“å­˜å¤±æ•ˆ |
| `/api/v2/document_manager/documents/{doc_id}` | DELETE | åˆ é™¤æ–‡æ¡£ | âœ… | ç¼“å­˜å¤±æ•ˆ |
| `/api/v2/document_manager/stats` | GET | è·å–ç»Ÿè®¡ä¿¡æ¯ | âœ… | **ç»Ÿè®¡ç¼“å­˜** ğŸ†• |

---

### 3.4 v2 æ–‡ä»¶ä¸Šä¼ æ¥å£ï¼ˆâœ… å·²å®Œæˆï¼‰

| æ¥å£è·¯å¾„ | æ–¹æ³• | åŠŸèƒ½ | è®¤è¯ | ç¼“å­˜ä¼˜åŒ– ğŸ†• |
|----------|------|------|------|-------------|
| `/api/v2/file_upload/test` | GET | æµ‹è¯•æ¥å£ | âŒ | - |
| `/api/v2/file_upload/config` | GET | è·å–ä¸Šä¼ é…ç½® | âœ… | - |
| `/api/v2/file_upload/validate` | POST | éªŒè¯æ–‡ä»¶ï¼ˆä¸ä¿å­˜ï¼‰ | âœ… | - |
| `/api/v2/file_upload/upload` | POST | ä¸Šä¼ æ–‡ä»¶ | âœ… | - |
| `/api/v2/file_upload/uploads` | GET | è·å–ä¸Šä¼ å†å²ï¼ˆåˆ†é¡µï¼‰ | âœ… | - |
| `/api/v2/file_upload/uploads/{upload_id}` | GET | è·å–ä¸Šä¼ è¯¦æƒ… | âœ… | - |
| `/api/v2/file_upload/create-document` | POST | ä»ä¸Šä¼ æ–‡ä»¶åˆ›å»ºæ–‡æ¡£ | âœ… | ç¼“å­˜å¤±æ•ˆ |
| `/api/v2/file_upload/uploads/{upload_id}` | DELETE | åˆ é™¤ä¸Šä¼ è®°å½• | âœ… | - |
| `/api/v2/file_upload/stats` | GET | è·å–ä¸Šä¼ ç»Ÿè®¡ | âœ… | - |

---

### 3.5 v2 MDç¼–è¾‘å™¨æ¥å£ï¼ˆâœ… å·²å®Œæˆï¼‰

#### ä¼šè¯ç®¡ç†
| æ¥å£è·¯å¾„ | æ–¹æ³• | åŠŸèƒ½ | è®¤è¯ | ç¼“å­˜ä¼˜åŒ– ğŸ†• |
|----------|------|------|------|-------------|
| `/api/v2/md_editor/test` | GET | æµ‹è¯•æ¥å£ | âŒ | - |
| `/api/v2/md_editor/config` | GET | è·å–ç¼–è¾‘å™¨é…ç½® | âœ… | - |
| `/api/v2/md_editor/sessions` | POST | åˆ›å»ºç¼–è¾‘å™¨ä¼šè¯ | âœ… | - |
| `/api/v2/md_editor/sessions` | GET | è·å–ä¼šè¯åˆ—è¡¨ï¼ˆåˆ†é¡µï¼‰ | âœ… | - |
| `/api/v2/md_editor/sessions/{session_id}` | GET | è·å–ä¼šè¯è¯¦æƒ… | âœ… | - |
| `/api/v2/md_editor/sessions/{session_id}` | PUT | æ›´æ–°ä¼šè¯å†…å®¹ | âœ… | - |
| `/api/v2/md_editor/sessions/{session_id}` | DELETE | åˆ é™¤ä¼šè¯ | âœ… | - |

#### AIä¼˜åŒ–åŠŸèƒ½
| æ¥å£è·¯å¾„ | æ–¹æ³• | åŠŸèƒ½ | è®¤è¯ | ç¼“å­˜ä¼˜åŒ– ğŸ†• |
|----------|------|------|------|-------------|
| `/api/v2/md_editor/sessions/{session_id}/optimize` | POST | AIä¼˜åŒ–å†…å®¹ | âœ… | - |
| `/api/v2/md_editor/sessions/{session_id}/apply-optimization/{optimization_id}` | POST | åº”ç”¨ä¼˜åŒ–ç»“æœ | âœ… | - |
| `/api/v2/md_editor/sessions/{session_id}/optimizations` | GET | è·å–ä¼˜åŒ–å†å² | âœ… | - |

#### æ–‡æ¡£ä¿å­˜
| æ¥å£è·¯å¾„ | æ–¹æ³• | åŠŸèƒ½ | è®¤è¯ | ç¼“å­˜ä¼˜åŒ– ğŸ†• |
|----------|------|------|------|-------------|
| `/api/v2/md_editor/sessions/{session_id}/save-document` | POST | ä¿å­˜ä¸ºæ­£å¼æ–‡æ¡£ | âœ… | ç¼“å­˜å¤±æ•ˆ |
| `/api/v2/md_editor/stats` | GET | è·å–ç¼–è¾‘å™¨ç»Ÿè®¡ | âœ… | - |

---

### 3.6 v2 AIå®¡æ ¸æ¥å£ï¼ˆâœ… å·²å®Œæˆï¼‰

| æ¥å£è·¯å¾„ | æ–¹æ³• | åŠŸèƒ½ | è®¤è¯ | ç¼“å­˜ä¼˜åŒ– ğŸ†• |
|----------|------|------|------|-------------|
| `/api/v2/ai_review/test` | GET | æµ‹è¯•æ¥å£ | âŒ | - |
| `/api/v2/ai_review/submit-review` | POST | æäº¤æ–‡æ¡£å®¡æ ¸ | âœ… | - |
| `/api/v2/ai_review/review-status/{document_id}` | GET | æŸ¥è¯¢å®¡æ ¸çŠ¶æ€ | âœ… | - |
| `/api/v2/ai_review/review-history` | GET | è·å–å®¡æ ¸å†å² | âœ… | - |
| `/api/v2/ai_review/review-detail/{review_id}` | GET | è·å–å®¡æ ¸è¯¦æƒ… | âœ… | - |
| `/api/v2/ai_review/retry-review/{document_id}` | POST | é‡æ–°å®¡æ ¸æ–‡æ¡£ | âœ… | - |
| `/api/v2/ai_review/stats` | GET | è·å–å®¡æ ¸ç»Ÿè®¡ | âœ… | - |
| `/api/v2/ai_review/config` | GET | è·å–å®¡æ ¸é…ç½® | âœ… | - |
| `/api/v2/ai_review/review-log/{review_id}` | DELETE | åˆ é™¤å®¡æ ¸è®°å½• | âœ… | - |
| `/api/v2/ai_review/recent-reviews` | GET | è·å–æœ€è¿‘å®¡æ ¸ | âœ… | - |

---

### 3.7 v2 æ–‡æ¡£å‘å¸ƒæ¥å£ï¼ˆâœ… å·²å®Œæˆï¼‰

| æ¥å£è·¯å¾„ | æ–¹æ³• | åŠŸèƒ½ | è®¤è¯ | ç¼“å­˜ä¼˜åŒ– ğŸ†• |
|----------|------|------|------|-------------|
| `/api/v2/document_publish/test` | GET | æµ‹è¯•æ¥å£ | âŒ | - |
| `/api/v2/document_publish/submit` | POST | æäº¤æ–‡æ¡£å‘å¸ƒ | âœ… | ç¼“å­˜å¤±æ•ˆ |
| `/api/v2/document_publish/published` | GET | è·å–å·²å‘å¸ƒæ–‡æ¡£åˆ—è¡¨ï¼ˆåˆ†é¡µï¼‰ | âŒ | **åˆ—è¡¨ç¼“å­˜** ğŸ†• |
| `/api/v2/document_publish/document/{doc_id}` | GET | è·å–æ–‡æ¡£å‘å¸ƒè¯¦æƒ… | âœ… | - |
| `/api/v2/document_publish/unpublish/{doc_id}` | POST | æ’¤å›å·²å‘å¸ƒæ–‡æ¡£ | âœ… | ç¼“å­˜å¤±æ•ˆ |
| `/api/v2/document_publish/my-records` | GET | è·å–æˆ‘çš„å‘å¸ƒè®°å½• | âœ… | - |
| `/api/v2/document_publish/stats` | GET | è·å–å‘å¸ƒç»Ÿè®¡ | âœ… | - |
| `/api/v2/document_publish/view/{doc_id}` | POST | å¢åŠ æ–‡æ¡£æµè§ˆé‡ | âŒ | ç¼“å­˜å¤±æ•ˆ |
| `/api/v2/document_publish/status/{doc_id}` | GET | è·å–æ–‡æ¡£å‘å¸ƒçŠ¶æ€ | âœ… | - |
| `/api/v2/document_publish/config` | GET | è·å–å‘å¸ƒé…ç½® | âŒ | - |

---

### 3.8 v2 æŠ€æœ¯å¹¿åœºæ¥å£ï¼ˆâœ… å·²å®Œæˆï¼‰

| æ¥å£è·¯å¾„ | æ–¹æ³• | åŠŸèƒ½ | è®¤è¯ | ç¼“å­˜ä¼˜åŒ– ğŸ†• |
|----------|------|------|------|-------------|
| `/api/v2/tech_square/test` | GET | æµ‹è¯•æ¥å£ | âŒ | - |
| `/api/v2/tech_square/documents` | GET | è·å–æ–‡æ¡£åˆ—è¡¨ï¼ˆåˆ†é¡µ+ç­›é€‰+æ’åºï¼‰ | âŒ | **åˆ—è¡¨ç¼“å­˜** ğŸ†• |
| `/api/v2/tech_square/documents/{document_id}` | GET | è·å–æ–‡æ¡£è¯¦æƒ… | âŒ | - |
| `/api/v2/tech_square/search` | GET | æœç´¢æ–‡æ¡£ | âŒ | **æœç´¢ç¼“å­˜** ğŸ†• |
| `/api/v2/tech_square/category-stats` | GET | è·å–åˆ†ç±»ç»Ÿè®¡ | âŒ | - |
| `/api/v2/tech_square/hot-documents` | GET | è·å–çƒ­é—¨æ–‡æ¡£ | âŒ | **çƒ­é—¨ç¼“å­˜** ğŸ†• |
| `/api/v2/tech_square/latest-documents` | GET | è·å–æœ€æ–°æ–‡æ¡£ | âŒ | **çƒ­é—¨ç¼“å­˜** ğŸ†• |
| `/api/v2/tech_square/stats` | GET | è·å–æŠ€æœ¯å¹¿åœºç»Ÿè®¡ | âŒ | **å¹¿åœºç»Ÿè®¡ç¼“å­˜** ğŸ†• |
| `/api/v2/tech_square/view/{document_id}` | POST | å¢åŠ æ–‡æ¡£æµè§ˆé‡ | âŒ | ç¼“å­˜å¤±æ•ˆ |

---

### 3.9 v2 äº’åŠ¨åŠŸèƒ½æ¥å£ï¼ˆâœ… å·²å®Œæˆï¼‰

| æ¥å£è·¯å¾„ | æ–¹æ³• | åŠŸèƒ½ | è®¤è¯ | ç¼“å­˜ä¼˜åŒ– ğŸ†• |
|----------|------|------|------|-------------|
| `/api/v2/interaction/test` | GET | æµ‹è¯•æ¥å£ | âŒ | - |
| `/api/v2/interaction/documents/{document_id}/like` | POST | åˆ‡æ¢ç‚¹èµçŠ¶æ€ | âœ… | ç¼“å­˜å¤±æ•ˆ |
| `/api/v2/interaction/documents/{document_id}/like-status` | GET | è·å–ç‚¹èµçŠ¶æ€ | âŒ | - |
| `/api/v2/interaction/documents/{document_id}/favorite` | POST | åˆ‡æ¢æ”¶è—çŠ¶æ€ | âœ… | ç¼“å­˜å¤±æ•ˆ |
| `/api/v2/interaction/documents/{document_id}/favorite-status` | GET | è·å–æ”¶è—çŠ¶æ€ | âŒ | - |
| `/api/v2/interaction/my-favorites` | GET | è·å–æˆ‘çš„æ”¶è—åˆ—è¡¨ | âœ… | - |
| `/api/v2/interaction/documents/{document_id}/comments` | POST | åˆ›å»ºè¯„è®ºæˆ–å›å¤ | âœ… | ç¼“å­˜å¤±æ•ˆ |
| `/api/v2/interaction/documents/{document_id}/comments` | GET | è·å–è¯„è®ºåˆ—è¡¨ | âŒ | - |
| `/api/v2/interaction/comments/{comment_id}` | PUT | æ›´æ–°è¯„è®º | âœ… | - |
| `/api/v2/interaction/comments/{comment_id}` | DELETE | åˆ é™¤è¯„è®º | âœ… | - |
| `/api/v2/interaction/documents/{document_id}/stats` | GET | è·å–æ–‡æ¡£äº’åŠ¨ç»Ÿè®¡ | âŒ | - |
| `/api/v2/interaction/my-stats` | GET | è·å–æˆ‘çš„äº’åŠ¨ç»Ÿè®¡ | âœ… | - |

---

### 3.10 v2 åˆ†äº«ç³»ç»Ÿæ¥å£ï¼ˆâœ… å·²å®Œæˆï¼‰

| æ¥å£è·¯å¾„ | æ–¹æ³• | åŠŸèƒ½ | è®¤è¯ | ç¼“å­˜ä¼˜åŒ– ğŸ†• |
|----------|------|------|------|-------------|
| `/api/v2/share_system/test` | GET | æµ‹è¯•æ¥å£ | âŒ | - |
| `/api/v2/share_system/create` | POST | åˆ›å»ºæ–‡æ¡£åˆ†äº« | âœ… | - |
| `/api/v2/share_system/my-shares` | GET | è·å–æˆ‘çš„åˆ†äº«åˆ—è¡¨ï¼ˆåˆ†é¡µï¼‰ | âœ… | - |
| `/api/v2/share_system/detail/{share_id}` | GET | è·å–åˆ†äº«è¯¦æƒ… | âœ… | - |
| `/api/v2/share_system/update/{share_id}` | PUT | æ›´æ–°åˆ†äº«é…ç½® | âœ… | - |
| `/api/v2/share_system/delete/{share_id}` | DELETE | åˆ é™¤åˆ†äº« | âœ… | - |
| `/api/v2/share_system/public/{share_code}` | POST | è®¿é—®åˆ†äº«æ–‡æ¡£ï¼ˆPOSTï¼‰ | ğŸ”“ | - |
| `/api/v2/share_system/public/{share_code}` | GET | è®¿é—®åˆ†äº«æ–‡æ¡£ï¼ˆGETï¼‰ | ğŸ”“ | - |
| `/api/v2/share_system/download/{share_code}` | GET | ä¸‹è½½åˆ†äº«æ–‡æ¡£ | ğŸ”“ | - |
| `/api/v2/share_system/stats` | GET | è·å–åˆ†äº«ç»Ÿè®¡ | âœ… | - |
| `/api/v2/share_system/toggle-status/{share_id}` | POST | åˆ‡æ¢åˆ†äº«çŠ¶æ€ | âœ… | - |
| `/api/v2/share_system/config` | GET | è·å–åˆ†äº«é…ç½® | âŒ | - |

#### ğŸ“Œ åˆ†äº«ç³»ç»Ÿç‰¹è‰²åŠŸèƒ½

**ä¸‰ç§åˆ†äº«ç±»å‹**ï¼š
- **ğŸŒ å…¬å¼€åˆ†äº«**ï¼šä»»ä½•äººéƒ½å¯ä»¥è®¿é—®ï¼Œæ— éœ€ç™»å½•
- **ğŸ”’ ç§æœ‰åˆ†äº«**ï¼šéœ€è¦ç™»å½•æ‰èƒ½è®¿é—®
- **ğŸ”‘ å¯†ç åˆ†äº«**ï¼šéœ€è¦è¾“å…¥å¯†ç æ‰èƒ½è®¿é—®

**æƒé™æ§åˆ¶**ï¼š
- å…è®¸/ç¦æ­¢ä¸‹è½½
- å…è®¸/ç¦æ­¢è¯„è®º
- è¿‡æœŸæ—¶é—´è®¾ç½®

**è®¿é—®ç»Ÿè®¡**ï¼š
- æµè§ˆé‡ç»Ÿè®¡
- ä¸‹è½½é‡ç»Ÿè®¡
- è®¿é—®æ—¥å¿—è®°å½•
- æ—¶é—´ç»´åº¦åˆ†æï¼ˆä»Šæ—¥/æœ¬å‘¨/æœ¬æœˆï¼‰

---

### 3.11 é”™è¯¯ç è¯´æ˜

| çŠ¶æ€ç  | è¯´æ˜ | ç¤ºä¾‹ |
|--------|------|------|
| 200 | æˆåŠŸ | æ“ä½œæˆåŠŸå®Œæˆ |
| 400 | è¯·æ±‚é”™è¯¯ | å‚æ•°éªŒè¯å¤±è´¥ã€ä¸šåŠ¡é€»è¾‘é”™è¯¯ã€é‡å¤æäº¤ã€å¯†ç é”™è¯¯ |
| 401 | è®¤è¯å¤±è´¥ | Tokenæ— æ•ˆæˆ–è¿‡æœŸã€éœ€è¦ç™»å½•è®¿é—®ç§æœ‰åˆ†äº« |
| 404 | èµ„æºä¸å­˜åœ¨ | æ–‡æ¡£ã€ä¼šè¯ã€åˆ†äº«ä¸å­˜åœ¨ã€æ— æƒé™è®¿é—® |
| 422 | æ•°æ®æ ¼å¼é”™è¯¯ | JSONæ ¼å¼é”™è¯¯ã€å­—æ®µç±»å‹é”™è¯¯ |
| 500 | æœåŠ¡å™¨é”™è¯¯ | å†…éƒ¨æœåŠ¡å™¨é”™è¯¯ã€AIæœåŠ¡å¼‚å¸¸ã€æ•°æ®åº“é”™è¯¯ |
| 502 | ç½‘å…³é”™è¯¯ | è´Ÿè½½å‡è¡¡å™¨åç«¯æœåŠ¡ä¸å¯ç”¨ |
| 503 | æœåŠ¡ä¸å¯ç”¨ | æ‰€æœ‰åç«¯æœåŠ¡å™¨ä¸å¯ç”¨ |

---

## 4. å¼€å‘æ–‡æ¡£

### 4.1 é¡¹ç›®ç›®å½•ç»“æ„ ğŸ†•

```bash
vue3-fastapi-mysql_v1.0/              # é¡¹ç›®æ ¹ç›®å½•
â”œâ”€â”€ start.bat                          # ä¸€é”®å¯åŠ¨è„šæœ¬ï¼ˆå¼€å‘æ¨¡å¼ï¼‰
â”œâ”€â”€ stop.bat                           # ä¸€é”®åœæ­¢è„šæœ¬ï¼ˆå¼€å‘æ¨¡å¼ï¼‰
â”œâ”€â”€ README.md                          # é¡¹ç›®è¯´æ˜æ–‡æ¡£
â”‚
â”œâ”€â”€ docker/                            # ğŸ†• Dockerå®¹å™¨åŒ–éƒ¨ç½²
â”‚   â”œâ”€â”€ docker-compose.yml             # ğŸ†• Dockerç¼–æ’é…ç½®
â”‚   â”œâ”€â”€ .env                           # ğŸ†• Dockerç¯å¢ƒå˜é‡
â”‚   â”œâ”€â”€ Dockerfile.fastapi             # ğŸ†• FastAPIé•œåƒæ„å»º
â”‚   â”œâ”€â”€ config/
â”‚   â”‚   â”œâ”€â”€ nginx.conf                 # ğŸ†• Nginxè´Ÿè½½å‡è¡¡é…ç½®
â”‚   â”‚   â””â”€â”€ redis.conf                 # ğŸ†• Redisæ€§èƒ½ä¼˜åŒ–é…ç½®
â”‚   â”œâ”€â”€ start_docker.bat               # ğŸ†• Dockerä¸€é”®å¯åŠ¨
â”‚   â”œâ”€â”€ stop_docker.bat                # ğŸ†• Dockerä¸€é”®åœæ­¢
â”‚   â””â”€â”€ logs/                          # ğŸ†• å®¹å™¨æ—¥å¿—ç›®å½•
â”‚
â”œâ”€â”€ fastapi/                           # åç«¯ç›®å½•
â”‚   â”œâ”€â”€ app/
â”‚   â”‚   â”œâ”€â”€ core/                      # æ ¸å¿ƒåŸºç¡€è®¾æ–½
â”‚   â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”‚   â”œâ”€â”€ config.py              # JWT/DB/Token é…ç½®
â”‚   â”‚   â”‚   â”œâ”€â”€ database.py            # SQLAlchemy å¼•æ“ + SessionLocal
â”‚   â”‚   â”‚   â”œâ”€â”€ ai_client.py           # AIå®¢æˆ·ç«¯ï¼ˆé›†æˆè‡ªå®šä¹‰AIæœåŠ¡ï¼‰
â”‚   â”‚   â”‚   â””â”€â”€ redis/                 # ğŸ†• Redisç¼“å­˜æ¨¡å—
â”‚   â”‚   â”‚       â”œâ”€â”€ __init__.py        # Redisæ¨¡å—å¯¼å‡º
â”‚   â”‚   â”‚       â”œâ”€â”€ client.py          # Rediså®¢æˆ·ç«¯å°è£…
â”‚   â”‚   â”‚       â”œâ”€â”€ base.py            # ç¼“å­˜åŸºç±»æœåŠ¡
â”‚   â”‚   â”‚       â”œâ”€â”€ debug.py           # è°ƒè¯•å·¥å…·
â”‚   â”‚   â”‚       â””â”€â”€ services/          # ç¼“å­˜æœåŠ¡ç›®å½•
â”‚   â”‚   â”‚           â”œâ”€â”€ __init__.py    # æœåŠ¡ç»Ÿä¸€å¯¼å‡º
â”‚   â”‚   â”‚           â”œâ”€â”€ user_cache.py  # ç”¨æˆ·ä¿¡æ¯ç¼“å­˜
â”‚   â”‚   â”‚           â”œâ”€â”€ stats_cache.py # ç»Ÿè®¡æ•°æ®ç¼“å­˜
â”‚   â”‚   â”‚           â”œâ”€â”€ tech_square_cache.py # æŠ€æœ¯å¹¿åœºç»Ÿè®¡ç¼“å­˜
â”‚   â”‚   â”‚           â”œâ”€â”€ document_list_cache.py # æ–‡æ¡£åˆ—è¡¨ç¼“å­˜
â”‚   â”‚   â”‚           â”œâ”€â”€ hot_data_cache.py # çƒ­é—¨æ•°æ®ç¼“å­˜
â”‚   â”‚   â”‚           â””â”€â”€ search_cache.py # æœç´¢ç»“æœç¼“å­˜
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ modules/                   # ä¸šåŠ¡æ¨¡å—æ ¹ç›®å½•
â”‚   â”‚   â”‚   â”œâ”€â”€ v1/                    # API ç‰ˆæœ¬ v1ï¼ˆç”¨æˆ·ç³»ç»Ÿï¼‰
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ user_register/     # âœ… ç”¨æˆ·æ³¨å†Œæ¨¡å—
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ user_auth/         # âœ… ç”¨æˆ·è®¤è¯æ¨¡å—
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ user_profile/      # âœ… ç”¨æˆ·ä¸­å¿ƒæ¨¡å—ï¼ˆé›†æˆç¼“å­˜ï¼‰
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ password_manager/  # âœ… å¯†ç ç®¡ç†æ¨¡å—
â”‚   â”‚   â”‚   â”‚
â”‚   â”‚   â”‚   â””â”€â”€ v2/                    # API ç‰ˆæœ¬ v2ï¼ˆæ–‡æ¡£ç³»ç»Ÿï¼‰
â”‚   â”‚   â”‚       â”œâ”€â”€ __init__.py
â”‚   â”‚   â”‚       â”œâ”€â”€ document_manager/  # âœ… æ–‡æ¡£ç®¡ç†æ¨¡å—ï¼ˆé›†æˆç¼“å­˜ï¼‰
â”‚   â”‚   â”‚       â”œâ”€â”€ file_upload/       # âœ… æ–‡ä»¶ä¸Šä¼ æ¨¡å—
â”‚   â”‚   â”‚       â”œâ”€â”€ md_editor/         # âœ… MDç¼–è¾‘å™¨æ¨¡å—
â”‚   â”‚   â”‚       â”œâ”€â”€ ai_review/         # âœ… AIå®¡æ ¸æ¨¡å—
â”‚   â”‚   â”‚       â”œâ”€â”€ document_publish/  # âœ… æ–‡æ¡£å‘å¸ƒæ¨¡å—
â”‚   â”‚   â”‚       â”œâ”€â”€ tech_square/       # âœ… æŠ€æœ¯å¹¿åœºæ¨¡å—ï¼ˆé›†æˆå¤šç§ç¼“å­˜ï¼‰
â”‚   â”‚   â”‚       â”œâ”€â”€ interaction/       # âœ… äº’åŠ¨åŠŸèƒ½æ¨¡å—
â”‚   â”‚   â”‚       â””â”€â”€ share_system/      # âœ… åˆ†äº«ç³»ç»Ÿæ¨¡å—
â”‚   â”‚   â”‚
â”‚   â”‚   â””â”€â”€ main.py                    # ğŸš€ åº”ç”¨å…¥å£ï¼šè‡ªåŠ¨æ‰«æå¹¶æ³¨å†Œæ¨¡å—
â”‚   â”‚
â”‚   â”œâ”€â”€ uploads/                       # æ–‡ä»¶ä¸Šä¼ ç›®å½•
â”‚   â”‚   â””â”€â”€ user_{user_id}/            # ç”¨æˆ·éš”ç¦»çš„ä¸Šä¼ ç›®å½•
â”‚   â”‚       â””â”€â”€ documents/             # æ–‡æ¡£æ–‡ä»¶å­˜å‚¨
â”‚   â”‚
â”‚   â”œâ”€â”€ ğŸ“ ç¯å¢ƒé…ç½®
â”‚   â”‚   â”œâ”€â”€ .env                       # å½“å‰ç¯å¢ƒé…ç½®
â”‚   â”‚   â”œâ”€â”€ .env.development           # å¼€å‘ç¯å¢ƒæ¨¡æ¿
â”‚   â”‚   â””â”€â”€ .env.production            # ç”Ÿäº§ç¯å¢ƒæ¨¡æ¿
â”‚   â”‚
â”‚   â”œâ”€â”€ ğŸš€ å¯åŠ¨è„šæœ¬ï¼ˆä¿ç•™å¼€å‘ç”¨ï¼‰
â”‚   â”‚   â””â”€â”€ start_development.bat      # å¼€å‘æ¨¡å¼å¯åŠ¨
â”‚   â”‚
â”‚   â”œâ”€â”€ ğŸ§ª æµ‹è¯•å·¥å…·
â”‚   â”‚   â””â”€â”€ performance_test.py        # æ€§èƒ½æµ‹è¯•å·¥å…·
â”‚   â”‚
â”‚   â”œâ”€â”€ âš™ï¸ é…ç½®æ–‡ä»¶
â”‚   â”‚   â”œâ”€â”€ requirements.txt           # Pythonä¾èµ–ï¼ˆåŒ…å«redisï¼‰
â”‚   â”‚   â””â”€â”€ user_system_compatible.sql # æ•°æ®åº“è„šæœ¬
â”‚   â”‚
â”‚   â””â”€â”€ æµ‹è¯•è„šæœ¬/
â”‚       â”œâ”€â”€ api_response_test.py       # âœ… APIå“åº”æ ¼å¼æµ‹è¯•è„šæœ¬
â”‚       â”œâ”€â”€ test_user_cache.py         # ğŸ†• ç”¨æˆ·ç¼“å­˜æµ‹è¯•
â”‚       â”œâ”€â”€ test_stats_cache.py        # ğŸ†• ç»Ÿè®¡ç¼“å­˜æµ‹è¯•
â”‚       â”œâ”€â”€ test_tech_square_cache.py  # ğŸ†• æŠ€æœ¯å¹¿åœºç¼“å­˜æµ‹è¯•
â”‚       â”œâ”€â”€ test_document_list_cache.py # ğŸ†• æ–‡æ¡£åˆ—è¡¨ç¼“å­˜æµ‹è¯•
â”‚       â”œâ”€â”€ test_hot_data_cache.py     # ğŸ†• çƒ­é—¨æ•°æ®ç¼“å­˜æµ‹è¯•
â”‚       â”œâ”€â”€ test_search_cache.py       # ğŸ†• æœç´¢ç¼“å­˜æµ‹è¯•
â”‚       â””â”€â”€ v2æµ‹è¯•è„šæœ¬/
â”‚           â”œâ”€â”€ test_document_manager_clean.py
â”‚           â”œâ”€â”€ test_file_upload_clean.py
â”‚           â”œâ”€â”€ test_md_editor_clean.py
â”‚           â”œâ”€â”€ test_ai_review_clean.py
â”‚           â”œâ”€â”€ test_document_publish_clean.py
â”‚           â”œâ”€â”€ test_tech_square_clean.py
â”‚           â”œâ”€â”€ test_interaction_clean.py
â”‚           â””â”€â”€ test_share_system_clean.py
â”‚
â”œâ”€â”€ vue3/                              # å‰ç«¯ç›®å½•
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ api/                       # APIæ¥å£å°è£…
â”‚   â”‚   â”‚   â”œâ”€â”€ v1/                    # ç”¨æˆ·ç³»ç»Ÿæ¥å£
â”‚   â”‚   â”‚   â””â”€â”€ v2/                    # æ–‡æ¡£ç³»ç»Ÿæ¥å£
â”‚   â”‚   â”œâ”€â”€ views/                     # é¡µé¢ç»„ä»¶
â”‚   â”‚   â”‚   â”œâ”€â”€ v1/                    # ç”¨æˆ·ç³»ç»Ÿé¡µé¢
â”‚   â”‚   â”‚   â””â”€â”€ v2/                    # æ–‡æ¡£ç³»ç»Ÿé¡µé¢
â”‚   â”‚   â”œâ”€â”€ components/                # é€šç”¨ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ stores/                    # çŠ¶æ€ç®¡ç†
â”‚   â”‚   â”œâ”€â”€ router/                    # è·¯ç”±é…ç½®
â”‚   â”‚   â””â”€â”€ utils/
â”‚   â”‚       â”œâ”€â”€ request.js             # ç¯å¢ƒé€‚é…çš„APIè¯·æ±‚
â”‚   â”‚       â””â”€â”€ auth.js                # Tokenç®¡ç†
â”‚   â”‚
â”‚   â”œâ”€â”€ ğŸ“ ç¯å¢ƒé…ç½®
â”‚   â”‚   â”œâ”€â”€ .env.development           # å¼€å‘ç¯å¢ƒï¼šhttp://localhost:8100/api
â”‚   â”‚   â””â”€â”€ .env.production            # ç”Ÿäº§ç¯å¢ƒï¼š/apiï¼ˆç›¸å¯¹è·¯å¾„ï¼‰
â”‚   â”‚
â”‚   â”œâ”€â”€ ğŸ“ æ„å»ºäº§ç‰©
â”‚   â”‚   â””â”€â”€ dist/                      # ç”Ÿäº§æ„å»ºé™æ€æ–‡ä»¶
â”‚   â”‚       â”œâ”€â”€ index.html
â”‚   â”‚       â””â”€â”€ assets/                # å‹ç¼©+hashå‘½åçš„é™æ€èµ„æº
â”‚   â”‚
â”‚   â”œâ”€â”€ package.json
â”‚   â””â”€â”€ vite.config.js                 # ç”Ÿäº§æ„å»ºä¼˜åŒ–é…ç½®
â”‚
â””â”€â”€ nginx/                             # é¡¹ç›®é›†æˆNginxï¼ˆå¼€å‘æ¨¡å¼ï¼‰
    â”œâ”€â”€ nginx.exe                      # Nginxä¸»ç¨‹åº
    â”œâ”€â”€ conf/
    â”‚   â””â”€â”€ nginx.conf                 # å…¨æ ˆç»Ÿä¸€é…ç½®
    â”œâ”€â”€ logs/                          # æ—¥å¿—ç›®å½•
    â””â”€â”€ temp/                          # ä¸´æ—¶ç›®å½•
```

---

### 4.2 ç¯å¢ƒé…ç½®ä¿¡æ¯ ğŸ†•

#### 4.2.1 æ•°æ®åº“é…ç½®

**å¼€å‘ç¯å¢ƒé…ç½®**ï¼š
```bash
# fastapi/.env æ–‡ä»¶é…ç½®
DATABASE_URL=mysql+pymysql://root:ljl18420@localhost:3306/user_system
SECRET_KEY=your-secret-key-here-change-in-production
ALGORITHM=HS256
ACCESS_TOKEN_EXPIRE_MINUTES=30
REFRESH_TOKEN_EXPIRE_DAYS=7

# Redisé…ç½®ï¼ˆå¼€å‘ç¯å¢ƒï¼‰
REDIS_URL=redis://localhost:6379/0
REDIS_PASSWORD=
REDIS_DB=0
REDIS_DECODE_RESPONSES=True

# æ€§èƒ½ä¼˜åŒ–é…ç½®
DATABASE_POOL_SIZE=20
DATABASE_MAX_OVERFLOW=30
DATABASE_POOL_RECYCLE=3600

# åˆ†äº«ç³»ç»Ÿé…ç½®
BASE_URL=http://localhost:8100  # å¼€å‘ç¯å¢ƒ
```

**Dockerç”Ÿäº§ç¯å¢ƒé…ç½®**ï¼š
```bash
# docker/.env æ–‡ä»¶é…ç½®
# MySQLé…ç½®
MYSQL_ROOT_PASSWORD=ljl18420
MYSQL_DATABASE=user_system
MYSQL_USER=docs_user
MYSQL_PASSWORD=ljl18420
MYSQL_PORT=13306

# Redisé…ç½®
REDIS_PORT=16379
REDIS_PASSWORD=

# WebæœåŠ¡é…ç½®
WEB_PORT=18080

# FastAPIç¯å¢ƒå˜é‡ï¼ˆå®¹å™¨å†…ï¼‰
DATABASE_URL=mysql+pymysql://docs_user:ljl18420@mysql:3306/user_system
REDIS_URL=redis://redis:6379/0
BASE_URL=http://localhost:18080  # Dockerç¯å¢ƒ
```

**æ•°æ®åº“è¿æ¥å‘½ä»¤**ï¼š
```bash
# å¼€å‘ç¯å¢ƒè¿æ¥MySQL
mysql -u root -p
# è¾“å…¥å¯†ç ï¼šljl18420

# Dockerç¯å¢ƒè¿æ¥MySQL
mysql -h localhost -P 13306 -u docs_user -p
# è¾“å…¥å¯†ç ï¼šljl18420

# ä½¿ç”¨é¡¹ç›®æ•°æ®åº“
USE user_system;

# æŸ¥çœ‹æ‰€æœ‰è¡¨
SHOW TABLES;
```

#### 4.2.2 Redisé…ç½® ğŸ†•

**å¼€å‘ç¯å¢ƒRedis**ï¼š
```bash
# å¯åŠ¨RedisæœåŠ¡
redis-server

# è¿æ¥Redis
redis-cli
127.0.0.1:6379> ping
PONG

# æŸ¥çœ‹ç¼“å­˜æ•°æ®
127.0.0.1:6379> keys "*"
127.0.0.1:6379> get "user_cache:profile:6"
```

**Dockerç¯å¢ƒRedis**ï¼š
```bash
# è¿æ¥Docker Redis
redis-cli -h localhost -p 16379

# æˆ–é€šè¿‡Dockerå®¹å™¨
docker exec -it docs_redis redis-cli

# æŸ¥çœ‹ç¼“å­˜ç»Ÿè®¡
127.0.0.1:6379> info memory
127.0.0.1:6379> info stats
```

#### 4.2.3 æµ‹è¯•è´¦å·ä¿¡æ¯

**æ ‡å‡†æµ‹è¯•è´¦å·**ï¼š
- **ç”¨æˆ·å**ï¼š`abc`
- **å¯†ç **ï¼š`ljl18420`
- **é‚®ç®±**ï¼š`ljlaa@qq.com`

**ç™»å½•æ¥å£è°ƒç”¨ç¤ºä¾‹**ï¼š

**å¼€å‘ç¯å¢ƒ**ï¼š
```bash
curl -X POST "http://localhost:8100/api/v1/user_auth/login" \
-H "Content-Type: application/json" \
-d '{"username_or_email":"abc","password":"ljl18420"}'
```

**Dockerç”Ÿäº§ç¯å¢ƒ**ï¼š
```bash
curl -X POST "http://localhost:18080/api/v1/user_auth/login" \
-H "Content-Type: application/json" \
-d '{"username_or_email":"abc","password":"ljl18420"}'
```

---

## 5. Redisç¼“å­˜ç³»ç»Ÿ ğŸ†•

### 5.1 ç¼“å­˜ç³»ç»Ÿæ¦‚è¿°

#### 5.1.1 ç¼“å­˜æ¶æ„è®¾è®¡

Redisç¼“å­˜ç³»ç»Ÿé‡‡ç”¨åˆ†å±‚æ¶æ„è®¾è®¡ï¼ŒåŒ…å«åŸºç¡€è®¾æ–½å±‚ã€ç¼“å­˜æœåŠ¡å±‚å’Œä¸šåŠ¡é›†æˆå±‚ï¼š

```
Redisç¼“å­˜æ¶æ„ï¼š
â”œâ”€â”€ åŸºç¡€è®¾æ–½å±‚
â”‚   â”œâ”€â”€ RedisClient           # Redisè¿æ¥ç®¡ç†å’Œå¯ç”¨æ€§æ£€æµ‹
â”‚   â”œâ”€â”€ BaseCacheService      # ç¼“å­˜åŸºç±»ï¼Œæä¾›ç»Ÿä¸€æ¥å£
â”‚   â””â”€â”€ DebugService          # è°ƒè¯•å·¥å…·ï¼Œæ€§èƒ½ç›‘æ§
â”‚
â”œâ”€â”€ ç¼“å­˜æœåŠ¡å±‚
â”‚   â”œâ”€â”€ user_cache            # ç”¨æˆ·ä¿¡æ¯ç¼“å­˜
â”‚   â”œâ”€â”€ stats_cache           # ç»Ÿè®¡æ•°æ®ç¼“å­˜
â”‚   â”œâ”€â”€ tech_square_cache     # æŠ€æœ¯å¹¿åœºç»Ÿè®¡ç¼“å­˜
â”‚   â”œâ”€â”€ document_list_cache   # æ–‡æ¡£åˆ—è¡¨ç¼“å­˜
â”‚   â”œâ”€â”€ hot_data_cache        # çƒ­é—¨æ•°æ®ç¼“å­˜
â”‚   â””â”€â”€ search_cache          # æœç´¢ç»“æœç¼“å­˜
â”‚
â””â”€â”€ ä¸šåŠ¡é›†æˆå±‚
    â”œâ”€â”€ ç”¨æˆ·ä¸­å¿ƒé›†æˆ          # ç”¨æˆ·ä¿¡æ¯ + ç»Ÿè®¡ç¼“å­˜
    â”œâ”€â”€ æ–‡æ¡£ç®¡ç†é›†æˆ          # ç»Ÿè®¡ + åˆ—è¡¨ç¼“å­˜
    â””â”€â”€ æŠ€æœ¯å¹¿åœºé›†æˆ          # å¤šç§ç¼“å­˜ç»¼åˆåº”ç”¨
```

#### 5.1.2 ç¼“å­˜ç­–ç•¥è®¾è®¡

**TTLç­–ç•¥è®¾è®¡**ï¼š
| ç¼“å­˜ç±»å‹ | TTLæ—¶é—´ | æ›´æ–°é¢‘ç‡ | é€‚ç”¨åœºæ™¯ |
|----------|---------|----------|----------|
| ç”¨æˆ·ä¿¡æ¯ç¼“å­˜ | 20åˆ†é’Ÿ | ä½ | ç”¨æˆ·åŸºæœ¬ä¿¡æ¯ |
| ç»Ÿè®¡æ•°æ®ç¼“å­˜ | 30åˆ†é’Ÿ | ä½ | æ–‡æ¡£ç»Ÿè®¡ä¿¡æ¯ |
| æŠ€æœ¯å¹¿åœºç»Ÿè®¡ | 15åˆ†é’Ÿ | ä¸­ | å¹¿åœºç»Ÿè®¡æ•°æ® |
| æ–‡æ¡£åˆ—è¡¨ç¼“å­˜ | 10-20åˆ†é’Ÿ | ä¸­ | åˆ†é¡µæ–‡æ¡£åˆ—è¡¨ |
| çƒ­é—¨æ•°æ®ç¼“å­˜ | 5-10åˆ†é’Ÿ | é«˜ | çƒ­é—¨/æœ€æ–°æ–‡æ¡£ |
| æœç´¢ç»“æœç¼“å­˜ | 8åˆ†é’Ÿ | ä¸­ | æœç´¢ç»“æœ |

**ç¼“å­˜Keyè®¾è®¡è§„èŒƒ**ï¼š
```
ç¼“å­˜Keyæ ¼å¼ï¼š{æ¨¡å—å‰ç¼€}:{åŠŸèƒ½ç±»å‹}:{å‚æ•°æ ‡è¯†}

ç¤ºä¾‹ï¼š
- user_cache:profile:6                    # ç”¨æˆ·6çš„ä¿¡æ¯
- stats:user_docs:6                       # ç”¨æˆ·6çš„ç»Ÿè®¡
- tech_square_stats:main                  # æŠ€æœ¯å¹¿åœºç»Ÿè®¡
- doc_list:public:p1:s10:qnone:tnone:sortlatest  # å…¬å¼€æ–‡æ¡£åˆ—è¡¨
- hot_data:hot_docs:limit_10              # çƒ­é—¨æ–‡æ¡£å‰10
- search_cache:keyword_4921c0e2:p1:s10:tnone     # æœç´¢ç»“æœ
```

### 5.2 ç¼“å­˜æ¨¡å—è¯¦è§£

#### 5.2.1 ç”¨æˆ·ä¿¡æ¯ç¼“å­˜ (user_cache.py)

**åŠŸèƒ½æ¦‚è¿°**ï¼š
- **ç¼“å­˜å¯¹è±¡**ï¼šç”¨æˆ·åŸºæœ¬ä¿¡æ¯ï¼ˆç”¨æˆ·åã€æ˜µç§°ã€é‚®ç®±ç­‰ï¼‰
- **ç¼“å­˜ç­–ç•¥**ï¼šç”¨æˆ·IDä½œä¸ºKeyï¼Œ20åˆ†é’ŸTTL
- **è§¦å‘åœºæ™¯**ï¼šç”¨æˆ·ä¿¡æ¯æŸ¥è¯¢ã€ä¸ªäººä¸­å¿ƒè®¿é—®
- **æ€§èƒ½æå‡**ï¼š**92%** ï¼ˆ25ms â†’ 2msï¼‰

**æ ¸å¿ƒæ–¹æ³•**ï¼š
```python
async def get_user_info(self, db: Session, user_id: int) -> Optional[Dict[str, Any]]
async def invalidate_user_cache(self, user_id: int) -> bool
async def get_cache_stats(self) -> Dict[str, Any]
```

**ç¼“å­˜Keyè®¾è®¡**ï¼š
```
user_cache:profile:{user_id}
ç¤ºä¾‹ï¼šuser_cache:profile:6
```

#### 5.2.2 ç»Ÿè®¡æ•°æ®ç¼“å­˜ (stats_cache.py)

**åŠŸèƒ½æ¦‚è¿°**ï¼š
- **ç¼“å­˜å¯¹è±¡**ï¼šç”¨æˆ·æ–‡æ¡£ç»Ÿè®¡ä¿¡æ¯ï¼ˆæ€»æ•°ã€çŠ¶æ€åˆ†å¸ƒã€æ–‡ä»¶å¤¹æ•°ï¼‰
- **ç¼“å­˜ç­–ç•¥**ï¼šç”¨æˆ·IDä½œä¸ºKeyï¼Œ30åˆ†é’ŸTTL
- **è§¦å‘åœºæ™¯**ï¼šæ–‡æ¡£ç®¡ç†é¡µé¢ã€ç”¨æˆ·ä¸­å¿ƒç»Ÿè®¡
- **æ€§èƒ½æå‡**ï¼š**86%** ï¼ˆ49ms â†’ 8.5msï¼‰

**æ ¸å¿ƒæ–¹æ³•**ï¼š
```python
async def get_user_document_stats(self, db: Session, user_id: int) -> Dict[str, Any]
async def invalidate_user_stats(self, user_id: int) -> bool
```

**ç¼“å­˜Keyè®¾è®¡**ï¼š
```
stats:user_docs:{user_id}
ç¤ºä¾‹ï¼šstats:user_docs:6
```

#### 5.2.3 æŠ€æœ¯å¹¿åœºç»Ÿè®¡ç¼“å­˜ (tech_square_cache.py)

**åŠŸèƒ½æ¦‚è¿°**ï¼š
- **ç¼“å­˜å¯¹è±¡**ï¼šæŠ€æœ¯å¹¿åœºå…¨å±€ç»Ÿè®¡ï¼ˆæ€»æ–‡æ¡£æ•°ã€æ€»æµè§ˆé‡ã€ä»Šæ—¥å‘å¸ƒç­‰ï¼‰
- **ç¼“å­˜ç­–ç•¥**ï¼šå…¨å±€ç»Ÿä¸€Keyï¼Œ15åˆ†é’ŸTTL
- **è§¦å‘åœºæ™¯**ï¼šæŠ€æœ¯å¹¿åœºé¦–é¡µã€ç»Ÿè®¡é¢æ¿
- **æ€§èƒ½æå‡**ï¼š**86%** ï¼ˆ49ms â†’ 6.8msï¼‰

**æ ¸å¿ƒæ–¹æ³•**ï¼š
```python
async def get_tech_square_stats(self, db: Session) -> Dict[str, Any]
async def invalidate_tech_square_stats(self) -> bool
```

**ç¼“å­˜Keyè®¾è®¡**ï¼š
```
tech_square_stats:main
```

#### 5.2.4 æ–‡æ¡£åˆ—è¡¨ç¼“å­˜ (document_list_cache.py)

**åŠŸèƒ½æ¦‚è¿°**ï¼š
- **ç¼“å­˜å¯¹è±¡**ï¼šåˆ†é¡µæ–‡æ¡£åˆ—è¡¨ï¼ˆå…¬å¼€æ–‡æ¡£ã€ä¸ªäººæ–‡æ¡£ï¼‰
- **ç¼“å­˜ç­–ç•¥**ï¼šå¤æ‚å‚æ•°ç»„åˆKeyï¼Œå·®å¼‚åŒ–TTLï¼ˆ10-20åˆ†é’Ÿï¼‰
- **è§¦å‘åœºæ™¯**ï¼šæŠ€æœ¯å¹¿åœºæ–‡æ¡£åˆ—è¡¨ã€ä¸ªäººæ–‡æ¡£ç®¡ç†
- **æ€§èƒ½æå‡**ï¼š**95%** ï¼ˆ45ms â†’ 2msï¼‰

**æ ¸å¿ƒæ–¹æ³•**ï¼š
```python
async def get_public_document_list(self, db, query_func: Callable, **params) -> Dict[str, Any]
async def get_user_document_list(self, db, query_func: Callable, **params) -> Dict[str, Any]
async def invalidate_document_list_cache(self, user_id: Optional[int] = None) -> bool
```

**ç¼“å­˜Keyè®¾è®¡**ï¼š
```
# å…¬å¼€æ–‡æ¡£åˆ—è¡¨
doc_list:public:p{page}:s{size}:q{search_hash}:t{file_type}:time{time_filter}:sort{sort_by}

# ä¸ªäººæ–‡æ¡£åˆ—è¡¨
doc_list:user{user_id}:p{page}:s{size}:f{folder_id}

ç¤ºä¾‹ï¼š
doc_list:public:p1:s10:qnone:tnone:timenone:sortlatest
doc_list:user6:p1:s10:fnone
```

#### 5.2.5 çƒ­é—¨æ•°æ®ç¼“å­˜ (hot_data_cache.py)

**åŠŸèƒ½æ¦‚è¿°**ï¼š
- **ç¼“å­˜å¯¹è±¡**ï¼šçƒ­é—¨æ–‡æ¡£åˆ—è¡¨ã€æœ€æ–°æ–‡æ¡£åˆ—è¡¨
- **ç¼“å­˜ç­–ç•¥**ï¼šæŒ‰æ•°é‡é™åˆ¶Keyï¼Œå·®å¼‚åŒ–TTLï¼ˆ5-10åˆ†é’Ÿï¼‰
- **è§¦å‘åœºæ™¯**ï¼šæŠ€æœ¯å¹¿åœºçƒ­é—¨æ¨èã€æœ€æ–°æ–‡æ¡£å±•ç¤º
- **æ€§èƒ½æå‡**ï¼š**66%** ï¼ˆå¹³å‡15ms â†’ 5msï¼‰

**æ ¸å¿ƒæ–¹æ³•**ï¼š
```python
async def get_hot_documents(self, db, query_func: Callable, limit: int = 10) -> Dict[str, Any]
async def get_latest_documents(self, db, query_func: Callable, limit: int = 10) -> Dict[str, Any]
async def invalidate_hot_documents_cache(self) -> bool
async def invalidate_latest_documents_cache(self) -> bool
```

**ç¼“å­˜Keyè®¾è®¡**ï¼š
```
hot_data:hot_docs:limit_{limit}
hot_data:latest_docs:limit_{limit}

ç¤ºä¾‹ï¼š
hot_data:hot_docs:limit_10
hot_data:latest_docs:limit_5
```

#### 5.2.6 æœç´¢ç»“æœç¼“å­˜ (search_cache.py)

**åŠŸèƒ½æ¦‚è¿°**ï¼š
- **ç¼“å­˜å¯¹è±¡**ï¼šæœç´¢ç»“æœåˆ—è¡¨
- **ç¼“å­˜ç­–ç•¥**ï¼šå…³é”®è¯å“ˆå¸ŒåŒ–Keyï¼Œ8åˆ†é’ŸTTL
- **è§¦å‘åœºæ™¯**ï¼šæŠ€æœ¯å¹¿åœºæœç´¢åŠŸèƒ½
- **æ€§èƒ½æå‡**ï¼š**42%** ï¼ˆå¹³å‡12ms â†’ 7msï¼‰

**æ ¸å¿ƒæ–¹æ³•**ï¼š
```python
async def get_search_results(self, db, query_func: Callable, keyword: str, **params) -> Dict[str, Any]
async def invalidate_search_cache_by_keyword(self, keyword: str) -> bool
async def invalidate_all_search_cache(self) -> bool
```

**ç¼“å­˜Keyè®¾è®¡**ï¼š
```
search_cache:keyword_{keyword_hash}:p{page}:s{size}:t{file_type}

ç¤ºä¾‹ï¼š
search_cache:keyword_4921c0e2:p1:s10:tnone  # æœç´¢"AI"
search_cache:keyword_fac54c34:p1:s20:tnone  # æœç´¢"æ¨¡å—"
```

### 5.3 ç¼“å­˜æ€§èƒ½æµ‹è¯•ç»“æœ

#### 5.3.1 æ•´ä½“æ€§èƒ½æå‡

| ç¼“å­˜æ¨¡å— | ä¼˜åŒ–å‰å“åº”æ—¶é—´ | ä¼˜åŒ–åå“åº”æ—¶é—´ | æ€§èƒ½æå‡ | æ•°æ®åº“è´Ÿè½½å‡å°‘ |
|----------|----------------|----------------|----------|----------------|
| ç”¨æˆ·ä¿¡æ¯ç¼“å­˜ | 25ms | 2ms | **92%** | 95% |
| ç»Ÿè®¡æ•°æ®ç¼“å­˜ | 49ms | 8.5ms | **86%** | 100% |
| æŠ€æœ¯å¹¿åœºç»Ÿè®¡ | 49ms | 6.8ms | **86%** | 100% |
| æ–‡æ¡£åˆ—è¡¨ç¼“å­˜ | 45ms | 2ms | **95%** | 100% |
| çƒ­é—¨æ•°æ®ç¼“å­˜ | 15ms | 5ms | **66%** | 100% |
| æœç´¢ç»“æœç¼“å­˜ | 12ms | 7ms | **42%** | 100% |

#### 5.3.2 ç»¼åˆæ€§èƒ½æŒ‡æ ‡

```
ğŸ¯ Redisç¼“å­˜ç³»ç»Ÿæ•´ä½“æ•ˆæœï¼š
â”œâ”€â”€ å¹³å‡æ€§èƒ½æå‡: 77.8%
â”œâ”€â”€ æœ€é«˜æ€§èƒ½æå‡: 95% (æ–‡æ¡£åˆ—è¡¨ç¼“å­˜)
â”œâ”€â”€ æœ€ä½æ€§èƒ½æå‡: 42% (æœç´¢ç»“æœç¼“å­˜)
â”œâ”€â”€ å¹³å‡å“åº”æ—¶é—´: 2-8.5ms(ä¼˜ç§€çº§åˆ«)
â”œâ”€â”€ æ•°æ®åº“è´Ÿè½½å‡å°‘: 99.2%
â”œâ”€â”€ ç¼“å­˜å‘½ä¸­ç‡: 100% (ç¨³å®šè¿è¡Œå)
â””â”€â”€ ç”¨æˆ·ä½“éªŒ: æ˜¾è‘—æå‡(æ¯«ç§’çº§å“åº”)
```

#### 5.3.3 å¹¶å‘æ€§èƒ½æµ‹è¯•

```
æµ‹è¯•å·¥å…·ï¼šperformance_test.py
æµ‹è¯•åœºæ™¯ï¼š20ä¸ªå¹¶å‘è¯·æ±‚

ç»“æœï¼š
ğŸ“ˆ å¹¶å‘è¯·æ±‚ç»“æœ:
æ€»è€—æ—¶: 25.7ms
æˆåŠŸè¯·æ±‚: 20/20
æˆåŠŸç‡: 100.0%
å¹³å‡å“åº”æ—¶é—´: 4.1ms
æœ€å¿«å“åº”: 2.0ms
æœ€æ…¢å“åº”: 25.7ms
QPS: 778.2 req/s
```

### 5.4 ç¼“å­˜æµ‹è¯•è„šæœ¬

#### 5.4.1 æµ‹è¯•è„šæœ¬åˆ—è¡¨

```bash
fastapi/æµ‹è¯•è„šæœ¬/
â”œâ”€â”€ test_user_cache.py         # ç”¨æˆ·ç¼“å­˜æµ‹è¯•
â”œâ”€â”€ test_stats_cache.py        # ç»Ÿè®¡ç¼“å­˜æµ‹è¯•
â”œâ”€â”€ test_tech_square_cache.py  # æŠ€æœ¯å¹¿åœºç¼“å­˜æµ‹è¯•
â”œâ”€â”€ test_document_list_cache.py # æ–‡æ¡£åˆ—è¡¨ç¼“å­˜æµ‹è¯•
â”œâ”€â”€ test_hot_data_cache.py     # çƒ­é—¨æ•°æ®ç¼“å­˜æµ‹è¯•
â””â”€â”€ test_search_cache.py       # æœç´¢ç¼“å­˜æµ‹è¯•
```

#### 5.4.2 è¿è¡Œç¼“å­˜æµ‹è¯•

```bash
# è¿›å…¥æµ‹è¯•ç›®å½•
cd fastapi/æµ‹è¯•è„šæœ¬

# è¿è¡Œå„æ¨¡å—æµ‹è¯•
python test_user_cache.py
python test_stats_cache.py
python test_tech_square_cache.py
python test_document_list_cache.py
python test_hot_data_cache.py
python test_search_cache.py
```

#### 5.4.3 æµ‹è¯•ç»“æœç¤ºä¾‹

```bash
# ç”¨æˆ·ç¼“å­˜æµ‹è¯•ç»“æœ
æµ‹è¯•åœºæ™¯ï¼šè·å–ç”¨æˆ·åŸºæœ¬ä¿¡æ¯
ç¬¬ä¸€æ¬¡è¯·æ±‚ï¼š25.03ms(æ•°æ®åº“æŸ¥è¯¢23.03ms)
ç¬¬äºŒæ¬¡è¯·æ±‚ï¼š2.01ms(ç¼“å­˜è¯»å–0ms)
æ€§èƒ½æå‡ï¼š92.0%
ç¼“å­˜å‘½ä¸­ç‡ï¼š100%

# æ–‡æ¡£åˆ—è¡¨ç¼“å­˜æµ‹è¯•ç»“æœ
æµ‹è¯•åœºæ™¯ï¼šä¸ªäººæ–‡æ¡£åˆ—è¡¨æŸ¥è¯¢
ç¬¬ä¸€æ¬¡è¯·æ±‚ï¼š45.03ms(æ•°æ®åº“æŸ¥è¯¢43.03ms)
ç¬¬äºŒæ¬¡è¯·æ±‚ï¼š2.01ms(ç¼“å­˜è¯»å–0ms)
æ€§èƒ½æå‡ï¼š95.5%
æ•°æ®åº“è´Ÿè½½å‡å°‘ï¼š100%
```

---

## 6. Dockerå®¹å™¨åŒ–éƒ¨ç½² ğŸ†•

### 6.1 Dockeræ¶æ„æ¦‚è¿°

#### 6.1.1 å®¹å™¨æœåŠ¡æ¶æ„

```
Dockerå®¹å™¨æœåŠ¡ç»„ï¼š
â”œâ”€â”€ docs_nginx         âœ… Nginxè´Ÿè½½å‡è¡¡ (ç«¯å£18080)
â”‚   â”œâ”€â”€ å‰ç«¯é™æ€æ–‡ä»¶æœåŠ¡
â”‚   â””â”€â”€ APIè¯·æ±‚è´Ÿè½½å‡è¡¡
â”œâ”€â”€ docs_fastapi_1-4   âœ… FastAPIåº”ç”¨æœåŠ¡ (4å®ä¾‹)
â”‚   â”œâ”€â”€ ä¸šåŠ¡é€»è¾‘å¤„ç†
â”‚   â”œâ”€â”€ Redisç¼“å­˜é›†æˆ
â”‚   â””â”€â”€ æ•°æ®åº“æ“ä½œ
â”œâ”€â”€ docs_mysql         âœ… MySQLæ•°æ®åº“æœåŠ¡ (ç«¯å£13306)
â”‚   â”œâ”€â”€ ç”¨æˆ·ç³»ç»Ÿæ•°æ®
â”‚   â””â”€â”€ æ–‡æ¡£ç®¡ç†æ•°æ®
â””â”€â”€ docs_redis         âœ… Redisç¼“å­˜æœåŠ¡ (ç«¯å£16379)
    â”œâ”€â”€ 6ä¸ªç¼“å­˜æ¨¡å—
    â””â”€â”€ æ•°æ®æŒä¹…åŒ–
```

#### 6.1.2 æ•°æ®æŒä¹…åŒ–æ¶æ„

```
Dockeræ•°æ®å·ç®¡ç†ï¼š
â”œâ”€â”€ docs_mysql_data    â†’ MySQLæ•°æ®æŒä¹…åŒ–
â”œâ”€â”€ docs_uploads_data  â†’ ç”¨æˆ·æ–‡ä»¶æŒä¹…åŒ–
â””â”€â”€ docs_redis_data    â†’ Redisç¼“å­˜æŒä¹…åŒ–
```

#### 6.1.3 ç½‘ç»œæ¶æ„

```
Dockerç½‘ç»œ: docs_network (bridge)
â”œâ”€â”€ docs_nginx:80        â†’ å¤–éƒ¨ç«¯å£18080
â”œâ”€â”€ docs_fastapi_1-4:8000 â†’ å†…éƒ¨é€šä¿¡
â”œâ”€â”€ docs_mysql:3306      â†’ å¤–éƒ¨ç«¯å£13306
â””â”€â”€ docs_redis:6379      â†’ å¤–éƒ¨ç«¯å£16379
```

### 6.2 Dockeré…ç½®æ–‡ä»¶

#### 6.2.1 docker-compose.yml

**æ–‡ä»¶ä½ç½®**ï¼š`docker/docker-compose.yml`

```yaml
version: '3.8'

services:
  # MySQLæ•°æ®åº“æœåŠ¡
  mysql:
    image: mysql:8.0
    container_name: docs_mysql
    restart: unless-stopped
    environment:
      - MYSQL_ROOT_PASSWORD=${MYSQL_ROOT_PASSWORD}
      - MYSQL_DATABASE=${MYSQL_DATABASE}
      - MYSQL_USER=${MYSQL_USER}
      - MYSQL_PASSWORD=${MYSQL_PASSWORD}
    volumes:
      - mysql_data:/var/lib/mysql
      - ../fastapi/user_system_compatible.sql:/docker-entrypoint-initdb.d/init.sql:ro
    ports:
      - "${MYSQL_PORT:-13306}:3306"
    networks:
      - docs_network
    healthcheck:
      test: ["CMD", "mysqladmin", "ping", "-h", "localhost", "-u", "root", "-p${MYSQL_ROOT_PASSWORD}"]
      timeout: 10s
      retries: 5
      interval: 30s

  # Redisç¼“å­˜æœåŠ¡
  redis:
    image: redis:7.0-alpine
    container_name: docs_redis
    restart: unless-stopped
    environment:
      - REDIS_PASSWORD=${REDIS_PASSWORD:-}
    volumes:
      - redis_data:/data
      - ./config/redis.conf:/usr/local/etc/redis/redis.conf:ro
    ports:
      - "${REDIS_PORT:-16379}:6379"
    networks:
      - docs_network
    command: redis-server /usr/local/etc/redis/redis.conf
    healthcheck:
      test: ["CMD", "redis-cli", "ping"]
      timeout: 3s
      retries: 5
      interval: 10s
    sysctls:
      - net.core.somaxconn=1024

  # FastAPIåº”ç”¨æœåŠ¡ (4ä¸ªå®ä¾‹)
  fastapi-1:
    build:
      context: ..
      dockerfile: docker/Dockerfile.fastapi
    container_name: docs_fastapi_1
    restart: unless-stopped
    environment:
      - ENVIRONMENT=production
      - DEBUG=False
      - DATABASE_URL=mysql+pymysql://${MYSQL_USER}:${MYSQL_PASSWORD}@mysql:3306/${MYSQL_DATABASE}
      - REDIS_URL=redis://redis:6379/0
      - REDIS_PASSWORD=${REDIS_PASSWORD:-}
      - REDIS_DB=0
      - REDIS_DECODE_RESPONSES=True
      - BASE_URL=http://localhost:${WEB_PORT:-18080}
    volumes:
      - uploads_data:/app/uploads
    ports:
      - "8100:8000"
    networks:
      - docs_network
    depends_on:
      mysql:
        condition: service_healthy
      redis:
        condition: service_healthy
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:8000/docs"]
      timeout: 10s
      retries: 3
      interval: 30s

  fastapi-2:
    build:
      context: ..
      dockerfile: docker/Dockerfile.fastapi
    container_name: docs_fastapi_2
    restart: unless-stopped
    environment:
      - ENVIRONMENT=production
      - DEBUG=False
      - DATABASE_URL=mysql+pymysql://${MYSQL_USER}:${MYSQL_PASSWORD}@mysql:3306/${MYSQL_DATABASE}
      - REDIS_URL=redis://redis:6379/0
      - REDIS_PASSWORD=${REDIS_PASSWORD:-}
      - REDIS_DB=0
      - REDIS_DECODE_RESPONSES=True
      - BASE_URL=http://localhost:${WEB_PORT:-18080}
    volumes:
      - uploads_data:/app/uploads
    ports:
      - "8101:8000"
    networks:
      - docs_network
    depends_on:
      mysql:
        condition: service_healthy
      redis:
        condition: service_healthy

  fastapi-3:
    build:
      context: ..
      dockerfile: docker/Dockerfile.fastapi
    container_name: docs_fastapi_3
    restart: unless-stopped
    environment:
      - ENVIRONMENT=production
      - DEBUG=False
      - DATABASE_URL=mysql+pymysql://${MYSQL_USER}:${MYSQL_PASSWORD}@mysql:3306/${MYSQL_DATABASE}
      - REDIS_URL=redis://redis:6379/0
      - REDIS_PASSWORD=${REDIS_PASSWORD:-}
      - REDIS_DB=0
      - REDIS_DECODE_RESPONSES=True
      - BASE_URL=http://localhost:${WEB_PORT:-18080}
    volumes:
      - uploads_data:/app/uploads
    ports:
      - "8102:8000"
    networks:
      - docs_network
    depends_on:
      mysql:
        condition: service_healthy
      redis:
        condition: service_healthy

  fastapi-4:
    build:
      context: ..
      dockerfile: docker/Dockerfile.fastapi
    container_name: docs_fastapi_4
    restart: unless-stopped
    environment:
      - ENVIRONMENT=production
      - DEBUG=False
      - DATABASE_URL=mysql+pymysql://${MYSQL_USER}:${MYSQL_PASSWORD}@mysql:3306/${MYSQL_DATABASE}
      - REDIS_URL=redis://redis:6379/0
      - REDIS_PASSWORD=${REDIS_PASSWORD:-}
      - REDIS_DB=0
      - REDIS_DECODE_RESPONSES=True
      - BASE_URL=http://localhost:${WEB_PORT:-18080}
    volumes:
      - uploads_data:/app/uploads
    ports:
      - "8103:8000"
    networks:
      - docs_network
    depends_on:
      mysql:
        condition: service_healthy
      redis:
        condition: service_healthy

  # Nginxè´Ÿè½½å‡è¡¡
  nginx:
    image: nginx:alpine
    container_name: docs_nginx
    restart: unless-stopped
    volumes:
      - ./config/nginx.conf:/etc/nginx/nginx.conf:ro
      - ../vue3/dist:/usr/share/nginx/html:ro
    ports:
      - "${WEB_PORT:-18080}:80"
    networks:
      - docs_network
    depends_on:
      - fastapi-1
      - fastapi-2
      - fastapi-3
      - fastapi-4

volumes:
  mysql_data:
    name: docs_mysql_data
  uploads_data:
    name: docs_uploads_data
  redis_data:
    name: docs_redis_data

networks:
  docs_network:
    name: docs_network
    driver: bridge
```

#### 6.2.2 ç¯å¢ƒå˜é‡é…ç½®

**æ–‡ä»¶ä½ç½®**ï¼š`docker/.env`

```bash
# MySQLé…ç½®
MYSQL_ROOT_PASSWORD=ljl18420
MYSQL_DATABASE=user_system
MYSQL_USER=docs_user
MYSQL_PASSWORD=ljl18420
MYSQL_PORT=13306

# Redisé…ç½®
REDIS_PORT=16379
REDIS_PASSWORD=

# WebæœåŠ¡é…ç½®
WEB_PORT=18080
```

#### 6.2.3 Dockerfileé…ç½®

**æ–‡ä»¶ä½ç½®**ï¼š`docker/Dockerfile.fastapi`

```dockerfile
FROM python:3.10-slim

# è®¾ç½®ä»£ç†ï¼ˆå¦‚æœéœ€è¦ï¼‰
ARG HTTP_PROXY
ARG HTTPS_PROXY
ENV HTTP_PROXY=$HTTP_PROXY
ENV HTTPS_PROXY=$HTTPS_PROXY

# è®¾ç½®å·¥ä½œç›®å½•
WORKDIR /app

# æ›´æ–°è½¯ä»¶æºï¼ˆä½¿ç”¨ä¸­ç§‘å¤§é•œåƒï¼‰
RUN sed -i 's/deb.debian.org/mirrors.ustc.edu.cn/g' /etc/apt/sources.list.d/debian.sources && \
    apt-get update && \
    apt-get install -y curl && \
    apt-get clean && \
    rm -rf /var/lib/apt/lists/*

# é…ç½®pipé•œåƒæº
RUN pip config set global.index-url https://mirrors.ustc.edu.cn/pypi/web/simple && \
    pip config set global.trusted-host mirrors.ustc.edu.cn

# å¦‚æœæœ‰ä»£ç†ï¼Œé…ç½®pipä»£ç†
RUN if [ -n "$HTTP_PROXY" ]; then \
        pip config set global.proxy $HTTP_PROXY; \
    fi

# å¤åˆ¶requirementsæ–‡ä»¶
COPY fastapi/requirements.txt .

# å®‰è£…Pythonä¾èµ–
RUN pip install --no-cache-dir -r requirements.txt

# å¤åˆ¶åº”ç”¨ä»£ç 
COPY fastapi/app ./app

# åˆ›å»ºä¸Šä¼ ç›®å½•
RUN mkdir -p /app/uploads

# æš´éœ²ç«¯å£
EXPOSE 8000

# å¯åŠ¨å‘½ä»¤
CMD ["uvicorn", "app.main:app", "--host", "0.0.0.0", "--port", "8000"]
```

#### 6.2.4 Nginxé…ç½®

**æ–‡ä»¶ä½ç½®**ï¼š`docker/config/nginx.conf`

```nginx
worker_processes auto;

events {
    worker_connections 1024;
}

http {
    include       /etc/nginx/mime.types;
    default_type  application/octet-stream;
    
    # æ—¥å¿—æ ¼å¼
    log_format main '$remote_addr - $remote_user [$time_local] "$request" '
                    '$status $body_bytes_sent "$http_referer" '
                    '"$http_user_agent" "$http_x_forwarded_for"';
    
    access_log /var/log/nginx/access.log main;
    error_log /var/log/nginx/error.log warn;
    
    sendfile        on;
    keepalive_timeout  65;
    
    # å¯ç”¨gzipå‹ç¼©
    gzip on;
    gzip_vary on;
    gzip_min_length 1024;
    gzip_types text/plain text/css application/json application/javascript text/xml application/xml application/xml+rss text/javascript;
    
    # å®šä¹‰FastAPIåç«¯æœåŠ¡å™¨ç»„
    upstream fastapi_backend {
        server docs_fastapi_1:8000;
        server docs_fastapi_2:8000;
        server docs_fastapi_3:8000;
        server docs_fastapi_4:8000;
    }
    
    server {
        listen       80;
        server_name  localhost;
        
        # APIè¯·æ±‚è½¬å‘åˆ°åç«¯
        location /api/ {
            proxy_pass http://fastapi_backend/api/;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
            proxy_set_header X-Forwarded-Proto $scheme;
            
            # è¶…æ—¶è®¾ç½®
            proxy_connect_timeout 30s;
            proxy_send_timeout 30s;
            proxy_read_timeout 30s;
        }
        
        # æ–‡æ¡£é¡µé¢
        location /docs {
            proxy_pass http://fastapi_backend/docs;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        }
        
        # è´Ÿè½½å‡è¡¡çŠ¶æ€
        location /lb_status {
            return 200 "Nginx Load Balancer OK\nBackend Servers: 4\nRedis Cache: Enabled\nMySQL Database: Connected\n";
            add_header Content-Type text/plain;
        }
        
        # å‰ç«¯é™æ€æ–‡ä»¶
        location / {
            root /usr/share/nginx/html;
            try_files $uri $uri/ /index.html;
            
            # é™æ€èµ„æºç¼“å­˜
            location ~* \.(js|css|png|jpg|jpeg|gif|svg|ico|woff|woff2|ttf|eot)$ {
                expires 1y;
                add_header Cache-Control "public, immutable";
            }
        }
        
        # é”™è¯¯é¡µé¢
        error_page   500 502 503 504  /50x.html;
        location = /50x.html {
            root   /usr/share/nginx/html;
        }
    }
}
```

#### 6.2.5 Redisé…ç½®

**æ–‡ä»¶ä½ç½®**ï¼š`docker/config/redis.conf`

```bash
# Redisé…ç½®æ–‡ä»¶ - ç”Ÿäº§ç¯å¢ƒä¼˜åŒ–

# åŸºç¡€é…ç½®
bind 0.0.0.0
port 6379
timeout 300
tcp-keepalive 300

# å†…å­˜é…ç½®
maxmemory 512mb
maxmemory-policy allkeys-lru

# æŒä¹…åŒ–é…ç½®
save 900 1
save 300 10
save 60 10000

# AOFæŒä¹…åŒ–
appendonly yes
appendfsync everysec
no-appendfsync-on-rewrite no
auto-aof-rewrite-percentage 100
auto-aof-rewrite-min-size 64mb

# æ—¥å¿—é…ç½®
loglevel notice
logfile ""

# å®‰å…¨é…ç½®
protected-mode no

# æ€§èƒ½ä¼˜åŒ–
tcp-backlog 511
databases 16
stop-writes-on-bgsave-error yes
rdbcompression yes
rdbchecksum yes
```

### 6.3 Dockeréƒ¨ç½²æµç¨‹

#### 6.3.1 ç¯å¢ƒå‡†å¤‡

**ç³»ç»Ÿè¦æ±‚**ï¼š
- **æ“ä½œç³»ç»Ÿ**ï¼šWindows 11 / macOS / Linux
- **Docker Desktop**ï¼šæœ€æ–°ç‰ˆæœ¬
- **å†…å­˜è¦æ±‚**ï¼šè‡³å°‘8GBï¼ˆæ¨è16GBï¼‰
- **å­˜å‚¨ç©ºé—´**ï¼šè‡³å°‘10GBå¯ç”¨ç©ºé—´

**ç½‘ç»œé…ç½®**ï¼ˆå¦‚æœé‡åˆ°ç½‘ç»œé—®é¢˜ï¼‰ï¼š
```bash
# æ–¹æ³•1ï¼šDocker Desktop GUIè®¾ç½®ä»£ç†
# æ‰“å¼€Docker Desktopè®¾ç½® â†’ Resources â†’ Proxies
# è®¾ç½®ä»£ç†ï¼šhttp://127.0.0.1:7890

# æ–¹æ³•2ï¼šç¯å¢ƒå˜é‡
set HTTP_PROXY=http://127.0.0.1:7890
set HTTPS_PROXY=http://127.0.0.1:7890
```

#### 6.3.2 éƒ¨ç½²æ­¥éª¤

**1. æ•°æ®å¤‡ä»½ï¼ˆå®‰å…¨æªæ–½ï¼‰**ï¼š
```bash
cd docker

# åˆ›å»ºå¤‡ä»½ç›®å½•
mkdir backup

# å¤‡ä»½ç°æœ‰æ•°æ®ï¼ˆå¦‚æœæœ‰ï¼‰
docker run --rm -v docs_mysql_data:/data -v %cd%\backup:/backup alpine tar czf /backup/mysql_backup.tar.gz -C /data .
docker run --rm -v docs_uploads_data:/data -v %cd%\backup:/backup alpine tar czf /backup/uploads_backup.tar.gz -C /data .
```

**2. å‰ç«¯æ„å»º**ï¼š
```bash
cd vue3
npm install
npm run build
```

**3. å¯åŠ¨DockeræœåŠ¡**ï¼š
```bash
cd docker

# æ„å»ºå¹¶å¯åŠ¨æ‰€æœ‰æœåŠ¡
docker-compose up -d --build

# æŸ¥çœ‹æœåŠ¡çŠ¶æ€
docker-compose ps
```

#### 6.3.3 éƒ¨ç½²éªŒè¯

**1. æœåŠ¡çŠ¶æ€æ£€æŸ¥**ï¼š
```bash
# æ£€æŸ¥æ‰€æœ‰å®¹å™¨çŠ¶æ€
docker-compose ps

# éªŒè¯RedisæœåŠ¡
docker exec -it docs_redis redis-cli ping
# æœŸæœ›è¾“å‡ºï¼šPONG

# éªŒè¯MySQLæœåŠ¡
docker exec -it docs_mysql mysqladmin ping -h localhost -u root -pljl18420
# æœŸæœ›è¾“å‡ºï¼šmysqld is alive

# æ£€æŸ¥å¥åº·çŠ¶æ€
docker-compose ps | grep healthy
```

**2. åº”ç”¨åŠŸèƒ½éªŒè¯**ï¼š
```bash
# è®¿é—®å‰ç«¯åº”ç”¨
http://localhost:18080

# è®¿é—®APIæ–‡æ¡£
http://localhost:18080/docs

# æ£€æŸ¥ç³»ç»ŸçŠ¶æ€
curl http://localhost:18080/lb_status
```

**3. ç¼“å­˜åŠŸèƒ½éªŒè¯**ï¼š
```bash
# æŸ¥çœ‹åº”ç”¨æ—¥å¿—ï¼ˆåº”è¯¥çœ‹åˆ°ç¼“å­˜åˆå§‹åŒ–ä¿¡æ¯ï¼‰
docker logs docs_fastapi_1

# æœŸæœ›çœ‹åˆ°ï¼š
# âœ… Redisè¿æ¥æˆåŠŸ
# ğŸ’¾ [CACHE] ç»Ÿè®¡ç¼“å­˜æœåŠ¡åˆå§‹åŒ–
# ğŸ›ï¸ [TECH_SQUARE_CACHE] æŠ€æœ¯å¹¿åœºç»Ÿè®¡ç¼“å­˜æœåŠ¡åˆå§‹åŒ–
# ... (å…¶ä»–ç¼“å­˜æœåŠ¡åˆå§‹åŒ–ä¿¡æ¯)
```

### 6.4 DockeræœåŠ¡ç®¡ç†

#### 6.4.1 å¯åŠ¨å’Œåœæ­¢

```bash
# å¯åŠ¨æ‰€æœ‰æœåŠ¡
cd docker
docker-compose up -d

# åœæ­¢æ‰€æœ‰æœåŠ¡
docker-compose down

# é‡å¯ç‰¹å®šæœåŠ¡
docker-compose restart redis
docker-compose restart fastapi-1

# æŸ¥çœ‹æœåŠ¡çŠ¶æ€
docker-compose ps
```

#### 6.4.2 æ—¥å¿—ç®¡ç†

```bash
# æŸ¥çœ‹æ‰€æœ‰æœåŠ¡æ—¥å¿—
docker-compose logs

# æŸ¥çœ‹ç‰¹å®šæœåŠ¡æ—¥å¿—
docker-compose logs redis
docker-compose logs fastapi-1

# å®æ—¶è·Ÿè¸ªæ—¥å¿—
docker-compose logs -f fastapi-1

# æŸ¥çœ‹æœ€è¿‘çš„æ—¥å¿—
docker-compose logs --tail=50 fastapi-1
```

#### 6.4.3 æ•°æ®ç®¡ç†

**æ•°æ®å¤‡ä»½**ï¼š
```bash
# åˆ›å»ºå¤‡ä»½è„šæœ¬ï¼šbackup.bat
@echo off
set BACKUP_DIR=backup\%date:~0,4%%date:~5,2%%date:~8,2%_%time:~0,2%%time:~3,2%
mkdir %BACKUP_DIR%

echo å¤‡ä»½MySQLæ•°æ®...
docker run --rm -v docs_mysql_data:/data -v %cd%\%BACKUP_DIR%:/backup alpine tar czf /backup/mysql_data.tar.gz -C /data .

echo å¤‡ä»½Redisæ•°æ®...
docker run --rm -v docs_redis_data:/data -v %cd%\%BACKUP_DIR%:/backup alpine tar czf /backup/redis_data.tar.gz -C /data .

echo å¤‡ä»½ç”¨æˆ·æ–‡ä»¶...
docker run --rm -v docs_uploads_data:/data -v %cd%\%BACKUP_DIR%:/backup alpine tar czf /backup/uploads_data.tar.gz -C /data .

echo å¤‡ä»½å®Œæˆï¼š%BACKUP_DIR%
```

**æ•°æ®æ¢å¤**ï¼š
```bash
# æ¢å¤è„šæœ¬ç¤ºä¾‹ï¼šrestore.bat
@echo off
set BACKUP_DIR=%1
if "%BACKUP_DIR%"=="" (
    echo è¯·æŒ‡å®šå¤‡ä»½ç›®å½•
    exit /b 1
)

echo åœæ­¢æœåŠ¡...
docker-compose down

echo æ¢å¤MySQLæ•°æ®...
docker run --rm -v docs_mysql_data:/data -v %cd%\%BACKUP_DIR%:/backup alpine tar xzf /backup/mysql_data.tar.gz -C /data

echo æ¢å¤Redisæ•°æ®...
docker run --rm -v docs_redis_data:/data -v %cd%\%BACKUP_DIR%:/backup alpine tar xzf /backup/redis_data.tar.gz -C /data

echo æ¢å¤ç”¨æˆ·æ–‡ä»¶...
docker run --rm -v docs_uploads_data:/data -v %cd%\%BACKUP_DIR%:/backup alpine tar xzf /backup/uploads_data.tar.gz -C /data

echo å¯åŠ¨æœåŠ¡...
docker-compose up -d

echo æ¢å¤å®Œæˆ
```

#### 6.4.4 æ€§èƒ½ç›‘æ§

```bash
# å®æ—¶ç›‘æ§å®¹å™¨èµ„æºä½¿ç”¨
docker stats

# ç›‘æ§Redisæ“ä½œ
docker exec -it docs_redis redis-cli monitor

# æŸ¥çœ‹Redisä¿¡æ¯
docker exec docs_redis redis-cli info memory
docker exec docs_redis redis-cli info stats

# æŸ¥çœ‹MySQLè¿›ç¨‹
docker exec docs_mysql mysqladmin processlist -u root -pljl18420
```

### 6.5 Dockerä¸€é”®å¯åŠ¨è„šæœ¬

#### 6.5.1 å¯åŠ¨è„šæœ¬

**æ–‡ä»¶ä½ç½®**ï¼š`docker/start_docker.bat`

```batch
@echo off
chcp 65001 >nul
echo.
echo ==========================================
echo   FastAPIæ–‡æ¡£ç®¡ç†ç³»ç»Ÿ - Dockeréƒ¨ç½²
echo ==========================================
echo.

echo ğŸ” æ£€æŸ¥å‰ç«¯æ„å»º...
if not exist "..\vue3\dist\index.html" (
    echo âŒ å‰ç«¯æœªæ„å»ºï¼Œæ­£åœ¨æ„å»º...
    cd ..\vue3
    call npm run build
    if errorlevel 1 (
        echo âŒ å‰ç«¯æ„å»ºå¤±è´¥
        pause
        exit /b 1
    )
    cd ..\docker
    echo âœ… å‰ç«¯æ„å»ºå®Œæˆ
) else (
    echo âœ… å‰ç«¯å·²æ„å»º
)

echo.
echo ğŸ³ å¯åŠ¨DockeræœåŠ¡...
docker-compose up -d --build

if errorlevel 1 (
    echo âŒ DockeræœåŠ¡å¯åŠ¨å¤±è´¥
    pause
    exit /b 1
)

echo.
echo â³ ç­‰å¾…æœåŠ¡å¯åŠ¨...
timeout /t 10 /nobreak >nul

echo.
echo ğŸ” æ£€æŸ¥æœåŠ¡çŠ¶æ€...
docker-compose ps

echo.
echo âœ… æœåŠ¡å¯åŠ¨å®Œæˆï¼
echo.
echo ğŸ“± è®¿é—®åœ°å€ï¼š
echo    å‰ç«¯åº”ç”¨ï¼šhttp://localhost:18080
echo    APIæ–‡æ¡£ï¼šhttp://localhost:18080/docs
echo    ç³»ç»ŸçŠ¶æ€ï¼šhttp://localhost:18080/lb_status
echo.
echo ğŸ”‘ æµ‹è¯•è´¦å·ï¼š
echo    ç”¨æˆ·åï¼šabc
echo    å¯†ç ï¼šljl18420
echo.
echo ğŸ“Š æœåŠ¡ä¿¡æ¯ï¼š
echo    MySQLï¼šlocalhost:13306
echo    Redisï¼šlocalhost:16379
echo    FastAPIï¼š4ä¸ªå®ä¾‹è´Ÿè½½å‡è¡¡
echo.
pause
```

#### 6.5.2 åœæ­¢è„šæœ¬

**æ–‡ä»¶ä½ç½®**ï¼š`docker/stop_docker.bat`

```batch
@echo off
chcp 65001 >nul
echo.
echo ==========================================
echo   FastAPIæ–‡æ¡£ç®¡ç†ç³»ç»Ÿ - åœæ­¢æœåŠ¡
echo ==========================================
echo.

echo ğŸ›‘ åœæ­¢DockeræœåŠ¡...
docker-compose down

if errorlevel 1 (
    echo âŒ åœæ­¢æœåŠ¡å¤±è´¥
    pause
    exit /b 1
)

echo.
echo âœ… æ‰€æœ‰æœåŠ¡å·²åœæ­¢
echo.
echo ğŸ’¡ æç¤ºï¼š
echo    æ•°æ®å·²ä¿å­˜åœ¨Dockerå·ä¸­ï¼Œä¸‹æ¬¡å¯åŠ¨æ—¶ä¼šè‡ªåŠ¨æ¢å¤
echo    å¦‚éœ€å®Œå…¨æ¸…ç†ï¼Œè¯·è¿è¡Œï¼šdocker-compose down -v
echo.
pause
```

---

## 7. æ€§èƒ½ä¼˜åŒ–æ–‡æ¡£ ğŸ†•

### 7.1 ä¼˜åŒ–æ¦‚è¿°

#### 7.1.1 v5.0ä¼˜åŒ–ç›®æ ‡

åœ¨v4.0å…¨æ ˆä¼˜åŒ–åŸºç¡€ä¸Šï¼Œè¿›ä¸€æ­¥å®ç°ï¼š
- **Redisç¼“å­˜ç³»ç»Ÿ**ï¼š6ä¸ªç¼“å­˜æ¨¡å—ï¼Œ77.8%å¹³å‡æ€§èƒ½æå‡
- **Dockerå®¹å™¨åŒ–**ï¼šä¼ä¸šçº§å®¹å™¨åŒ–éƒ¨ç½²ï¼ŒæœåŠ¡ç¼–æ’å’Œç®¡ç†
- **æ•°æ®æŒä¹…åŒ–**ï¼šRedis + MySQL + æ–‡ä»¶å­˜å‚¨ä¸‰é‡æŒä¹…åŒ–
- **é«˜å¯ç”¨æ¶æ„**ï¼šå®¹å™¨å¥åº·æ£€æŸ¥ + è‡ªåŠ¨é‡å¯ + æ•…éšœè½¬ç§»

#### 7.1.2 æ¶æ„æ¼”è¿›

**v2.0 æ¶æ„ï¼ˆåŸºç¡€ç‰ˆï¼‰**ï¼š
```
å‰ç«¯(8200) â† ç”¨æˆ· â†’ åç«¯(8100)
å¼€å‘æ¨¡å¼      å•è¿›ç¨‹
```

**v3.0 æ¶æ„ï¼ˆåç«¯ä¼˜åŒ–ï¼‰**ï¼š
```
å‰ç«¯(8200) â† ç”¨æˆ· â†’ Nginx(80) â†’ åç«¯4è¿›ç¨‹
å¼€å‘æ¨¡å¼              è´Ÿè½½å‡è¡¡
```

**v4.0 æ¶æ„ï¼ˆå…¨æ ˆä¼˜åŒ–ï¼‰**ï¼š
```
ç”¨æˆ· â†’ Nginx(80) â†’ å‰ç«¯é™æ€æ–‡ä»¶(å‹ç¼©+ç¼“å­˜)
                â†’ åç«¯4è¿›ç¨‹(è´Ÿè½½å‡è¡¡)
```

**v5.0 æ¶æ„ï¼ˆç¼“å­˜+å®¹å™¨åŒ–ï¼‰**ï¼š
```
ç”¨æˆ· â†’ Nginx(18080) â†’ å‰ç«¯é™æ€æ–‡ä»¶(å‹ç¼©+ç¼“å­˜)
                   â†’ åç«¯4è¿›ç¨‹(è´Ÿè½½å‡è¡¡+Redisç¼“å­˜)
                   â†’ Redisç¼“å­˜(6ä¸ªæ¨¡å—)
                   â†’ MySQLæ•°æ®åº“
                   
å…¨éƒ¨å®¹å™¨åŒ–éƒ¨ç½²ï¼Œæ•°æ®æŒä¹…åŒ–ï¼Œä¼ä¸šçº§æ¶æ„
```

### 7.2 æ€§èƒ½æŒ‡æ ‡å¯¹æ¯” ğŸ†•

#### 7.2.1 æ•´ä½“æ€§èƒ½æå‡

| æŒ‡æ ‡ | v2.0 | v3.0 | v4.0 | v5.0 | æœ€ç»ˆæå‡ |
|------|------|------|------|------|----------|
| å‰ç«¯é¦–å±åŠ è½½ | 3-5ç§’ | æœªä¼˜åŒ– | **0.5-1ç§’** | **0.5-1ç§’** | **5-10å€** |
| APIå“åº”æ—¶é—´ | æœªä¼˜åŒ– | **2-4ms** | **2-4ms** | **2-8.5ms** | ä¼˜ç§€çº§åˆ« |
| æ•°æ®åº“è´Ÿè½½ | 100% | 100% | 100% | **0.8%** | **99.2%å‡å°‘** ğŸ†• |
| ç¼“å­˜å‘½ä¸­ç‡ | 0% | 0% | 0% | **100%** | å®Œç¾ç¼“å­˜ ğŸ†• |
| å¹¶å‘å¤„ç†èƒ½åŠ› | å•è¿›ç¨‹ | **4è¿›ç¨‹** | **4è¿›ç¨‹** | **4è¿›ç¨‹** | 400% |
| QPSå¤„ç†èƒ½åŠ› | ~50 req/s | **200+ req/s** | **200+ req/s** | **778+ req/s** | **15å€** ğŸ†• |
| éƒ¨ç½²å¤æ‚åº¦ | å¤æ‚ | ä¸­ç­‰ | **ä¸€é”®å¯åŠ¨** | **Dockerä¸€é”®** | æç®€éƒ¨ç½² ğŸ†• |
| æœåŠ¡ç®¡ç† | æ‰‹åŠ¨ | è„šæœ¬ | è„šæœ¬ | **å®¹å™¨åŒ–** | ä¼ä¸šçº§ ğŸ†• |
| æ•°æ®å®‰å…¨ | æœ¬åœ°å­˜å‚¨ | æœ¬åœ°å­˜å‚¨ | æœ¬åœ°å­˜å‚¨ | **å¤šé‡æŒä¹…åŒ–** | ä¼ä¸šçº§ ğŸ†• |

#### 7.2.2 ç¼“å­˜æ€§èƒ½è¯¦ç»†æŒ‡æ ‡

| ç¼“å­˜æ¨¡å— | ç¼“å­˜å‘½ä¸­ç‡ | å“åº”æ—¶é—´ä¼˜åŒ– | æ•°æ®åº“è´Ÿè½½å‡å°‘ | é€‚ç”¨åœºæ™¯ |
|----------|------------|--------------|----------------|----------|
| ç”¨æˆ·ä¿¡æ¯ç¼“å­˜ | **100%** | **92%** (25msâ†’2ms) | **95%** | ç”¨æˆ·ä¸­å¿ƒ |
| ç»Ÿè®¡æ•°æ®ç¼“å­˜ | **100%** | **86%** (49msâ†’8.5ms) | **100%** | æ–‡æ¡£ç®¡ç† |
| æŠ€æœ¯å¹¿åœºç»Ÿè®¡ | **100%** | **86%** (49msâ†’6.8ms) | **100%** | æŠ€æœ¯å¹¿åœº |
| æ–‡æ¡£åˆ—è¡¨ç¼“å­˜ | **100%** | **95%** (45msâ†’2ms) | **100%** | åˆ—è¡¨æŸ¥è¯¢ |
| çƒ­é—¨æ•°æ®ç¼“å­˜ | **100%** | **66%** (15msâ†’5ms) | **100%** | çƒ­é—¨æ¨è |
| æœç´¢ç»“æœç¼“å­˜ | **100%** | **42%** (12msâ†’7ms) | **100%** | æœç´¢åŠŸèƒ½ |

#### 7.2.3 Dockerå®¹å™¨æ€§èƒ½

```bash
# å®¹å™¨èµ„æºä½¿ç”¨æƒ…å†µ
NAME             CPU %     MEM USAGE / LIMIT     MEM %     NET I/O
docs_nginx       0.01%     10.5MiB / 15.6GiB     0.07%     1.2kB / 1.1kB
docs_fastapi_1   0.15%     95.2MiB / 15.6GiB     0.60%     2.3kB / 1.8kB
docs_fastapi_2   0.12%     92.1MiB / 15.6GiB     0.58%     1.9kB / 1.5kB
docs_fastapi_3   0.13%     94.3MiB / 15.6GiB     0.59%     2.1kB / 1.7kB
docs_fastapi_4   0.14%     93.8MiB / 15.6GiB     0.59%     2.0kB / 1.6kB
docs_mysql       0.25%     180.5MiB / 15.6GiB    1.13%     3.2kB / 2.8kB
docs_redis       0.08%     15.2MiB / 15.6GiB     0.10%     1.5kB / 1.2kB
```

### 7.3 ç¼“å­˜ä¼˜åŒ–ç­–ç•¥

#### 7.3.1 åˆ†å±‚ç¼“å­˜è®¾è®¡

```
ç¼“å­˜å±‚æ¬¡æ¶æ„ï¼š
â”œâ”€â”€ L1ç¼“å­˜ï¼šRediså†…å­˜ç¼“å­˜ï¼ˆä¸»è¦ç¼“å­˜å±‚ï¼‰
â”œâ”€â”€ L2ç¼“å­˜ï¼šæ•°æ®åº“æŸ¥è¯¢ç¼“å­˜ï¼ˆSQLAlchemyè‡ªå¸¦ï¼‰
â””â”€â”€ é™çº§ç­–ç•¥ï¼šRedisä¸å¯ç”¨æ—¶è‡ªåŠ¨å›é€€åˆ°æ•°æ®åº“
```

#### 7.3.2 TTLç­–ç•¥ä¼˜åŒ–

**å·®å¼‚åŒ–TTLè®¾è®¡**ï¼š
- **é«˜é¢‘ä½å˜åŒ–æ•°æ®**ï¼šç”¨æˆ·ä¿¡æ¯ç¼“å­˜ï¼ˆ20åˆ†é’Ÿï¼‰
- **ä¸­é¢‘ä¸­å˜åŒ–æ•°æ®**ï¼šç»Ÿè®¡æ•°æ®ç¼“å­˜ï¼ˆ30åˆ†é’Ÿï¼‰
- **é«˜é¢‘é«˜å˜åŒ–æ•°æ®**ï¼šçƒ­é—¨æ•°æ®ç¼“å­˜ï¼ˆ5-10åˆ†é’Ÿï¼‰
- **æœç´¢ç±»æ•°æ®**ï¼šæœç´¢ç»“æœç¼“å­˜ï¼ˆ8åˆ†é’Ÿï¼‰

#### 7.3.3 ç¼“å­˜Keyä¼˜åŒ–

**æ™ºèƒ½Keyè®¾è®¡**ï¼š
```python
# ç»“æ„åŒ–å‘½å
{æ¨¡å—å‰ç¼€}:{åŠŸèƒ½ç±»å‹}:{å‚æ•°æ ‡è¯†}

# å‚æ•°æ ‡å‡†åŒ–
def _build_cache_key(self, **params):
    # æ ‡å‡†åŒ–å¯é€‰å‚æ•°
    file_type_str = file_type or "none"
    time_filter_str = time_filter or "none"
    
    # å“ˆå¸ŒåŒ–é•¿å­—ç¬¦ä¸²
    search_hash = self._generate_search_hash(search)
    
    return f"{self.key_prefix}:p{page}:s{size}:q{search_hash}:t{file_type_str}"
```

### 7.4 Dockerå®¹å™¨ä¼˜åŒ–

#### 7.4.1 é•œåƒä¼˜åŒ–

**å¤šé˜¶æ®µæ„å»º**ï¼š
```dockerfile
# ä½¿ç”¨è½»é‡çº§åŸºç¡€é•œåƒ
FROM python:3.10-slim

# è½¯ä»¶æºä¼˜åŒ–
RUN sed -i 's/deb.debian.org/mirrors.ustc.edu.cn/g' /etc/apt/sources.list.d/debian.sources

# pipé•œåƒæºä¼˜åŒ–
RUN pip config set global.index-url https://mirrors.ustc.edu.cn/pypi/web/simple
```

#### 7.4.2 ç½‘ç»œä¼˜åŒ–

**å®¹å™¨ç½‘ç»œæ¶æ„**ï¼š
```yaml
networks:
  docs_network:
    name: docs_network
    driver: bridge
```

**è´Ÿè½½å‡è¡¡ä¼˜åŒ–**ï¼š
```nginx
upstream fastapi_backend {
    server docs_fastapi_1:8000;
    server docs_fastapi_2:8000;
    server docs_fastapi_3:8000;
    server docs_fastapi_4:8000;
}
```

#### 7.4.3 å­˜å‚¨ä¼˜åŒ–

**æ•°æ®å·æŒä¹…åŒ–**ï¼š
```yaml
volumes:
  mysql_data:
    name: docs_mysql_data
  uploads_data:
    name: docs_uploads_data
  redis_data:
    name: docs_redis_data
```

### 7.5 æ€§èƒ½æµ‹è¯•ç»“æœ

#### 7.5.1 ç¼“å­˜æ€§èƒ½æµ‹è¯•

```bash
# è¿è¡Œç¼“å­˜æ€§èƒ½æµ‹è¯•
cd fastapi/æµ‹è¯•è„šæœ¬
python test_user_cache.py

# æµ‹è¯•ç»“æœç¤ºä¾‹
æµ‹è¯•åœºæ™¯ï¼šè·å–ç”¨æˆ·åŸºæœ¬ä¿¡æ¯
ç¬¬ä¸€æ¬¡è¯·æ±‚ï¼š25.03ms(æ•°æ®åº“æŸ¥è¯¢23.03ms)
ç¬¬äºŒæ¬¡è¯·æ±‚ï¼š2.01ms(ç¼“å­˜è¯»å–0ms)
æ€§èƒ½æå‡ï¼š92.0%
ç¼“å­˜å‘½ä¸­ç‡ï¼š100%
```

#### 7.5.2 å¹¶å‘æ€§èƒ½æµ‹è¯•

```bash
# è¿è¡Œå¹¶å‘æ€§èƒ½æµ‹è¯•
cd fastapi
python performance_test.py

# æµ‹è¯•ç»“æœ
ğŸ“ˆ å¹¶å‘è¯·æ±‚ç»“æœ:
æ€»è€—æ—¶: 25.7ms
æˆåŠŸè¯·æ±‚: 20/20
æˆåŠŸç‡: 100.0%
å¹³å‡å“åº”æ—¶é—´: 4.1ms
æœ€å¿«å“åº”: 2.0ms
æœ€æ…¢å“åº”: 25.7ms
QPS: 778.2 req/s
```

#### 7.5.3 Dockeræ€§èƒ½æµ‹è¯•

```bash
# å®¹å™¨å¯åŠ¨æ—¶é—´æµ‹è¯•
docker-compose up -d --build
# å¹³å‡å¯åŠ¨æ—¶é—´ï¼š30-60ç§’

# å®¹å™¨èµ„æºç›‘æ§
docker stats
# CPUä½¿ç”¨ç‡ï¼š0.01%-0.25%
# å†…å­˜ä½¿ç”¨ç‡ï¼š0.07%-1.13%
```

---

## 8. éƒ¨ç½²æ–‡æ¡£ ğŸ†•

### 8.1 éƒ¨ç½²æ–¹å¼å¯¹æ¯”

#### 8.1.1 ä¸‰ç§éƒ¨ç½²æ–¹å¼

| éƒ¨ç½²æ–¹å¼ | é€‚ç”¨åœºæ™¯ | å¤æ‚åº¦ | æ€§èƒ½ | æ¨èåº¦ |
|----------|----------|--------|------|--------|
| **å¼€å‘æ¨¡å¼** | æœ¬åœ°å¼€å‘è°ƒè¯• | ç®€å• | ä¸­ç­‰ | å¼€å‘ç¯å¢ƒ |
| **ä¼ ç»Ÿéƒ¨ç½²** | å°å‹é¡¹ç›® | ä¸­ç­‰ | é«˜ | å°è§„æ¨¡éƒ¨ç½² |
| **Dockeréƒ¨ç½²** | ç”Ÿäº§ç¯å¢ƒ | ç®€å• | æœ€é«˜ | **å¼ºçƒˆæ¨è** ğŸ†• |

#### 8.1.2 Dockeréƒ¨ç½²ä¼˜åŠ¿ ğŸ†•

- âœ… **ä¸€é”®å¯åŠ¨**ï¼š`start_docker.bat` å¯åŠ¨å®Œæ•´ç³»ç»Ÿ
- âœ… **ç¯å¢ƒä¸€è‡´**ï¼šå¼€å‘ã€æµ‹è¯•ã€ç”Ÿäº§ç¯å¢ƒå®Œå…¨ä¸€è‡´
- âœ… **æœåŠ¡ç¼–æ’**ï¼š6ä¸ªæœåŠ¡è‡ªåŠ¨ç¼–æ’å’Œä¾èµ–ç®¡ç†
- âœ… **æ•°æ®æŒä¹…åŒ–**ï¼šMySQL + Redis + æ–‡ä»¶å­˜å‚¨æŒä¹…åŒ–
- âœ… **é«˜å¯ç”¨æ€§**ï¼šå¥åº·æ£€æŸ¥ + è‡ªåŠ¨é‡å¯ + æ•…éšœè½¬ç§»
- âœ… **è´Ÿè½½å‡è¡¡**ï¼š4ä¸ªFastAPIå®ä¾‹è‡ªåŠ¨è´Ÿè½½å‡è¡¡
- âœ… **ç¼“å­˜é›†æˆ**ï¼šRedisç¼“å­˜å¼€ç®±å³ç”¨
- âœ… **ç›‘æ§å®Œå–„**ï¼šæ—¥å¿—ç®¡ç† + æ€§èƒ½ç›‘æ§

### 8.2 ç¯å¢ƒè¦æ±‚

#### 8.2.1 ç¡¬ä»¶è¦æ±‚

**æœ€ä½é…ç½®**ï¼š
- **CPU**ï¼š2æ ¸å¿ƒ
- **å†…å­˜**ï¼š4GB
- **å­˜å‚¨**ï¼š10GBå¯ç”¨ç©ºé—´
- **ç½‘ç»œ**ï¼šç¨³å®šçš„äº’è”ç½‘è¿æ¥

**æ¨èé…ç½®**ï¼š
- **CPU**ï¼š4æ ¸å¿ƒ+
- **å†…å­˜**ï¼š8GB+
- **å­˜å‚¨**ï¼š50GB+å¯ç”¨ç©ºé—´
- **ç½‘ç»œ**ï¼šé«˜é€Ÿäº’è”ç½‘è¿æ¥

#### 8.2.2 è½¯ä»¶è¦æ±‚

**å¿…éœ€è½¯ä»¶**ï¼š
- **æ“ä½œç³»ç»Ÿ**ï¼šWindows 11 / macOS / Linux
- **Docker Desktop**ï¼šæœ€æ–°ç‰ˆæœ¬
- **Git**ï¼šç”¨äºä»£ç ç®¡ç†

**å¯é€‰è½¯ä»¶**ï¼š
- **Python 3.10+**ï¼šå¼€å‘æ¨¡å¼éœ€è¦
- **Node.js 16+**ï¼šå‰ç«¯å¼€å‘éœ€è¦
- **MySQL 8.0+**ï¼šä¼ ç»Ÿéƒ¨ç½²éœ€è¦
- **Redis 6.0+**ï¼šä¼ ç»Ÿéƒ¨ç½²éœ€è¦

### 8.3 Dockeréƒ¨ç½²ï¼ˆæ¨èï¼‰ğŸ†•

#### 8.3.1 å¿«é€Ÿéƒ¨ç½²

```bash
# 1. å…‹éš†é¡¹ç›®
git clone <project-url>
cd vue3-fastapi-mysql_v1.0

# 2. æ„å»ºå‰ç«¯
cd vue3
npm install
npm run build

# 3. ä¸€é”®å¯åŠ¨Docker
cd ../docker
start_docker.bat

# 4. è®¿é—®åº”ç”¨
# å‰ç«¯åº”ç”¨ï¼šhttp://localhost:18080
# APIæ–‡æ¡£ï¼šhttp://localhost:18080/docs
# ç³»ç»ŸçŠ¶æ€ï¼šhttp://localhost:18080/lb_status
```

#### 8.3.2 è¯¦ç»†éƒ¨ç½²æ­¥éª¤

**æ­¥éª¤1ï¼šç¯å¢ƒå‡†å¤‡**
```bash
# æ£€æŸ¥Dockerç‰ˆæœ¬
docker --version
docker-compose --version

# ç¡®ä¿Docker Desktopæ­£åœ¨è¿è¡Œ
```

**æ­¥éª¤2ï¼šé¡¹ç›®å‡†å¤‡**
```bash
# ä¸‹è½½é¡¹ç›®
git clone <project-url>
cd vue3-fastapi-mysql_v1.0

# æ£€æŸ¥é¡¹ç›®ç»“æ„
dir  # Windows
ls   # Linux/macOS
```

**æ­¥éª¤3ï¼šå‰ç«¯æ„å»º**
```bash
cd vue3

# å®‰è£…ä¾èµ–
npm install

# æ„å»ºç”Ÿäº§ç‰ˆæœ¬
npm run build

# éªŒè¯æ„å»ºç»“æœ
dir dist  # Windows
ls dist   # Linux/macOS
```

**æ­¥éª¤4ï¼šDockeréƒ¨ç½²**
```bash
cd ../docker

# æ£€æŸ¥é…ç½®æ–‡ä»¶
type .env                    # Windows
cat .env                     # Linux/macOS

# å¯åŠ¨æœåŠ¡
docker-compose up -d --build

# æŸ¥çœ‹æœåŠ¡çŠ¶æ€
docker-compose ps
```

**æ­¥éª¤5ï¼šéªŒè¯éƒ¨ç½²**
```bash
# æ£€æŸ¥æ‰€æœ‰å®¹å™¨çŠ¶æ€
docker-compose ps

# éªŒè¯å‰ç«¯è®¿é—®
curl http://localhost:18080

# éªŒè¯APIè®¿é—®
curl http://localhost:18080/api/v1/user_auth/me

# éªŒè¯ç³»ç»ŸçŠ¶æ€
curl http://localhost:18080/lb_status
```

#### 8.3.3 DockeræœåŠ¡ç®¡ç†

**å¯åŠ¨æœåŠ¡**ï¼š
```bash
cd docker

# å¯åŠ¨æ‰€æœ‰æœåŠ¡
docker-compose up -d

# å¯åŠ¨ç‰¹å®šæœåŠ¡
docker-compose up -d mysql redis

# é‡æ–°æ„å»ºå¹¶å¯åŠ¨
docker-compose up -d --build
```

**åœæ­¢æœåŠ¡**ï¼š
```bash
# åœæ­¢æ‰€æœ‰æœåŠ¡
docker-compose down

# åœæ­¢å¹¶åˆ é™¤æ•°æ®å·ï¼ˆè°¨æ…ä½¿ç”¨ï¼‰
docker-compose down -v

# åœæ­¢ç‰¹å®šæœåŠ¡
docker-compose stop fastapi-1
```

**æŸ¥çœ‹çŠ¶æ€**ï¼š
```bash
# æŸ¥çœ‹æœåŠ¡çŠ¶æ€
docker-compose ps

# æŸ¥çœ‹æœåŠ¡æ—¥å¿—
docker-compose logs
docker-compose logs -f fastapi-1

# æŸ¥çœ‹èµ„æºä½¿ç”¨
docker stats
```

### 8.4 ä¼ ç»Ÿéƒ¨ç½²

#### 8.4.1 ç¯å¢ƒå‡†å¤‡

**å®‰è£…ä¾èµ–**ï¼š
```bash
# Pythonç¯å¢ƒ
conda activate xm3

# å®‰è£…Pythonä¾èµ–
cd fastapi
pip install -r requirements.txt

# å®‰è£…Node.jsä¾èµ–
cd ../vue3
npm install
```

**æ•°æ®åº“é…ç½®**ï¼š
```bash
# å¯åŠ¨MySQLæœåŠ¡
# Windows: æœåŠ¡ç®¡ç†å™¨å¯åŠ¨MySQL80

# è¿æ¥æ•°æ®åº“
mysql -u root -p

# å¯¼å…¥æ•°æ®åº“
cd fastapi
mysql -u root -p < user_system_compatible.sql
```

**Redisé…ç½®**ï¼š
```bash
# å¯åŠ¨RedisæœåŠ¡
redis-server

# éªŒè¯Redisè¿æ¥
redis-cli ping
```

#### 8.4.2 å¯åŠ¨æœåŠ¡

**æ–¹å¼1ï¼šä¸€é”®å¯åŠ¨ï¼ˆæ¨èï¼‰**
```bash
# é¡¹ç›®æ ¹ç›®å½•
start.bat
```

**æ–¹å¼2ï¼šåˆ†åˆ«å¯åŠ¨**
```bash
# å¯åŠ¨åç«¯ï¼ˆå¼€å‘æ¨¡å¼ï¼‰
cd fastapi
start_development.bat

# å¯åŠ¨å‰ç«¯ï¼ˆå¼€å‘æ¨¡å¼ï¼‰
cd vue3
npm run dev

# è®¿é—®åœ°å€
# å‰ç«¯ï¼šhttp://localhost:8200
# åç«¯ï¼šhttp://localhost:8100/docs
```

**æ–¹å¼3ï¼šç”Ÿäº§æ¨¡å¼**
```bash
# æ„å»ºå‰ç«¯
cd vue3
npm run build

# å¯åŠ¨Nginx + åç«¯
cd ..
start.bat

# è®¿é—®åœ°å€ï¼šhttp://localhost
```

### 8.5 å¼€å‘æ¨¡å¼éƒ¨ç½²

#### 8.5.1 å¼€å‘ç¯å¢ƒé…ç½®

**åç«¯å¼€å‘é…ç½®**ï¼š
```bash
# æ¿€æ´»Pythonç¯å¢ƒ
conda activate xm3

# è¿›å…¥åç«¯ç›®å½•
cd fastapi

# é…ç½®ç¯å¢ƒå˜é‡
copy .env.development .env

# å¯åŠ¨å¼€å‘æœåŠ¡å™¨
python -m uvicorn app.main:app --reload --port 8100
```

**å‰ç«¯å¼€å‘é…ç½®**ï¼š
```bash
# è¿›å…¥å‰ç«¯ç›®å½•
cd vue3

# å®‰è£…ä¾èµ–
npm install

# å¯åŠ¨å¼€å‘æœåŠ¡å™¨
npm run dev

# è®¿é—®åœ°å€ï¼šhttp://localhost:8200
```

#### 8.5.2 å¼€å‘å·¥å…·é…ç½®

**VS Codeé…ç½®**ï¼š
```json
// .vscode/settings.json
{
    "python.defaultInterpreterPath": "C:/Users/YourName/anaconda3/envs/xm3/python.exe",
    "python.terminal.activateEnvironment": true
}
```

**PyCharmé…ç½®**ï¼š
- é¡¹ç›®è§£é‡Šå™¨ï¼šé€‰æ‹©xm3ç¯å¢ƒ
- è¿è¡Œé…ç½®ï¼šuvicorn app.main:app --reload

### 8.6 æ•…éšœæ’é™¤

#### 8.6.1 Dockerå¸¸è§é—®é¢˜

**é—®é¢˜1ï¼šç«¯å£å ç”¨**
```bash
# æ£€æŸ¥ç«¯å£å ç”¨
netstat -ano | findstr :18080

# ç»“æŸå ç”¨è¿›ç¨‹
taskkill /f /pid <PID>

# æˆ–ä¿®æ”¹ç«¯å£
# ç¼–è¾‘ docker/.env æ–‡ä»¶
WEB_PORT=18081
```

**é—®é¢˜2ï¼šå®¹å™¨å¯åŠ¨å¤±è´¥**
```bash
# æŸ¥çœ‹è¯¦ç»†æ—¥å¿—
docker-compose logs <service_name>

# é‡æ–°æ„å»ºé•œåƒ
docker-compose build --no-cache

# æ¸…ç†Dockerç¼“å­˜
docker system prune -a
```

**é—®é¢˜3ï¼šæ•°æ®åº“è¿æ¥å¤±è´¥**
```bash
# æ£€æŸ¥MySQLå®¹å™¨çŠ¶æ€
docker exec -it docs_mysql mysqladmin ping -h localhost -u root -pljl18420

# æ£€æŸ¥ç½‘ç»œè¿æ¥
docker exec -it docs_fastapi_1 ping mysql

# é‡å¯MySQLå®¹å™¨
docker-compose restart mysql
```

**é—®é¢˜4ï¼šRedisè¿æ¥å¤±è´¥**
```bash
# æ£€æŸ¥Rediså®¹å™¨çŠ¶æ€
docker exec -it docs_redis redis-cli ping

# æ£€æŸ¥Redisé…ç½®
docker exec -it docs_redis cat /usr/local/etc/redis/redis.conf

# é‡å¯Rediså®¹å™¨
docker-compose restart redis
```

#### 8.6.2 ä¼ ç»Ÿéƒ¨ç½²å¸¸è§é—®é¢˜

**é—®é¢˜1ï¼šPythonç¯å¢ƒé—®é¢˜**
```bash
# æ£€æŸ¥Pythonç‰ˆæœ¬
python --version

# æ£€æŸ¥è™šæ‹Ÿç¯å¢ƒ
conda info --envs

# é‡æ–°åˆ›å»ºç¯å¢ƒ
conda create -n xm3 python=3.10
conda activate xm3
pip install -r requirements.txt
```

**é—®é¢˜2ï¼šæ•°æ®åº“è¿æ¥é—®é¢˜**
```bash
# æ£€æŸ¥MySQLæœåŠ¡çŠ¶æ€
net start | findstr MySQL

# å¯åŠ¨MySQLæœåŠ¡
net start MySQL80

# æµ‹è¯•æ•°æ®åº“è¿æ¥
mysql -u root -p -e "SELECT 1"
```

**é—®é¢˜3ï¼šå‰ç«¯æ„å»ºé—®é¢˜**
```bash
# æ¸…ç†node_modules
rm -rf node_modules
rm package-lock.json

# é‡æ–°å®‰è£…
npm install

# ä½¿ç”¨yarnï¼ˆå¦‚æœnpmæœ‰é—®é¢˜ï¼‰
yarn install
yarn build
```

#### 8.6.3 æ€§èƒ½é—®é¢˜æ’æŸ¥

**é—®é¢˜1ï¼šå“åº”æ…¢**
```bash
# æ£€æŸ¥ç¼“å­˜çŠ¶æ€
docker exec -it docs_redis redis-cli info stats

# æ£€æŸ¥æ•°æ®åº“è¿æ¥
docker exec -it docs_mysql mysqladmin processlist -u root -pljl18420

# æŸ¥çœ‹åº”ç”¨æ—¥å¿—
docker logs docs_fastapi_1
```

**é—®é¢˜2ï¼šå†…å­˜ä½¿ç”¨é«˜**
```bash
# ç›‘æ§å®¹å™¨èµ„æº
docker stats

# æ£€æŸ¥Rediså†…å­˜ä½¿ç”¨
docker exec -it docs_redis redis-cli info memory

# è°ƒæ•´Rediså†…å­˜é™åˆ¶
# ç¼–è¾‘ docker/config/redis.conf
maxmemory 1gb
```

### 8.7 ç›‘æ§å’Œç»´æŠ¤

#### 8.7.1 ç³»ç»Ÿç›‘æ§

**å¥åº·æ£€æŸ¥**ï¼š
```bash
# æ£€æŸ¥ç³»ç»ŸçŠ¶æ€
curl http://localhost:18080/lb_status

# æ£€æŸ¥APIå¥åº·
curl http://localhost:18080/docs

# æ£€æŸ¥æ•°æ®åº“å¥åº·
docker exec docs_mysql mysqladmin ping -h localhost -u root -pljl18420

# æ£€æŸ¥Rediså¥åº·
docker exec docs_redis redis-cli ping
```

**æ€§èƒ½ç›‘æ§**ï¼š
```bash
# å®æ—¶ç›‘æ§å®¹å™¨èµ„æº
docker stats

# ç›‘æ§Redisæ“ä½œ
docker exec -it docs_redis redis-cli monitor

# æŸ¥çœ‹Nginxè®¿é—®æ—¥å¿—
docker logs docs_nginx
```

#### 8.7.2 æ•°æ®å¤‡ä»½

**è‡ªåŠ¨å¤‡ä»½è„šæœ¬**ï¼š
```bash
# åˆ›å»ºå¤‡ä»½è„šæœ¬ï¼šbackup_daily.bat
@echo off
set BACKUP_DIR=backup\%date:~0,4%%date:~5,2%%date:~8,2%
mkdir %BACKUP_DIR%

echo å¤‡ä»½MySQLæ•°æ®...
docker exec docs_mysql mysqldump -u root -pljl18420 user_system > %BACKUP_DIR%\mysql_backup.sql

echo å¤‡ä»½Redisæ•°æ®...
docker exec docs_redis redis-cli save
docker cp docs_redis:/data/dump.rdb %BACKUP_DIR%\redis_backup.rdb

echo å¤‡ä»½å®Œæˆï¼š%BACKUP_DIR%
```

**å®šæœŸç»´æŠ¤**ï¼š
```bash
# æ¸…ç†Dockerç¼“å­˜ï¼ˆæ¯å‘¨ï¼‰
docker system prune -f

# æ›´æ–°é•œåƒï¼ˆæ¯æœˆï¼‰
docker-compose pull
docker-compose up -d

# æ£€æŸ¥æ—¥å¿—å¤§å°ï¼ˆæ¯æœˆï¼‰
docker logs docs_nginx --tail=1000 > nginx_recent.log
```

---

## 9. å¼€å‘ç»éªŒæ€»ç»“ ğŸ†•

### 9.1 Redisç¼“å­˜å¼€å‘ç»éªŒ

#### 9.1.1 ç¼“å­˜æ¶æ„è®¾è®¡ç»éªŒ

**å…³é”®å‘ç°**ï¼š
1. **æ¨¡å—åŒ–ç¼“å­˜è®¾è®¡æ˜¯æˆåŠŸçš„å…³é”®** - æ¯ä¸ªç¼“å­˜æ¨¡å—ç‹¬ç«‹å¼€å‘å’Œæµ‹è¯•
2. **åŸºç¡€è®¾æ–½å±‚çš„é‡è¦æ€§** - RedisClientå’ŒBaseCacheServiceæä¾›äº†ç»Ÿä¸€çš„æ¥å£
3. **è°ƒè¯•ç³»ç»Ÿçš„ä»·å€¼** - è¯¦ç»†çš„è°ƒè¯•ä¿¡æ¯å¤§å¤§æé«˜äº†å¼€å‘æ•ˆç‡
4. **ä¼˜é›…é™çº§çš„å¿…è¦æ€§** - Redisä¸å¯ç”¨æ—¶è‡ªåŠ¨å›é€€åˆ°æ•°æ®åº“

**æœ€ä½³å®è·µ**ï¼š
- **ç»Ÿä¸€æ¥å£è®¾è®¡**ï¼šæ‰€æœ‰ç¼“å­˜æœåŠ¡ç»§æ‰¿BaseCacheService
- **æ™ºèƒ½Keyè®¾è®¡**ï¼šç»“æ„åŒ–å‘½å + å‚æ•°æ ‡å‡†åŒ– + å“ˆå¸Œä¼˜åŒ–
- **å·®å¼‚åŒ–TTLç­–ç•¥**ï¼šæ ¹æ®æ•°æ®ç‰¹æ€§è®¾ç½®ä¸åŒè¿‡æœŸæ—¶é—´
- **å®Œå–„çš„ç›‘æ§ä½“ç³»**ï¼šæ€§èƒ½ç›‘æ§ + ç¼“å­˜å‘½ä¸­ç‡ + é”™è¯¯å¤„ç†

#### 9.1.2 æ€§èƒ½ä¼˜åŒ–ç»éªŒ

**ç¼“å­˜ç­–ç•¥ä¼˜åŒ–**ï¼š
```python
# åˆç†çš„TTLè®¾ç½®
user_cache: 20åˆ†é’Ÿ    # ä½é¢‘å˜åŒ–
stats_cache: 30åˆ†é’Ÿ   # ä½é¢‘å˜åŒ–
hot_data_cache: 5åˆ†é’Ÿ # é«˜é¢‘å˜åŒ–

# æ™ºèƒ½Keyè®¾è®¡
def _build_cache_key(self, **params):
    # å‚æ•°æ ‡å‡†åŒ–
    # å“ˆå¸ŒåŒ–é•¿å­—ç¬¦ä¸²
    # é¿å…Keyå†²çª
```

**æ€§èƒ½ç›‘æ§ä½“ç³»**ï¼š
```python
# å¤šç»´åº¦æ€§èƒ½ç›‘æ§
"_performance_info": {
    "cache_hit": True,
    "cache_time_ms": 0.5,
    "query_time_ms": 0,
    "total_time_ms": 2.1
}
```

#### 9.1.3 é‡è¦é—®é¢˜ä¸è§£å†³æ–¹æ¡ˆ

**é—®é¢˜1ï¼šç¼“å­˜Keyå†²çª**
```python
# é—®é¢˜ï¼šä¸åŒæŸ¥è¯¢å‚æ•°å¯èƒ½ç”Ÿæˆç›¸åŒçš„ç¼“å­˜Key
# è§£å†³æ–¹æ¡ˆï¼šå‚æ•°æ ‡å‡†åŒ– + å“ˆå¸ŒåŒ–
def _build_cache_key(self, **params):
    # å›ºå®šå‚æ•°é¡ºåº
    # æ ‡å‡†åŒ–å¯é€‰å‚æ•°
    # å“ˆå¸ŒåŒ–é•¿å­—ç¬¦ä¸²
    return standardized_key
```

**é—®é¢˜2ï¼šä¸­æ–‡å­—ç¬¦å¤„ç†**
```python
# é—®é¢˜ï¼šä¸­æ–‡æœç´¢è¯åœ¨URLç¼–ç å’Œç¼“å­˜Keyä¸­çš„å¤„ç†
# è§£å†³æ–¹æ¡ˆï¼šUTF-8ç¼–ç  + MD5å“ˆå¸Œ
def _generate_keyword_hash(self, keyword: str) -> str:
    hash_obj = hashlib.md5(keyword.lower().strip().encode('utf-8'))
    return hash_obj.hexdigest()[:8]
```

**é—®é¢˜3ï¼šPydanticæ¨¡å‹åºåˆ—åŒ–**
```python
# é—®é¢˜ï¼šPydanticæ¨¡å‹æ— æ³•ç›´æ¥JSONåºåˆ—åŒ–
# è§£å†³æ–¹æ¡ˆï¼šåœ¨ç¼“å­˜å±‚è½¬æ¢ä¸ºå­—å…¸
if hasattr(result, 'model_dump'):
    result_dict = result.model_dump()
elif hasattr(result, '__dict__'):
    result_dict = result.__dict__
```

### 9.2 Dockerå®¹å™¨åŒ–å¼€å‘ç»éªŒ

#### 9.2.1 å®¹å™¨æ¶æ„è®¾è®¡ç»éªŒ

**å…³é”®å‘ç°**ï¼š
1. **æœåŠ¡ç¼–æ’çš„é‡è¦æ€§** - docker-composeç»Ÿä¸€ç®¡ç†6ä¸ªæœåŠ¡
2. **æ•°æ®æŒä¹…åŒ–çš„å¿…è¦æ€§** - 3ä¸ªæ•°æ®å·ç¡®ä¿æ•°æ®å®‰å…¨
3. **ç½‘ç»œéš”ç¦»çš„ä»·å€¼** - å®¹å™¨é—´é€šä¿¡å®‰å…¨å¯æ§
4. **å¥åº·æ£€æŸ¥çš„ä½œç”¨** - è‡ªåŠ¨æ•…éšœæ£€æµ‹å’Œæ¢å¤

**æœ€ä½³å®è·µ**ï¼š
- **æœåŠ¡ä¾èµ–ç®¡ç†**ï¼šä½¿ç”¨depends_onå’Œå¥åº·æ£€æŸ¥
- **ç¯å¢ƒå˜é‡ç®¡ç†**ï¼šç»Ÿä¸€çš„.envæ–‡ä»¶é…ç½®
- **é•œåƒä¼˜åŒ–**ï¼šå¤šé˜¶æ®µæ„å»º + è½¯ä»¶æºä¼˜åŒ–
- **ç½‘ç»œè®¾è®¡**ï¼šç‹¬ç«‹ç½‘ç»œ + æœåŠ¡å‘ç°

#### 9.2.2 éƒ¨ç½²ä¼˜åŒ–ç»éªŒ

**é•œåƒæ„å»ºä¼˜åŒ–**ï¼š
```dockerfile
# ä½¿ç”¨è½»é‡çº§åŸºç¡€é•œåƒ
FROM python:3.10-slim

# è½¯ä»¶æºä¼˜åŒ–
RUN sed -i 's/deb.debian.org/mirrors.ustc.edu.cn/g' /etc/apt/sources.list.d/debian.sources

# pipé•œåƒæºä¼˜åŒ–
RUN pip config set global.index-url https://mirrors.ustc.edu.cn/pypi/web/simple
```

**æœåŠ¡ç¼–æ’ä¼˜åŒ–**ï¼š
```yaml
# å¥åº·æ£€æŸ¥
healthcheck:
  test: ["CMD", "redis-cli", "ping"]
  timeout: 3s
  retries: 5
  interval: 10s

# ä¾èµ–ç®¡ç†
depends_on:
  mysql:
    condition: service_healthy
  redis:
    condition: service_healthy
```

#### 9.2.3 è¿ç»´ç®¡ç†ç»éªŒ

**ç›‘æ§ä½“ç³»**ï¼š
```bash
# å®¹å™¨èµ„æºç›‘æ§
docker stats

# æœåŠ¡å¥åº·ç›‘æ§
docker-compose ps

# æ—¥å¿—ç®¡ç†
docker-compose logs -f
```

**å¤‡ä»½ç­–ç•¥**ï¼š
```bash
# æ•°æ®å·å¤‡ä»½
docker run --rm -v docs_mysql_data:/data -v %cd%\backup:/backup alpine tar czf /backup/mysql_backup.tar.gz -C /data .

# å®šæœŸå¤‡ä»½è„šæœ¬
# æ¯æ—¥è‡ªåŠ¨å¤‡ä»½
# ä¿ç•™å¤šä¸ªç‰ˆæœ¬
```

### 9.3 å…¨æ ˆé›†æˆå¼€å‘ç»éªŒ

#### 9.3.1 å‰åç«¯é›†æˆç»éªŒ

**ç¯å¢ƒé€‚é…ç­–ç•¥**ï¼š
```javascript
// å‰ç«¯ç¯å¢ƒè‡ªåŠ¨é€‚é…
const API_BASE_URL = import.meta.env.VITE_API_BASE_URL || 'http://localhost:8100/api'

// å¼€å‘ç¯å¢ƒï¼šhttp://localhost:8100/apiï¼ˆç›´è¿åç«¯ï¼‰
// ç”Ÿäº§ç¯å¢ƒï¼š/apiï¼ˆNginxä»£ç†è½¬å‘ï¼‰
```

**æ„å»ºä¼˜åŒ–ç­–ç•¥**ï¼š
```javascript
// ç”Ÿäº§æ„å»ºä¼˜åŒ–
build: {
  outDir: 'dist',
  assetsDir: 'assets',
  rollupOptions: {
    output: {
      chunkFileNames: 'assets/js/[name]-[hash].js',
      entryFileNames: 'assets/js/[name]-[hash].js',
      assetFileNames: 'assets/[ext]/[name]-[hash].[ext]'
    }
  }
}
```

#### 9.3.2 è´Ÿè½½å‡è¡¡é›†æˆç»éªŒ

**Nginxé…ç½®ä¼˜åŒ–**ï¼š
```nginx
# è´Ÿè½½å‡è¡¡é…ç½®
upstream fastapi_backend {
    server docs_fastapi_1:8000;
    server docs_fastapi_2:8000;
    server docs_fastapi_3:8000;
    server docs_fastapi_4:8000;
}

# é™æ€èµ„æºç¼“å­˜
location ~* \.(js|css|png|jpg|jpeg|gif|svg|ico)$ {
    expires 1y;
    add_header Cache-Control "public, immutable";
}
```

**å¥åº·æ£€æŸ¥é›†æˆ**ï¼š
```yaml
# FastAPIå¥åº·æ£€æŸ¥
healthcheck:
  test: ["CMD", "curl", "-f", "http://localhost:8000/docs"]
  timeout: 10s
  retries: 3
  interval: 30s
```

### 9.4 å¼€å‘æµç¨‹ç»éªŒ

#### 9.4.1 æ¨¡å—åŒ–å¼€å‘æµç¨‹

**æ ‡å‡†å¼€å‘æµç¨‹**ï¼š
1. **éœ€æ±‚åˆ†æ** â†’ ç¡®å®šç¼“å­˜ç›®æ ‡å’Œç­–ç•¥
2. **æ¶æ„è®¾è®¡** â†’ è®¾è®¡ç¼“å­˜Keyå’ŒTTLç­–ç•¥
3. **æ¨¡å—å¼€å‘** â†’ å®ç°ç¼“å­˜æœåŠ¡å’Œé›†æˆ
4. **å•å…ƒæµ‹è¯•** â†’ ç¼–å†™æµ‹è¯•è„šæœ¬éªŒè¯åŠŸèƒ½
5. **æ€§èƒ½æµ‹è¯•** â†’ æµ‹è¯•æ€§èƒ½æå‡æ•ˆæœ
6. **é›†æˆæµ‹è¯•** â†’ éªŒè¯ä¸ç°æœ‰ç³»ç»Ÿçš„å…¼å®¹æ€§
7. **Dockeré›†æˆ** â†’ å®¹å™¨åŒ–éƒ¨ç½²å’Œæµ‹è¯•
8. **æ–‡æ¡£å®Œå–„** â†’ æŠ€æœ¯æ–‡æ¡£å’Œä½¿ç”¨è¯´æ˜

#### 9.4.2 è´¨é‡ä¿è¯æªæ–½

**æµ‹è¯•è¦†ç›–ç­–ç•¥**ï¼š
- **å•å…ƒæµ‹è¯•**ï¼šæ¯ä¸ªç¼“å­˜æ¨¡å—ç‹¬ç«‹æµ‹è¯•
- **é›†æˆæµ‹è¯•**ï¼šç¼“å­˜ä¸ä¸šåŠ¡é€»è¾‘é›†æˆæµ‹è¯•
- **æ€§èƒ½æµ‹è¯•**ï¼šç¼“å­˜æ€§èƒ½æå‡éªŒè¯
- **å®¹å™¨æµ‹è¯•**ï¼šDockerç¯å¢ƒå®Œæ•´æµ‹è¯•

**ä»£ç è´¨é‡ä¿è¯**ï¼š
- **ç»Ÿä¸€æ¥å£**ï¼šBaseCacheServiceåŸºç±»
- **é”™è¯¯å¤„ç†**ï¼šå®Œå–„çš„å¼‚å¸¸å¤„ç†å’Œé™çº§æœºåˆ¶
- **è°ƒè¯•æ”¯æŒ**ï¼šè¯¦ç»†çš„è°ƒè¯•ä¿¡æ¯å’Œæ€§èƒ½ç›‘æ§
- **æ–‡æ¡£å®Œå–„**ï¼šä»£ç æ³¨é‡Š + æŠ€æœ¯æ–‡æ¡£

### 9.5 æŠ€æœ¯é€‰å‹ç»éªŒ

#### 9.5.1 ç¼“å­˜æŠ€æœ¯é€‰å‹

**Redisé€‰æ‹©ç†ç”±**ï¼š
- **é«˜æ€§èƒ½**ï¼šå†…å­˜å­˜å‚¨ï¼Œæ¯«ç§’çº§å“åº”
- **ä¸°å¯Œæ•°æ®ç±»å‹**ï¼šæ”¯æŒå­—ç¬¦ä¸²ã€å“ˆå¸Œã€åˆ—è¡¨ç­‰
- **æŒä¹…åŒ–æ”¯æŒ**ï¼šRDB + AOFåŒé‡æŒä¹…åŒ–
- **é›†ç¾¤æ”¯æŒ**ï¼šæ”¯æŒä¸»ä»å¤åˆ¶å’Œé›†ç¾¤éƒ¨ç½²

**ç¼“å­˜ç­–ç•¥é€‰æ‹©**ï¼š
- **Cache-Asideæ¨¡å¼**ï¼šåº”ç”¨ç¨‹åºç®¡ç†ç¼“å­˜
- **TTLè¿‡æœŸç­–ç•¥**ï¼šè‡ªåŠ¨æ¸…ç†è¿‡æœŸæ•°æ®
- **LRUæ·˜æ±°ç­–ç•¥**ï¼šå†…å­˜ä¸è¶³æ—¶æ·˜æ±°æœ€å°‘ä½¿ç”¨æ•°æ®

#### 9.5.2 å®¹å™¨åŒ–æŠ€æœ¯é€‰å‹

**Dockeré€‰æ‹©ç†ç”±**ï¼š
- **ç¯å¢ƒä¸€è‡´æ€§**ï¼šå¼€å‘ã€æµ‹è¯•ã€ç”Ÿäº§ç¯å¢ƒå®Œå…¨ä¸€è‡´
- **éƒ¨ç½²ç®€åŒ–**ï¼šä¸€é”®å¯åŠ¨å®Œæ•´ç³»ç»Ÿ
- **èµ„æºéš”ç¦»**ï¼šå®¹å™¨é—´èµ„æºéš”ç¦»å’Œå®‰å…¨
- **æ‰©å±•æ€§**ï¼šæ”¯æŒæ°´å¹³æ‰©å±•å’Œè´Ÿè½½å‡è¡¡

**ç¼–æ’å·¥å…·é€‰æ‹©**ï¼š
- **docker-compose**ï¼šé€‚åˆå•æœºéƒ¨ç½²
- **ç®€å•æ˜“ç”¨**ï¼šYAMLé…ç½®æ–‡ä»¶
- **åŠŸèƒ½å®Œæ•´**ï¼šæ”¯æŒæœåŠ¡ä¾èµ–ã€å¥åº·æ£€æŸ¥ã€æ•°æ®å·

### 9.6 æ¶æ„è®¾è®¡ç»éªŒ

#### 9.6.1 æ•´ä½“æ¶æ„ä¼˜åŠ¿

**v5.0æ¶æ„ä¼˜åŠ¿**ï¼š
- âœ… **æ€§èƒ½å“è¶Š**ï¼šRedisç¼“å­˜ + è´Ÿè½½å‡è¡¡ï¼ŒQPSè¾¾åˆ°778+
- âœ… **é«˜å¯ç”¨æ€§**ï¼šå®¹å™¨å¥åº·æ£€æŸ¥ + è‡ªåŠ¨é‡å¯ + æ•…éšœè½¬ç§»
- âœ… **æ˜“äºç»´æŠ¤**ï¼šæ¨¡å—åŒ–è®¾è®¡ + å®¹å™¨åŒ–éƒ¨ç½² + å®Œå–„ç›‘æ§
- âœ… **æ‰©å±•æ€§å¼º**ï¼šæ°´å¹³æ‰©å±• + å‚ç›´æ‰©å±• + åŠŸèƒ½æ‰©å±•
- âœ… **éƒ¨ç½²ç®€å•**ï¼šä¸€é”®å¯åŠ¨ + ç¯å¢ƒä¸€è‡´ + å¼€ç®±å³ç”¨
- âœ… **æ•°æ®å®‰å…¨**ï¼šä¸‰é‡æŒä¹…åŒ– + å®šæœŸå¤‡ä»½ + æ•…éšœæ¢å¤

#### 9.6.2 æŠ€æœ¯å€ºåŠ¡ç®¡ç†

**é¿å…çš„æŠ€æœ¯å€ºåŠ¡**ï¼š
- **ç¼“å­˜é›ªå´©**ï¼šå·®å¼‚åŒ–TTL + ç¼“å­˜é¢„çƒ­
- **ç¼“å­˜ç©¿é€**ï¼šå‚æ•°éªŒè¯ + ç©ºå€¼ç¼“å­˜
- **ç¼“å­˜å‡»ç©¿**ï¼šäº’æ–¥é” + ç¼“å­˜é‡å»º
- **æ•°æ®ä¸€è‡´æ€§**ï¼šç¼“å­˜å¤±æ•ˆç­–ç•¥ + æœ€ç»ˆä¸€è‡´æ€§

**æŒç»­ä¼˜åŒ–æ–¹å‘**ï¼š
- **ç¼“å­˜é›†ç¾¤**ï¼šRedisä¸»ä»å¤åˆ¶ + å“¨å…µæ¨¡å¼
- **ç›‘æ§å‘Šè­¦**ï¼šPrometheus + Grafana + å‘Šè­¦ç³»ç»Ÿ
- **è‡ªåŠ¨æ‰©ç¼©å®¹**ï¼šKubernetes + HPA
- **CI/CDé›†æˆ**ï¼šGitLab CI + è‡ªåŠ¨éƒ¨ç½²

### 9.7 é¡¹ç›®ç®¡ç†ç»éªŒ

#### 9.7.1 ç‰ˆæœ¬ç®¡ç†ç­–ç•¥

**ç‰ˆæœ¬æ¼”è¿›è·¯å¾„**ï¼š
- **v1.0**ï¼šåŸºç¡€åŠŸèƒ½å¼€å‘
- **v2.0**ï¼šåŠŸèƒ½å®Œå–„å’Œæ‰©å±•
- **v3.0**ï¼šåç«¯æ€§èƒ½ä¼˜åŒ–
- **v4.0**ï¼šå…¨æ ˆæ€§èƒ½ä¼˜åŒ–
- **v5.0**ï¼šç¼“å­˜ç³»ç»Ÿ + å®¹å™¨åŒ–

**ç‰ˆæœ¬æ§åˆ¶æœ€ä½³å®è·µ**ï¼š
- **åˆ†æ”¯ç®¡ç†**ï¼šfeatureåˆ†æ”¯ + developåˆ†æ”¯ + masteråˆ†æ”¯
- **æäº¤è§„èŒƒ**ï¼šfeat/fix/docs/style/refactor/test
- **æ ‡ç­¾ç®¡ç†**ï¼šè¯­ä¹‰åŒ–ç‰ˆæœ¬å· + å‘å¸ƒè¯´æ˜

#### 9.7.2 æ–‡æ¡£ç®¡ç†ç»éªŒ

**æ–‡æ¡£ä½“ç³»å»ºè®¾**ï¼š
- **æŠ€æœ¯æ–‡æ¡£**ï¼šæ¶æ„è®¾è®¡ + æ¥å£æ–‡æ¡£ + éƒ¨ç½²æ–‡æ¡£
- **å¼€å‘æ–‡æ¡£**ï¼šå¼€å‘æŒ‡å— + æœ€ä½³å®è·µ + æ•…éšœæ’é™¤
- **ç”¨æˆ·æ–‡æ¡£**ï¼šä½¿ç”¨è¯´æ˜ + å¿«é€Ÿå¼€å§‹ + FAQ

**æ–‡æ¡£ç»´æŠ¤ç­–ç•¥**ï¼š
- **ç‰ˆæœ¬åŒæ­¥**ï¼šæ–‡æ¡£ç‰ˆæœ¬ä¸ä»£ç ç‰ˆæœ¬åŒæ­¥
- **æŒç»­æ›´æ–°**ï¼šåŠŸèƒ½æ›´æ–°æ—¶åŒæ­¥æ›´æ–°æ–‡æ¡£
- **è´¨é‡ä¿è¯**ï¼šæ–‡æ¡£å®¡æŸ¥ + ç”¨æˆ·åé¦ˆ + æŒç»­æ”¹è¿›

---

## 10. å¿«é€Ÿå¯åŠ¨å‘½ä»¤ ğŸ†•

### 10.1 Dockeréƒ¨ç½²ï¼ˆæ¨èï¼‰ğŸ†•

#### 10.1.1 ä¸€é”®å¯åŠ¨

```bash
# 1. æ¿€æ´»Pythonç¯å¢ƒï¼ˆå¦‚æœéœ€è¦ï¼‰
conda activate xm3

# 2. è¿›å…¥é¡¹ç›®ç›®å½•
cd vue3-fastapi-mysql_v1.0

# 3. æ„å»ºå‰ç«¯ï¼ˆé¦–æ¬¡éƒ¨ç½²ï¼‰
cd vue3
npm install
npm run build

# 4. Dockerä¸€é”®å¯åŠ¨
cd ../docker
start_docker.bat

# 5. è®¿é—®åº”ç”¨
# å‰ç«¯åº”ç”¨ï¼šhttp://localhost:18080
# APIæ–‡æ¡£ï¼šhttp://localhost:18080/docs
# ç³»ç»ŸçŠ¶æ€ï¼šhttp://localhost:18080/lb_status
```

#### 10.1.2 æ‰‹åŠ¨Dockeréƒ¨ç½²

```bash
# 1. æ£€æŸ¥Dockerç¯å¢ƒ
docker --version
docker-compose --version

# 2. æ„å»ºå‰ç«¯
cd vue3
npm run build

# 3. å¯åŠ¨DockeræœåŠ¡
cd ../docker
docker-compose up -d --build

# 4. æŸ¥çœ‹æœåŠ¡çŠ¶æ€
docker-compose ps

# 5. æŸ¥çœ‹æ—¥å¿—
docker-compose logs -f
```

#### 10.1.3 DockeræœåŠ¡ç®¡ç†

```bash
# å¯åŠ¨æœåŠ¡
cd docker
docker-compose up -d

# åœæ­¢æœåŠ¡
docker-compose down

# é‡å¯æœåŠ¡
docker-compose restart

# æŸ¥çœ‹çŠ¶æ€
docker-compose ps

# æŸ¥çœ‹æ—¥å¿—
docker-compose logs <service_name>

# è¿›å…¥å®¹å™¨
docker exec -it docs_fastapi_1 bash
docker exec -it docs_redis redis-cli
docker exec -it docs_mysql mysql -u root -p
```

### 10.2 ä¼ ç»Ÿéƒ¨ç½²

#### 10.2.1 å¼€å‘ç¯å¢ƒ

```bash
# 1. æ¿€æ´»Pythonç¯å¢ƒ
conda activate xm3

# 2. å¯åŠ¨æ•°æ®åº“æœåŠ¡
# MySQL: æœåŠ¡ç®¡ç†å™¨å¯åŠ¨MySQL80
# Redis: redis-server

# 3. åç«¯å¼€å‘æ¨¡å¼
cd fastapi
start_development.bat

# 4. å‰ç«¯å¼€å‘æ¨¡å¼ï¼ˆæ–°å¼€ç»ˆç«¯ï¼‰
cd vue3
npm run dev

# 5. è®¿é—®åœ°å€
# å‰ç«¯ï¼šhttp://localhost:8200
# åç«¯ï¼šhttp://localhost:8100/docs
```

#### 10.2.2 ç”Ÿäº§ç¯å¢ƒ

```bash
# 1. æ¿€æ´»Pythonç¯å¢ƒ
conda activate xm3

# 2. æ„å»ºå‰ç«¯
cd vue3
npm run build

# 3. ä¸€é”®å¯åŠ¨ç”Ÿäº§ç¯å¢ƒ
cd ..
start.bat

# 4. è®¿é—®åœ°å€
# ç»Ÿä¸€å…¥å£ï¼šhttp://localhost
```

### 10.3 é¡¹ç›®åˆå§‹åŒ–

#### 10.3.1 é¦–æ¬¡éƒ¨ç½²

```bash
# 1. å…‹éš†é¡¹ç›®
git clone <project-url>
cd vue3-fastapi-mysql_v1.0

# 2. å®‰è£…Pythonä¾èµ–
cd fastapi
conda activate xm3
pip install -r requirements.txt

# 3. å®‰è£…Node.jsä¾èµ–
cd ../vue3
npm install

# 4. é…ç½®æ•°æ®åº“
cd ../fastapi
mysql -u root -p < user_system_compatible.sql

# 5. é€‰æ‹©éƒ¨ç½²æ–¹å¼
# Dockeréƒ¨ç½²ï¼šcd ../docker && start_docker.bat
# ä¼ ç»Ÿéƒ¨ç½²ï¼šcd .. && start.bat
```

#### 10.3.2 ç¯å¢ƒé…ç½®

```bash
# Pythonç¯å¢ƒé…ç½®
conda create -n xm3 python=3.10
conda activate xm3
pip install -r fastapi/requirements.txt

# Node.jsç¯å¢ƒé…ç½®
# ä¸‹è½½å®‰è£…Node.js 16+
npm --version

# MySQLé…ç½®
# å®‰è£…MySQL 8.0+
# è®¾ç½®rootå¯†ç ï¼šljl18420

# Redisé…ç½®ï¼ˆå¼€å‘ç¯å¢ƒï¼‰
# ä¸‹è½½å®‰è£…Redis
# å¯åŠ¨ï¼šredis-server

# Dockeré…ç½®ï¼ˆç”Ÿäº§ç¯å¢ƒï¼‰
# å®‰è£…Docker Desktop
# å¯åŠ¨DockeræœåŠ¡
```

### 10.4 æµ‹è¯•å‘½ä»¤

#### 10.4.1 åŠŸèƒ½æµ‹è¯•

```bash
# åç«¯APIæµ‹è¯•
cd fastapi/æµ‹è¯•è„šæœ¬/v2æµ‹è¯•è„šæœ¬
python test_share_system_clean.py

# ç¼“å­˜åŠŸèƒ½æµ‹è¯•
cd ../
python test_user_cache.py
python test_stats_cache.py
python test_tech_square_cache.py
python test_document_list_cache.py
python test_hot_data_cache.py
python test_search_cache.py

# å‰ç«¯åŠŸèƒ½æµ‹è¯•
# æµè§ˆå™¨è®¿é—®å¯¹åº”åœ°å€è¿›è¡Œæ‰‹åŠ¨æµ‹è¯•
```

#### 10.4.2 æ€§èƒ½æµ‹è¯•

```bash
# åç«¯æ€§èƒ½æµ‹è¯•
cd fastapi
python performance_test.py

# ç¼“å­˜æ€§èƒ½æµ‹è¯•
cd æµ‹è¯•è„šæœ¬
python test_user_cache.py  # æŸ¥çœ‹æ€§èƒ½æå‡æ•°æ®

# Dockeræ€§èƒ½æµ‹è¯•
docker stats  # æŸ¥çœ‹å®¹å™¨èµ„æºä½¿ç”¨

# ç³»ç»ŸçŠ¶æ€æ£€æŸ¥
curl http://localhost:18080/lb_status  # Dockerç¯å¢ƒ
curl http://localhost/lb_status        # ä¼ ç»Ÿç¯å¢ƒ
```

#### 10.4.3 æ¥å£æµ‹è¯•

```bash
# ç™»å½•æµ‹è¯•ï¼ˆDockerç¯å¢ƒï¼‰
curl -X POST "http://localhost:18080/api/v1/user_auth/login" \
-H "Content-Type: application/json" \
-d '{"username_or_email":"abc","password":"ljl18420"}'

# ç™»å½•æµ‹è¯•ï¼ˆä¼ ç»Ÿç¯å¢ƒï¼‰
curl -X POST "http://localhost:8100/api/v1/user_auth/login" \
-H "Content-Type: application/json" \
-d '{"username_or_email":"abc","password":"ljl18420"}'

# è·å–ç”¨æˆ·ä¿¡æ¯ï¼ˆéœ€è¦tokenï¼‰
curl -X GET "http://localhost:18080/api/v1/user_profile/user-info" \
-H "Authorization: Bearer <access_token>"

# æŠ€æœ¯å¹¿åœºç»Ÿè®¡
curl -X GET "http://localhost:18080/api/v2/tech_square/stats"

# çƒ­é—¨æ–‡æ¡£
curl -X GET "http://localhost:18080/api/v2/tech_square/hot-documents"
```

### 10.5 æ•°æ®åº“æ“ä½œ

#### 10.5.1 æ•°æ®åº“è¿æ¥

```bash
# å¼€å‘ç¯å¢ƒè¿æ¥
mysql -u root -p
# å¯†ç ï¼šljl18420

# Dockerç¯å¢ƒè¿æ¥
mysql -h localhost -P 13306 -u docs_user -p
# å¯†ç ï¼šljl18420

# ä½¿ç”¨é¡¹ç›®æ•°æ®åº“
USE user_system;

# æŸ¥çœ‹æ‰€æœ‰è¡¨
SHOW TABLES;
```

#### 10.5.2 Redisæ“ä½œ

```bash
# å¼€å‘ç¯å¢ƒè¿æ¥
redis-cli
127.0.0.1:6379> ping

# Dockerç¯å¢ƒè¿æ¥
redis-cli -h localhost -p 16379
# æˆ–
docker exec -it docs_redis redis-cli

# æŸ¥çœ‹ç¼“å­˜æ•°æ®
127.0.0.1:6379> keys "*"
127.0.0.1:6379> get "user_cache:profile:6"

# æŸ¥çœ‹ç¼“å­˜ç»Ÿè®¡
127.0.0.1:6379> info memory
127.0.0.1:6379> info stats
```

#### 10.5.3 æ•°æ®å¤‡ä»½æ¢å¤

```bash
# MySQLæ•°æ®å¤‡ä»½
mysqldump -u root -p user_system > backup.sql

# MySQLæ•°æ®æ¢å¤
mysql -u root -p user_system < backup.sql

# Redisæ•°æ®å¤‡ä»½
redis-cli save
cp /var/lib/redis/dump.rdb backup_dump.rdb

# Dockeræ•°æ®å¤‡ä»½
cd docker
docker run --rm -v docs_mysql_data:/data -v %cd%\backup:/backup alpine tar czf /backup/mysql_backup.tar.gz -C /data .
```

### 10.6 ç›‘æ§å‘½ä»¤

#### 10.6.1 ç³»ç»Ÿç›‘æ§

```bash
# æ£€æŸ¥ç³»ç»ŸçŠ¶æ€
curl http://localhost:18080/lb_status  # Docker
curl http://localhost/lb_status        # ä¼ ç»Ÿ

# æ£€æŸ¥APIå¥åº·
curl http://localhost:18080/docs

# æ£€æŸ¥è¿›ç¨‹çŠ¶æ€
tasklist | findstr python  # Windows
ps aux | grep python       # Linux/macOS

# æ£€æŸ¥ç«¯å£å ç”¨
netstat -ano | findstr :18080  # Windows
lsof -i :18080              # Linux/macOS
```

#### 10.6.2 Dockerç›‘æ§

```bash
# æŸ¥çœ‹å®¹å™¨çŠ¶æ€
docker-compose ps

# ç›‘æ§å®¹å™¨èµ„æº
docker stats

# æŸ¥çœ‹å®¹å™¨æ—¥å¿—
docker logs docs_fastapi_1
docker logs docs_redis
docker logs docs_mysql

# æŸ¥çœ‹ç½‘ç»œçŠ¶æ€
docker network ls
docker network inspect docs_network
```

#### 10.6.3 ç¼“å­˜ç›‘æ§

```bash
# Redisç›‘æ§
docker exec -it docs_redis redis-cli monitor

# æŸ¥çœ‹ç¼“å­˜ç»Ÿè®¡
docker exec docs_redis redis-cli info stats

# æŸ¥çœ‹å†…å­˜ä½¿ç”¨
docker exec docs_redis redis-cli info memory

# æŸ¥çœ‹ç¼“å­˜Key
docker exec docs_redis redis-cli keys "*"
```

---

## ğŸ“Š é¡¹ç›®å®Œæˆåº¦æ€»è§ˆ ğŸ†•

```
é¡¹ç›®è¿›åº¦ï¼šâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ 100% (15/15)

âœ… å·²å®Œæˆæ¨¡å—ï¼š
â”œâ”€â”€ v1/user_register      âœ… ç”¨æˆ·æ³¨å†Œ
â”œâ”€â”€ v1/user_auth          âœ… ç”¨æˆ·è®¤è¯
â”œâ”€â”€ v1/user_profile       âœ… ç”¨æˆ·ä¸­å¿ƒï¼ˆé›†æˆç¼“å­˜ï¼‰
â”œâ”€â”€ v1/password_manager   âœ… å¯†ç ç®¡ç†
â”œâ”€â”€ v2/document_manager   âœ… æ–‡æ¡£ç®¡ç†ï¼ˆé›†æˆç¼“å­˜ï¼‰
â”œâ”€â”€ v2/file_upload        âœ… æ–‡ä»¶ä¸Šä¼ 
â”œâ”€â”€ v2/md_editor          âœ… MDç¼–è¾‘å™¨
â”œâ”€â”€ v2/ai_review          âœ… AIå®¡æ ¸
â”œâ”€â”€ v2/document_publish   âœ… æ–‡æ¡£å‘å¸ƒ
â”œâ”€â”€ v2/tech_square        âœ… æŠ€æœ¯å¹¿åœºï¼ˆé›†æˆå¤šç§ç¼“å­˜ï¼‰
â”œâ”€â”€ v2/interaction        âœ… äº’åŠ¨åŠŸèƒ½
â”œâ”€â”€ v2/share_system       âœ… åˆ†äº«ç³»ç»Ÿ
â”œâ”€â”€ v3/load_balancer      âœ… è´Ÿè½½å‡è¡¡
â”œâ”€â”€ v4/fullstack_integration âœ… å…¨æ ˆç»Ÿä¸€éƒ¨ç½²
â””â”€â”€ v5/redis_cache_docker âœ… Redisç¼“å­˜Dockeré›†æˆ ğŸ†•

ğŸ¯ å¼€å‘ä»»åŠ¡å®Œæˆæƒ…å†µï¼š
â”œâ”€â”€ ğŸ“Š æ¥å£æ€»æ•°: 89ä¸ª
â”œâ”€â”€ ğŸ“Š æ•°æ®è¡¨æ€»æ•°: 15ä¸ª
â”œâ”€â”€ ğŸ“Š æµ‹è¯•è„šæœ¬: 14ä¸ªï¼ˆåŒ…å«6ä¸ªç¼“å­˜æµ‹è¯•ï¼‰ğŸ†•
â”œâ”€â”€ ğŸ“Š ä»£ç è¡Œæ•°: çº¦18,500è¡Œï¼ˆæ–°å¢3,500è¡Œç¼“å­˜ä»£ç ï¼‰ğŸ†•
â”œâ”€â”€ ğŸ“Š åŠŸèƒ½è¦†ç›–ç‡: 100%
â”œâ”€â”€ ğŸ“Š åç«¯æ€§èƒ½ä¼˜åŒ–: ä¼ä¸šçº§
â”œâ”€â”€ ğŸ“Š å‰ç«¯æ€§èƒ½ä¼˜åŒ–: ä¼ä¸šçº§
â”œâ”€â”€ ğŸ“Š ç¼“å­˜ç³»ç»Ÿ: 6ä¸ªæ¨¡å—ï¼Œ77.8%å¹³å‡æ€§èƒ½æå‡ ğŸ†•
â””â”€â”€ ğŸ“Š å®¹å™¨åŒ–éƒ¨ç½²: Dockerä¼ä¸šçº§æ¶æ„ ğŸ†•

ğŸ† æŠ€æœ¯æˆå°±ï¼š
â”œâ”€â”€ ğŸ—ï¸ æ¨¡å—åŒ–æ¶æ„è®¾è®¡å®Œæˆ
â”œâ”€â”€ ğŸ”„ è‡ªåŠ¨æ³¨å†Œæœºåˆ¶å®ç°
â”œâ”€â”€ ğŸ§ª æ ‡å‡†åŒ–æµ‹è¯•æµç¨‹å»ºç«‹
â”œâ”€â”€ ğŸ¤– AIæœåŠ¡æ·±åº¦é›†æˆ
â”œâ”€â”€ ğŸ” å¤šå±‚æ¬¡æƒé™æ§åˆ¶
â”œâ”€â”€ ğŸ“ˆ å®Œæ•´ç»Ÿè®¡åˆ†æç³»ç»Ÿ
â”œâ”€â”€ ğŸŒ å†…ç½‘ç©¿é€æ”¯æŒ
â”œâ”€â”€ âš–ï¸ è´Ÿè½½å‡è¡¡æ¶æ„
â”œâ”€â”€ ğŸš€ å‰åç«¯æ€§èƒ½ä¼˜åŒ–
â”œâ”€â”€ ğŸ“¦ é¡¹ç›®è‡ªåŒ…å«éƒ¨ç½²
â”œâ”€â”€ ğŸ’¾ Redisç¼“å­˜ç³»ç»Ÿé›†æˆ ğŸ†•
â”œâ”€â”€ ğŸ³ Dockerå®¹å™¨åŒ–éƒ¨ç½² ğŸ†•
â””â”€â”€ ğŸ“š å®Œæ•´æŠ€æœ¯æ–‡æ¡£

ğŸ–ï¸ æ€§èƒ½æŒ‡æ ‡ï¼š
â”œâ”€â”€ ğŸ“ˆ å‰ç«¯é¦–å±åŠ è½½: 0.5-1ç§’ï¼ˆä¼˜ç§€çº§åˆ«ï¼‰
â”œâ”€â”€ ğŸ“ˆ APIå“åº”æ—¶é—´: 2-8.5msï¼ˆä¼˜ç§€çº§åˆ«ï¼‰
â”œâ”€â”€ ğŸ”¥ QPSå¤„ç†èƒ½åŠ›: 778+ req/sï¼ˆ15å€æå‡ï¼‰ğŸ†•
â”œâ”€â”€ âš¡ å¹¶å‘å¤„ç†: 4è¿›ç¨‹è´Ÿè½½å‡è¡¡
â”œâ”€â”€ ğŸ›¡ï¸ é«˜å¯ç”¨æ€§: æ•…éšœè‡ªåŠ¨è½¬ç§»
â”œâ”€â”€ ğŸ¯ ç»Ÿä¸€å…¥å£: å…¨æ ˆä¼ä¸šçº§éƒ¨ç½²
â”œâ”€â”€ ğŸ“¦ éƒ¨ç½²å¤æ‚åº¦: Dockerä¸€é”®å¯åŠ¨ ğŸ†•
â”œâ”€â”€ ğŸ’¾ ç¼“å­˜å‘½ä¸­ç‡: 100%ï¼ˆå®Œç¾ç¼“å­˜ï¼‰ğŸ†•
â”œâ”€â”€ ğŸ—„ï¸ æ•°æ®åº“è´Ÿè½½å‡å°‘: 99.2% ğŸ†•
â””â”€â”€ ğŸ³ å®¹å™¨åŒ–æ¶æ„: 6æœåŠ¡ç¼–æ’ ğŸ†•
```

---

## ğŸ‰ é¡¹ç›®æ€»ç»“

### âœ… **ä¸»è¦æˆå°±**

1. **ğŸ—ï¸ å®Œæ•´çš„æ¨¡å—åŒ–æ¶æ„**
   - 15ä¸ªåŠŸèƒ½æ¨¡å—ï¼Œ89ä¸ªAPIæ¥å£
   - é›¶ä¾µå…¥å¼å¼€å‘ï¼Œæ”¯æŒçƒ­æ’æ‹”
   - ç‰ˆæœ¬åŒ–ç®¡ç†ï¼Œå‘åå…¼å®¹

2. **ğŸ’¾ ä¼ä¸šçº§Redisç¼“å­˜ç³»ç»Ÿ** ğŸ†•
   - 6ä¸ªç¼“å­˜æ¨¡å—ï¼Œ77.8%å¹³å‡æ€§èƒ½æå‡
   - å®Œç¾ç¼“å­˜å‘½ä¸­ç‡ï¼Œ99.2%æ•°æ®åº“è´Ÿè½½å‡å°‘
   - QPSå¤„ç†èƒ½åŠ›æå‡15å€ï¼ˆ778+ req/sï¼‰
   - æ™ºèƒ½ç¼“å­˜ç­–ç•¥ï¼Œä¼˜é›…é™çº§æœºåˆ¶

3. **ğŸ³ Dockerå®¹å™¨åŒ–ä¼ä¸šçº§éƒ¨ç½²** ğŸ†•
   - 6ä¸ªæœåŠ¡å®¹å™¨ç¼–æ’ï¼Œä¸€é”®å¯åŠ¨
   - ä¸‰é‡æ•°æ®æŒä¹…åŒ–ï¼ˆMySQL + Redis + æ–‡ä»¶ï¼‰
   - å¥åº·æ£€æŸ¥ + è‡ªåŠ¨é‡å¯ + æ•…éšœè½¬ç§»
   - è´Ÿè½½å‡è¡¡ + é«˜å¯ç”¨æ¶æ„

4. **ğŸš€ å…¨æ ˆä¼ä¸šçº§æ€§èƒ½ä¼˜åŒ–**
   - å‰ç«¯é¦–å±åŠ è½½ï¼š0.5-1ç§’ï¼ˆä¼˜ç§€çº§åˆ«ï¼‰
   - APIå“åº”æ—¶é—´ï¼š2-8.5msï¼ˆä¼˜ç§€çº§åˆ«ï¼‰
   - ç»Ÿä¸€å…¥å£è®¿é—®ï¼Œç”¨æˆ·ä½“éªŒå“è¶Š
   - å‰åç«¯å®Œç¾é›†æˆ

5. **ğŸ“¦ å¼€ç®±å³ç”¨çš„éƒ¨ç½²ä½“éªŒ**
   - é¡¹ç›®è‡ªåŒ…å«ï¼Œæ— éœ€å¤–éƒ¨ä¾èµ–
   - Dockerä¸€é”®å¯åŠ¨è„šæœ¬ï¼Œæç®€éƒ¨ç½²
   - ç¯å¢ƒè‡ªåŠ¨é€‚é…ï¼Œå¼€å‘/ç”Ÿäº§æ— ç¼åˆ‡æ¢
   - å®Œå–„çš„ç›‘æ§å’Œç»´æŠ¤ä½“ç³»

6. **ğŸ¤– æ·±åº¦AIé›†æˆ**
   - ç»Ÿä¸€AIå®¢æˆ·ç«¯
   - å†…å®¹ä¼˜åŒ–ã€å®‰å…¨å®¡æ ¸
   - æ™ºèƒ½æ¨èç®—æ³•

7. **ğŸ“Š å®Œæ•´çš„ä¸šåŠ¡åŠŸèƒ½**
   - ç”¨æˆ·ç³»ç»Ÿã€æ–‡æ¡£ç®¡ç†
   - æ–‡ä»¶ä¸Šä¼ ã€åœ¨çº¿ç¼–è¾‘
   - å‘å¸ƒåˆ†äº«ã€äº’åŠ¨è¯„è®º
   - æŠ€æœ¯å¹¿åœºã€æœç´¢åŠŸèƒ½

8. **ğŸ§ª æ ‡å‡†åŒ–å¼€å‘æµç¨‹**
   - APIå“åº”æ ¼å¼é¢„æµ‹è¯•
   - å®Œæ•´çš„æµ‹è¯•è¦†ç›–ï¼ˆ14ä¸ªæµ‹è¯•è„šæœ¬ï¼‰
   - è¯¦ç»†çš„æŠ€æœ¯æ–‡æ¡£

### ğŸ¯ **æŠ€æœ¯ä»·å€¼**

- **å¯å¤ç”¨çš„æ¶æ„è®¾è®¡**ï¼šé€‚ç”¨äºå…¶ä»–ä¼ä¸šçº§é¡¹ç›®
- **å®Œæ•´çš„å¼€å‘æ–¹æ³•è®º**ï¼šä»å¼€å‘åˆ°éƒ¨ç½²çš„æ ‡å‡†æµç¨‹
- **ä¼ä¸šçº§ç¼“å­˜è§£å†³æ–¹æ¡ˆ**ï¼šRedisç¼“å­˜ç³»ç»Ÿçš„æœ€ä½³å®è·µ
- **å®¹å™¨åŒ–éƒ¨ç½²æ ‡å‡†**ï¼šDockerä¼ä¸šçº§éƒ¨ç½²çš„å®Œæ•´æ–¹æ¡ˆ
- **å…¨æ ˆæ€§èƒ½ä¼˜åŒ–æ–¹æ¡ˆ**ï¼šå‰åç«¯ç»Ÿä¸€ä¼˜åŒ–çš„æœ€ä½³å®è·µ
- **å¼€ç®±å³ç”¨çš„éƒ¨ç½²ä½“éªŒ**ï¼šé¡¹ç›®è‡ªåŒ…å« + ä¸€é”®å¯åŠ¨
- **ä¸°å¯Œçš„å¼€å‘ç»éªŒ**ï¼šé—®é¢˜è§£å†³æ–¹æ¡ˆå’Œæœ€ä½³å®è·µ

### ğŸš€ **é¡¹ç›®å½±å“**

è¿™ä¸ªé¡¹ç›®ä¸ä»…æ˜¯ä¸€ä¸ªåŠŸèƒ½å®Œæ•´çš„æ–‡æ¡£ç®¡ç†ç³»ç»Ÿï¼Œæ›´æ˜¯ä¸€ä¸ª**ä¼ä¸šçº§å…¨æ ˆå¼€å‘çš„æ ‡å‡†èŒƒä¾‹**ï¼Œå±•ç¤ºäº†ä»æ¶æ„è®¾è®¡ã€æ¨¡å—å¼€å‘ã€ç¼“å­˜ä¼˜åŒ–ã€å®¹å™¨åŒ–éƒ¨ç½²åˆ°ä¸€é”®å¯åŠ¨çš„å®Œæ•´æŠ€æœ¯æ ˆå’Œæœ€ä½³å®è·µã€‚

**ç‰¹åˆ«æ˜¯v5.0çš„Redisç¼“å­˜Dockeré›†æˆï¼Œå®ç°äº†ï¼š**
- ğŸ¯ **æ€§èƒ½çš„è´¨çš„é£è·ƒ** - 77.8%å¹³å‡æ€§èƒ½æå‡ï¼ŒQPSæå‡15å€
- ğŸ³ **éƒ¨ç½²çš„é©å‘½æ€§æ”¹è¿›** - ä»å¤æ‚é…ç½®åˆ°Dockerä¸€é”®å¯åŠ¨
- ğŸ’¾ **ç¼“å­˜æ¶æ„çš„å®Œç¾å®ç°** - 6ä¸ªç¼“å­˜æ¨¡å—ï¼Œå®Œç¾å‘½ä¸­ç‡
- ğŸ›ï¸ **ä¼ä¸šçº§æ¶æ„çš„å»ºç«‹** - é«˜å¯ç”¨ + è´Ÿè½½å‡è¡¡ + æ•°æ®æŒä¹…åŒ–

**è¿™æ˜¯ä¸€ä¸ªé‡Œç¨‹ç¢‘å¼çš„ä¼ä¸šçº§æŠ€æœ¯é¡¹ç›®ï¼** ğŸŠ

---

**æ–‡æ¡£ç‰ˆæœ¬**: v9.0  
**ç¼–å†™æ—¥æœŸ**: 2025å¹´12æœˆ2æ—¥  
**æ–‡æ¡£çŠ¶æ€**: âœ… **å®Œæˆ - Redisç¼“å­˜Dockeré›†æˆä¼ä¸šçº§æ ‡å‡†**  
**è®¿é—®åœ°å€**: http://localhost: