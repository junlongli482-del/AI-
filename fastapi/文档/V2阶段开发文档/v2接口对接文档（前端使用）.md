# 📘 FastAPI 文档管理系统 - 前端开发接口文档

> **项目状态**：✅ **后端开发完成，可开始前端开发**  
> **最后更新**：2025年10月16日  
> **接口版本**：v6.0

---

## 📋 目录

- [1. 项目概述](#1-项目概述)
- [2. 环境配置](#2-环境配置)
- [3. 接口文档](#3-接口文档)
- [4. 错误处理](#4-错误处理)
- [5. 开发指南](#5-开发指南)

---

## 1. 项目概述

### 1.1 项目简介

FastAPI文档管理系统是一个企业级文档管理平台，支持用户注册登录、文档管理、AI集成、分享系统等功能。

### 1.2 技术架构

- **后端框架**：FastAPI
- **数据库**：MySQL
- **认证方式**：JWT Token
- **文件支持**：Markdown、PDF

### 1.3 功能模块

```
✅ v1 用户系统 (4个模块)：
├── user_register      ✅ 用户注册
├── user_auth          ✅ 用户认证  
├── user_profile       ✅ 用户中心
└── password_manager   ✅ 密码管理

✅ v2 文档系统 (7个模块)：
├── document_manager   ✅ 文档管理
├── file_upload        ✅ 文件上传
├── md_editor          ✅ MD编辑器
├── ai_review          ✅ AI审核
├── document_publish   ✅ 文档发布
├── tech_square        ✅ 技术广场
├── interaction        ✅ 互动功能
└── share_system       ✅ 分享系统
```

---

## 2. 环境配置

### 2.1 基础信息

- **API基础地址**：`http://localhost:8100`
- **认证方式**：`Authorization: Bearer <access_token>`
- **Content-Type**：`application/json`

### 2.2 测试账号

- **用户名**：`abc`
- **密码**：`ljl18420`
- **邮箱**：`ljlaa@qq.com`

### 2.3 登录示例

```javascript
// 登录接口调用示例
const loginResponse = await fetch('http://localhost:8100/api/v1/user_auth/login', {
  method: 'POST',
  headers: {
    'Content-Type': 'application/json'
  },
  body: JSON.stringify({
    username_or_email: 'abc',
    password: 'ljl18420'
  })
});

const loginData = await loginResponse.json();
// 返回格式：
// {
//   "access_token": "eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9...",
//   "refresh_token": "eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9...",
//   "token_type": "bearer",
//   "expires_in": 1800
// }
```

---

## 3. 接口文档

### 3.1 v1 用户系统接口

#### 3.1.1 用户注册模块 (`/api/v1/user_register`)

| 接口路径 | 方法 | 功能 | 认证 | 说明 |
|----------|------|------|------|------|
| `/register` | POST | 用户注册 | ❌ | 注册新用户账号 |
| `/check-username/{username}` | GET | 检查用户名可用性 | ❌ | 实时验证用户名 |
| `/check-email/{email}` | GET | 检查邮箱可用性 | ❌ | 实时验证邮箱 |

**注册接口示例**：
```javascript
const registerData = {
  username: "newuser",
  email: "user@example.com",
  password: "securePassword123"
};

const response = await fetch('/api/v1/user_register/register', {
  method: 'POST',
  headers: { 'Content-Type': 'application/json' },
  body: JSON.stringify(registerData)
});
```

#### 3.1.2 用户认证模块 (`/api/v1/user_auth`)

| 接口路径 | 方法 | 功能 | 认证 | 说明 |
|----------|------|------|------|------|
| `/login` | POST | 用户登录 | ❌ | 获取访问令牌 |
| `/refresh` | POST | 刷新token | ✅ | 刷新访问令牌 |
| `/logout` | POST | 退出登录 | ✅ | 注销当前会话 |

#### 3.1.3 用户中心模块 (`/api/v1/user_profile`)

| 接口路径 | 方法 | 功能 | 认证 | 说明 |
|----------|------|------|------|------|
| `/me` | GET | 获取当前用户信息 | ✅ | 用户个人信息 |
| `/nickname` | PUT | 更新昵称 | ✅ | 修改用户昵称 |
| `/check-nickname/{nickname}` | GET | 检查昵称可用性 | ✅ | 实时验证昵称 |
| `/user-info` | GET | 获取用户信息 | ✅ | 详细用户信息 |

#### 3.1.4 密码管理模块 (`/api/v1/password_manager`)

| 接口路径 | 方法 | 功能 | 认证 | 说明 |
|----------|------|------|------|------|
| `/change-password` | POST | 修改密码 | ✅ | 更改用户密码 |
| `/check-strength` | POST | 检查密码强度 | ❌ | 密码强度验证 |

---

### 3.2 v2 文档系统接口

#### 3.2.1 文档管理模块 (`/api/v2/document_manager`)

**文件夹管理**：
| 接口路径 | 方法 | 功能 | 认证 | 说明 |
|----------|------|------|------|------|
| `/folders` | POST | 创建文件夹 | ✅ | 最多3层嵌套 |
| `/folders/tree` | GET | 获取文件夹树 | ✅ | 树形结构展示 |
| `/folders/{folder_id}` | DELETE | 删除文件夹 | ✅ | 级联删除 |

**文档管理**：
| 接口路径 | 方法 | 功能 | 认证 | 说明 |
|----------|------|------|------|------|
| `/documents` | POST | 创建文档 | ✅ | 新建文档 |
| `/documents` | GET | 获取文档列表 | ✅ | 支持分页筛选 |
| `/documents/{doc_id}` | GET | 获取文档详情 | ✅ | 文档完整信息 |
| `/documents/{doc_id}` | PUT | 更新文档 | ✅ | 修改文档内容 |
| `/documents/{doc_id}` | DELETE | 删除文档 | ✅ | 删除文档 |
| `/stats` | GET | 获取统计信息 | ✅ | 文档统计数据 |

**文档列表查询参数**：
```javascript
const params = {
  page: 1,           // 页码
  size: 10,          // 每页数量
  folder_id: null,   // 文件夹ID筛选
  file_type: 'md',   // 文件类型筛选 (md/pdf)
  status: 'draft'    // 状态筛选 (draft/published/review_failed)
};
```

#### 3.2.2 文件上传模块 (`/api/v2/file_upload`)

| 接口路径 | 方法 | 功能 | 认证 | 说明 |
|----------|------|------|------|------|
| `/config` | GET | 获取上传配置 | ✅ | 文件大小限制等 |
| `/validate` | POST | 验证文件 | ✅ | 上传前验证 |
| `/upload` | POST | 上传文件 | ✅ | 支持MD/PDF |
| `/uploads` | GET | 获取上传历史 | ✅ | 分页查询 |
| `/uploads/{upload_id}` | GET | 获取上传详情 | ✅ | 单个文件信息 |
| `/create-document` | POST | 创建文档 | ✅ | 从上传文件创建 |
| `/uploads/{upload_id}` | DELETE | 删除上传记录 | ✅ | 删除文件 |
| `/stats` | GET | 获取上传统计 | ✅ | 上传统计数据 |

**文件上传示例**：
```javascript
const formData = new FormData();
formData.append('file', fileInput.files[0]);

const response = await fetch('/api/v2/file_upload/upload', {
  method: 'POST',
  headers: {
    'Authorization': `Bearer ${token}`
  },
  body: formData
});
```

#### 3.2.3 MD编辑器模块 (`/api/v2/md_editor`)

**会话管理**：
| 接口路径 | 方法 | 功能 | 认证 | 说明 |
|----------|------|------|------|------|
| `/config` | GET | 获取编辑器配置 | ✅ | 编辑器设置 |
| `/sessions` | POST | 创建编辑器会话 | ✅ | 新建/编辑会话 |
| `/sessions` | GET | 获取会话列表 | ✅ | 分页查询 |
| `/sessions/{session_id}` | GET | 获取会话详情 | ✅ | 会话内容 |
| `/sessions/{session_id}` | PUT | 更新会话内容 | ✅ | 保存草稿 |
| `/sessions/{session_id}` | DELETE | 删除会话 | ✅ | 删除会话 |

**AI优化功能**：
| 接口路径 | 方法 | 功能 | 认证 | 说明 |
|----------|------|------|------|------|
| `/sessions/{session_id}/optimize` | POST | AI优化内容 | ✅ | 内容优化 |
| `/sessions/{session_id}/apply-optimization/{optimization_id}` | POST | 应用优化结果 | ✅ | 应用AI建议 |
| `/sessions/{session_id}/optimizations` | GET | 获取优化历史 | ✅ | 优化记录 |

**文档保存**：
| 接口路径 | 方法 | 功能 | 认证 | 说明 |
|----------|------|------|------|------|
| `/sessions/{session_id}/save-document` | POST | 保存为正式文档 | ✅ | 发布文档 |
| `/stats` | GET | 获取编辑器统计 | ✅ | 使用统计 |

#### 3.2.4 AI审核模块 (`/api/v2/ai_review`)

| 接口路径 | 方法 | 功能 | 认证 | 说明 |
|----------|------|------|------|------|
| `/submit-review` | POST | 提交文档审核 | ✅ | 手动提交审核 |
| `/review-status/{document_id}` | GET | 查询审核状态 | ✅ | 审核进度查询 |
| `/review-history` | GET | 获取审核历史 | ✅ | 历史记录 |
| `/review-detail/{review_id}` | GET | 获取审核详情 | ✅ | 详细审核结果 |
| `/retry-review/{document_id}` | POST | 重新审核文档 | ✅ | 重新提交审核 |
| `/stats` | GET | 获取审核统计 | ✅ | 审核统计数据 |
| `/config` | GET | 获取审核配置 | ✅ | 审核规则配置 |
| `/recent-reviews` | GET | 获取最近审核 | ✅ | 最近审核记录 |

#### 3.2.5 文档发布模块 (`/api/v2/document_publish`)

| 接口路径 | 方法 | 功能 | 认证 | 说明 |
|----------|------|------|------|------|
| `/submit` | POST | 提交文档发布 | ✅ | 发布文档到广场 |
| `/published` | GET | 获取已发布文档 | ❌ | 公开文档列表 |
| `/document/{doc_id}` | GET | 获取文档发布详情 | ✅ | 发布状态信息 |
| `/unpublish/{doc_id}` | POST | 撤回已发布文档 | ✅ | 取消发布 |
| `/my-records` | GET | 获取我的发布记录 | ✅ | 个人发布历史 |
| `/stats` | GET | 获取发布统计 | ✅ | 发布统计数据 |
| `/view/{doc_id}` | POST | 增加文档浏览量 | ❌ | 浏览量统计 |
| `/status/{doc_id}` | GET | 获取文档发布状态 | ✅ | 发布状态查询 |
| `/config` | GET | 获取发布配置 | ❌ | 发布规则配置 |

#### 3.2.6 技术广场模块 (`/api/v2/tech_square`)

| 接口路径 | 方法 | 功能 | 认证 | 说明 |
|----------|------|------|------|------|
| `/documents` | GET | 获取文档列表 | ❌ | 支持筛选排序 |
| `/documents/{document_id}` | GET | 获取文档详情 | ❌ | 文档完整内容 |
| `/search` | GET | 搜索文档 | ❌ | 关键词搜索 |
| `/category-stats` | GET | 获取分类统计 | ❌ | 分类数量统计 |
| `/hot-documents` | GET | 获取热门文档 | ❌ | 热门推荐 |
| `/latest-documents` | GET | 获取最新文档 | ❌ | 最新发布 |
| `/stats` | GET | 获取技术广场统计 | ❌ | 整体统计 |
| `/view/{document_id}` | POST | 增加文档浏览量 | ❌ | 浏览量+1 |

**查询参数示例**：
```javascript
const params = {
  page: 1,
  size: 10,
  file_type: 'md',        // 文件类型筛选
  sort_by: 'latest',      // 排序方式: latest/popular/recommended
  time_range: 'week',     // 时间范围: day/week/month/all
  keyword: '搜索关键词'    // 搜索关键词
};
```

#### 3.2.7 互动功能模块 (`/api/v2/interaction`)

| 接口路径 | 方法 | 功能 | 认证 | 说明 |
|----------|------|------|------|------|
| `/documents/{document_id}/like` | POST | 切换点赞状态 | ✅ | 点赞/取消点赞 |
| `/documents/{document_id}/like-status` | GET | 获取点赞状态 | ❌ | 查询是否已点赞 |
| `/documents/{document_id}/favorite` | POST | 切换收藏状态 | ✅ | 收藏/取消收藏 |
| `/documents/{document_id}/favorite-status` | GET | 获取收藏状态 | ❌ | 查询是否已收藏 |
| `/my-favorites` | GET | 获取我的收藏列表 | ✅ | 个人收藏夹 |
| `/documents/{document_id}/comments` | POST | 创建评论或回复 | ✅ | 发表评论 |
| `/documents/{document_id}/comments` | GET | 获取评论列表 | ❌ | 文档评论 |
| `/comments/{comment_id}` | PUT | 更新评论 | ✅ | 修改评论 |
| `/comments/{comment_id}` | DELETE | 删除评论 | ✅ | 删除评论 |
| `/documents/{document_id}/stats` | GET | 获取文档互动统计 | ❌ | 点赞收藏数 |
| `/my-stats` | GET | 获取我的互动统计 | ✅ | 个人互动数据 |

**评论结构**：
```javascript
// 创建评论
const commentData = {
  content: "这是一条评论",
  parent_id: null  // null为主评论，有值为回复
};

// 评论返回格式
{
  "id": 1,
  "content": "评论内容",
  "user_id": 1,
  "username": "用户名",
  "parent_id": null,
  "created_at": "2024-01-01T12:00:00",
  "replies": [...]  // 回复列表
}
```

#### 3.2.8 分享系统模块 (`/api/v2/share_system`)

| 接口路径 | 方法 | 功能 | 认证 | 说明 |
|----------|------|------|------|------|
| `/create` | POST | 创建文档分享 | ✅ | 生成分享链接 |
| `/my-shares` | GET | 获取我的分享列表 | ✅ | 个人分享管理 |
| `/detail/{share_id}` | GET | 获取分享详情 | ✅ | 分享配置信息 |
| `/update/{share_id}` | PUT | 更新分享配置 | ✅ | 修改分享设置 |
| `/delete/{share_id}` | DELETE | 删除分享 | ✅ | 删除分享链接 |
| `/public/{share_code}` | POST | 访问分享文档 | 🔓 | 访问分享内容 |
| `/public/{share_code}` | GET | 访问分享文档 | 🔓 | 获取分享内容 |
| `/download/{share_code}` | GET | 下载分享文档 | 🔓 | 下载文档文件 |
| `/stats` | GET | 获取分享统计 | ✅ | 分享数据统计 |
| `/toggle-status/{share_id}` | POST | 切换分享状态 | ✅ | 启用/禁用分享 |
| `/config` | GET | 获取分享配置 | ❌ | 分享规则配置 |

**分享类型说明**：
- **🌐 公开分享**：任何人都可以访问，无需登录
- **🔒 私有分享**：需要登录才能访问
- **🔑 密码分享**：需要输入密码才能访问

**创建分享示例**：
```javascript
const shareData = {
  document_id: 1,
  share_type: "public",     // public/private/password
  share_password: null,     // 密码分享时必填
  allow_download: true,     // 是否允许下载
  allow_comment: true,      // 是否允许评论
  expire_hours: 168         // 过期时间（小时）
};

const response = await fetch('/api/v2/share_system/create', {
  method: 'POST',
  headers: {
    'Authorization': `Bearer ${token}`,
    'Content-Type': 'application/json'
  },
  body: JSON.stringify(shareData)
});
```

**访问分享示例**：
```javascript
// 访问公开分享
const response = await fetch(`/api/v2/share_system/public/${shareCode}`, {
  method: 'POST',
  headers: { 'Content-Type': 'application/json' },
  body: JSON.stringify({})
});

// 访问密码分享
const response = await fetch(`/api/v2/share_system/public/${shareCode}`, {
  method: 'POST',
  headers: { 'Content-Type': 'application/json' },
  body: JSON.stringify({ password: "分享密码" })
});
```

---

## 4. 错误处理

### 4.1 HTTP状态码

| 状态码 | 说明 | 常见场景 |
|--------|------|----------|
| 200 | 成功 | 操作成功完成 |
| 400 | 请求错误 | 参数验证失败、业务逻辑错误 |
| 401 | 认证失败 | Token无效或过期 |
| 404 | 资源不存在 | 文档、用户不存在 |
| 422 | 数据格式错误 | JSON格式错误 |
| 500 | 服务器错误 | 内部服务器错误 |

### 4.2 错误响应格式

```javascript
// 错误响应示例
{
  "detail": "错误描述信息"
}

// 验证错误响应示例
{
  "detail": [
    {
      "loc": ["body", "email"],
      "msg": "field required",
      "type": "value_error.missing"
    }
  ]
}
```

### 4.3 前端错误处理建议

```javascript
// 统一错误处理函数
async function apiRequest(url, options = {}) {
  try {
    const response = await fetch(url, {
      ...options,
      headers: {
        'Content-Type': 'application/json',
        ...options.headers
      }
    });
    
    if (!response.ok) {
      const errorData = await response.json();
      throw new Error(errorData.detail || '请求失败');
    }
    
    return await response.json();
  } catch (error) {
    console.error('API请求错误:', error);
    throw error;
  }
}

// Token过期处理
function handleTokenExpired() {
  localStorage.removeItem('access_token');
  localStorage.removeItem('refresh_token');
  // 重定向到登录页
  window.location.href = '/login';
}
```

---

## 5. 开发指南

### 5.1 认证流程

```javascript
// 1. 用户登录
const loginData = await apiRequest('/api/v1/user_auth/login', {
  method: 'POST',
  body: JSON.stringify({
    username_or_email: 'abc',
    password: 'ljl18420'
  })
});

// 2. 保存Token
localStorage.setItem('access_token', loginData.access_token);
localStorage.setItem('refresh_token', loginData.refresh_token);

// 3. 后续请求携带Token
const headers = {
  'Authorization': `Bearer ${localStorage.getItem('access_token')}`,
  'Content-Type': 'application/json'
};

// 4. Token刷新
async function refreshToken() {
  const refreshToken = localStorage.getItem('refresh_token');
  const response = await fetch('/api/v1/user_auth/refresh', {
    method: 'POST',
    headers: {
      'Authorization': `Bearer ${refreshToken}`,
      'Content-Type': 'application/json'
    }
  });
  
  if (response.ok) {
    const data = await response.json();
    localStorage.setItem('access_token', data.access_token);
    return data.access_token;
  } else {
    handleTokenExpired();
  }
}
```

### 5.2 分页处理

```javascript
// 分页查询示例
async function fetchDocuments(page = 1, size = 10, filters = {}) {
  const params = new URLSearchParams({
    page: page.toString(),
    size: size.toString(),
    ...filters
  });
  
  const response = await apiRequest(
    `/api/v2/document_manager/documents?${params}`,
    {
      headers: {
        'Authorization': `Bearer ${localStorage.getItem('access_token')}`
      }
    }
  );
  
  return response;
  // 返回格式：
  // {
  //   "items": [...],
  //   "total": 100,
  //   "page": 1,
  //   "size": 10,
  //   "pages": 10
  // }
}
```

### 5.3 文件上传处理

```javascript
// 文件上传示例
async function uploadFile(file) {
  const formData = new FormData();
  formData.append('file', file);
  
  const response = await fetch('/api/v2/file_upload/upload', {
    method: 'POST',
    headers: {
      'Authorization': `Bearer ${localStorage.getItem('access_token')}`
    },
    body: formData
  });
  
  if (!response.ok) {
    throw new Error('文件上传失败');
  }
  
  return await response.json();
}

// 文件验证
async function validateFile(file) {
  const formData = new FormData();
  formData.append('file', file);
  
  const response = await fetch('/api/v2/file_upload/validate', {
    method: 'POST',
    headers: {
      'Authorization': `Bearer ${localStorage.getItem('access_token')}`
    },
    body: formData
  });
  
  return await response.json();
}
```

### 5.4 实时功能建议

```javascript
// 定期检查审核状态
async function checkReviewStatus(documentId) {
  const response = await apiRequest(
    `/api/v2/ai_review/review-status/${documentId}`,
    {
      headers: {
        'Authorization': `Bearer ${localStorage.getItem('access_token')}`
      }
    }
  );
  
  return response.status; // pending/passed/failed/error
}

// 轮询审核状态
function pollReviewStatus(documentId, callback) {
  const interval = setInterval(async () => {
    try {
      const status = await checkReviewStatus(documentId);
      if (status !== 'pending') {
        clearInterval(interval);
        callback(status);
      }
    } catch (error) {
      clearInterval(interval);
      callback('error');
    }
  }, 3000); // 每3秒检查一次
}
```

### 5.5 开发建议

1. **统一API调用**：封装统一的API请求函数
2. **错误处理**：建立完善的错误处理机制
3. **Token管理**：实现自动Token刷新
4. **分页组件**：封装可复用的分页组件
5. **文件上传**：支持拖拽上传和进度显示
6. **实时更新**：对于审核状态等使用轮询或WebSocket
7. **缓存策略**：合理使用本地缓存减少API调用
8. **用户体验**：添加加载状态和友好的错误提示

---

## 📊 接口总览

```
接口统计：
├── v1 用户系统: 12个接口
├── v2 文档管理: 8个接口
├── v2 文件上传: 8个接口
├── v2 MD编辑器: 11个接口
├── v2 AI审核: 9个接口
├── v2 文档发布: 10个接口
├── v2 技术广场: 8个接口
├── v2 互动功能: 11个接口
└── v2 分享系统: 12个接口

总计: 89个接口
认证接口: 67个
公开接口: 22个
```

**🎯 开发优先级建议**：
1. **用户系统** → 登录注册功能
2. **文档管理** → 基础文档CRUD
3. **文件上传** → 文件上传功能
4. **技术广场** → 文档展示页面
5. **互动功能** → 点赞评论功能
6. **分享系统** → 文档分享功能
7. **MD编辑器** → 在线编辑器
8. **AI功能** → AI审核和优化