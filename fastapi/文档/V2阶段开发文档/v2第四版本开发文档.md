# 📘 FastAPI 模块化文档管理系统 - 完整技术文档 (v3.2)

> **最后更新**：2025年10月16日  
> **项目状态**：✅ `ai_review` 模块开发完成并通过测试  
> **架构原则**：模块化 + 版本化 + 零侵入 + 自动注册

---

## 📋 目录

- [1. 接口文档](#1-接口文档)
- [2. 开发文档](#2-开发文档)
- [3. 继续开发指南](#3-继续开发指南)
- [4. 快速启动命令](#4-快速启动命令)

---

## 1. 接口文档

### 1.1 基础信息

- **基础地址**：`http://localhost:8100`
- **认证方式**：`Authorization: Bearer <access_token>`
- **Content-Type**：`application/json`

---

### 1.2 v1 用户系统接口（✅ 已完成）

| 接口路径 | 方法 | 功能 | 认证 |
|----------|------|------|------|
| `/register` | POST | 用户注册 | ❌ |
| `/check-username/{username}` | GET | 检查用户名可用性 | ❌ |
| `/check-email/{email}` | GET | 检查邮箱可用性 | ❌ |
| `/login` | POST | 用户登录 | ❌ |
| `/me` | GET | 获取当前用户信息 | ✅ |
| `/refresh` | POST | 刷新token | ✅ |
| `/nickname` | PUT | 更新昵称 | ✅ |
| `/check-nickname/{nickname}` | GET | 检查昵称可用性 | ✅ |
| `/logout` | POST | 退出登录 | ✅ |
| `/change-password` | POST | 修改密码 | ✅ |
| `/check-strength` | POST | 检查密码强度 | ❌ |
| `/user-info` | GET | 获取用户信息 | ✅ |

---

### 1.3 v2 文档管理接口（✅ 已完成）

#### 文件夹管理
| 接口路径 | 方法 | 功能 | 认证 |
|----------|------|------|------|
| `/folders` | POST | 创建文件夹 | ✅ |
| `/folders/tree` | GET | 获取文件夹树 | ✅ |
| `/folders/{folder_id}` | DELETE | 删除文件夹 | ✅ |

#### 文档管理
| 接口路径 | 方法 | 功能 | 认证 |
|----------|------|------|------|
| `/documents` | POST | 创建文档 | ✅ |
| `/documents` | GET | 获取文档列表（分页） | ✅ |
| `/documents/{doc_id}` | GET | 获取文档详情 | ✅ |
| `/documents/{doc_id}` | PUT | 更新文档 | ✅ |
| `/documents/{doc_id}` | DELETE | 删除文档 | ✅ |
| `/stats` | GET | 获取统计信息 | ✅ |

---

### 1.4 v2 文件上传接口（✅ 已完成）

| 接口路径 | 方法 | 功能 | 认证 |
|----------|------|------|------|
| `/test` | GET | 测试接口 | ❌ |
| `/config` | GET | 获取上传配置 | ✅ |
| `/validate` | POST | 验证文件（不保存） | ✅ |
| `/upload` | POST | 上传文件 | ✅ |
| `/uploads` | GET | 获取上传历史（分页） | ✅ |
| `/uploads/{upload_id}` | GET | 获取上传详情 | ✅ |
| `/create-document` | POST | 从上传文件创建文档 | ✅ |
| `/uploads/{upload_id}` | DELETE | 删除上传记录 | ✅ |
| `/stats` | GET | 获取上传统计 | ✅ |

---

### 1.5 v2 MD编辑器接口（✅ 已完成）

#### 会话管理
| 接口路径 | 方法 | 功能 | 认证 |
|----------|------|------|------|
| `/test` | GET | 测试接口 | ❌ |
| `/config` | GET | 获取编辑器配置 | ✅ |
| `/sessions` | POST | 创建编辑器会话 | ✅ |
| `/sessions` | GET | 获取会话列表（分页） | ✅ |
| `/sessions/{session_id}` | GET | 获取会话详情 | ✅ |
| `/sessions/{session_id}` | PUT | 更新会话内容 | ✅ |
| `/sessions/{session_id}` | DELETE | 删除会话 | ✅ |

#### AI优化功能
| 接口路径 | 方法 | 功能 | 认证 |
|----------|------|------|------|
| `/sessions/{session_id}/optimize` | POST | AI优化内容 | ✅ |
| `/sessions/{session_id}/apply-optimization/{optimization_id}` | POST | 应用优化结果 | ✅ |
| `/sessions/{session_id}/optimizations` | GET | 获取优化历史 | ✅ |

#### 文档保存
| 接口路径 | 方法 | 功能 | 认证 |
|----------|------|------|------|
| `/sessions/{session_id}/save-document` | POST | 保存为正式文档 | ✅ |
| `/stats` | GET | 获取编辑器统计 | ✅ |

---

### 1.6 v2 AI审核接口（✅ 新增）

| 接口路径 | 方法 | 功能 | 认证 |
|----------|------|------|------|
| `/test` | GET | 测试接口 | ❌ |
| `/submit-review` | POST | 提交文档审核 | ✅ |
| `/review-status/{document_id}` | GET | 查询审核状态 | ✅ |
| `/review-history` | GET | 获取审核历史 | ✅ |
| `/review-detail/{review_id}` | GET | 获取审核详情 | ✅ |
| `/retry-review/{document_id}` | POST | 重新审核文档 | ✅ |
| `/stats` | GET | 获取审核统计 | ✅ |
| `/config` | GET | 获取审核配置 | ✅ |
| `/review-log/{review_id}` | DELETE | 删除审核记录 | ✅ |
| `/recent-reviews` | GET | 获取最近审核 | ✅ |

#### 📌 关键接口示例

**提交文档审核**
```bash
curl -X POST "http://localhost:8100/api/v2/ai_review/submit-review?document_id=123" \
  -H "Authorization: Bearer YOUR_TOKEN"
```

**查询审核状态**
```bash
curl -H "Authorization: Bearer YOUR_TOKEN" \
  http://localhost:8100/api/v2/ai_review/review-status/123
```

---

### 1.7 错误码说明

| 状态码 | 说明 | 示例 |
|--------|------|------|
| 200 | 成功 | 操作成功完成 |
| 400 | 请求错误 | 参数验证失败、业务逻辑错误 |
| 401 | 认证失败 | Token无效或过期 |
| 404 | 资源不存在 | 文档、会话或文件夹不存在 |
| 422 | 数据格式错误 | JSON格式错误、字段类型错误 |
| 500 | 服务器错误 | 内部服务器错误、AI服务异常 |

---

## 2. 开发文档

### 2.1 项目目录结构

```bash
fastapi/
├── app/
│   ├── core/                     # 核心基础设施
│   │   ├── __init__.py
│   │   ├── config.py             # JWT/DB/Token 配置
│   │   ├── database.py           # SQLAlchemy 引擎 + SessionLocal
│   │   └── ai_client.py          # 🆕 AI客户端（集成自定义AI服务）
│   │
│   ├── modules/                  # 业务模块根目录
│   │   ├── v1/                   # API 版本 v1（用户系统）
│   │   │   ├── __init__.py
│   │   │   ├── user_register/    # ✅ 用户注册模块
│   │   │   ├── user_auth/        # ✅ 用户认证模块
│   │   │   ├── user_profile/     # ✅ 用户中心模块
│   │   │   └── password_manager/ # ✅ 密码管理模块
│   │   │
│   │   └── v2/                   # API 版本 v2（文档系统）
│   │       ├── __init__.py
│   │       ├── document_manager/ # ✅ 文档管理模块
│   │       ├── file_upload/      # ✅ 文件上传模块
│   │       ├── md_editor/        # ✅ MD编辑器模块
│   │       └── ai_review/        # ✅ AI审核模块（新增）
│   │           ├── models.py     # AIReviewLog, ReviewRule ORM 模型
│   │           ├── schemas.py    # API验证模型
│   │           ├── services.py   # 审核业务逻辑 + AI集成
│   │           ├── routes.py     # API路由
│   │           └── dependencies.py # 依赖注入
│   │
│   └── main.py                   # 🚀 应用入口：自动扫描并注册模块
│
├── uploads/                      # 文件上传目录
│   └── user_{user_id}/           # 用户隔离的上传目录
│       └── documents/            # 文档文件存储
│
├── .env                          # 环境变量
├── requirements.txt              # 依赖列表
├── README.md                     # 项目说明
└── 测试脚本/
    └── v2测试脚本/
        ├── test_document_manager_clean.py
        ├── test_file_upload_clean.py
        ├── test_md_editor_clean.py
        └── test_ai_review_clean.py      # ✅ 新增测试脚本
```

---

### 2.2 技术架构

#### 2.2.1 架构设计原则

- **模块化设计**：每个功能独立成模块，互不干扰
- **版本化管理**：v1用户系统，v2文档系统，支持并行开发
- **自动注册**：新模块无需修改`main.py`，自动发现和注册
- **零侵入原则**：新增功能不影响现有功能
- **统一依赖管理**：所有模块共享`core`中的基础设施
- **AI服务集成**：统一AI客户端，支持多种AI服务配置

#### 2.2.2 AI集成架构

- **AI客户端设计**：
  ```python
  # app/core/ai_client.py
  class AIClient:
      def __init__(self, api_url, api_key):
          self.api_url = api_url
          self.api_key = api_key
      
      def optimize_markdown(self, content, optimization_type):
          # 调用AI服务优化MD内容
          pass
      
      def chat_with_ai(self, query, file_ids=None):
          # 通用AI对话接口
          pass
  ```

- **AI服务端预设提示词**：审核逻辑由AI服务端处理，客户端仅负责内容传递和结果解析

---

### 2.3 数据库设计

#### 2.3.1 用户系统表（v1）

```sql
CREATE TABLE us_users (
    id INT AUTO_INCREMENT PRIMARY KEY,
    username VARCHAR(50) NOT NULL UNIQUE,
    email VARCHAR(100) NOT NULL UNIQUE,
    password_hash VARCHAR(255) NOT NULL,
    nickname VARCHAR(50) DEFAULT NULL UNIQUE,
    is_active BOOLEAN DEFAULT TRUE,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
);
```

#### 2.3.2 文档系统表（v2）

```sql
-- 文件夹表
CREATE TABLE us_folders (
    id INT AUTO_INCREMENT PRIMARY KEY,
    name VARCHAR(100) NOT NULL,
    parent_id INT DEFAULT NULL,
    user_id INT NOT NULL,
    level TINYINT DEFAULT 1,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    FOREIGN KEY (parent_id) REFERENCES us_folders(id) ON DELETE CASCADE,
    FOREIGN KEY (user_id) REFERENCES us_users(id) ON DELETE CASCADE
);

-- 文档表
CREATE TABLE us_documents (
    id INT AUTO_INCREMENT PRIMARY KEY,
    title VARCHAR(200) NOT NULL,
    content LONGTEXT,
    file_path VARCHAR(500),
    file_type ENUM('md', 'pdf') NOT NULL DEFAULT 'md',
    file_size INT DEFAULT 0,
    summary TEXT,
    status ENUM('draft', 'published', 'review_failed') DEFAULT 'draft',
    publish_time TIMESTAMP NULL,
    review_message TEXT,
    folder_id INT DEFAULT NULL,
    user_id INT NOT NULL,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    FOREIGN KEY (folder_id) REFERENCES us_folders(id) ON DELETE SET NULL,
    FOREIGN KEY (user_id) REFERENCES us_users(id) ON DELETE CASCADE
);

-- 文件上传表
CREATE TABLE us_upload_records (
    id INT AUTO_INCREMENT PRIMARY KEY,
    original_filename VARCHAR(255) NOT NULL,
    stored_filename VARCHAR(255) NOT NULL,
    file_path VARCHAR(500) NOT NULL,
    file_size INT NOT NULL,
    file_type ENUM('md', 'pdf') NOT NULL,
    mime_type VARCHAR(100) NOT NULL,
    status ENUM('uploading', 'uploaded', 'validated', 'failed', 'deleted') DEFAULT 'uploading',
    validation_message TEXT,
    user_id INT NOT NULL,
    document_id INT DEFAULT NULL,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    FOREIGN KEY (user_id) REFERENCES us_users(id) ON DELETE CASCADE,
    FOREIGN KEY (document_id) REFERENCES us_documents(id) ON DELETE SET NULL
);

-- 编辑器会话表
CREATE TABLE us_editor_sessions (
    id INT AUTO_INCREMENT PRIMARY KEY,
    document_id INT DEFAULT NULL,
    user_id INT NOT NULL,
    title VARCHAR(200) DEFAULT NULL,
    content LONGTEXT,
    is_draft BOOLEAN DEFAULT TRUE,
    session_type ENUM('new_document', 'edit_document') DEFAULT 'new_document',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    FOREIGN KEY (document_id) REFERENCES us_documents(id) ON DELETE CASCADE,
    FOREIGN KEY (user_id) REFERENCES us_users(id) ON DELETE CASCADE,
    INDEX idx_user_id (user_id),
    INDEX idx_document_id (document_id),
    INDEX idx_session_type (session_type)
);

-- AI优化记录表
CREATE TABLE us_ai_optimizations (
    id INT AUTO_INCREMENT PRIMARY KEY,
    session_id INT NOT NULL,
    user_id INT NOT NULL,
    original_content LONGTEXT NOT NULL,
    optimized_content LONGTEXT NOT NULL,
    optimization_prompt TEXT,
    ai_provider VARCHAR(50) DEFAULT 'default',
    status ENUM('pending', 'completed', 'failed') DEFAULT 'completed',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (session_id) REFERENCES us_editor_sessions(id) ON DELETE CASCADE,
    FOREIGN KEY (user_id) REFERENCES us_users(id) ON DELETE CASCADE,
    INDEX idx_session_id (session_id),
    INDEX idx_user_id (user_id),
    INDEX idx_created_at (created_at)
);
```

#### 2.3.3 AI审核表（v2）🆕

```sql
-- AI审核日志表
CREATE TABLE us_ai_review_logs (
    id INT AUTO_INCREMENT PRIMARY KEY,
    document_id INT NOT NULL,
    user_id INT NOT NULL,
    review_type ENUM('content_safety') NOT NULL,
    ai_provider VARCHAR(50) DEFAULT 'default',
    file_id VARCHAR(100) DEFAULT NULL,
    review_prompt TEXT NOT NULL,
    ai_response LONGTEXT,
    review_result ENUM('pending', 'passed', 'failed', 'error') DEFAULT 'pending',
    failure_reason TEXT,
    confidence_score DECIMAL(3,2) DEFAULT NULL,
    review_duration INT DEFAULT NULL,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    FOREIGN KEY (document_id) REFERENCES us_documents(id) ON DELETE CASCADE,
    FOREIGN KEY (user_id) REFERENCES us_users(id) ON DELETE CASCADE,
    INDEX idx_document_id (document_id),
    INDEX idx_user_id (user_id),
    INDEX idx_review_result (review_result),
    INDEX idx_created_at (created_at)
);
```

> 💡 **说明**：`ReviewRule` 表设计已预留，当前仅启用内容安全审核（`content_safety`）

---

### 2.4 已完成功能清单 ✅

#### v1 用户系统
- ✅ 用户注册 (`user_register`)
- ✅ 用户认证 (`user_auth`)
- ✅ 用户中心 (`user_profile`)
- ✅ 密码管理 (`password_manager`)

#### v2 文档系统
- ✅ 文档管理 (`document_manager`)
  - 文档CRUD操作
  - 分层级文件夹管理（最多3层）
  - 分页查询
  - 统计功能
- ✅ 文件上传 (`file_upload`)
  - 支持MD、PDF格式上传
  - 文件验证（格式、大小、内容完整性）
  - 上传历史管理
  - 与文档系统集成
  - 统计功能
- ✅ MD编辑器 (`md_editor`)
  - 编辑器会话管理（新建/编辑文档）
  - AI内容优化功能（集成自定义AI服务）
  - 优化历史记录
  - 草稿自动保存
  - 与文档系统深度集成
  - 多种优化模式（通用、语法、结构、扩展）
- ✅ AI审核 (`ai_review`) 🆕
  - 文档大小检查（PDF ≤ 10页，MD ≤ 1000行）
  - AI内容安全审核（政治、暴力、色情等）
  - 审核状态管理
  - 审核历史记录
  - 审核统计分析

---

### 2.5 待开发功能清单 🔄

| 优先级 | 模块 | 功能描述 |
|--------|------|----------|
| 🔴 高 | `document_publish` | 发布管理系统：文档发布流程、状态控制、权限管理 |
| 🟠 中 | `tech_square` | 技术广场：文档展示、搜索、排序、分类筛选 |
| 🟡 低 | `interaction` | 互动功能：点赞、收藏、评论（二层结构） |
| 🟡 低 | `share_system` | 分享链接系统：生成链接、权限控制、统计分析 |

> **模块依赖关系**：`ai_review` → `document_publish` → `tech_square` → `interaction` → `share_system`

---

## 3. 继续开发指南

### 3.1 项目背景信息

**项目名称**：文档管理与技术广场产品  
**项目目标**：在现有用户系统基础上，构建完整的文档管理和技术分享平台  
**核心价值**：提供安全、高效、智能的文档创作、审核、发布和分享一体化解决方案

---

### 3.2 当前项目状态摘要

✅ **已完成模块**（6/10）
- `v1/user_register` ✅ 用户注册
- `v1/user_auth` ✅ 用户认证  
- `v1/user_profile` ✅ 用户中心
- `v1/password_manager` ✅ 密码管理
- `v2/document_manager` ✅ 文档管理
- `v2/file_upload` ✅ 文件上传
- `v2/md_editor` ✅ MD编辑器
- `v2/ai_review` ✅ AI审核系统

🔄 **待开发模块**（4/10）
- `v2/document_publish` 🔄 发布管理
- `v2/tech_square` 🔄 技术广场
- `v2/interaction` 🔄 互动功能
- `v2/share_system` 🔄 分享系统

**完成度**：60% (6/10)

---

### 3.3 技术栈和架构信息

#### 后端技术栈
- **框架**：FastAPI
- **数据库**：MySQL 8+
- **ORM**：SQLAlchemy
- **认证**：JWT Bearer Token (HS256)
- **AI集成**：自定义AI服务（HTTP API）
- **Python版本**：3.x
- **环境管理**：Anaconda (`xm_3`)

#### AI服务集成
- **AI客户端**：`app/core/ai_client.py`
- **支持功能**：MD优化、内容分析、安全审核
- **配置方式**：环境变量或代码配置
- **错误处理**：超时、重试、降级策略
- **当前API密钥**：`app-Tsm3DbgdIXiaFZMKBuNR7IO9`

---

### 3.4 下一步开发需求

#### 立即开始：`document_publish` 模块

**功能需求**：
- 文档发布流程管理（草稿 → 审核 → 发布）
- 发布状态控制和权限管理
- 发布历史记录和版本管理
- 与AI审核系统集成（依赖`ai_review`模块）

**技术要点**：
- 文档状态机设计
- 发布权限验证
- 历史版本存储
- 与现有文档表集成

**预期API接口**：
- `POST /publish` - 提交发布
- `GET /published/{doc_id}` - 获取已发布文档
- `GET /publish-history` - 获取发布历史
- `PUT /unpublish/{doc_id}` - 撤回发布

---

### 3.5 现有数据库结构

```sql
-- 用户表（v1）
us_users (id, username, email, password_hash, nickname, is_active, created_at, updated_at)

-- 文件夹表（v2）
us_folders (id, name, parent_id, user_id, level, created_at, updated_at)

-- 文档表（v2）
us_documents (id, title, content, file_path, file_type, file_size, summary, status, publish_time, review_message, folder_id, user_id, created_at, updated_at)

-- 文件上传表（v2）
us_upload_records (id, original_filename, stored_filename, file_path, file_size, file_type, mime_type, status, validation_message, user_id, document_id, created_at, updated_at)

-- 编辑器会话表（v2）
us_editor_sessions (id, document_id, user_id, title, content, is_draft, session_type, created_at, updated_at)

-- AI优化记录表（v2）
us_ai_optimizations (id, session_id, user_id, original_content, optimized_content, optimization_prompt, ai_provider, status, created_at)

-- AI审核日志表（v2）🆕
us_ai_review_logs (id, document_id, user_id, review_type, ai_provider, file_id, review_prompt, ai_response, review_result, failure_reason, confidence_score, review_duration, created_at, updated_at)
```

**待扩展表**：
```sql
-- 发布管理表（即将开发）
us_published_documents (发布文档表)
us_publish_history (发布历史表)
```

---

### 3.6 开发流程提醒

#### 模块开发标准流程
1. **创建模块目录**：在 `app/modules/v2/` 下创建新模块文件夹
2. **实现5个标准文件**：
   - `models.py` - 数据模型
   - `schemas.py` - API验证模型  
   - `services.py` - 业务逻辑
   - `routes.py` - API路由
   - `dependencies.py` - 依赖注入
3. **数据库设计**：如需新表，先设计SQL并创建
4. **编写测试脚本**：参考现有测试脚本模式
5. **测试验证**：确保所有接口正常工作
6. **文档更新**：更新API文档和技术文档

#### 开发注意事项 ✅
- **零修改原则**：不修改 `main.py`，系统自动注册新模块
- **模块隔离**：模块间通过API通信，避免直接调用
- **统一Base**：所有ORM模型使用 `from app.core.database import Base`
- **错误处理**：统一使用 `HTTPException` 处理错误
- **认证依赖**：复用 `from app.modules.v1.user_auth.dependencies import get_current_user`
- **枚举处理**：使用字符串枚举，避免Python枚举类转换问题
- **AI集成**：使用 `from app.core.ai_client import default_ai_client`（如适用）

---

## 4. 快速启动命令

### 4.1 环境准备

```bash
# 激活conda环境
conda activate xm_3

# 安装依赖（如果需要）
pip install fastapi uvicorn sqlalchemy pymysql python-decouple python-jose[cryptography] passlib[bcrypt] python-multipart requests PyPDF2
```

### 4.2 数据库准备

```bash
# 连接MySQL
mysql -u root -p

# 使用数据库
USE user_system;

# 检查表结构
SHOW TABLES LIKE 'us_%';
DESC us_ai_review_logs;  # 🆕 新表
```

### 4.3 服务器启动

```bash
# 进入项目目录
cd C:\A_XM\xm_3\vue3-fastapi-mysql_v1.0\fastapi

# 启动服务器
python -m app.main
```

**服务器启动成功标志**：
```
✅ 用户模型导入成功
✅ 数据库表创建完成
✅ 已注册模块: v1/user_register, v1/user_auth, v1/user_profile, v1/password_manager
✅ 已注册模块: v2/document_manager, v2/file_upload, v2/md_editor, v2/ai_review  # 🆕 新增
INFO: Uvicorn running on http://0.0.0.0:8100
```

### 4.4 API文档访问

- **Swagger UI**：http://localhost:8100/docs
- **ReDoc**：http://localhost:8100/redoc

---

## 🎯 总结

**当前状态**：✅ `ai_review` 模块已完成，系统具备完整的文档审核功能  
**下一步目标**：🚀 开发 `document_publish` 模块，实现文档发布管理  
**最终目标**：🎯 构建完整的文档管理与技术广场平台

**核心能力**：
- ✅ 完整的用户系统
- ✅ 文档创建、编辑、管理
- ✅ 文件上传与验证  
- ✅ AI内容优化
- ✅ AI内容安全审核
- 🔄 即将支持文档发布和分享

**准备就绪**：✅ 环境配置完成，✅ 基础架构稳定，✅ AI服务集成，✅ 开发流程明确

> **重要提醒**：使用字符串枚举避免SQLAlchemy转换问题，AI服务调用添加超时和错误处理，新模块开发遵循5文件标准结构。

**可以开始 `document_publish` 模块的开发了！** 🚀