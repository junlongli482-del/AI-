å¥½çš„ï¼æˆ‘æ¥æ›´æ–°ä½ çš„å®Œæ•´æŠ€æœ¯æ–‡æ¡£ã€‚

# ğŸ“˜ FastAPI æ¨¡å—åŒ–æ–‡æ¡£ç®¡ç†ç³»ç»Ÿ - å®Œæ•´æŠ€æœ¯æ–‡æ¡£ (v3.1)

> **æœ€åæ›´æ–°**ï¼š2025å¹´1æœˆ  
> **é¡¹ç›®çŠ¶æ€**ï¼šâœ… MD Editoræ¨¡å—å·²å®Œæˆï¼Œå‡†å¤‡å¼€å‘ä¸‹ä¸€æ¨¡å—  
> **æ¶æ„åŸåˆ™**ï¼šæ¨¡å—åŒ– + ç‰ˆæœ¬åŒ– + é›¶ä¾µå…¥ + è‡ªåŠ¨æ³¨å†Œ

---

## ğŸ“‹ ç›®å½•

- [1. é¡¹ç›®æ¦‚è§ˆ](#1-é¡¹ç›®æ¦‚è§ˆ)
- [2. æ¥å£æ–‡æ¡£](#2-æ¥å£æ–‡æ¡£)
- [3. å¼€å‘æ–‡æ¡£](#3-å¼€å‘æ–‡æ¡£)
- [4. å¸¸è§é—®é¢˜ä¸è§£å†³æ–¹æ¡ˆ](#4-å¸¸è§é—®é¢˜ä¸è§£å†³æ–¹æ¡ˆ)
- [5. ç»§ç»­å¼€å‘æŒ‡å—](#5-ç»§ç»­å¼€å‘æŒ‡å—)
- [6. å¿«é€Ÿå¯åŠ¨å‘½ä»¤](#6-å¿«é€Ÿå¯åŠ¨å‘½ä»¤)

---

## 1. é¡¹ç›®æ¦‚è§ˆ

### 1.1 é¡¹ç›®ä¿¡æ¯

| é¡¹ç›®å±æ€§ | å€¼ |
|--------|----|
| é¡¹ç›®åç§° | FastAPI Modular Document Management System |
| é¡¹ç›®è·¯å¾„ | `C:\A_XM\xm_3\vue3-fastapi-mysql_v1.0\fastapi` |
| æœåŠ¡ç«¯å£ | `8100` |
| æ•°æ®åº“ | MySQL 8+ï¼Œåº“å `user_system` |
| è¡¨å‰ç¼€ | `us_`ï¼ˆé¿å…å‘½åå†²çªï¼‰ |
| è®¤è¯æ–¹å¼ | JWT Bearer Tokenï¼ˆHS256ï¼‰ |
| æ¶æ„é£æ ¼ | æ¨¡å—åŒ– + ç‰ˆæœ¬åŒ–ï¼ˆv1ç”¨æˆ·ç³»ç»Ÿ + v2æ–‡æ¡£ç³»ç»Ÿï¼‰ |

### 1.2 å·²å®ŒæˆåŠŸèƒ½

#### âœ… v1 ç”¨æˆ·ç³»ç»Ÿï¼ˆå®Œæˆï¼‰
- ç”¨æˆ·æ³¨å†Œ (`user_register`)
- ç”¨æˆ·è®¤è¯ (`user_auth`)
- ç”¨æˆ·ä¸­å¿ƒ (`user_profile`)
- å¯†ç ç®¡ç† (`password_manager`)

#### âœ… v2 æ–‡æ¡£ç®¡ç†ï¼ˆå®Œæˆï¼‰
- æ–‡æ¡£ç®¡ç† (`document_manager`)
  - æ–‡æ¡£CRUDæ“ä½œ
  - åˆ†å±‚çº§æ–‡ä»¶å¤¹ç®¡ç†ï¼ˆæœ€å¤š3å±‚ï¼‰
  - åˆ†é¡µæŸ¥è¯¢
  - ç»Ÿè®¡åŠŸèƒ½

#### âœ… v2 æ–‡ä»¶ä¸Šä¼ ï¼ˆå®Œæˆï¼‰
- æ–‡ä»¶ä¸Šä¼  (`file_upload`)
  - æ”¯æŒMDã€PDFæ ¼å¼ä¸Šä¼ 
  - æ–‡ä»¶éªŒè¯ï¼ˆæ ¼å¼ã€å¤§å°ã€å†…å®¹å®Œæ•´æ€§ï¼‰
  - ä¸Šä¼ å†å²ç®¡ç†
  - ä¸æ–‡æ¡£ç³»ç»Ÿé›†æˆ
  - ç»Ÿè®¡åŠŸèƒ½

#### âœ… v2 MDç¼–è¾‘å™¨ï¼ˆåˆšå®Œæˆï¼‰
- MDç¼–è¾‘å™¨ (`md_editor`)
  - ç¼–è¾‘å™¨ä¼šè¯ç®¡ç†ï¼ˆæ–°å»º/ç¼–è¾‘æ–‡æ¡£ï¼‰
  - AIå†…å®¹ä¼˜åŒ–åŠŸèƒ½ï¼ˆé›†æˆè‡ªå®šä¹‰AIæœåŠ¡ï¼‰
  - ä¼˜åŒ–å†å²è®°å½•
  - è‰ç¨¿è‡ªåŠ¨ä¿å­˜
  - ä¸æ–‡æ¡£ç³»ç»Ÿæ·±åº¦é›†æˆ
  - å¤šç§ä¼˜åŒ–æ¨¡å¼ï¼ˆé€šç”¨ã€è¯­æ³•ã€ç»“æ„ã€æ‰©å±•ï¼‰

### 1.3 å¾…å¼€å‘åŠŸèƒ½ï¼ˆæŒ‰ä¼˜å…ˆçº§ï¼‰

#### ğŸ”„ ç¬¬äºŒé˜¶æ®µï¼šAIåŠŸèƒ½
- `ai_review` - AIå®¡æ ¸ç³»ç»Ÿ

#### ğŸ”„ ç¬¬ä¸‰é˜¶æ®µï¼šæŠ€æœ¯å¹¿åœº
- `document_publish` - å‘å¸ƒç®¡ç†
- `tech_square` - æŠ€æœ¯å¹¿åœºï¼ˆå±•ç¤ºã€æœç´¢ã€æ’åºï¼‰
- `interaction` - äº’åŠ¨åŠŸèƒ½ï¼ˆç‚¹èµã€æ”¶è—ã€è¯„è®ºï¼‰
- `share_system` - åˆ†äº«é“¾æ¥ç³»ç»Ÿ

---

## 2. æ¥å£æ–‡æ¡£

### 2.1 åŸºç¡€ä¿¡æ¯

**åŸºç¡€åœ°å€**ï¼š`http://localhost:8100`  
**è®¤è¯æ–¹å¼**ï¼š`Authorization: Bearer <access_token>`  
**Content-Type**ï¼š`application/json`

### 2.2 v1 ç”¨æˆ·ç³»ç»Ÿæ¥å£

#### ç”¨æˆ·æ³¨å†Œ `/api/v1/user_register`

| æ¥å£ | æ–¹æ³• | åŠŸèƒ½ | è®¤è¯ |
|------|------|------|------|
| `/register` | POST | ç”¨æˆ·æ³¨å†Œ | âŒ |
| `/check-username/{username}` | GET | æ£€æŸ¥ç”¨æˆ·åå¯ç”¨æ€§ | âŒ |
| `/check-email/{email}` | GET | æ£€æŸ¥é‚®ç®±å¯ç”¨æ€§ | âŒ |

#### ç”¨æˆ·è®¤è¯ `/api/v1/user_auth`

| æ¥å£ | æ–¹æ³• | åŠŸèƒ½ | è®¤è¯ |
|------|------|------|------|
| `/login` | POST | ç”¨æˆ·ç™»å½• | âŒ |
| `/me` | GET | è·å–å½“å‰ç”¨æˆ·ä¿¡æ¯ | âœ… |
| `/refresh` | POST | åˆ·æ–°token | âœ… |

#### ç”¨æˆ·ä¸­å¿ƒ `/api/v1/user_profile`

| æ¥å£ | æ–¹æ³• | åŠŸèƒ½ | è®¤è¯ |
|------|------|------|------|
| `/me` | GET | è·å–ç”¨æˆ·èµ„æ–™ | âœ… |
| `/nickname` | PUT | æ›´æ–°æ˜µç§° | âœ… |
| `/check-nickname/{nickname}` | GET | æ£€æŸ¥æ˜µç§°å¯ç”¨æ€§ | âœ… |
| `/logout` | POST | é€€å‡ºç™»å½• | âœ… |

#### å¯†ç ç®¡ç† `/api/v1/password_manager`

| æ¥å£ | æ–¹æ³• | åŠŸèƒ½ | è®¤è¯ |
|------|------|------|------|
| `/change-password` | POST | ä¿®æ”¹å¯†ç  | âœ… |
| `/check-strength` | POST | æ£€æŸ¥å¯†ç å¼ºåº¦ | âŒ |
| `/user-info` | GET | è·å–ç”¨æˆ·ä¿¡æ¯ | âœ… |

### 2.3 v2 æ–‡æ¡£ç®¡ç†æ¥å£

#### æ–‡æ¡£ç®¡ç† `/api/v2/document_manager`

##### æ–‡ä»¶å¤¹ç®¡ç†

| æ¥å£ | æ–¹æ³• | åŠŸèƒ½ | è®¤è¯ |
|------|------|------|------|
| `/folders` | POST | åˆ›å»ºæ–‡ä»¶å¤¹ | âœ… |
| `/folders/tree` | GET | è·å–æ–‡ä»¶å¤¹æ ‘ | âœ… |
| `/folders/{folder_id}` | DELETE | åˆ é™¤æ–‡ä»¶å¤¹ | âœ… |

##### æ–‡æ¡£ç®¡ç†

| æ¥å£ | æ–¹æ³• | åŠŸèƒ½ | è®¤è¯ |
|------|------|------|------|
| `/documents` | POST | åˆ›å»ºæ–‡æ¡£ | âœ… |
| `/documents` | GET | è·å–æ–‡æ¡£åˆ—è¡¨ï¼ˆåˆ†é¡µï¼‰ | âœ… |
| `/documents/{doc_id}` | GET | è·å–æ–‡æ¡£è¯¦æƒ… | âœ… |
| `/documents/{doc_id}` | PUT | æ›´æ–°æ–‡æ¡£ | âœ… |
| `/documents/{doc_id}` | DELETE | åˆ é™¤æ–‡æ¡£ | âœ… |
| `/stats` | GET | è·å–ç»Ÿè®¡ä¿¡æ¯ | âœ… |

### 2.4 v2 æ–‡ä»¶ä¸Šä¼ æ¥å£

#### æ–‡ä»¶ä¸Šä¼  `/api/v2/file_upload`

| æ¥å£ | æ–¹æ³• | åŠŸèƒ½ | è®¤è¯ |
|------|------|------|------|
| `/test` | GET | æµ‹è¯•æ¥å£ | âŒ |
| `/config` | GET | è·å–ä¸Šä¼ é…ç½® | âœ… |
| `/validate` | POST | éªŒè¯æ–‡ä»¶ï¼ˆä¸ä¿å­˜ï¼‰ | âœ… |
| `/upload` | POST | ä¸Šä¼ æ–‡ä»¶ | âœ… |
| `/uploads` | GET | è·å–ä¸Šä¼ å†å²ï¼ˆåˆ†é¡µï¼‰ | âœ… |
| `/uploads/{upload_id}` | GET | è·å–ä¸Šä¼ è¯¦æƒ… | âœ… |
| `/create-document` | POST | ä»ä¸Šä¼ æ–‡ä»¶åˆ›å»ºæ–‡æ¡£ | âœ… |
| `/uploads/{upload_id}` | DELETE | åˆ é™¤ä¸Šä¼ è®°å½• | âœ… |
| `/stats` | GET | è·å–ä¸Šä¼ ç»Ÿè®¡ | âœ… |

### 2.5 v2 MDç¼–è¾‘å™¨æ¥å£

#### MDç¼–è¾‘å™¨ `/api/v2/md_editor`

##### ä¼šè¯ç®¡ç†

| æ¥å£ | æ–¹æ³• | åŠŸèƒ½ | è®¤è¯ |
|------|------|------|------|
| `/test` | GET | æµ‹è¯•æ¥å£ | âŒ |
| `/config` | GET | è·å–ç¼–è¾‘å™¨é…ç½® | âœ… |
| `/sessions` | POST | åˆ›å»ºç¼–è¾‘å™¨ä¼šè¯ | âœ… |
| `/sessions` | GET | è·å–ä¼šè¯åˆ—è¡¨ï¼ˆåˆ†é¡µï¼‰ | âœ… |
| `/sessions/{session_id}` | GET | è·å–ä¼šè¯è¯¦æƒ… | âœ… |
| `/sessions/{session_id}` | PUT | æ›´æ–°ä¼šè¯å†…å®¹ | âœ… |
| `/sessions/{session_id}` | DELETE | åˆ é™¤ä¼šè¯ | âœ… |

##### AIä¼˜åŒ–åŠŸèƒ½

| æ¥å£ | æ–¹æ³• | åŠŸèƒ½ | è®¤è¯ |
|------|------|------|------|
| `/sessions/{session_id}/optimize` | POST | AIä¼˜åŒ–å†…å®¹ | âœ… |
| `/sessions/{session_id}/apply-optimization/{optimization_id}` | POST | åº”ç”¨ä¼˜åŒ–ç»“æœ | âœ… |
| `/sessions/{session_id}/optimizations` | GET | è·å–ä¼˜åŒ–å†å² | âœ… |

##### æ–‡æ¡£ä¿å­˜

| æ¥å£ | æ–¹æ³• | åŠŸèƒ½ | è®¤è¯ |
|------|------|------|------|
| `/sessions/{session_id}/save-document` | POST | ä¿å­˜ä¸ºæ­£å¼æ–‡æ¡£ | âœ… |
| `/stats` | GET | è·å–ç¼–è¾‘å™¨ç»Ÿè®¡ | âœ… |

#### MDç¼–è¾‘å™¨è¯¦ç»†è¯´æ˜

**åˆ›å»ºæ–°æ–‡æ¡£ä¼šè¯ç¤ºä¾‹**ï¼š
```bash
curl -X POST http://localhost:8100/api/v2/md_editor/sessions \
  -H "Authorization: Bearer YOUR_TOKEN" \
  -H "Content-Type: application/json" \
  -d '{
    "title": "æˆ‘çš„æ–°æ–‡æ¡£",
    "content": "# æ ‡é¢˜\n\nå†…å®¹...",
    "session_type": "new_document"
  }'
```

**AIä¼˜åŒ–å†…å®¹ç¤ºä¾‹**ï¼š
```bash
curl -X POST http://localhost:8100/api/v2/md_editor/sessions/1/optimize \
  -H "Authorization: Bearer YOUR_TOKEN" \
  -H "Content-Type: application/json" \
  -d '{
    "content": "# æµ‹è¯•æ–‡æ¡£\n\nè¿™ä¸ªæ–‡æ¡£éœ€è¦ä¼˜åŒ–ã€‚",
    "optimization_type": "general"
  }'
```

**ä¼˜åŒ–ç±»å‹è¯´æ˜**ï¼š
- `general` - é€šç”¨ä¼˜åŒ–ï¼šæå‡è¡¨è¾¾è´¨é‡å’Œå¯è¯»æ€§
- `grammar` - è¯­æ³•æ£€æŸ¥ï¼šä¿®æ­£è¯­æ³•å’Œæ‹¼å†™é”™è¯¯
- `structure` - ç»“æ„ä¼˜åŒ–ï¼šä¼˜åŒ–æ–‡æ¡£ç»“æ„å’Œå±‚æ¬¡
- `expand` - å†…å®¹æ‰©å±•ï¼šé€‚å½“æ‰©å±•å’Œå®Œå–„å†…å®¹

**å“åº”ç¤ºä¾‹**ï¼š
```json
{
  "success": true,
  "message": "å†…å®¹ä¼˜åŒ–æˆåŠŸ",
  "optimization_id": 5,
  "original_content": "# æµ‹è¯•æ–‡æ¡£\n\nè¿™ä¸ªæ–‡æ¡£éœ€è¦ä¼˜åŒ–ã€‚",
  "optimized_content": "# æµ‹è¯•æ–‡æ¡£\n\nè¿™æ˜¯ä¸€ä¸ªç»è¿‡AIä¼˜åŒ–çš„æ–‡æ¡£ï¼Œå†…å®¹æ›´åŠ å®Œå–„å’Œä¸“ä¸šã€‚\n\n## ä¸»è¦å†…å®¹\n\næ–‡æ¡£çš„æ ¸å¿ƒå†…å®¹åœ¨è¿™é‡Œå±•ç¤º...",
  "can_apply": true
}
```

### 2.6 é”™è¯¯ç è¯´æ˜

| çŠ¶æ€ç  | è¯´æ˜ | ç¤ºä¾‹ |
|--------|------|------|
| 200 | æˆåŠŸ | æ“ä½œæˆåŠŸå®Œæˆ |
| 400 | è¯·æ±‚é”™è¯¯ | å‚æ•°éªŒè¯å¤±è´¥ã€ä¸šåŠ¡é€»è¾‘é”™è¯¯ |
| 401 | è®¤è¯å¤±è´¥ | Tokenæ— æ•ˆæˆ–è¿‡æœŸ |
| 404 | èµ„æºä¸å­˜åœ¨ | æ–‡æ¡£ã€ä¼šè¯æˆ–æ–‡ä»¶å¤¹ä¸å­˜åœ¨ |
| 422 | æ•°æ®æ ¼å¼é”™è¯¯ | JSONæ ¼å¼é”™è¯¯ã€å­—æ®µç±»å‹é”™è¯¯ |
| 500 | æœåŠ¡å™¨é”™è¯¯ | å†…éƒ¨æœåŠ¡å™¨é”™è¯¯ã€AIæœåŠ¡å¼‚å¸¸ |

---

## 3. å¼€å‘æ–‡æ¡£

### 3.1 é¡¹ç›®ç›®å½•ç»“æ„

```bash
fastapi/
â”œâ”€â”€ app/
â”‚   â”œâ”€â”€ core/                          # æ ¸å¿ƒåŸºç¡€è®¾æ–½
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ config.py                  # JWT/DB/Token é…ç½®
â”‚   â”‚   â”œâ”€â”€ database.py                # SQLAlchemy å¼•æ“ + SessionLocal
â”‚   â”‚   â””â”€â”€ ai_client.py               # ğŸ†• AIå®¢æˆ·ç«¯ï¼ˆé›†æˆè‡ªå®šä¹‰AIæœåŠ¡ï¼‰
â”‚   â”‚
â”‚   â”œâ”€â”€ modules/                       # ä¸šåŠ¡æ¨¡å—æ ¹ç›®å½•
â”‚   â”‚   â”œâ”€â”€ v1/                        # API ç‰ˆæœ¬ v1ï¼ˆç”¨æˆ·ç³»ç»Ÿï¼‰
â”‚   â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”‚   â”œâ”€â”€ user_register/         # âœ… ç”¨æˆ·æ³¨å†Œæ¨¡å—
â”‚   â”‚   â”‚   â”œâ”€â”€ user_auth/             # âœ… ç”¨æˆ·è®¤è¯æ¨¡å—
â”‚   â”‚   â”‚   â”œâ”€â”€ user_profile/          # âœ… ç”¨æˆ·ä¸­å¿ƒæ¨¡å—
â”‚   â”‚   â”‚   â””â”€â”€ password_manager/      # âœ… å¯†ç ç®¡ç†æ¨¡å—
â”‚   â”‚   â”‚
â”‚   â”‚   â””â”€â”€ v2/                        # API ç‰ˆæœ¬ v2ï¼ˆæ–‡æ¡£ç³»ç»Ÿï¼‰
â”‚   â”‚       â”œâ”€â”€ __init__.py
â”‚   â”‚       â”œâ”€â”€ document_manager/      # âœ… æ–‡æ¡£ç®¡ç†æ¨¡å—
â”‚   â”‚       â”œâ”€â”€ file_upload/           # âœ… æ–‡ä»¶ä¸Šä¼ æ¨¡å—
â”‚   â”‚       â”‚
â”‚   â”‚       â”œâ”€â”€ md_editor/             # âœ… MDç¼–è¾‘å™¨æ¨¡å—ï¼ˆåˆšå®Œæˆï¼‰
â”‚   â”‚       â”‚   â”œâ”€â”€ models.py          # EditorSession, AIOptimization ORM æ¨¡å‹
â”‚   â”‚       â”‚   â”œâ”€â”€ schemas.py         # APIéªŒè¯æ¨¡å‹
â”‚   â”‚       â”‚   â”œâ”€â”€ services.py        # ç¼–è¾‘å™¨ä¸šåŠ¡é€»è¾‘ + AIä¼˜åŒ–
â”‚   â”‚       â”‚   â”œâ”€â”€ routes.py          # APIè·¯ç”±
â”‚   â”‚       â”‚   â””â”€â”€ dependencies.py    # ä¾èµ–æ³¨å…¥
â”‚   â”‚       â”‚
â”‚   â”‚       â”œâ”€â”€ ai_review/             # ğŸ”„ å¾…å¼€å‘ï¼šAIå®¡æ ¸
â”‚   â”‚       â”œâ”€â”€ document_publish/      # ğŸ”„ å¾…å¼€å‘ï¼šå‘å¸ƒç®¡ç†
â”‚   â”‚       â”œâ”€â”€ tech_square/           # ğŸ”„ å¾…å¼€å‘ï¼šæŠ€æœ¯å¹¿åœº
â”‚   â”‚       â”œâ”€â”€ interaction/           # ğŸ”„ å¾…å¼€å‘ï¼šäº’åŠ¨åŠŸèƒ½
â”‚   â”‚       â””â”€â”€ share_system/          # ğŸ”„ å¾…å¼€å‘ï¼šåˆ†äº«ç³»ç»Ÿ
â”‚   â”‚
â”‚   â””â”€â”€ main.py                        # ğŸš€ åº”ç”¨å…¥å£ï¼šè‡ªåŠ¨æ‰«æå¹¶æ³¨å†Œæ¨¡å—
â”‚
â”œâ”€â”€ uploads/                           # æ–‡ä»¶ä¸Šä¼ ç›®å½•
â”‚   â””â”€â”€ user_{user_id}/               # ç”¨æˆ·éš”ç¦»çš„ä¸Šä¼ ç›®å½•
â”‚       â””â”€â”€ documents/                # æ–‡æ¡£æ–‡ä»¶å­˜å‚¨
â”‚
â”œâ”€â”€ .env                               # ç¯å¢ƒå˜é‡
â”œâ”€â”€ requirements.txt                   # ä¾èµ–åˆ—è¡¨
â”œâ”€â”€ README.md                          # é¡¹ç›®è¯´æ˜
â””â”€â”€ æµ‹è¯•è„šæœ¬/                          # æµ‹è¯•è„šæœ¬ç›®å½•
    â”œâ”€â”€ v2æµ‹è¯•è„šæœ¬/
    â”‚   â”œâ”€â”€ test_document_manager_clean.py
    â”‚   â”œâ”€â”€ test_file_upload_clean.py
    â”‚   â””â”€â”€ test_md_editor_clean.py    # ğŸ†• MDç¼–è¾‘å™¨æµ‹è¯•è„šæœ¬
    â””â”€â”€ ...
```

### 3.2 æŠ€æœ¯æ¶æ„

#### 3.2.1 æ¶æ„è®¾è®¡åŸåˆ™

- **æ¨¡å—åŒ–è®¾è®¡**ï¼šæ¯ä¸ªåŠŸèƒ½ç‹¬ç«‹æˆæ¨¡å—ï¼Œäº’ä¸å¹²æ‰°
- **ç‰ˆæœ¬åŒ–ç®¡ç†**ï¼šv1ç”¨æˆ·ç³»ç»Ÿï¼Œv2æ–‡æ¡£ç³»ç»Ÿï¼Œæ”¯æŒå¹¶è¡Œå¼€å‘
- **è‡ªåŠ¨æ³¨å†Œ**ï¼šæ–°æ¨¡å—æ— éœ€ä¿®æ”¹main.pyï¼Œè‡ªåŠ¨å‘ç°å’Œæ³¨å†Œ
- **é›¶ä¾µå…¥åŸåˆ™**ï¼šæ–°å¢åŠŸèƒ½ä¸å½±å“ç°æœ‰åŠŸèƒ½
- **ç»Ÿä¸€ä¾èµ–ç®¡ç†**ï¼šæ‰€æœ‰æ¨¡å—å…±äº«coreä¸­çš„åŸºç¡€è®¾æ–½
- **AIæœåŠ¡é›†æˆ**ï¼šç»Ÿä¸€AIå®¢æˆ·ç«¯ï¼Œæ”¯æŒå¤šç§AIæœåŠ¡é…ç½®

#### 3.2.2 AIé›†æˆæ¶æ„

**AIå®¢æˆ·ç«¯è®¾è®¡**ï¼š
```python
# app/core/ai_client.py
class AIClient:
    def __init__(self, api_url, api_key):
        self.api_url = api_url
        self.api_key = api_key
    
    def optimize_markdown(self, content, optimization_type):
        # è°ƒç”¨AIæœåŠ¡ä¼˜åŒ–MDå†…å®¹
        pass
    
    def chat_with_ai(self, query, file_ids=None):
        # é€šç”¨AIå¯¹è¯æ¥å£
        pass
```

**æ”¯æŒçš„AIåŠŸèƒ½**ï¼š
- MDå†…å®¹ä¼˜åŒ–ï¼ˆ4ç§æ¨¡å¼ï¼‰
- æ–‡æ¡£ç»“æ„åˆ†æ
- è¯­æ³•æ£€æŸ¥å’Œä¿®æ­£
- å†…å®¹æ‰©å±•å»ºè®®

### 3.3 æ•°æ®åº“è®¾è®¡

#### 3.3.1 ç”¨æˆ·ç³»ç»Ÿè¡¨ï¼ˆv1ï¼‰

**us_users è¡¨**ï¼š
```sql
CREATE TABLE us_users (
    id INT AUTO_INCREMENT PRIMARY KEY,
    username VARCHAR(50) NOT NULL UNIQUE,
    email VARCHAR(100) NOT NULL UNIQUE,
    password_hash VARCHAR(255) NOT NULL,
    nickname VARCHAR(50) DEFAULT NULL UNIQUE,
    is_active BOOLEAN DEFAULT TRUE,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
);
```

#### 3.3.2 æ–‡æ¡£ç³»ç»Ÿè¡¨ï¼ˆv2ï¼‰

**us_folders è¡¨**ï¼š
```sql
CREATE TABLE us_folders (
    id INT AUTO_INCREMENT PRIMARY KEY,
    name VARCHAR(100) NOT NULL,
    parent_id INT DEFAULT NULL,
    user_id INT NOT NULL,
    level TINYINT DEFAULT 1,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    FOREIGN KEY (parent_id) REFERENCES us_folders(id) ON DELETE CASCADE,
    FOREIGN KEY (user_id) REFERENCES us_users(id) ON DELETE CASCADE
);
```

**us_documents è¡¨**ï¼š
```sql
CREATE TABLE us_documents (
    id INT AUTO_INCREMENT PRIMARY KEY,
    title VARCHAR(200) NOT NULL,
    content LONGTEXT,
    file_path VARCHAR(500),
    file_type ENUM('md', 'pdf') NOT NULL DEFAULT 'md',
    file_size INT DEFAULT 0,
    summary TEXT,
    status ENUM('draft', 'published', 'review_failed') DEFAULT 'draft',
    publish_time TIMESTAMP NULL,
    review_message TEXT,
    folder_id INT DEFAULT NULL,
    user_id INT NOT NULL,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    FOREIGN KEY (folder_id) REFERENCES us_folders(id) ON DELETE SET NULL,
    FOREIGN KEY (user_id) REFERENCES us_users(id) ON DELETE CASCADE
);
```

#### 3.3.3 æ–‡ä»¶ä¸Šä¼ è¡¨ï¼ˆv2ï¼‰

**us_upload_records è¡¨**ï¼š
```sql
CREATE TABLE us_upload_records (
    id INT AUTO_INCREMENT PRIMARY KEY,
    original_filename VARCHAR(255) NOT NULL,
    stored_filename VARCHAR(255) NOT NULL,
    file_path VARCHAR(500) NOT NULL,
    file_size INT NOT NULL,
    file_type ENUM('md', 'pdf') NOT NULL,
    mime_type VARCHAR(100) NOT NULL,
    status ENUM('uploading', 'uploaded', 'validated', 'failed', 'deleted') DEFAULT 'uploading',
    validation_message TEXT,
    user_id INT NOT NULL,
    document_id INT DEFAULT NULL,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    FOREIGN KEY (user_id) REFERENCES us_users(id) ON DELETE CASCADE,
    FOREIGN KEY (document_id) REFERENCES us_documents(id) ON DELETE SET NULL
);
```

#### 3.3.4 MDç¼–è¾‘å™¨è¡¨ï¼ˆv2ï¼‰ğŸ†•

**us_editor_sessions è¡¨**ï¼š
```sql
CREATE TABLE us_editor_sessions (
    id INT AUTO_INCREMENT PRIMARY KEY,
    document_id INT DEFAULT NULL,
    user_id INT NOT NULL,
    title VARCHAR(200) DEFAULT NULL,
    content LONGTEXT,
    is_draft BOOLEAN DEFAULT TRUE,
    session_type ENUM('new_document', 'edit_document') DEFAULT 'new_document',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    FOREIGN KEY (document_id) REFERENCES us_documents(id) ON DELETE CASCADE,
    FOREIGN KEY (user_id) REFERENCES us_users(id) ON DELETE CASCADE,
    INDEX idx_user_id (user_id),
    INDEX idx_document_id (document_id),
    INDEX idx_session_type (session_type)
);
```

**us_ai_optimizations è¡¨**ï¼š
```sql
CREATE TABLE us_ai_optimizations (
    id INT AUTO_INCREMENT PRIMARY KEY,
    session_id INT NOT NULL,
    user_id INT NOT NULL,
    original_content LONGTEXT NOT NULL,
    optimized_content LONGTEXT NOT NULL,
    optimization_prompt TEXT,
    ai_provider VARCHAR(50) DEFAULT 'default',
    status ENUM('pending', 'completed', 'failed') DEFAULT 'completed',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (session_id) REFERENCES us_editor_sessions(id) ON DELETE CASCADE,
    FOREIGN KEY (user_id) REFERENCES us_users(id) ON DELETE CASCADE,
    INDEX idx_session_id (session_id),
    INDEX idx_user_id (user_id),
    INDEX idx_created_at (created_at)
);
```

### 3.4 é…ç½®æ–‡ä»¶

#### .env é…ç½®
```env
DATABASE_URL=mysql+pymysql://root:ljl18420@localhost:3306/user_system
SECRET_KEY=your-secret-key-here-change-in-production
ALGORITHM=HS256
ACCESS_TOKEN_EXPIRE_MINUTES=30
REFRESH_TOKEN_EXPIRE_DAYS=7

# AIæœåŠ¡é…ç½®ï¼ˆå¯é€‰ï¼‰
AI_API_URL=http://127.0.0.1:8888/v1/chat-messages
AI_API_KEY=app-JxcTVFGIpdo7gWhLaSoSAVTq
```

---

## 4. å¸¸è§é—®é¢˜ä¸è§£å†³æ–¹æ¡ˆ

### 4.1 SQLAlchemyæšä¸¾é—®é¢˜ ğŸ”§

#### é—®é¢˜æè¿°
```
LookupError: 'md' is not among the defined enum values. Enum name: filetype. Possible values: MD, PDF
```

#### è§£å†³æ–¹æ¡ˆï¼ˆæ¨èï¼‰
**ç›´æ¥ä½¿ç”¨å­—ç¬¦ä¸²æšä¸¾ï¼Œé¿å…Pythonæšä¸¾ç±»**ï¼š

```python
# âœ… æ­£ç¡®çš„å†™æ³•
file_type = Column(Enum('md', 'pdf'), nullable=False, default='md')
session_type = Column(Enum('new_document', 'edit_document'), default='new_document')
status = Column(Enum('pending', 'completed', 'failed'), default='completed')

# åœ¨ä»£ç ä¸­ç›´æ¥ä½¿ç”¨å­—ç¬¦ä¸²
record.file_type = 'md'  # è€Œä¸æ˜¯ FileType.MD
```

### 4.2 AIæœåŠ¡é›†æˆé—®é¢˜ ğŸ”§

#### é—®é¢˜æè¿°
AIæœåŠ¡è°ƒç”¨å¤±è´¥æˆ–è¶…æ—¶

#### è§£å†³æ–¹æ¡ˆ
```python
# æ·»åŠ è¶…æ—¶å’Œé”™è¯¯å¤„ç†
try:
    response = requests.post(
        self.api_url,
        headers=headers,
        data=json.dumps(payload),
        timeout=30  # æ·»åŠ è¶…æ—¶
    )
    
    if response.status_code == 200:
        return response.json().get("answer", "")
    else:
        return None
        
except Exception as e:
    print(f"AIè¯·æ±‚å¼‚å¸¸: {e}")
    return None
```

### 4.3 æ¨¡å—å…³ç³»æ˜ å°„é—®é¢˜ ğŸ”§

#### è§£å†³æ–¹æ¡ˆ
**ä½¿ç”¨å•å‘å…³ç³»ï¼Œéµå¾ªé›¶ä¿®æ”¹åŸåˆ™**ï¼š

```python
# âœ… æ­£ç¡®çš„å†™æ³• - å•å‘å…³ç³»
class EditorSession(Base):
    # ä¸ä½¿ç”¨ back_populatesï¼Œé¿å…ä¿®æ”¹ç°æœ‰æ¨¡å‹
    ai_optimizations = relationship("AIOptimization", cascade="all, delete-orphan")

class AIOptimization(Base):
    session = relationship("EditorSession")
```

---

## 5. ç»§ç»­å¼€å‘æŒ‡å—

### 5.1 é¡¹ç›®èƒŒæ™¯ä¿¡æ¯

#### å®Œæ•´éœ€æ±‚æ–‡æ¡£æ‘˜è¦

**é¡¹ç›®åç§°**ï¼šæ–‡æ¡£ç®¡ç†ä¸æŠ€æœ¯å¹¿åœºäº§å“  
**é¡¹ç›®ç›®æ ‡**ï¼šåœ¨ç°æœ‰ç”¨æˆ·ç³»ç»ŸåŸºç¡€ä¸Šï¼Œæ„å»ºå®Œæ•´çš„æ–‡æ¡£ç®¡ç†å’ŒæŠ€æœ¯åˆ†äº«å¹³å°

**æ ¸å¿ƒåŠŸèƒ½æ¨¡å—**ï¼š

1. **ä¸ªäººæ–‡æ¡£ç®¡ç†**ï¼ˆâœ… å·²å®Œæˆï¼‰
2. **æ–‡ä»¶ä¸Šä¼ ç³»ç»Ÿ**ï¼ˆâœ… å·²å®Œæˆï¼‰
3. **MDç¼–è¾‘å™¨å¢å¼º**ï¼ˆâœ… å·²å®Œæˆï¼‰
   - âœ… ç¼–è¾‘å™¨ä¼šè¯ç®¡ç†
   - âœ… AIä¼˜åŒ–åŠŸèƒ½ï¼ˆ4ç§æ¨¡å¼ï¼‰
   - âœ… ä¼˜åŒ–å†å²è®°å½•
   - âœ… è‰ç¨¿è‡ªåŠ¨ä¿å­˜
   - âœ… ä¸æ–‡æ¡£ç³»ç»Ÿé›†æˆ

4. **AIå®¡æ ¸ç³»ç»Ÿ**ï¼ˆğŸ”„ ä¸‹ä¸€æ­¥å¼€å‘ï¼‰
   - åç«¯å†™æ­»å¤šä¸ªæ¥å£ï¼Œæ¯ä¸ªAIä¸€ä¸ªä¸“é—¨æ¥å£
   - å®¡æ ¸é€šè¿‡è¿”å›trueï¼Œå¤±è´¥è¿”å›å…·ä½“åŸå› 
   - å‘å¸ƒé™åˆ¶ï¼šPDFä¸è¶…è¿‡10é¡µï¼ŒMDç›¸å½“äº10é¡µA4çº¸å†…å®¹

5. **æŠ€æœ¯å¹¿åœº**ï¼ˆğŸ”„ å¾…å¼€å‘ï¼‰
6. **åˆ†äº«åŠŸèƒ½**ï¼ˆğŸ”„ å¾…å¼€å‘ï¼‰

### 5.2 å½“å‰é¡¹ç›®çŠ¶æ€

#### âœ… å·²å®ŒæˆåŠŸèƒ½
- **v1ç”¨æˆ·ç³»ç»Ÿ**ï¼šæ³¨å†Œã€ç™»å½•ã€ç”¨æˆ·ä¸­å¿ƒã€å¯†ç ç®¡ç†ï¼ˆå®Œå…¨ç¨³å®šï¼‰
- **v2æ–‡æ¡£ç®¡ç†**ï¼šæ–‡æ¡£CRUDã€æ–‡ä»¶å¤¹ç®¡ç†ã€åˆ†é¡µæŸ¥è¯¢ã€ç»Ÿè®¡åŠŸèƒ½ï¼ˆç¨³å®šè¿è¡Œï¼‰
- **v2æ–‡ä»¶ä¸Šä¼ **ï¼šæ–‡ä»¶ä¸Šä¼ ã€éªŒè¯ã€å†å²ç®¡ç†ã€æ–‡æ¡£é›†æˆï¼ˆç¨³å®šè¿è¡Œï¼‰
- **v2 MDç¼–è¾‘å™¨**ï¼šç¼–è¾‘å™¨ä¼šè¯ã€AIä¼˜åŒ–ã€è‰ç¨¿ä¿å­˜ã€æ–‡æ¡£é›†æˆï¼ˆåˆšå®Œæˆæµ‹è¯•ï¼‰

#### ğŸ”„ å½“å‰å¼€å‘çŠ¶æ€
- **MD Editoræ¨¡å—**ï¼šâœ… å·²å®Œæˆå¹¶é€šè¿‡å®Œæ•´æµ‹è¯•
- **æ•°æ®åº“è¡¨ç»“æ„**ï¼šâœ… us_users, us_folders, us_documents, us_upload_records, us_editor_sessions, us_ai_optimizations å·²åˆ›å»º
- **AIé›†æˆ**ï¼šâœ… è‡ªå®šä¹‰AIæœåŠ¡å·²é›†æˆï¼Œæ”¯æŒ4ç§ä¼˜åŒ–æ¨¡å¼
- **æµ‹è¯•è„šæœ¬**ï¼šâœ… å®Œæ•´çš„è‡ªåŠ¨åŒ–æµ‹è¯•è„šæœ¬å·²ç¼–å†™

#### ğŸ“‹ ä¸‹ä¸€æ­¥å¼€å‘ä¼˜å…ˆçº§

**ç«‹å³å¼€å§‹ï¼šai_review æ¨¡å—**
1. **AIå®¡æ ¸æ¥å£**ï¼š
   - å¤šä¸ªAIå®¡æ ¸æœåŠ¡æ¥å£
   - å®¡æ ¸ç»“æœæ ‡å‡†åŒ–
   - å®¡æ ¸å†å²è®°å½•

2. **å®¡æ ¸è§„åˆ™å¼•æ“**ï¼š
   - PDFé¡µæ•°é™åˆ¶æ£€æŸ¥
   - MDå†…å®¹é•¿åº¦æ£€æŸ¥
   - å†…å®¹è´¨é‡è¯„ä¼°

3. **å®¡æ ¸æµç¨‹ç®¡ç†**ï¼š
   - æäº¤å®¡æ ¸
   - å®¡æ ¸çŠ¶æ€è·Ÿè¸ª
   - å®¡æ ¸ç»“æœå¤„ç†

### 5.3 æŠ€æœ¯æ ˆä¿¡æ¯

#### åç«¯æŠ€æœ¯æ ˆ
- **æ¡†æ¶**ï¼šFastAPI
- **æ•°æ®åº“**ï¼šMySQL 8+
- **ORM**ï¼šSQLAlchemy
- **è®¤è¯**ï¼šJWT Bearer Token
- **AIé›†æˆ**ï¼šè‡ªå®šä¹‰AIæœåŠ¡ï¼ˆHTTP APIï¼‰
- **Pythonç‰ˆæœ¬**ï¼š3.x
- **ç¯å¢ƒç®¡ç†**ï¼šAnaconda (xm_3)

#### AIæœåŠ¡é›†æˆ
- **AIå®¢æˆ·ç«¯**ï¼š`app/core/ai_client.py`
- **æ”¯æŒåŠŸèƒ½**ï¼šMDä¼˜åŒ–ã€å†…å®¹åˆ†æã€è´¨é‡è¯„ä¼°
- **é…ç½®æ–¹å¼**ï¼šç¯å¢ƒå˜é‡æˆ–ä»£ç é…ç½®
- **é”™è¯¯å¤„ç†**ï¼šè¶…æ—¶ã€é‡è¯•ã€é™çº§ç­–ç•¥

### 5.4 å¼€å‘æµç¨‹æé†’

#### æ¨¡å—å¼€å‘æ ‡å‡†æµç¨‹
1. **åˆ›å»ºæ¨¡å—ç›®å½•**ï¼šåœ¨ `app/modules/v2/` ä¸‹åˆ›å»ºæ–°æ¨¡å—æ–‡ä»¶å¤¹
2. **å®ç°5ä¸ªæ ‡å‡†æ–‡ä»¶**ï¼šmodels.py, schemas.py, services.py, routes.py, dependencies.py
3. **æ•°æ®åº“è®¾è®¡**ï¼šå¦‚éœ€æ–°è¡¨ï¼Œå…ˆè®¾è®¡SQLå¹¶åˆ›å»º
4. **ç¼–å†™æµ‹è¯•è„šæœ¬**ï¼šå‚è€ƒç°æœ‰æµ‹è¯•è„šæœ¬çš„æ¨¡å¼
5. **æµ‹è¯•éªŒè¯**ï¼šç¡®ä¿æ‰€æœ‰æ¥å£æ­£å¸¸å·¥ä½œ
6. **æ–‡æ¡£æ›´æ–°**ï¼šæ›´æ–°APIæ–‡æ¡£å’ŒæŠ€æœ¯æ–‡æ¡£

#### å¼€å‘æ³¨æ„äº‹é¡¹
- âœ… **é›¶ä¿®æ”¹åŸåˆ™**ï¼šä¸ä¿®æ”¹ main.pyï¼Œç³»ç»Ÿè‡ªåŠ¨æ³¨å†Œæ–°æ¨¡å—
- âœ… **æ¨¡å—éš”ç¦»**ï¼šæ¨¡å—é—´é€šè¿‡APIé€šä¿¡ï¼Œé¿å…ç›´æ¥è°ƒç”¨
- âœ… **ç»Ÿä¸€Base**ï¼šæ‰€æœ‰ORMæ¨¡å‹ä½¿ç”¨ `from app.core.database import Base`
- âœ… **é”™è¯¯å¤„ç†**ï¼šç»Ÿä¸€ä½¿ç”¨HTTPExceptionå¤„ç†é”™è¯¯
- âœ… **è®¤è¯ä¾èµ–**ï¼šå¤ç”¨ `from app.modules.v1.user_auth.dependencies import get_current_user`
- âœ… **æšä¸¾å¤„ç†**ï¼šä½¿ç”¨å­—ç¬¦ä¸²æšä¸¾ï¼Œé¿å…Pythonæšä¸¾ç±»è½¬æ¢é—®é¢˜
- âœ… **AIé›†æˆ**ï¼šä½¿ç”¨ `from app.core.ai_client import default_ai_client`

### 5.5 ç°æœ‰æ•°æ®åº“ç»“æ„

#### å½“å‰è¡¨ç»“æ„
```sql
-- ç”¨æˆ·è¡¨ï¼ˆv1ï¼‰
us_users (id, username, email, password_hash, nickname, is_active, created_at, updated_at)

-- æ–‡ä»¶å¤¹è¡¨ï¼ˆv2ï¼‰  
us_folders (id, name, parent_id, user_id, level, created_at, updated_at)

-- æ–‡æ¡£è¡¨ï¼ˆv2ï¼‰
us_documents (id, title, content, file_path, file_type, file_size, summary, status, publish_time, review_message, folder_id, user_id, created_at, updated_at)

-- æ–‡ä»¶ä¸Šä¼ è¡¨ï¼ˆv2ï¼‰
us_upload_records (id, original_filename, stored_filename, file_path, file_size, file_type, mime_type, status, validation_message, user_id, document_id, created_at, updated_at)

-- ç¼–è¾‘å™¨ä¼šè¯è¡¨ï¼ˆv2ï¼‰ğŸ†•
us_editor_sessions (id, document_id, user_id, title, content, is_draft, session_type, created_at, updated_at)

-- AIä¼˜åŒ–è®°å½•è¡¨ï¼ˆv2ï¼‰ğŸ†•
us_ai_optimizations (id, session_id, user_id, original_content, optimized_content, optimization_prompt, ai_provider, status, created_at)
```

#### å¾…æ‰©å±•è¡¨ç»“æ„ï¼ˆæ ¹æ®éœ€æ±‚ï¼‰
```sql
-- å³å°†å¼€å‘çš„æ–°è¡¨
us_ai_review_logs (AIå®¡æ ¸æ—¥å¿—è¡¨)
us_document_interactions (æ–‡æ¡£äº’åŠ¨è¡¨ï¼šç‚¹èµã€æ”¶è—ã€è½¬å‘)
us_comments (è¯„è®ºè¡¨ï¼šäºŒå±‚è¯„è®ºç³»ç»Ÿ)
us_share_links (åˆ†äº«é“¾æ¥è¡¨)
```

### 5.6 ä¸‹ä¸€æ­¥å…·ä½“å¼€å‘ä»»åŠ¡

#### ç«‹å³å¼€å§‹ï¼šai_review æ¨¡å—
**åŠŸèƒ½éœ€æ±‚**ï¼š
- å¤šAIå®¡æ ¸æœåŠ¡é›†æˆ
- å®¡æ ¸è§„åˆ™å¼•æ“ï¼ˆé¡µæ•°ã€å†…å®¹é•¿åº¦é™åˆ¶ï¼‰
- å®¡æ ¸æµç¨‹ç®¡ç†
- å®¡æ ¸å†å²è®°å½•

**æŠ€æœ¯è¦ç‚¹**ï¼š
- æ‰©å±•ç°æœ‰AIå®¢æˆ·ç«¯
- å®¡æ ¸è§„åˆ™é…ç½®åŒ–
- å¼‚æ­¥å®¡æ ¸å¤„ç†
- å®¡æ ¸ç»“æœæ ‡å‡†åŒ–

**å¼€å‘æ–¹å¼**ï¼šå»ºè®®ä½¿ç”¨ä¸­é€Ÿæ¨¡å¼ï¼Œä¸€æ¬¡æä¾›2-3ä¸ªæ–‡ä»¶

---

## 6. å¿«é€Ÿå¯åŠ¨å‘½ä»¤

### 6.1 ç¯å¢ƒå‡†å¤‡

```bash
# æ¿€æ´»condaç¯å¢ƒ
conda activate xm_3

# å®‰è£…ä¾èµ–ï¼ˆå¦‚æœéœ€è¦ï¼‰
pip install fastapi uvicorn sqlalchemy pymysql python-decouple python-jose[cryptography] passlib[bcrypt] python-multipart requests
```

### 6.2 æ•°æ®åº“å‡†å¤‡

```bash
# è¿æ¥MySQL
mysql -u root -p

# ä½¿ç”¨æ•°æ®åº“
USE user_system;

# æ£€æŸ¥è¡¨ç»“æ„
SHOW TABLES LIKE 'us_%';
DESC us_users;
DESC us_folders; 
DESC us_documents;
DESC us_upload_records;
DESC us_editor_sessions;      # ğŸ†• æ–°è¡¨
DESC us_ai_optimizations;     # ğŸ†• æ–°è¡¨
```

### 6.3 æœåŠ¡å™¨å¯åŠ¨

```bash
# è¿›å…¥é¡¹ç›®ç›®å½•
cd C:\A_XM\xm_3\vue3-fastapi-mysql_v1.0\fastapi

# å¯åŠ¨æœåŠ¡å™¨
python -m app.main

# æœåŠ¡å™¨å¯åŠ¨æˆåŠŸæ ‡å¿—ï¼š
# âœ… ç”¨æˆ·æ¨¡å‹å¯¼å…¥æˆåŠŸ
# âœ… æ•°æ®åº“è¡¨åˆ›å»ºå®Œæˆ
# âœ… å·²æ³¨å†Œæ¨¡å—: v1/user_register, v1/user_auth, v1/user_profile, v1/password_manager
# âœ… å·²æ³¨å†Œæ¨¡å—: v2/document_manager, v2/file_upload, v2/md_editor  # ğŸ†• æ–°å¢
# INFO: Uvicorn running on http://0.0.0.0:8100
```

### 6.4 APIæ–‡æ¡£è®¿é—®

```bash
# Swagger UI
http://localhost:8100/docs

# ReDoc
http://localhost:8100/redoc

# æ–°å¢çš„MDç¼–è¾‘å™¨æ¥å£å°†å‡ºç°åœ¨ v2/md_editor åˆ†ç»„ä¸‹
```

### 6.5 æµ‹è¯•å‘½ä»¤

```bash
# åŸºç¡€å¥åº·æ£€æŸ¥
curl http://localhost:8100/api/v2/md_editor/test

# è·å–ç¼–è¾‘å™¨é…ç½®
curl -H "Authorization: Bearer YOUR_TOKEN" http://localhost:8100/api/v2/md_editor/config

# ç”¨æˆ·ç™»å½•è·å–token
curl -X POST http://localhost:8100/api/v1/user_auth/login \
  -H "Content-Type: application/json" \
  -d '{"username_or_email":"abc","password":"ljl18420"}'

# è¿è¡Œå®Œæ•´æµ‹è¯•è„šæœ¬
python æµ‹è¯•è„šæœ¬/v2æµ‹è¯•è„šæœ¬/test_document_manager_clean.py
python æµ‹è¯•è„šæœ¬/v2æµ‹è¯•è„šæœ¬/test_file_upload_clean.py
python æµ‹è¯•è„šæœ¬/v2æµ‹è¯•è„šæœ¬/test_md_editor_clean.py  # ğŸ†• æ–°æµ‹è¯•è„šæœ¬
```

### 6.6 å¼€å‘è°ƒè¯•å‘½ä»¤

```bash
# æŸ¥çœ‹æ—¥å¿—ï¼ˆæœåŠ¡å™¨è¿è¡Œæ—¶ï¼‰
# ç›´æ¥åœ¨å¯åŠ¨æœåŠ¡å™¨çš„ç»ˆç«¯æŸ¥çœ‹å®æ—¶æ—¥å¿—

# æ•°æ®åº“æŸ¥è¯¢è°ƒè¯•
mysql -u root -p -e "USE user_system; SELECT COUNT(*) FROM us_documents;"
mysql -u root -p -e "USE user_system; SELECT COUNT(*) FROM us_editor_sessions;"  # ğŸ†•
mysql -u root -p -e "USE user_system; SELECT COUNT(*) FROM us_ai_optimizations;" # ğŸ†•

# æ£€æŸ¥AIä¼˜åŒ–è®°å½•
mysql -u root -p -e "USE user_system; SELECT id, session_id, ai_provider, status, created_at FROM us_ai_optimizations ORDER BY created_at DESC LIMIT 5;"

# æ£€æŸ¥ç¼–è¾‘å™¨ä¼šè¯
mysql -u root -p -e "USE user_system; SELECT id, title, session_type, is_draft, created_at FROM us_editor_sessions ORDER BY updated_at DESC LIMIT 5;"
```

### 6.7 AIæœåŠ¡æµ‹è¯•å‘½ä»¤

```bash
# æµ‹è¯•AIæœåŠ¡è¿æ¥ï¼ˆéœ€è¦AIæœåŠ¡è¿è¡Œåœ¨8888ç«¯å£ï¼‰
curl -X POST http://127.0.0.1:8888/v1/chat-messages \
  -H "Authorization: Bearer app-JxcTVFGIpdo7gWhLaSoSAVTq" \
  -H "Content-Type: application/json" \
  -d '{
    "inputs": {},
    "query": "æµ‹è¯•AIè¿æ¥",
    "response_mode": "blocking",
    "conversation_id": "",
    "user": "test-user",
    "files": []
  }'
```

---

## ğŸ“‹ å¼€å‘æ£€æŸ¥æ¸…å•

### å¼€å§‹æ–°æ¨¡å—å¼€å‘å‰
- [ ] ç¡®è®¤æœåŠ¡å™¨æ­£å¸¸å¯åŠ¨
- [ ] ç¡®è®¤ç°æœ‰åŠŸèƒ½æ­£å¸¸å·¥ä½œ
- [ ] ç¡®è®¤æ•°æ®åº“è¿æ¥æ­£å¸¸
- [ ] ç¡®è®¤AIæœåŠ¡è¿æ¥æ­£å¸¸ï¼ˆå¦‚éœ€è¦ï¼‰
- [ ] ç¡®è®¤æµ‹è¯•è„šæœ¬å¯ä»¥è¿è¡Œ

### å¼€å‘æ–°æ¨¡å—æ—¶
- [ ] åˆ›å»ºæ ‡å‡†5æ–‡ä»¶ç»“æ„
- [ ] å®ç°æ•°æ®æ¨¡å‹ï¼ˆå¦‚éœ€è¦ï¼‰
- [ ] ç¼–å†™ä¸šåŠ¡é€»è¾‘
- [ ] å®ç°APIæ¥å£
- [ ] é›†æˆAIåŠŸèƒ½ï¼ˆå¦‚éœ€è¦ï¼‰
- [ ] ç¼–å†™æµ‹è¯•è„šæœ¬
- [ ] éªŒè¯åŠŸèƒ½å®Œæ•´æ€§

### å®Œæˆæ¨¡å—å¼€å‘å
- [ ] æ‰€æœ‰æ¥å£æµ‹è¯•é€šè¿‡
- [ ] AIåŠŸèƒ½æµ‹è¯•é€šè¿‡ï¼ˆå¦‚é€‚ç”¨ï¼‰
- [ ] é”™è¯¯å¤„ç†å®Œå–„
- [ ] æ–‡æ¡£æ›´æ–°å®Œæˆ
- [ ] ä¸ç°æœ‰æ¨¡å—é›†æˆæ­£å¸¸
- [ ] å‡†å¤‡ä¸‹ä¸€æ¨¡å—å¼€å‘

### å¸¸è§é—®é¢˜æ£€æŸ¥
- [ ] æšä¸¾å­—æ®µä½¿ç”¨å­—ç¬¦ä¸²æšä¸¾
- [ ] è·¨æ¨¡å—é›†æˆé¿å…æœåŠ¡å±‚è°ƒç”¨
- [ ] AIæœåŠ¡è°ƒç”¨æ·»åŠ è¶…æ—¶å’Œé”™è¯¯å¤„ç†
- [ ] æ•°æ®åº“å¤–é”®çº¦æŸæ­£ç¡®
- [ ] å•å‘å…³ç³»æ˜ å°„é¿å…å¾ªç¯ä¾èµ–

---

## ğŸ¯ æ€»ç»“

**å½“å‰çŠ¶æ€**ï¼šMD Editoræ¨¡å—å·²å®Œæˆï¼Œç³»ç»Ÿå…·å¤‡å®Œæ•´çš„æ–‡æ¡£ç¼–è¾‘å’ŒAIä¼˜åŒ–åŠŸèƒ½  
**ä¸‹ä¸€æ­¥**ï¼šå¼€å‘ ai_review æ¨¡å—ï¼Œå®ç°AIå®¡æ ¸ç³»ç»Ÿ  
**å¼€å‘æ¨¡å¼**ï¼šå»ºè®®ä½¿ç”¨ä¸­é€Ÿæ¨¡å¼ï¼Œä¸€æ¬¡2-3ä¸ªæ–‡ä»¶  
**æŠ€æœ¯æ ˆ**ï¼šFastAPI + MySQL + SQLAlchemy + è‡ªå®šä¹‰AIæœåŠ¡ï¼Œæ¨¡å—åŒ–æ¶æ„  

**æ–°å¢èƒ½åŠ›**ï¼š
- âœ… MDç¼–è¾‘å™¨ä¼šè¯ç®¡ç†
- âœ… AIå†…å®¹ä¼˜åŒ–ï¼ˆ4ç§æ¨¡å¼ï¼‰
- âœ… ä¼˜åŒ–å†å²è®°å½•
- âœ… è‰ç¨¿è‡ªåŠ¨ä¿å­˜
- âœ… ä¸æ–‡æ¡£ç³»ç»Ÿæ·±åº¦é›†æˆ

**å‡†å¤‡å°±ç»ª**ï¼šâœ… ç¯å¢ƒé…ç½®å®Œæˆï¼Œâœ… åŸºç¡€æ¶æ„ç¨³å®šï¼Œâœ… AIæœåŠ¡é›†æˆï¼Œâœ… å¼€å‘æµç¨‹æ˜ç¡®ï¼Œâœ… é—®é¢˜è§£å†³æ–¹æ¡ˆå®Œå¤‡

**é‡è¦æé†’**ï¼š
- ä½¿ç”¨å­—ç¬¦ä¸²æšä¸¾é¿å…SQLAlchemyè½¬æ¢é—®é¢˜
- AIæœåŠ¡è°ƒç”¨æ·»åŠ è¶…æ—¶å’Œé”™è¯¯å¤„ç†
- è·¨æ¨¡å—é›†æˆæ—¶ç›´æ¥åˆ›å»ºORMå¯¹è±¡
- æ–°æ¨¡å—å¼€å‘éµå¾ª5æ–‡ä»¶æ ‡å‡†ç»“æ„
- æµ‹è¯•é©±åŠ¨å¼€å‘ï¼Œç¡®ä¿åŠŸèƒ½ç¨³å®š

**AIé›†æˆç»éªŒ**ï¼š
- ç»Ÿä¸€AIå®¢æˆ·ç«¯è®¾è®¡ï¼Œä¾¿äºæ‰©å±•å¤šç§AIæœåŠ¡
- ä¼˜åŒ–æç¤ºè¯è®¾è®¡ï¼Œæé«˜AIè¾“å‡ºè´¨é‡
- å®Œå–„é”™è¯¯å¤„ç†ï¼Œç¡®ä¿AIæœåŠ¡å¼‚å¸¸æ—¶ç³»ç»Ÿç¨³å®š
- ä¿å­˜ä¼˜åŒ–å†å²ï¼Œä¾¿äºç”¨æˆ·æŸ¥çœ‹å’Œç®¡ç†

å¯ä»¥å¼€å§‹ä¸‹ä¸€ä¸ªæ¨¡å—çš„å¼€å‘äº†ï¼ğŸš€

---

**æ–‡æ¡£æ›´æ–°å®Œæˆ v3.1**

ç°åœ¨ç³»ç»Ÿå·²ç»å…·å¤‡äº†å®Œæ•´çš„æ–‡æ¡£ç®¡ç†ã€æ–‡ä»¶ä¸Šä¼ ã€MDç¼–è¾‘å’ŒAIä¼˜åŒ–åŠŸèƒ½ã€‚ä¸‹ä¸€æ­¥å¯ä»¥å¼€å‘ ai_review æ¨¡å—ï¼Œå®ç°æ–‡æ¡£çš„AIå®¡æ ¸åŠŸèƒ½ã€‚