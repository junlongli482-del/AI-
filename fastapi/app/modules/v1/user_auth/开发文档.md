å®Œç¾ï¼è®©æˆ‘ä¸ºä½ æ•´ç†å®Œæ•´çš„æ–‡æ¡£ã€‚ğŸ“‹

---

# ğŸ“– ç”¨æˆ·è®¤è¯æ¨¡å— - å®Œæ•´æ–‡æ¡£

## ğŸ”— æ¥å£æ–‡æ¡£

### åŸºç¡€ä¿¡æ¯
- **æœåŠ¡åœ°å€**ï¼šhttp://localhost:8100
- **APIç‰ˆæœ¬**ï¼šv1
- **æ¨¡å—å‰ç¼€**ï¼š/api/v1/user_auth
- **è®¤è¯æ–¹å¼**ï¼šJWT Bearer Token

---

### 1. ç”¨æˆ·ç™»å½•æ¥å£

**æ¥å£åœ°å€ï¼š** `POST /api/v1/user_auth/login`

**åŠŸèƒ½æè¿°ï¼š** æ”¯æŒç”¨æˆ·å/é‚®ç®± + å¯†ç ä¸¤ç§ç™»å½•æ–¹å¼

**è¯·æ±‚å‚æ•°ï¼š**
```json
{
  "username_or_email": "string",  // ç”¨æˆ·åæˆ–é‚®ç®±åœ°å€
  "password": "string",           // ç”¨æˆ·å¯†ç 
  "remember_me": false           // æ˜¯å¦è®°ä½ç™»å½•ï¼ˆå¯é€‰ï¼Œé»˜è®¤falseï¼‰
}
```

**æˆåŠŸå“åº”ï¼ˆ200ï¼‰ï¼š**
```json
{
  "access_token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
  "refresh_token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...", // remember_me=trueæ—¶æ‰æœ‰
  "token_type": "bearer",
  "expires_in": 1800  // 30åˆ†é’Ÿï¼Œå•ä½ï¼šç§’
}
```

**é”™è¯¯å“åº”ï¼š**
- `401` - ç™»å½•å¤±è´¥ï¼š`{"detail": "ç”¨æˆ·å/é‚®ç®±æˆ–å¯†ç é”™è¯¯"}`
- `422` - æ•°æ®éªŒè¯é”™è¯¯

---

### 2. è·å–å½“å‰ç”¨æˆ·ä¿¡æ¯æ¥å£

**æ¥å£åœ°å€ï¼š** `GET /api/v1/user_auth/me`

**åŠŸèƒ½æè¿°ï¼š** è·å–å½“å‰ç™»å½•ç”¨æˆ·çš„åŸºæœ¬ä¿¡æ¯

**è¯·æ±‚å¤´ï¼š**
```
Authorization: Bearer <access_token>
```

**æˆåŠŸå“åº”ï¼ˆ200ï¼‰ï¼š**
```json
{
  "id": 2,
  "username": "testuser",
  "email": "test@example.com",
  "is_active": true,
  "created_at": "2025-01-20T10:30:00"
}
```

**é”™è¯¯å“åº”ï¼š**
- `401` - ä»¤ç‰Œæ— æ•ˆï¼š`{"detail": "æ— æ•ˆçš„è®¤è¯å‡­è¯"}`
- `401` - ç”¨æˆ·è¢«ç¦ç”¨ï¼š`{"detail": "ç”¨æˆ·è´¦æˆ·å·²è¢«ç¦ç”¨"}`

---

### 3. åˆ·æ–°è®¿é—®ä»¤ç‰Œæ¥å£

**æ¥å£åœ°å€ï¼š** `POST /api/v1/user_auth/refresh`

**åŠŸèƒ½æè¿°ï¼š** ä½¿ç”¨åˆ·æ–°ä»¤ç‰Œè·å–æ–°çš„è®¿é—®ä»¤ç‰Œ

**è¯·æ±‚å‚æ•°ï¼š**
```json
{
  "refresh_token": "string"  // åˆ·æ–°ä»¤ç‰Œ
}
```

**æˆåŠŸå“åº”ï¼ˆ200ï¼‰ï¼š**
```json
{
  "access_token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
  "refresh_token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...", // ä¿æŒä¸å˜
  "token_type": "bearer",
  "expires_in": 1800
}
```

**é”™è¯¯å“åº”ï¼š**
- `401` - åˆ·æ–°ä»¤ç‰Œæ— æ•ˆï¼š`{"detail": "æ— æ•ˆçš„åˆ·æ–°ä»¤ç‰Œ"}`

---

### 4. æ¨¡å—æµ‹è¯•æ¥å£

**æ¥å£åœ°å€ï¼š** `GET /api/v1/user_auth/test`

**åŠŸèƒ½æè¿°ï¼š** æµ‹è¯•æ¨¡å—æ˜¯å¦æ­£å¸¸è¿è¡Œ

**æˆåŠŸå“åº”ï¼ˆ200ï¼‰ï¼š**
```json
{
  "message": "ç”¨æˆ·è®¤è¯æ¨¡å—æ­£å¸¸è¿è¡Œ",
  "module": "user_auth",
  "version": "v1",
  "endpoints": [...]
}
```

---

## ğŸ—ï¸ å¼€å‘æ–‡æ¡£

### é¡¹ç›®ç»“æ„

```
fastapi/
â”œâ”€â”€ app/
â”‚   â”œâ”€â”€ core/                          # æ ¸å¿ƒç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ config.py                  # é…ç½®ç®¡ç†ï¼ˆå«JWTé…ç½®ï¼‰
â”‚   â”‚   â””â”€â”€ database.py                # æ•°æ®åº“è¿æ¥
â”‚   â”œâ”€â”€ modules/                       # ä¸šåŠ¡æ¨¡å—ï¼ˆç‰ˆæœ¬åŒ–ï¼‰
â”‚   â”‚   â””â”€â”€ v1/                        # ç‰ˆæœ¬1åŠŸèƒ½
â”‚   â”‚       â”œâ”€â”€ __init__.py
â”‚   â”‚       â”œâ”€â”€ user_register/         # ç”¨æˆ·æ³¨å†Œæ¨¡å— âœ…
â”‚   â”‚       â”‚   â”œâ”€â”€ models.py
â”‚   â”‚       â”‚   â”œâ”€â”€ schemas.py
â”‚   â”‚       â”‚   â”œâ”€â”€ services.py
â”‚   â”‚       â”‚   â”œâ”€â”€ routes.py
â”‚   â”‚       â”‚   â””â”€â”€ dependencies.py
â”‚   â”‚       â””â”€â”€ user_auth/             # ç”¨æˆ·è®¤è¯æ¨¡å— âœ…
â”‚   â”‚           â”œâ”€â”€ models.py          # å¤ç”¨Useræ¨¡å‹
â”‚   â”‚           â”œâ”€â”€ schemas.py         # ç™»å½•è¯·æ±‚/å“åº”æ¨¡å‹
â”‚   â”‚           â”œâ”€â”€ services.py        # JWTè®¤è¯æœåŠ¡
â”‚   â”‚           â”œâ”€â”€ routes.py          # ç™»å½•APIè·¯ç”±
â”‚   â”‚           â””â”€â”€ dependencies.py    # JWTä¾èµ–æ³¨å…¥
â”‚   â””â”€â”€ main.py                        # åº”ç”¨å…¥å£ï¼ˆè‡ªåŠ¨æ³¨å†Œæ¨¡å—ï¼‰
â”œâ”€â”€ requirements.txt                   # é¡¹ç›®ä¾èµ–
â””â”€â”€ .env                              # ç¯å¢ƒé…ç½®
```

---

### æŠ€æœ¯æ¶æ„

**æ ¸å¿ƒæŠ€æœ¯æ ˆï¼š**
- FastAPI 0.104.1
- SQLAlchemy 2.0.23
- MySQL + PyMySQL
- JWTè®¤è¯ï¼špython-jose[cryptography] 3.3.0
- å¯†ç åŠ å¯†ï¼špasslib[bcrypt] 1.7.4

**JWTé…ç½®ï¼š**
- è®¿é—®ä»¤ç‰Œæœ‰æ•ˆæœŸï¼š30åˆ†é’Ÿ
- åˆ·æ–°ä»¤ç‰Œæœ‰æ•ˆæœŸï¼š7å¤©
- åŠ å¯†ç®—æ³•ï¼šHS256

**æ¶æ„ç‰¹ç‚¹ï¼š**
- âœ… æ¨¡å—åŒ–è®¾è®¡ï¼šæ¯ä¸ªåŠŸèƒ½ç‹¬ç«‹æ¨¡å—
- âœ… ç‰ˆæœ¬åŒ–ç®¡ç†ï¼šæ”¯æŒå¤šç‰ˆæœ¬å¹¶å­˜
- âœ… è‡ªåŠ¨æ³¨å†Œï¼šæ–°æ¨¡å—é›¶é…ç½®è‡ªåŠ¨å‘ç°
- âœ… é›¶ä¿®æ”¹åŸåˆ™ï¼šæ–°åŠŸèƒ½ä¸ä¿®æ”¹ç°æœ‰ä»£ç 

---

### æ•°æ®åº“è®¾è®¡

**è¡¨åï¼š** `us_users`

**è¡¨ç»“æ„ï¼š**
```sql
CREATE TABLE us_users (
    id INT AUTO_INCREMENT PRIMARY KEY,
    username VARCHAR(50) NOT NULL UNIQUE,
    email VARCHAR(100) NOT NULL UNIQUE,
    password_hash VARCHAR(255) NOT NULL,  -- æ ¼å¼ï¼šç›å€¼:å“ˆå¸Œå€¼
    is_active BOOLEAN DEFAULT TRUE,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    INDEX idx_username (username),
    INDEX idx_email (email)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;
```

**å¯†ç å­˜å‚¨æ ¼å¼ï¼š** `ç›å€¼:SHA256å“ˆå¸Œå€¼`

---

### æ ¸å¿ƒæœåŠ¡ç±»

**AuthService ä¸»è¦æ–¹æ³•ï¼š**
- `verify_password()` - éªŒè¯å¯†ç 
- `authenticate_user()` - éªŒè¯ç”¨æˆ·èº«ä»½
- `create_access_token()` - ç”Ÿæˆè®¿é—®ä»¤ç‰Œ
- `create_refresh_token()` - ç”Ÿæˆåˆ·æ–°ä»¤ç‰Œ
- `login_user()` - å®Œæ•´ç™»å½•æµç¨‹
- `get_current_user()` - æ ¹æ®ä»¤ç‰Œè·å–ç”¨æˆ·

**ä¾èµ–æ³¨å…¥ï¼š**
- `get_current_user()` - JWTä»¤ç‰ŒéªŒè¯
- `get_current_active_user()` - æ´»è·ƒç”¨æˆ·éªŒè¯

---

### å·²å®ŒæˆåŠŸèƒ½

- âœ… **ç”¨æˆ·æ³¨å†Œæ¨¡å—**ï¼ˆuser_registerï¼‰ï¼šå®Œæ•´çš„ç”¨æˆ·æ³¨å†ŒåŠŸèƒ½
- âœ… **ç”¨æˆ·è®¤è¯æ¨¡å—**ï¼ˆuser_authï¼‰ï¼šJWTç™»å½•è®¤è¯ç³»ç»Ÿ

### å¾…å¼€å‘åŠŸèƒ½

- ğŸ”„ **ç”¨æˆ·ä¸­å¿ƒæ¨¡å—**ï¼ˆuser_profileï¼‰
- ğŸ”„ **å¯†ç ç®¡ç†æ¨¡å—**ï¼ˆpassword_managerï¼‰

---

## ğŸ“‹ æ–°å¯¹è¯æ–‡æ¡£

### ğŸ¯ é¡¹ç›®èƒŒæ™¯

æˆ‘æ­£åœ¨å¼€å‘ä¸€ä¸ª**æ¨¡å—åŒ–çš„FastAPIç”¨æˆ·ç³»ç»Ÿ**ï¼Œé‡‡ç”¨ç‰ˆæœ¬åŒ–çš„æ¨¡å—æ¶æ„ã€‚å·²ç»å®Œæˆäº†ç”¨æˆ·æ³¨å†Œå’Œç”¨æˆ·è®¤è¯æ¨¡å—ï¼Œç°åœ¨è¦ç»§ç»­å¼€å‘ç”¨æˆ·ä¸­å¿ƒæ¨¡å—ã€‚

### ğŸ—ï¸ å½“å‰é¡¹ç›®çŠ¶æ€

**é¡¹ç›®ä¿¡æ¯ï¼š**
- é¡¹ç›®è·¯å¾„ï¼š`C:\A_XM\xm_3\vue3-fastapi-mysql_v1.0\fastapi`
- æœåŠ¡ç«¯å£ï¼š8100
- æ•°æ®åº“ï¼šMySQLï¼Œæ•°æ®åº“å `user_system`
- è¡¨å‰ç¼€ï¼š`us_`

**æŠ€æœ¯æ ˆï¼š**
- FastAPI + SQLAlchemy + MySQL
- JWTè®¤è¯ï¼ˆpython-joseï¼‰
- å¯†ç åŠ å¯†ï¼ˆSHA256+ç›å€¼ï¼‰
- è‡ªåŠ¨æ¨¡å—æ³¨å†Œæœºåˆ¶

**å·²å®Œæˆæ¨¡å—ï¼š**
1. **ç”¨æˆ·æ³¨å†Œæ¨¡å—**ï¼ˆ`app/modules/v1/user_register/`ï¼‰
   - ç”¨æˆ·æ³¨å†ŒåŠŸèƒ½
   - æ•°æ®éªŒè¯å’Œå”¯ä¸€æ€§æ£€æŸ¥
   - å¯†ç åŠ å¯†å­˜å‚¨

2. **ç”¨æˆ·è®¤è¯æ¨¡å—**ï¼ˆ`app/modules/v1/user_auth/`ï¼‰
   - åŒé‡ç™»å½•æ–¹å¼ï¼ˆç”¨æˆ·å/é‚®ç®±+å¯†ç ï¼‰
   - JWTä»¤ç‰Œç”Ÿæˆå’ŒéªŒè¯
   - è®°ä½ç™»å½•çŠ¶æ€ï¼ˆåˆ·æ–°ä»¤ç‰Œï¼‰
   - ç”¨æˆ·èº«ä»½éªŒè¯ä¸­é—´ä»¶

**æ•°æ®åº“è¡¨ç»“æ„ï¼š**
```sql
-- us_users è¡¨
id, username, email, password_hash, is_active, created_at, updated_at
-- å¯†ç æ ¼å¼ï¼šç›å€¼:å“ˆå¸Œå€¼
```

### ğŸ¯ ä¸‹ä¸€æ­¥å¼€å‘éœ€æ±‚

éœ€è¦å¼€å‘**ç”¨æˆ·ä¸­å¿ƒæ¨¡å—**ï¼ˆuser_profileï¼‰ï¼ŒåŠŸèƒ½åŒ…æ‹¬ï¼š
- æ˜¾ç¤ºç”¨æˆ·åŸºæœ¬ä¿¡æ¯
- ç”¨æˆ·å¤´åƒç®¡ç†
- ä¸ªäººèµ„æ–™ç¼–è¾‘
- è´¦æˆ·è®¾ç½®
- é€€å‡ºç™»å½•åŠŸèƒ½

### ğŸ—ï¸ æ¨¡å—æ¶æ„è§„èŒƒ

**æ ‡å‡†æ¨¡å—ç»“æ„ï¼š**
```
app/modules/v1/{æ¨¡å—å}/
â”œâ”€â”€ models.py          # æ•°æ®æ¨¡å‹
â”œâ”€â”€ schemas.py         # APIåºåˆ—åŒ–æ¨¡å‹
â”œâ”€â”€ services.py        # ä¸šåŠ¡é€»è¾‘
â”œâ”€â”€ routes.py          # APIè·¯ç”±
â””â”€â”€ dependencies.py    # æ¨¡å—ä¾èµ–
```

**å¼€å‘åŸåˆ™ï¼š**
- âœ… æ–°æ¨¡å—åœ¨ `app/modules/v1/` ä¸‹åˆ›å»ºç›®å½•
- âœ… éµå¾ª5ä¸ªæ ‡å‡†æ–‡ä»¶ç»“æ„
- âœ… main.py è‡ªåŠ¨æ³¨å†Œï¼Œæ— éœ€ä¿®æ”¹
- âœ… æ¨¡å—é—´é€šè¿‡APIé€šä¿¡ï¼Œé¿å…ç›´æ¥ä¾èµ–

### ğŸ”§ é…ç½®æ–‡ä»¶çŠ¶æ€

**app/core/config.pyï¼š**
```python
from decouple import config

class Settings:
    DATABASE_URL: str = config("DATABASE_URL")
    SECRET_KEY: str = config("SECRET_KEY")
    ALGORITHM: str = config("ALGORITHM", default="HS256")
    ACCESS_TOKEN_EXPIRE_MINUTES: int = config("ACCESS_TOKEN_EXPIRE_MINUTES", default=30, cast=int)
    REFRESH_TOKEN_EXPIRE_DAYS: int = config("REFRESH_TOKEN_EXPIRE_DAYS", default=7, cast=int)

settings = Settings()
```

**.env é…ç½®ï¼š**
```env
DATABASE_URL=mysql+pymysql://root:ljl18420@localhost:3306/user_system
SECRET_KEY=your-secret-key-here-change-in-production
ALGORITHM=HS256
ACCESS_TOKEN_EXPIRE_MINUTES=30
REFRESH_TOKEN_EXPIRE_DAYS=7
```

**requirements.txtï¼š**
```txt
fastapi==0.104.1
uvicorn==0.24.0
sqlalchemy==2.0.23
pymysql==1.1.0
python-multipart==0.0.6
python-jose[cryptography]==3.3.0
passlib[bcrypt]==1.7.4
python-decouple==3.8
```

### ğŸš€ å¿«é€Ÿå¯åŠ¨å‘½ä»¤

```bash
# å¯åŠ¨æœåŠ¡å™¨
cd C:\A_XM\xm_3\vue3-fastapi-mysql_v1.0\fastapi
python -m app.main

# è®¿é—®APIæ–‡æ¡£
http://localhost:8100/docs

# æµ‹è¯•å·²æœ‰æ¨¡å—
http://localhost:8100/api/v1/user_register/test
http://localhost:8100/api/v1/user_auth/test
```

### ğŸ§ª æµ‹è¯•æ•°æ®

**æµ‹è¯•ç”¨æˆ·ï¼š**
- ç”¨æˆ·åï¼štestuser
- é‚®ç®±ï¼štest@example.com
- å¯†ç ï¼špassword123

**JWTä»¤ç‰Œè·å–ï¼š**
```bash
POST /api/v1/user_auth/login
{
  "username_or_email": "testuser",
  "password": "password123",
  "remember_me": true
}
```

### ğŸ“‹ å¼€å‘æŒ‡å¯¼åŸåˆ™

**å¯¹äºæ–°å¯¹è¯çš„å¼€å‘è€…ï¼š**
1. æˆ‘æ˜¯æœ‰ä¸€å®šåŸºç¡€çš„å°ç™½ï¼Œä½¿ç”¨**æ…¢é€Ÿæ¨¡å¼**æ•™å­¦
2. ä¸€æ¬¡åªå¼€å‘ä¸€ä¸ªæ¨¡å—ï¼Œç¡®ä¿æˆ‘èƒ½è·Ÿä¸Šè¿›åº¦
3. å…ˆæä¾›å®Œæ•´çš„éœ€æ±‚åˆ†æå’Œæ¶æ„è®¾è®¡
4. é€æ­¥ç¼–å†™ä»£ç æ–‡ä»¶ï¼Œæ¯ä¸ªæ–‡ä»¶éƒ½è¦è¯¦ç»†è§£é‡Š
5. æä¾›å®Œæ•´çš„æµ‹è¯•æŒ‡å¯¼

**é‡è¦æé†’ï¼š**
- main.py æ— éœ€ä¿®æ”¹ï¼Œè‡ªåŠ¨æ³¨å†Œæ–°æ¨¡å—
- å¦‚éœ€æ›´æ–°ç°æœ‰æ–‡ä»¶ï¼Œå…ˆè¦æ±‚æŸ¥çœ‹å½“å‰å†…å®¹
- éµå¾ªæ¨¡å—åŒ–åŸåˆ™ï¼Œé¿å…è·¨æ¨¡å—ç›´æ¥ä¾èµ–

---

**æŠŠè¿™ä¸ªæ–‡æ¡£æä¾›ç»™æ–°å¯¹è¯ï¼Œå°±å¯ä»¥æ— ç¼ç»§ç»­å¼€å‘ç”¨æˆ·ä¸­å¿ƒæ¨¡å—äº†ï¼** ğŸ‰

ç°åœ¨æˆ‘ä»¬å·²ç»æœ‰äº†å®Œæ•´çš„ç”¨æˆ·è®¤è¯ç³»ç»Ÿï¼Œå‡†å¤‡å¥½å¼€å‘ä¸‹ä¸€ä¸ªæ¨¡å—äº†å—ï¼Ÿ