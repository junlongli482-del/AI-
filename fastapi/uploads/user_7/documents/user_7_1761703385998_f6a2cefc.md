# ğŸ“˜ 08-AIå®¡æ ¸æ¨¡å— - å‰ç«¯æ¥å£æ–‡æ¡£

> **æ¨¡å—è·¯å¾„**ï¼š`/api/v2/ai_review`  
> **æ¥å£æ•°é‡**ï¼š8ä¸ª  
> **è®¤è¯è¦æ±‚**ï¼šâœ… éœ€è¦ç™»å½•

---

## ğŸ”— æ¥å£åˆ—è¡¨

### å®¡æ ¸ç®¡ç† (4ä¸ª)
1. **æäº¤æ–‡æ¡£å®¡æ ¸** - `POST /submit-review?document_id={id}`
2. **æŸ¥è¯¢å®¡æ ¸çŠ¶æ€** - `GET /review-status/{document_id}`
3. **é‡æ–°å®¡æ ¸æ–‡æ¡£** - `POST /retry-review/{document_id}`
4. **è·å–å®¡æ ¸è¯¦æƒ…** - `GET /review-detail/{review_id}`

### å†å²ç»Ÿè®¡ (3ä¸ª)
5. **å®¡æ ¸å†å²è®°å½•** - `GET /review-history`
6. **å®¡æ ¸ç»Ÿè®¡ä¿¡æ¯** - `GET /stats`
7. **æœ€è¿‘å®¡æ ¸è®°å½•** - `GET /recent-reviews`

### é…ç½®ç®¡ç† (1ä¸ª)
8. **å®¡æ ¸é…ç½®ä¿¡æ¯** - `GET /config`

---

## ğŸ“‹ æ¥å£è¯¦æƒ…

### 1. æäº¤æ–‡æ¡£å®¡æ ¸

**è¯·æ±‚å‚æ•°**
- **URLå‚æ•°**ï¼š`document_id` (å¿…éœ€) - æ–‡æ¡£ID

**å®¡æ ¸æµç¨‹**
1. æ£€æŸ¥æ–‡æ¡£å¤§å°é™åˆ¶ï¼ˆPDFâ‰¤10é¡µï¼ŒMDâ‰¤1000è¡Œï¼‰
2. é€šè¿‡å¤§å°æ£€æŸ¥åï¼Œè¿›è¡ŒAIå†…å®¹å®‰å…¨å®¡æ ¸
3. æ ¹æ®å®¡æ ¸ç»“æœæ›´æ–°æ–‡æ¡£çŠ¶æ€

**æˆåŠŸå“åº” (200)**
```json
{
  "id": 1,
  "document_id": 123,
  "user_id": 456,
  "review_type": "content_safety",
  "ai_provider": "default",
  "file_id": "file_abc123",
  "review_result": "passed",
  "failure_reason": null,
  "confidence_score": 0.95,
  "review_duration": 15,
  "created_at": "2025-01-27T10:30:45.123456",
  "updated_at": "2025-01-27T10:30:45.123456"
}
```

**é”™è¯¯å“åº”**
- `400` - `{"detail": "è¯¥æ–‡æ¡£å·²æœ‰å¾…å¤„ç†çš„å®¡æ ¸ï¼Œè¯·ç­‰å¾…å®¡æ ¸å®Œæˆ"}`
- `400` - `{"detail": "æ–‡æ¡£çŠ¶æ€ä¸º publishedï¼Œæ— æ³•æäº¤å®¡æ ¸"}`

### 2. æŸ¥è¯¢å®¡æ ¸çŠ¶æ€

**æˆåŠŸå“åº” (200)**
```json
{
  "document_id": 123,
  "overall_status": "passed",
  "review_logs": [
    {
      "id": 1,
      "review_type": "content_safety",
      "review_result": "passed",
      "failure_reason": null,
      "review_duration": 15,
      "created_at": "2025-01-27T10:30:45.123456"
    }
  ],
  "total_reviews": 1,
  "passed_reviews": 1,
  "failed_reviews": 0,
  "pending_reviews": 0
}
```

### 3. é‡æ–°å®¡æ ¸æ–‡æ¡£

**é€‚ç”¨åœºæ™¯**ï¼šå®¡æ ¸å¤±è´¥æˆ–å‡ºé”™çš„æ–‡æ¡£

**æˆåŠŸå“åº” (200)** - åŒæäº¤å®¡æ ¸å“åº”æ ¼å¼

**é”™è¯¯å“åº”**
- `400` - `{"detail": "æ–‡æ¡£çŠ¶æ€ä¸º publishedï¼Œæ— æ³•é‡æ–°å®¡æ ¸"}`

### 4. å®¡æ ¸å†å²è®°å½•

**æŸ¥è¯¢å‚æ•°**
- `page=1` - é¡µç  (â‰¥1)
- `size=20` - æ¯é¡µæ•°é‡ (1-100)
- `review_result` - ç­›é€‰ç»“æœ (pending/passed/failed/error)

**æˆåŠŸå“åº” (200)**
```json
{
  "success": true,
  "message": "è·å–å®¡æ ¸å†å²æˆåŠŸ",
  "data": {
    "total": 50,
    "page": 1,
    "size": 20,
    "pages": 3,
    "items": [
      {
        "id": 1,
        "document_id": 123,
        "review_type": "content_safety",
        "review_result": "passed",
        "failure_reason": null,
        "review_duration": 15,
        "created_at": "2025-01-27T10:30:45.123456"
      }
    ]
  }
}
```

### 5. å®¡æ ¸ç»Ÿè®¡ä¿¡æ¯

**æˆåŠŸå“åº” (200)**
```json
{
  "total_reviews": 25,
  "today_reviews": 3,
  "passed_rate": 0.8,
  "failed_rate": 0.2,
  "avg_review_duration": 18.5,
  "review_type_stats": {
    "content_safety": 25
  },
  "recent_reviews": [
    {
      "id": 1,
      "document_id": 123,
      "review_result": "passed",
      "created_at": "2025-01-27T10:30:45.123456"
    }
  ]
}
```

### 6. æœ€è¿‘å®¡æ ¸è®°å½•

**æŸ¥è¯¢å‚æ•°**
- `limit=10` - è¿”å›æ•°é‡ (1-50)

**æˆåŠŸå“åº” (200)**
```json
{
  "success": true,
  "message": "è·å–æœ€è¿‘å®¡æ ¸è®°å½•æˆåŠŸ",
  "data": {
    "total": 5,
    "reviews": [
      {
        "id": 1,
        "document_id": 123,
        "review_result": "passed",
        "created_at": "2025-01-27T10:30:45.123456"
      }
    ]
  }
}
```

### 7. å®¡æ ¸é…ç½®ä¿¡æ¯

**æˆåŠŸå“åº” (200)**
```json
{
  "success": true,
  "message": "è·å–å®¡æ ¸é…ç½®æˆåŠŸ",
  "config": {
    "review_types": ["content_safety"],
    "size_limits": {
      "pdf_max_pages": 10,
      "md_max_lines": 1000
    },
    "ai_provider": "default",
    "ai_service_info": "AIæœåŠ¡ç«¯å·²é¢„è®¾å†…å®¹å®‰å…¨å®¡æ ¸æç¤ºè¯",
    "review_prompt_info": "AIæœåŠ¡ç«¯å·²é¢„è®¾å†…å®¹å®‰å…¨å®¡æ ¸æç¤ºè¯ï¼š\n- æ£€æŸ¥æ”¿æ²»ã€æš´åŠ›ã€è‰²æƒ…ç­‰è¿è§„å†…å®¹\n- æ£€æŸ¥åŒéŸ³å­—ã€è°éŸ³ç­‰å˜ç›¸è¿è§„å†…å®¹\n- è¾“å‡ºæ ¼å¼ï¼štrue/false + å…·ä½“è¿è§„åŸå› ï¼ˆå¦‚æœæœ‰ï¼‰",
    "supported_file_types": ["pdf", "md"],
    "review_flow": [
      "1. æ–‡æ¡£å¤§å°æ£€æŸ¥ï¼ˆPDFâ‰¤10é¡µï¼ŒMDâ‰¤1000è¡Œï¼‰",
      "2. AIå†…å®¹å®‰å…¨å®¡æ ¸ï¼ˆä½¿ç”¨æœåŠ¡ç«¯é¢„è®¾æç¤ºè¯ï¼‰",
      "3. è§£æAIå“åº”ï¼ˆtrue/falseæ ¼å¼ï¼‰",
      "4. æ›´æ–°æ–‡æ¡£çŠ¶æ€"
    ]
  }
}
```

### 8. åˆ é™¤å®¡æ ¸è®°å½•

**æˆåŠŸå“åº” (200)**
```json
{
  "success": true,
  "message": "å®¡æ ¸è®°å½•åˆ é™¤æˆåŠŸ",
  "deleted_review_id": 1
}
```

---

## ğŸ“Š å®¡æ ¸ç»“æœè¯´æ˜

| çŠ¶æ€ | è¯´æ˜ | æ–‡æ¡£çŠ¶æ€å˜åŒ– |
|------|------|-------------|
| `pending` | å®¡æ ¸ä¸­ | ä¿æŒåŸçŠ¶æ€ |
| `passed` | å®¡æ ¸é€šè¿‡ | â†’ `published` |
| `failed` | å®¡æ ¸æœªé€šè¿‡ | â†’ `review_failed` |
| `error` | å®¡æ ¸å‡ºé”™ | â†’ `review_failed` |

---

## âŒ é”™è¯¯å“åº”

- `400` - `{"detail": "è¯¥æ–‡æ¡£å·²æœ‰å¾…å¤„ç†çš„å®¡æ ¸"}`
- `404` - `{"detail": "æ–‡æ¡£ä¸å­˜åœ¨æˆ–æ— æƒé™è®¿é—®"}`
- `500` - `{"detail": "æäº¤å®¡æ ¸å¤±è´¥: é”™è¯¯ä¿¡æ¯"}` 
