# ğŸ“˜ 09-æ–‡æ¡£å‘å¸ƒæ¨¡å— - å‰ç«¯æ¥å£æ–‡æ¡£

> **æ¨¡å—è·¯å¾„**ï¼š`/api/v2/document_publish`  
> **æ¥å£æ•°é‡**ï¼š10ä¸ª ğŸ†•  
> **è®¤è¯è¦æ±‚**ï¼šâœ… å¤§éƒ¨åˆ†éœ€è¦ç™»å½•

---

## ğŸ”— æ¥å£åˆ—è¡¨

### å‘å¸ƒç®¡ç† (5ä¸ª) ğŸ†•
1. **æäº¤å‘å¸ƒç”³è¯·** - `POST /submit`
2. **æ’¤å›å·²å‘å¸ƒæ–‡æ¡£** - `POST /unpublish/{document_id}`
3. **è·å–å‘å¸ƒçŠ¶æ€** - `GET /status/{document_id}`
4. **è·å–å‘å¸ƒè¯¦æƒ…** - `GET /document/{document_id}`
5. **ğŸ†• æ›´æ–°å·²å‘å¸ƒæ–‡æ¡£** - `PUT /update/{document_id}`

### æ–‡æ¡£å±•ç¤º (2ä¸ª)
6. **å·²å‘å¸ƒæ–‡æ¡£åˆ—è¡¨** - `GET /published` âŒ æ— éœ€è®¤è¯
7. **å¢åŠ æ–‡æ¡£æµè§ˆé‡** - `POST /view/{document_id}` âŒ æ— éœ€è®¤è¯

### ä¸ªäººç®¡ç† (2ä¸ª)
8. **æˆ‘çš„å‘å¸ƒè®°å½•** - `GET /my-records`
9. **å‘å¸ƒç»Ÿè®¡ä¿¡æ¯** - `GET /stats`

### é…ç½®ä¿¡æ¯ (1ä¸ª)
10. **å‘å¸ƒé…ç½®ä¿¡æ¯** - `GET /config`

---

## ğŸ“‹ æ¥å£è¯¦æƒ…

### 1. æäº¤å‘å¸ƒç”³è¯·

**è¯·æ±‚å‚æ•°**
```json
{
  "document_id": 123,
  "publish_reason": "åˆ†äº«æŠ€æœ¯ç»éªŒ",     // å¯é€‰ï¼Œå‘å¸ƒè¯´æ˜
  "publish_config": {                 // å¯é€‰ï¼Œå‘å¸ƒé…ç½®
    "auto_publish": true
  }
}
```

**å‘å¸ƒæµç¨‹**
1. æ£€æŸ¥æ–‡æ¡£æƒé™
2. åˆ›å»ºå‘å¸ƒè®°å½•
3. è§¦å‘AIå®¡æ ¸
4. è‡ªåŠ¨å‘å¸ƒï¼ˆå®¡æ ¸é€šè¿‡ï¼‰

**æˆåŠŸå“åº” (200)**
```json
{
  "id": 1,
  "document_id": 123,
  "user_id": 456,
  "publish_version": 1,
  "publish_status": "pending_review",
  "publish_time": null,
  "unpublish_time": null,
  "publish_reason": "åˆ†äº«æŠ€æœ¯ç»éªŒ",
  "unpublish_reason": null,
  "review_id": 789,
  "view_count": 0,
  "is_featured": false,
  "publish_config": {"auto_publish": true},
  "created_at": "2025-01-27T10:30:45.123456",
  "updated_at": "2025-01-27T10:30:45.123456"
}
```

**é”™è¯¯å“åº”**
- `400` - `{"detail": "æ–‡æ¡£å·²å‘å¸ƒï¼Œæ— æ³•é‡å¤æäº¤"}`
- `400` - `{"detail": "æ–‡æ¡£æ­£åœ¨å®¡æ ¸ä¸­ï¼Œè¯·å‹¿é‡å¤æäº¤"}`
- `404` - `{"detail": "æ–‡æ¡£ä¸å­˜åœ¨æˆ–æ— æƒé™"}`

### 2. å·²å‘å¸ƒæ–‡æ¡£åˆ—è¡¨ï¼ˆå…¬å¼€æ¥å£ï¼‰

**æŸ¥è¯¢å‚æ•°**
- `page=1` - é¡µç  (â‰¥1)
- `size=20` - æ¯é¡µæ•°é‡ (1-100)
- `status` - å‘å¸ƒçŠ¶æ€ç­›é€‰
- `is_featured` - æ˜¯å¦ç²¾é€‰ç­›é€‰

**æˆåŠŸå“åº” (200)**
```json
{
  "items": [
    {
      "id": 123,
      "title": "Vue3å¼€å‘æŒ‡å—",
      "summary": "è¯¦ç»†ä»‹ç»Vue3çš„æ–°ç‰¹æ€§",
      "file_type": "md",
      "user_id": 456,
      "publish_time": "2025-01-27T10:30:45.123456",
      "view_count": 150,
      "is_featured": true
    }
  ],
  "total": 50,
  "page": 1,
  "size": 20,
  "pages": 3
}
```

### 3. è·å–å‘å¸ƒè¯¦æƒ…

**æˆåŠŸå“åº” (200)**
```json
{
  "document_id": 123,
  "title": "Vue3å¼€å‘æŒ‡å—",
  "summary": "è¯¦ç»†ä»‹ç»Vue3çš„æ–°ç‰¹æ€§",
  "file_type": "md",
  "created_at": "2025-01-27T10:30:45.123456",
  "publish_record": {
    "id": 1,
    "publish_status": "published",
    "publish_time": "2025-01-27T11:00:00.000000",
    "view_count": 150,
    "is_featured": true
  },
  "publish_history": [
    {
      "id": 1,
      "action_type": "submit",
      "action_reason": "åˆ†äº«æŠ€æœ¯ç»éªŒ",
      "old_status": "draft",
      "new_status": "pending_review",
      "action_time": "2025-01-27T10:30:45.123456"
    },
    {
      "id": 2,
      "action_type": "approve",
      "action_reason": "AIå®¡æ ¸é€šè¿‡",
      "old_status": "pending_review",
      "new_status": "published",
      "action_time": "2025-01-27T11:00:00.000000"
    }
  ]
}
```

### 4. æ’¤å›å·²å‘å¸ƒæ–‡æ¡£

**è¯·æ±‚å‚æ•°**
```json
{
  "unpublish_reason": "å†…å®¹éœ€è¦æ›´æ–°"
}
```

**æˆåŠŸå“åº” (200)** - åŒæäº¤å‘å¸ƒç”³è¯·å“åº”æ ¼å¼

### 5. ğŸ†• æ›´æ–°å·²å‘å¸ƒæ–‡æ¡£

**åŠŸèƒ½ç‰¹ç‚¹**
- âœ… **ä¿ç•™æ‰€æœ‰äº’åŠ¨æ•°æ®**ï¼ˆè¯„è®ºã€ç‚¹èµã€æ”¶è—ã€æµè§ˆé‡ï¼‰
- âœ… **é‡æ–°æäº¤AIå®¡æ ¸**
- âœ… **å®¡æ ¸æœŸé—´æŠ€æœ¯å¹¿åœºæ˜¾ç¤ºæ—§ç‰ˆæœ¬**
- âœ… **å®¡æ ¸é€šè¿‡åæ˜¾ç¤ºæ–°ç‰ˆæœ¬**
- âœ… **åˆ†äº«é“¾æ¥ä¿æŒæœ‰æ•ˆ**
- âœ… **ç‰ˆæœ¬æ§åˆ¶å’Œæ“ä½œå†å²**

**ä¸šåŠ¡æµç¨‹**
1. éªŒè¯æ–‡æ¡£æƒé™å’Œå‘å¸ƒçŠ¶æ€
2. ä¿å­˜å¾…å®¡æ ¸å†…å®¹åˆ°ä¸´æ—¶å­—æ®µ
3. è§¦å‘AIå®¡æ ¸
4. å®¡æ ¸é€šè¿‡ï¼šåº”ç”¨æ–°å†…å®¹
5. å®¡æ ¸å¤±è´¥ï¼šå›æ»šåˆ°åŸå†…å®¹

**è¯·æ±‚å‚æ•°**
```json
{
  "title": "æ›´æ–°åçš„æ–‡æ¡£æ ‡é¢˜",           // å¯é€‰ï¼Œæ–°æ ‡é¢˜
  "content": "# æ›´æ–°åçš„å†…å®¹\n\n...",   // å¯é€‰ï¼Œæ–°å†…å®¹
  "summary": "æ›´æ–°åçš„æ‘˜è¦",           // å¯é€‰ï¼Œæ–°æ‘˜è¦
  "update_reason": "ä¿®å¤å†…å®¹é”™è¯¯ï¼Œå¢åŠ æ–°çš„ç¤ºä¾‹"  // å¿…å¡«ï¼Œæ›´æ–°åŸå› 
}
```

**æˆåŠŸå“åº” (200)**
```json
{
  "success": true,
  "message": "æ–‡æ¡£æ›´æ–°æäº¤æˆåŠŸï¼Œæ­£åœ¨è¿›è¡ŒAIå®¡æ ¸",
  "publish_record": {
    "id": 1,
    "document_id": 123,
    "user_id": 456,
    "publish_version": 2,
    "publish_status": "pending_review",
    "publish_time": "2025-01-27T11:00:00.000000",
    "view_count": 150,
    "is_featured": true,
    "created_at": "2025-01-27T10:30:45.123456",
    "updated_at": "2025-01-27T12:00:00.000000"
  },
  "update_info": {
    "has_pending_update": true,
    "review_status": "pending",
    "estimated_review_time": "1-3åˆ†é’Ÿ",
    "version": 2,
    "update_reason": "ä¿®å¤å†…å®¹é”™è¯¯ï¼Œå¢åŠ æ–°çš„ç¤ºä¾‹"
  }
}
```

**é”™è¯¯å“åº”**
- `400` - `{"detail": "æ–‡æ¡£æ­£åœ¨å®¡æ ¸ä¸­ï¼Œè¯·ç­‰å¾…å®¡æ ¸å®Œæˆ"}`
- `400` - `{"detail": "æœªæ£€æµ‹åˆ°å†…å®¹å˜æ›´"}`
- `400` - `{"detail": "æ–‡æ¡£æœªå‘å¸ƒæˆ–çŠ¶æ€å¼‚å¸¸"}`
- `404` - `{"detail": "æ–‡æ¡£ä¸å­˜åœ¨æˆ–æ— æƒé™"}`

**ä½¿ç”¨åœºæ™¯**
- ä¿®å¤å·²å‘å¸ƒæ–‡æ¡£çš„é”™è¯¯
- æ›´æ–°è¿‡æ—¶çš„æŠ€æœ¯å†…å®¹
- æ·»åŠ æ–°çš„ç¤ºä¾‹å’Œè¯´æ˜
- ä¼˜åŒ–æ–‡æ¡£ç»“æ„å’Œè¡¨è¾¾

**ä¸æ’¤å›é‡å‘çš„åŒºåˆ«**
| æ“ä½œæ–¹å¼ | äº’åŠ¨æ•°æ® | åˆ†äº«é“¾æ¥ | ç‰ˆæœ¬æ§åˆ¶ | æŠ€æœ¯å¹¿åœºæ˜¾ç¤º |
|----------|----------|----------|----------|-------------|
| æ’¤å›é‡å‘ | âŒ ä¸¢å¤± | âŒ å¤±æ•ˆ | âŒ é‡ç½® | âŒ ä¸‹çº¿åé‡æ–°ä¸Šçº¿ |
| ç›´æ¥æ›´æ–° | âœ… ä¿ç•™ | âœ… æœ‰æ•ˆ | âœ… é€’å¢ | âœ… æ— ç¼åˆ‡æ¢ |

### 6. æˆ‘çš„å‘å¸ƒè®°å½•

**æŸ¥è¯¢å‚æ•°**
- `page=1` - é¡µç  (â‰¥1)
- `size=20` - æ¯é¡µæ•°é‡ (1-100)

**æˆåŠŸå“åº” (200)**
```json
{
  "success": true,
  "data": {
    "items": [
      {
        "publish_record": {
          "id": 1,
          "document_id": 123,
          "publish_status": "published",
          "publish_time": "2025-01-27T11:00:00.000000",
          "view_count": 150
        },
        "document": {
          "id": 123,
          "title": "Vue3å¼€å‘æŒ‡å—",
          "summary": "è¯¦ç»†ä»‹ç»Vue3çš„æ–°ç‰¹æ€§",
          "file_type": "md"
        }
      }
    ],
    "total": 10,
    "page": 1,
    "size": 20,
    "pages": 1
  },
  "message": "è·å–å‘å¸ƒè®°å½•æˆåŠŸ"
}
```

### 7. å‘å¸ƒç»Ÿè®¡ä¿¡æ¯

**æŸ¥è¯¢å‚æ•°**
- `global_stats=false` - æ˜¯å¦è·å–å…¨å±€ç»Ÿè®¡

**æˆåŠŸå“åº” (200)**
```json
{
  "total_published": 15,
  "total_drafts": 5,
  "pending_review": 2,
  "today_published": 3,
  "featured_count": 8,
  "total_views": 1250
}
```

### 8. å¢åŠ æ–‡æ¡£æµè§ˆé‡ï¼ˆå…¬å¼€æ¥å£ï¼‰

**æˆåŠŸå“åº” (200)**
```json
{
  "success": true,
  "message": "æµè§ˆé‡å·²æ›´æ–°"
}
```

### 9. è·å–å‘å¸ƒçŠ¶æ€

**æˆåŠŸå“åº” (200)**
```json
{
  "success": true,
  "data": {
    "document_id": 123,
    "publish_status": "published",
    "publish_time": "2025-01-27T11:00:00.000000",
    "view_count": 150,
    "is_featured": true,
    "publish_reason": "åˆ†äº«æŠ€æœ¯ç»éªŒ",
    "unpublish_reason": null
  }
}
```

### 10. å‘å¸ƒé…ç½®ä¿¡æ¯

**æˆåŠŸå“åº” (200)**
```json
{
  "success": true,
  "data": {
    "publish_statuses": {
      "draft": "è‰ç¨¿",
      "pending_review": "å¾…å®¡æ ¸",
      "review_passed": "å®¡æ ¸é€šè¿‡",
      "review_failed": "å®¡æ ¸å¤±è´¥",
      "published": "å·²å‘å¸ƒ",
      "unpublished": "å·²æ’¤å›"
    },
    "action_types": {
      "submit": "æäº¤å‘å¸ƒ",
      "approve": "å®¡æ ¸é€šè¿‡",
      "reject": "å®¡æ ¸æ‹’ç»",
      "publish": "å‘å¸ƒ",
      "unpublish": "æ’¤å›",
      "edit": "ç¼–è¾‘"  // ğŸ†• æ–°å¢ç¼–è¾‘æ“ä½œç±»å‹
    },
    "rules": {
      "auto_review": "æ”¯æŒAIè‡ªåŠ¨å®¡æ ¸",
      "publish_flow": "æäº¤ â†’ AIå®¡æ ¸ â†’ è‡ªåŠ¨å‘å¸ƒ",
      "unpublish_anytime": "å·²å‘å¸ƒæ–‡æ¡£å¯éšæ—¶æ’¤å›",
      "view_tracking": "è‡ªåŠ¨è·Ÿè¸ªæ–‡æ¡£æµè§ˆé‡",
      "update_support": "ğŸ†• æ”¯æŒå·²å‘å¸ƒæ–‡æ¡£ç›´æ¥æ›´æ–°"
    }
  }
}
```

---

## ğŸ“Š å‘å¸ƒçŠ¶æ€è¯´æ˜

| çŠ¶æ€ | è¯´æ˜ | å¯æ‰§è¡Œæ“ä½œ |
|------|------|-----------|
| `draft` | è‰ç¨¿ | æäº¤å‘å¸ƒ |
| `pending_review` | å¾…å®¡æ ¸ | ç­‰å¾…AIå®¡æ ¸ |
| `review_passed` | å®¡æ ¸é€šè¿‡ | è‡ªåŠ¨å‘å¸ƒ |
| `review_failed` | å®¡æ ¸å¤±è´¥ | é‡æ–°æäº¤ |
| `published` | å·²å‘å¸ƒ | æ’¤å›å‘å¸ƒã€ğŸ†• ç›´æ¥æ›´æ–° |
| `unpublished` | å·²æ’¤å› | é‡æ–°æäº¤ |

---

## ğŸ”„ æ–‡æ¡£æ›´æ–°æµç¨‹å›¾ ğŸ†•

```
å·²å‘å¸ƒæ–‡æ¡£ â†’ æäº¤æ›´æ–° â†’ AIå®¡æ ¸ä¸­ â†’ å®¡æ ¸ç»“æœ
     â†“           â†“          â†“         â†“
  æ˜¾ç¤ºæ—§ç‰ˆæœ¬   ä¿å­˜ä¸´æ—¶å†…å®¹  æ˜¾ç¤ºæ—§ç‰ˆæœ¬   â†“
                                    â†“
                              å®¡æ ¸é€šè¿‡ â†’ æ˜¾ç¤ºæ–°ç‰ˆæœ¬
                                    â†“
                              å®¡æ ¸å¤±è´¥ â†’ å›æ»šåˆ°æ—§ç‰ˆæœ¬
```

**å…³é”®ä¼˜åŠ¿**ï¼š
- ğŸ”’ **é›¶åœæœºæ›´æ–°** - å®¡æ ¸æœŸé—´ç”¨æˆ·ä»å¯è®¿é—®æ—§ç‰ˆæœ¬
- ğŸ’¾ **æ•°æ®å®‰å…¨** - æ‰€æœ‰äº’åŠ¨æ•°æ®å®Œæ•´ä¿ç•™
- ğŸ”— **é“¾æ¥ç¨³å®š** - åˆ†äº«é“¾æ¥æ°¸ä¸å¤±æ•ˆ
- ğŸ“ˆ **ç‰ˆæœ¬è¿½è¸ª** - å®Œæ•´çš„æ›´æ–°å†å²è®°å½•

---

## âŒ é”™è¯¯å“åº”

- `400` - `{"detail": "æ–‡æ¡£å·²å‘å¸ƒï¼Œæ— æ³•é‡å¤æäº¤"}`
- `400` - `{"detail": "æ–‡æ¡£æ­£åœ¨å®¡æ ¸ä¸­ï¼Œè¯·ç­‰å¾…å®¡æ ¸å®Œæˆ"}` ğŸ†•
- `400` - `{"detail": "æœªæ£€æµ‹åˆ°å†…å®¹å˜æ›´"}` ğŸ†•
- `404` - `{"detail": "æ–‡æ¡£ä¸å­˜åœ¨æˆ–æ— æƒé™"}`
- `500` - `{"detail": "å‘å¸ƒç”³è¯·å¤±è´¥: é”™è¯¯ä¿¡æ¯"}`
- `500` - `{"detail": "æ›´æ–°æ–‡æ¡£å¤±è´¥: é”™è¯¯ä¿¡æ¯"}` ğŸ†•

---

**æ–‡æ¡£ç‰ˆæœ¬**ï¼šv2.1 | **æ›´æ–°æ—¶é—´**ï¼š2024-12-19 | **æ¥å£æ€»æ•°**ï¼š10ä¸ª ğŸ“„