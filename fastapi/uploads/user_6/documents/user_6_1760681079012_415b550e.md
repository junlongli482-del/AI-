LOCAL_FILES = {
    "md_file": r"C:\A_XM\xm_3\vue3-fastapi-mysql_v1.0\fastapi\文档\V1阶段开发文档\登录注册需求文档.md",  # 修改为你的MD文件路径
    "pdf_file": r"C:\Users\LJL\Desktop\静态心电第二页\24561_蒲玉莲_心电图报告.pdf",  # 修改为你的PDF文件路径
}

好的！以下是根据你提供的所有信息整理并完善的 **完整 Markdown 文档**，已按逻辑结构组织，可直接保存为 `.md` 文件使用。

---

📄 文件名建议：`FastAPI_模块化用户系统_完整技术文档.md`

```markdown
# 📘 FastAPI 模块化用户系统 — 完整技术文档（v2.1）

> **最后更新**：2025年4月  
> **适用对象**：后端开发、测试工程师、项目交接人员  
> **项目状态**：✅ 核心功能全部完成（注册、登录、资料、密码）  
> **架构原则**：模块化 + 版本化 + 零侵入 + 自动注册

---

## 一、项目概览

| 项目属性 | 值 |
|--------|----|
| 项目名称 | FastAPI Modular User System |
| 项目路径 | `C:\A_XM\xm_3\vue3-fastapi-mysql_v1.0\fastapi` |
| 服务端口 | `8100` |
| 数据库 | MySQL 8+，库名 `user_system` |
| 表前缀 | `us_`（避免命名冲突） |
| 认证方式 | JWT Bearer Token（HS256） |
| 架构风格 | 模块化 + 版本化（v1） |
| 自动注册 | ✅ 无需修改 `main.py` |

---

## 二、完整项目目录结构

```bash
fastapi/
├── app/
│   ├── core/                          # 核心基础设施
│   │   ├── __init__.py
│   │   ├── config.py                  # JWT/DB/Token 配置
│   │   └── database.py                # SQLAlchemy 引擎 + SessionLocal
│   │
│   ├── modules/                       # 业务模块根目录
│   │   └── v1/                        # API 版本 v1
│   │       ├── __init__.py
│   │       │
│   │       ├── user_register/         # ✅ 用户注册模块
│   │       │   ├── __init__.py
│   │       │   ├── models.py          # User ORM 模型（含 us_users 表映射）
│   │       │   ├── schemas.py         # Pydantic 模型：RegisterRequest, UserResponse
│   │       │   ├── services.py        # register_user(), check_username_exists()
│   │       │   ├── routes.py          # /register, /check-username, /test
│   │       │   └── dependencies.py    # DB 会话依赖
│   │       │
│   │       ├── user_auth/             # ✅ 用户认证模块
│   │       │   ├── __init__.py
│   │       │   ├── models.py          # 复用 User 模型
│   │       │   ├── schemas.py         # LoginRequest, TokenResponse
│   │       │   ├── services.py        # authenticate_user(), create_access_token()
│   │       │   ├── routes.py          # /login, /me, /refresh, /test
│   │       │   └── dependencies.py    # get_current_user(), JWT 验证
│   │       │
│   │       ├── user_profile/          # ✅ 用户中心模块
│   │       │   ├── __init__.py
│   │       │   ├── models.py          # 扩展 User（含 nickname）
│   │       │   ├── schemas.py         # UserProfileResponse, UpdateNicknameRequest
│   │       │   ├── services.py        # get_user_profile(), update_nickname()
│   │       │   ├── routes.py          # /me, /nickname, /check-nickname, /logout, /test
│   │       │   └── dependencies.py    # 复用 JWT 依赖
│   │       │
│   │       └── password_manager/      # ✅ 密码管理模块
│   │           ├── __init__.py
│   │           ├── models.py          # 复用 User 模型
│   │           ├── schemas.py         # ChangePasswordRequest, PasswordStrengthResponse
│   │           ├── services.py        # change_password(), validate_password_strength()
│   │           ├── routes.py          # /change-password, /check-strength, /user-info, /test
│   │           └── dependencies.py    # JWT + DB 依赖
│   │
│   └── main.py                        # 🚀 应用入口：自动扫描并注册 v1 模块
│
├── .env                               # 环境变量
├── requirements.txt                   # 依赖列表
├── README.md                          # 项目说明
└── tests/                             # （可选）单元测试目录
```

> ✅ **关键设计**：
> - 所有模块共享 `user_register/models.py` 中的 `User` ORM 模型
> - `main.py` 使用 `pathlib` + `importlib` 自动发现模块，**新增模块无需修改主程序**

---

## 三、数据库设计

### 表名：`us_users`

```sql
CREATE TABLE us_users (
    id INT AUTO_INCREMENT PRIMARY KEY,
    username VARCHAR(50) NOT NULL UNIQUE COMMENT '3-20字符，字母数字，唯一',
    email VARCHAR(100) NOT NULL UNIQUE COMMENT '有效邮箱，唯一',
    password_hash VARCHAR(255) NOT NULL COMMENT '格式：salt:sha256(salt+password)',
    nickname VARCHAR(50) DEFAULT NULL UNIQUE COMMENT '2-20字符（中英文数字），可为空，唯一',
    is_active BOOLEAN DEFAULT TRUE COMMENT '账户是否激活',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    
    INDEX idx_username (username),
    INDEX idx_email (email),
    INDEX idx_nickname (nickname)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;
```

