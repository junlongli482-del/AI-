import{_ as a,r as s,a as e,k as r,E as l,p as o,c as n,b as t,f as d,w as u,g as c,t as p,u as i,o as w,h as m,j as v,n as f,q as _,m as h}from"./index-Bz-vZ-vF.js";import{r as g}from"./request-DTYmNTM5.js";import{u as y}from"./user-BOiUjbcT.js";const b={class:"change-password-container"},k={class:"header"},E={class:"header-content"},V={class:"user-menu"},x={class:"user-info"},C={class:"username"},j={class:"main-content"},T={class:"password-card"},U={class:"user-info-display"},q={class:"info-item"},B={class:"value"},I={class:"info-item"},$={class:"value"},z={key:0,class:"password-strength"},A={class:"strength-bar"},F={class:"button-group"},P=a({__name:"ChangePassword",setup(a){const P=i(),R=y(),Z=s(null),D=s(!1),G=s(null),H=s(null),J=e({current_password:"",new_password:"",confirm_password:""});r(async()=>{try{G.value=await g({url:"v1/password_manager/user-info",method:"get"})}catch(a){l.error("è·å–ç”¨æˆ·ä¿¡æ¯å¤±è´¥")}});const K={current_password:[{validator:(a,s,e)=>{s?s.length<8?e(new Error("å¯†ç è‡³å°‘8ä½")):e():e(new Error("è¯·è¾“å…¥åŸå¯†ç "))},trigger:"blur"}],new_password:[{validator:(a,s,e)=>{s?s.length<8?e(new Error("å¯†ç è‡³å°‘8ä½")):/(?=.*[A-Za-z])(?=.*\d)/.test(s)?s===J.current_password?e(new Error("æ–°å¯†ç ä¸èƒ½ä¸åŸå¯†ç ç›¸åŒ")):e():e(new Error("å¯†ç å¿…é¡»åŒ…å«å­—æ¯å’Œæ•°å­—")):e(new Error("è¯·è¾“å…¥æ–°å¯†ç "))},trigger:"blur"}],confirm_password:[{validator:(a,s,e)=>{s?s!==J.new_password?e(new Error("ä¸¤æ¬¡è¾“å…¥çš„å¯†ç ä¸ä¸€è‡´")):e():e(new Error("è¯·å†æ¬¡è¾“å…¥æ–°å¯†ç "))},trigger:"blur"}]},L=async()=>{if(J.new_password.length>=8)try{H.value=await(a=J.new_password,g({url:"v1/password_manager/check-strength",method:"post",data:{password:a}}))}catch(s){H.value=null}else H.value=null;var a},M=o(()=>{if(!H.value)return"";const a=H.value.score;return a>=80?"strong":a>=60?"medium":"weak"}),N=o(()=>H.value?`${H.value.score}%`:"0%"),O=o(()=>{if(!H.value)return"";const a=H.value.score;return a>=80?"å¼º ğŸ’ª":a>=60?"ä¸­ ğŸ‘":"å¼± âš ï¸"}),Q=async()=>{Z.value&&await Z.value.validate(async a=>{if(a){D.value=!0;try{await(s={current_password:J.current_password,new_password:J.new_password,confirm_password:J.confirm_password},g({url:"v1/password_manager/change-password",method:"post",data:s})),l.success("å¯†ç ä¿®æ”¹æˆåŠŸï¼Œè¯·é‡æ–°ç™»å½•"),setTimeout(()=>{R.logout(),P.push("/login")},1500)}catch(e){}finally{D.value=!1}var s}})},S=()=>{P.back()},W=async a=>{if("home"===a)P.push("/home");else if("profile"===a)P.push("/user-center");else if("logout"===a)try{await h.confirm("ç¡®å®šè¦é€€å‡ºç™»å½•å—ï¼Ÿ","æç¤º",{confirmButtonText:"ç¡®å®š",cancelButtonText:"å–æ¶ˆ",type:"warning"}),R.logout(),l.success("å·²é€€å‡ºç™»å½•"),P.push("/login")}catch{}};return(a,s)=>{const e=c("el-dropdown-item"),r=c("el-dropdown-menu"),l=c("el-dropdown"),o=c("el-input"),i=c("el-form-item"),h=c("el-button"),g=c("el-form");return w(),n("div",b,[t("header",k,[t("div",E,[t("h1",{class:"logo",onClick:s[0]||(s[0]=s=>a.$router.push("/home"))},"ç”¨æˆ·ç³»ç»Ÿ"),t("div",V,[d(l,{onCommand:W},{dropdown:u(()=>[d(r,null,{default:u(()=>[d(e,{command:"home"},{default:u(()=>[...s[5]||(s[5]=[m("ğŸ  è¿”å›ä¸»é¡µ",-1)])]),_:1}),d(e,{command:"profile"},{default:u(()=>[...s[6]||(s[6]=[m("ğŸ‘¤ ç”¨æˆ·ä¸­å¿ƒ",-1)])]),_:1}),d(e,{command:"logout",divided:""},{default:u(()=>[...s[7]||(s[7]=[m("ğŸšª é€€å‡ºç™»å½•",-1)])]),_:1})]),_:1})]),default:u(()=>[t("div",x,[t("span",C,p(G.value?.username||"ç”¨æˆ·"),1),s[4]||(s[4]=t("span",{class:"arrow"},"â–¼",-1))])]),_:1})])])]),t("main",j,[t("div",T,[s[11]||(s[11]=t("div",{class:"card-header"},[t("div",{class:"header-icon"},"ğŸ”’"),t("h2",{class:"card-title"},"ä¿®æ”¹å¯†ç ")],-1)),t("div",U,[t("div",q,[s[8]||(s[8]=t("span",{class:"label"},"ğŸ‘¤ å½“å‰ç”¨æˆ·ï¼š",-1)),t("span",B,p(G.value?.username),1)]),t("div",I,[s[9]||(s[9]=t("span",{class:"label"},"ğŸ“§ é‚®ç®±ï¼š",-1)),t("span",$,p(G.value?.email),1)])]),d(g,{ref_key:"passwordFormRef",ref:Z,model:J,rules:K,"label-width":"100px",class:"password-form"},{default:u(()=>[d(i,{label:"åŸå¯†ç ",prop:"current_password"},{default:u(()=>[d(o,{modelValue:J.current_password,"onUpdate:modelValue":s[1]||(s[1]=a=>J.current_password=a),type:"password",placeholder:"è¯·è¾“å…¥åŸå¯†ç ","show-password":""},null,8,["modelValue"])]),_:1}),d(i,{label:"æ–°å¯†ç ",prop:"new_password"},{default:u(()=>[d(o,{modelValue:J.new_password,"onUpdate:modelValue":s[2]||(s[2]=a=>J.new_password=a),type:"password",placeholder:"è‡³å°‘8ä½ï¼ŒåŒ…å«å­—æ¯å’Œæ•°å­—","show-password":"",onInput:L},null,8,["modelValue"]),H.value?(w(),n("div",z,[t("div",A,[t("div",{class:_(["strength-fill",M.value]),style:f({width:N.value})},null,6)]),t("span",{class:_(["strength-text",M.value])}," å¯†ç å¼ºåº¦ï¼š"+p(O.value),3)])):v("",!0)]),_:1}),d(i,{label:"ç¡®è®¤æ–°å¯†ç ",prop:"confirm_password"},{default:u(()=>[d(o,{modelValue:J.confirm_password,"onUpdate:modelValue":s[3]||(s[3]=a=>J.confirm_password=a),type:"password",placeholder:"è¯·å†æ¬¡è¾“å…¥æ–°å¯†ç ","show-password":""},null,8,["modelValue"])]),_:1}),d(i,null,{default:u(()=>[t("div",F,[d(h,{type:"primary",onClick:Q,loading:D.value,class:"submit-button"},{default:u(()=>[m(p(D.value?"ä¿®æ”¹ä¸­...":"ç¡®è®¤ä¿®æ”¹"),1)]),_:1},8,["loading"]),d(h,{onClick:S,class:"cancel-button"},{default:u(()=>[...s[10]||(s[10]=[m(" å–æ¶ˆ ",-1)])]),_:1})])]),_:1})]),_:1},8,["model"]),s[12]||(s[12]=t("div",{class:"password-tips"},[t("h4",null,"ğŸ’¡ å¯†ç è¦æ±‚ï¼š"),t("ul",null,[t("li",null,"é•¿åº¦è‡³å°‘8ä½"),t("li",null,"å¿…é¡»åŒ…å«å­—æ¯å’Œæ•°å­—"),t("li",null,"å»ºè®®ä½¿ç”¨å¤§å°å†™å­—æ¯ã€æ•°å­—å’Œç‰¹æ®Šå­—ç¬¦ç»„åˆ")])],-1))])])])}}},[["__scopeId","data-v-2cb1d822"]]);export{P as default};
