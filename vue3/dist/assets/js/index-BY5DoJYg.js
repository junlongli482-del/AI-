const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/js/index-Be_SmzdB.js","assets/js/request-49VFfJMC.js","assets/js/index-mLi0s7WA.js","assets/css/index-Dz2H2Hq-.css"])))=>i.map(i=>d[i]);
import{A as e}from"./AppHeader-DG160XR7.js";import{_ as a,r as l,p as t,v as s,g as o,l as n,o as i,w as d,f as r,i as u,b as c,c as p,h as v,E as m,j as f,x as y,t as g,q as h,F as _,e as w,k,s as b,y as C,z as x,m as z,u as D,A as V,B as $,C as M,a as F,D as I,G as B,H as U,I as R,d as S,n as j}from"./index-mLi0s7WA.js";import{v as T,c as L,g as P,d as A,a as E,b as O,f as q,e as N,r as H,h as G,i as K,u as W,j as J,s as Q}from"./index-Be_SmzdB.js";import{r as X,A as Y}from"./request-49VFfJMC.js";import"./user-DXv7J6WQ.js";const Z={class:"level-hint"},ee={key:0},ae={key:1},le={key:2},te={key:3,class:"error-hint"},se={class:"dialog-footer"},oe=a({__name:"CreateFolder",props:{modelValue:{type:Boolean,default:!1},parentFolder:{type:Object,default:null}},emits:["update:modelValue","success"],setup(e,{emit:a}){const f=e,y=a,g=l(null),h=l(!1),_=l({name:"",parent_id:null}),w=t({get:()=>f.modelValue,set:e=>y("update:modelValue",e)}),k=t(()=>f.parentFolder?f.parentFolder.name:"æ ¹ç›®å½•"),b=t(()=>f.parentFolder?f.parentFolder.level:0),C={name:[{required:!0,message:"è¯·è¾“å…¥æ–‡ä»¶å¤¹åç§°",trigger:"blur"},{validator:(e,a,l)=>{const t=T(a);t.valid?l():l(new Error(t.message))},trigger:"blur"}]};s(()=>f.parentFolder,e=>{_.value.parent_id=e?e.id:null},{immediate:!0});const x=async()=>{if(g.value)try{if(await g.value.validate(),b.value>=3)return void m.error("æ–‡ä»¶å¤¹å±‚çº§ä¸èƒ½è¶…è¿‡3å±‚");h.value=!0;const e={name:_.value.name.trim()};_.value.parent_id&&(e.parent_id=_.value.parent_id),await L(e),y("success"),z()}catch(e){"cancel"!==e&&console.error("åˆ›å»ºæ–‡ä»¶å¤¹å¤±è´¥:",e)}finally{h.value=!1}},z=()=>{g.value?.resetFields(),_.value={name:"",parent_id:f.parentFolder?f.parentFolder.id:null},w.value=!1};return(e,a)=>{const l=o("el-input"),t=o("el-form-item"),s=o("el-form"),m=o("el-button"),f=o("el-dialog");return i(),n(f,{modelValue:w.value,"onUpdate:modelValue":a[1]||(a[1]=e=>w.value=e),title:"åˆ›å»ºæ–‡ä»¶å¤¹",width:"500px","close-on-click-modal":!1,onClose:z},{footer:d(()=>[c("div",se,[r(m,{onClick:z},{default:d(()=>[...a[2]||(a[2]=[v("å–æ¶ˆ",-1)])]),_:1}),r(m,{type:"primary",loading:h.value,onClick:x},{default:d(()=>[...a[3]||(a[3]=[v(" ç¡®å®š ",-1)])]),_:1},8,["loading"])])]),default:d(()=>[r(s,{ref_key:"formRef",ref:g,model:_.value,rules:C,"label-width":"100px"},{default:d(()=>[r(t,{label:"æ–‡ä»¶å¤¹åç§°",prop:"name"},{default:d(()=>[r(l,{modelValue:_.value.name,"onUpdate:modelValue":a[0]||(a[0]=e=>_.value.name=e),placeholder:"è¯·è¾“å…¥æ–‡ä»¶å¤¹åç§°",maxlength:"100","show-word-limit":"",onKeyup:u(x,["enter"])},null,8,["modelValue"])]),_:1}),r(t,{label:"çˆ¶æ–‡ä»¶å¤¹"},{default:d(()=>[r(l,{value:k.value,disabled:"",placeholder:"æ ¹ç›®å½•"},null,8,["value"])]),_:1}),r(t,{label:"å±‚çº§æç¤º"},{default:d(()=>[c("div",Z,[0===b.value?(i(),p("span",ee,"å°†åˆ›å»ºä¸€çº§æ–‡ä»¶å¤¹")):1===b.value?(i(),p("span",ae,"å°†åˆ›å»ºäºŒçº§æ–‡ä»¶å¤¹")):2===b.value?(i(),p("span",le,"å°†åˆ›å»ºä¸‰çº§æ–‡ä»¶å¤¹ï¼ˆæœ€åä¸€å±‚ï¼‰")):(i(),p("span",te,"âš ï¸ å·²è¾¾åˆ°æœ€å¤§å±‚çº§é™åˆ¶"))])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])}}},[["__scopeId","data-v-434f8edd"]]),ne={class:"folder-node-wrapper"},ie={class:"node-content"},de={key:1,class:"expand-placeholder"},re={class:"folder-name"},ue={class:"doc-count"},ce={class:"node-actions"},pe={key:0,class:"children-nodes"},ve=a({__name:"FolderNode",props:{folder:{type:Object,required:!0},selectedId:{type:Number,default:null}},emits:["select","create","delete"],setup(e,{emit:a}){const s=e,u=a,m=l(!0),k=t(()=>s.folder.children&&s.folder.children.length>0),b=()=>{m.value=!m.value},C=()=>{u("select",s.folder.id)},x=()=>{u("create",s.folder)},z=()=>{u("delete",s.folder)};return(a,l)=>{const t=o("el-button"),s=o("FolderNode",!0);return i(),p("div",ne,[c("div",{class:h(["folder-node",{active:e.selectedId===e.folder.id,"level-1":1===e.folder.level,"level-2":2===e.folder.level,"level-3":3===e.folder.level}]),onClick:y(C,["stop"])},[c("div",ie,[k.value?(i(),p("span",{key:0,class:"expand-icon",onClick:y(b,["stop"])},g(m.value?"â–¼":"â–¶"),1)):(i(),p("span",de)),l[5]||(l[5]=c("span",{class:"folder-icon"},"ğŸ“",-1)),c("span",re,g(e.folder.name),1),c("span",ue,"("+g(e.folder.document_count)+")",1),c("div",ce,[e.folder.level<3?(i(),n(t,{key:0,type:"text",size:"small",onClick:y(x,["stop"]),title:"åˆ›å»ºå­æ–‡ä»¶å¤¹"},{default:d(()=>[...l[3]||(l[3]=[v(" â• ",-1)])]),_:1})):f("",!0),r(t,{type:"text",size:"small",onClick:y(z,["stop"]),title:"åˆ é™¤æ–‡ä»¶å¤¹"},{default:d(()=>[...l[4]||(l[4]=[v(" ğŸ—‘ï¸ ",-1)])]),_:1})])])],2),k.value&&m.value?(i(),p("div",pe,[(i(!0),p(_,null,w(e.folder.children,t=>(i(),n(s,{key:t.id,folder:t,"selected-id":e.selectedId,onSelect:l[0]||(l[0]=e=>a.$emit("select",e)),onCreate:l[1]||(l[1]=e=>a.$emit("create",e)),onDelete:l[2]||(l[2]=e=>a.$emit("delete",e))},null,8,["folder","selected-id"]))),128))])):f("",!0)])}}},[["__scopeId","data-v-193202e7"]]),me={class:"folder-tree-container"},fe={class:"tree-header"},ye={key:0,class:"loading-container"},ge={key:1,class:"tree-content"},he={class:"node-content"},_e={class:"node-count"},we={class:"tree-list"},ke={key:0,class:"empty-state"},be=a({__name:"FolderTree",emits:["folder-select","tree-update"],setup(e,{expose:a,emit:t}){const s=l(!1),u=l([]),y=l(null),D=l(!1),V=l(null),$=l(0),M=t,F=async()=>{s.value=!0;try{const e=await P();u.value=e,$.value=I(e),M("tree-update",e)}catch(e){m.error("åŠ è½½æ–‡ä»¶å¤¹å¤±è´¥"),console.error("åŠ è½½æ–‡ä»¶å¤¹æ ‘å¤±è´¥:",e)}finally{s.value=!1}},I=e=>{let a=0;return e.forEach(e=>{a+=e.document_count||0,e.children&&e.children.length>0&&(a+=I(e.children))}),a},B=e=>{y.value=e,M("folder-select",e)},U=e=>{V.value=e,D.value=!0},R=()=>{F(),m.success("æ–‡ä»¶å¤¹åˆ›å»ºæˆåŠŸ")},S=async e=>{try{await z.confirm(`ç¡®å®šè¦åˆ é™¤æ–‡ä»¶å¤¹"${e.name}"å—ï¼Ÿåªèƒ½åˆ é™¤ç©ºæ–‡ä»¶å¤¹ã€‚`,"åˆ é™¤ç¡®è®¤",{confirmButtonText:"ç¡®å®š",cancelButtonText:"å–æ¶ˆ",type:"warning"}),await A(e.id),m.success("æ–‡ä»¶å¤¹åˆ é™¤æˆåŠŸ"),y.value===e.id&&B(null),F()}catch(a){"cancel"!==a&&console.error("åˆ é™¤æ–‡ä»¶å¤¹å¤±è´¥:",a)}};return a({refresh:F}),k(()=>{F()}),(e,a)=>{const l=o("el-button"),t=o("el-icon"),m=o("el-empty");return i(),p("div",me,[c("div",fe,[a[5]||(a[5]=c("h3",{class:"tree-title"},"ğŸ“ æ–‡ä»¶å¤¹",-1)),r(l,{type:"primary",size:"small",onClick:a[0]||(a[0]=e=>U(null)),icon:b(C)},{default:d(()=>[...a[4]||(a[4]=[v(" æ–°å»º ",-1)])]),_:1},8,["icon"])]),s.value?(i(),p("div",ye,[r(t,{class:"is-loading"},{default:d(()=>[r(b(x))]),_:1}),a[6]||(a[6]=c("span",null,"åŠ è½½ä¸­...",-1))])):(i(),p("div",ge,[c("div",{class:h(["tree-node root-node",{active:null===y.value}]),onClick:a[1]||(a[1]=e=>B(null))},[c("div",he,[a[7]||(a[7]=c("span",{class:"node-icon"},"ğŸ ",-1)),a[8]||(a[8]=c("span",{class:"node-label"},"å…¨éƒ¨æ–‡æ¡£",-1)),c("span",_e,"("+g($.value)+")",1)])],2),c("div",we,[(i(!0),p(_,null,w(u.value,e=>(i(),n(ve,{key:e.id,folder:e,"selected-id":y.value,onSelect:B,onCreate:U,onDelete:S},null,8,["folder","selected-id"]))),128))]),0===u.value.length?(i(),p("div",ke,[r(m,{description:"æš‚æ— æ–‡ä»¶å¤¹","image-size":80},{default:d(()=>[r(l,{type:"primary",size:"small",onClick:a[2]||(a[2]=e=>U(null))},{default:d(()=>[...a[9]||(a[9]=[v(" åˆ›å»ºç¬¬ä¸€ä¸ªæ–‡ä»¶å¤¹ ",-1)])]),_:1})]),_:1})])):f("",!0)])),r(oe,{modelValue:D.value,"onUpdate:modelValue":a[3]||(a[3]=e=>D.value=e),"parent-folder":V.value,onSuccess:R},null,8,["modelValue","parent-folder"])])}}},[["__scopeId","data-v-1489a5e7"]]),Ce="/v2/document_manager";function xe(e={}){return X({url:`${Ce}/documents`,method:"get",params:{page:e.page||1,page_size:e.page_size||20,folder_id:e.folder_id}})}function ze(e){return X({url:`${Ce}/documents/${e}`,method:"delete"})}function De(){return X({url:`${Ce}/stats`,method:"get"})}const Ve={draft:"è‰ç¨¿",published:"å·²å‘å¸ƒ",review_failed:"å®¡æ ¸å¤±è´¥"},$e={md:"Markdown",pdf:"PDF"};function Me(e){if(!e||0===e)return"0 B";const a=Math.floor(Math.log(e)/Math.log(1024));return Math.round(e/Math.pow(1024,a)*100)/100+" "+["B","KB","MB","GB"][a]}const Fe=Object.freeze(Object.defineProperty({__proto__:null,DocumentStatusText:Ve,FileTypeText:$e,deleteDocument:ze,formatFileSize:Me,getDocumentDetail:function(e){return X({url:`${Ce}/documents/${e}`,method:"get"})},getDocuments:xe,getStats:De},Symbol.toStringTag,{value:"Module"})),Ie={key:0,class:"document-detail"},Be={class:"detail-section"},Ue={class:"info-grid"},Re={class:"info-item"},Se={class:"info-value"},je={class:"info-item"},Te={class:"info-value"},Le={class:"info-item"},Pe={class:"info-value"},Ae={class:"info-item"},Ee={class:"info-value"},Oe={class:"info-item"},qe={class:"info-item"},Ne={class:"info-value"},He={class:"info-item"},Ge={class:"info-value"},Ke={key:0,class:"info-item"},We={class:"info-value"},Je={key:0,class:"detail-section"},Qe={class:"summary-text"},Xe={key:1,class:"detail-section"},Ye={key:2,class:"detail-section"},Ze={class:"content-preview"},ea={class:"dialog-footer"},aa=a({__name:"DocumentDetail",props:{modelValue:{type:Boolean,default:!1},document:{type:Object,default:null}},emits:["update:modelValue","refresh"],setup(e,{emit:a}){const l=D(),s=async()=>{if(m.document?.id)try{const e=await fetch(`${Y}/v2/document_manager/documents/${m.document.id}/stream`,{headers:{Authorization:`Bearer ${M()}`}});if(!e.ok)throw new Error("è·å–PDFå¤±è´¥");const a=await e.blob(),l=window.URL.createObjectURL(a);window.open(l,"_blank"),setTimeout(()=>{window.URL.revokeObjectURL(l)},1e3)}catch(e){console.error("æŸ¥çœ‹PDFå¤±è´¥:",e),ElMessage.error("æŸ¥çœ‹PDFå¤±è´¥")}},u=async()=>{if(m.document?.id)try{const e=await fetch(`${Y}/v2/document_manager/documents/${m.document.id}/download`,{headers:{Authorization:`Bearer ${M()}`}});if(!e.ok)throw new Error("ä¸‹è½½PDFå¤±è´¥");const a=e.headers.get("Content-Disposition");let l=m.document.title+".pdf";if(a){const e=a.match(/filename\*?=['"]?([^'";]+)['"]?/);e&&(l=decodeURIComponent(e[1]))}const t=await e.blob(),s=window.URL.createObjectURL(t),o=document.createElement("a");o.href=s,o.download=l,document.body.appendChild(o),o.click(),document.body.removeChild(o),window.URL.revokeObjectURL(s)}catch(e){console.error("ä¸‹è½½PDFå¤±è´¥:",e),ElMessage.error("ä¸‹è½½PDFå¤±è´¥")}},m=e,y=a,h=t({get:()=>m.modelValue,set:e=>y("update:modelValue",e)}),w=e=>Ve[e]||e,k=e=>{if(!e)return"";return new Date(e).toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"})},C=()=>{l.push({path:"/document-editor",query:{id:m.document.id}}),x()},x=()=>{h.value=!1};return(a,l)=>{const t=o("el-tag"),m=o("el-alert"),y=o("el-button"),z=o("el-icon"),D=o("el-dialog");return i(),n(D,{modelValue:h.value,"onUpdate:modelValue":l[0]||(l[0]=e=>h.value=e),title:e.document?.title||"æ–‡æ¡£è¯¦æƒ…",width:"800px",onClose:x},{footer:d(()=>[c("div",ea,[r(y,{onClick:x},{default:d(()=>[...l[13]||(l[13]=[v("å…³é—­",-1)])]),_:1}),"md"===e.document?.file_type?(i(),n(y,{key:0,type:"primary",onClick:C},{default:d(()=>[...l[14]||(l[14]=[v(" ç¼–è¾‘æ–‡æ¡£ ",-1)])]),_:1})):"pdf"===e.document?.file_type?(i(),p(_,{key:1},[r(y,{onClick:s},{default:d(()=>[r(z,null,{default:d(()=>[r(b(V))]),_:1}),l[15]||(l[15]=v(" æŸ¥çœ‹PDF ",-1))]),_:1}),r(y,{type:"primary",onClick:u},{default:d(()=>[r(z,null,{default:d(()=>[r(b($))]),_:1}),l[16]||(l[16]=v(" ä¸‹è½½PDF ",-1))]),_:1})],64)):f("",!0)])]),default:d(()=>{return[e.document?(i(),p("div",Ie,[c("div",Be,[l[9]||(l[9]=c("h4",{class:"section-title"},"åŸºæœ¬ä¿¡æ¯",-1)),c("div",Ue,[c("div",Re,[l[1]||(l[1]=c("span",{class:"info-label"},"æ–‡æ¡£æ ‡é¢˜ï¼š",-1)),c("span",Se,g(e.document.title),1)]),c("div",je,[l[2]||(l[2]=c("span",{class:"info-label"},"æ–‡ä»¶ç±»å‹ï¼š",-1)),c("span",Te,g((o=e.document.file_type,$e[o]||o)),1)]),c("div",Le,[l[3]||(l[3]=c("span",{class:"info-label"},"æ–‡ä»¶å¤§å°ï¼š",-1)),c("span",Pe,g(b(Me)(e.document.file_size)),1)]),c("div",Ae,[l[4]||(l[4]=c("span",{class:"info-label"},"æ‰€å±æ–‡ä»¶å¤¹ï¼š",-1)),c("span",Ee,g(e.document.folder_name||"æ ¹ç›®å½•"),1)]),c("div",Oe,[l[5]||(l[5]=c("span",{class:"info-label"},"çŠ¶æ€ï¼š",-1)),r(t,{type:(s=e.document.status,{draft:"",published:"success",review_failed:"danger"}[s]||""),size:"small"},{default:d(()=>[v(g(w(e.document.status)),1)]),_:1},8,["type"])]),c("div",qe,[l[6]||(l[6]=c("span",{class:"info-label"},"åˆ›å»ºæ—¶é—´ï¼š",-1)),c("span",Ne,g(k(e.document.created_at)),1)]),c("div",He,[l[7]||(l[7]=c("span",{class:"info-label"},"æ›´æ–°æ—¶é—´ï¼š",-1)),c("span",Ge,g(k(e.document.updated_at)),1)]),e.document.publish_time?(i(),p("div",Ke,[l[8]||(l[8]=c("span",{class:"info-label"},"å‘å¸ƒæ—¶é—´ï¼š",-1)),c("span",We,g(k(e.document.publish_time)),1)])):f("",!0)])]),e.document.summary?(i(),p("div",Je,[l[10]||(l[10]=c("h4",{class:"section-title"},"æ–‡æ¡£æ‘˜è¦",-1)),c("p",Qe,g(e.document.summary),1)])):f("",!0),e.document.review_message?(i(),p("div",Xe,[l[11]||(l[11]=c("h4",{class:"section-title"},"å®¡æ ¸ä¿¡æ¯",-1)),r(m,{type:"review_failed"===e.document.status?"error":"success",closable:!1},{default:d(()=>[v(g(e.document.review_message),1)]),_:1},8,["type"])])):f("",!0),"md"===e.document.file_type&&e.document.content?(i(),p("div",Ye,[l[12]||(l[12]=c("h4",{class:"section-title"},"å†…å®¹é¢„è§ˆ",-1)),c("div",Ze,g((a=e.document.content,a?a.length>500?a.substring(0,500)+"...":a:"")),1)])):f("",!0)])):f("",!0)];var a,s,o}),_:1},8,["modelValue","title"])}}},[["__scopeId","data-v-51366dd8"]]),la="/v2/file_upload";const ta={uploading:"ä¸Šä¼ ä¸­",uploaded:"å·²ä¸Šä¼ ",validated:"å·²éªŒè¯",failed:"å¤±è´¥",deleted:"å·²åˆ é™¤"};function sa(e){if(!e||0===e)return"0 B";const a=Math.floor(Math.log(e)/Math.log(1024));return Math.round(e/Math.pow(1024,a)*100)/100+" "+["B","KB","MB","GB"][a]}const oa={class:"dialog-footer"},na=a({__name:"CreateDocumentForm",props:{visible:{type:Boolean,required:!0},uploadResult:{type:Object,default:null}},emits:["update:visible","success"],setup(e,{emit:a}){const t=e,u=a,p=l(!1),f=l(null),y=l(!1),g=l([]),h=F({title:"",summary:"",folder_id:null}),_={title:[{required:!0,message:"è¯·è¾“å…¥æ–‡æ¡£æ ‡é¢˜",trigger:"blur"},{min:1,max:200,message:"æ ‡é¢˜é•¿åº¦åœ¨ 1 åˆ° 200 ä¸ªå­—ç¬¦",trigger:"blur"}],summary:[{max:500,message:"æ‘˜è¦ä¸èƒ½è¶…è¿‡ 500 ä¸ªå­—ç¬¦",trigger:"blur"}]},w={label:"name",value:"id",children:"children"};s(()=>t.visible,e=>{p.value=e,e&&(k(),b())}),s(p,e=>{e||u("update:visible",!1)});const k=()=>{var e;t.uploadResult&&(h.title=(e=t.uploadResult.file_info.original_filename)?e.replace(/\.(md|pdf)$/i,""):"",h.summary="",h.folder_id=null)},b=async()=>{try{const e=await P();g.value=[{id:null,name:"å…¨éƒ¨æ–‡æ¡£ï¼ˆæ ¹ç›®å½•ï¼‰",children:e}]}catch(e){console.error("åŠ è½½æ–‡ä»¶å¤¹æ ‘å¤±è´¥:",e),m.error("åŠ è½½æ–‡ä»¶å¤¹åˆ—è¡¨å¤±è´¥")}},C=async()=>{var e;if(f.value)try{await f.value.validate(),y.value=!0;const a=await(e={upload_id:t.uploadResult.upload_id,title:h.title,summary:h.summary||void 0,folder_id:h.folder_id||void 0},X({url:`${la}/create-document`,method:"post",data:e}));m.success("æ–‡æ¡£åˆ›å»ºæˆåŠŸ"),u("success",a),x()}catch(a){if(a.errors)return;console.error("åˆ›å»ºæ–‡æ¡£å¤±è´¥:",a),m.error(a.message||"åˆ›å»ºæ–‡æ¡£å¤±è´¥")}finally{y.value=!1}},x=()=>{f.value?.resetFields(),p.value=!1};return(e,a)=>{const l=o("el-input"),t=o("el-form-item"),s=o("el-tree-select"),u=o("el-form"),m=o("el-button"),k=o("el-dialog");return i(),n(k,{modelValue:p.value,"onUpdate:modelValue":a[3]||(a[3]=e=>p.value=e),title:"åˆ›å»ºæ–‡æ¡£",width:"500px","close-on-click-modal":!1,onClose:x},{footer:d(()=>[c("div",oa,[r(m,{onClick:x},{default:d(()=>[...a[4]||(a[4]=[v("å–æ¶ˆ",-1)])]),_:1}),r(m,{type:"primary",loading:y.value,onClick:C},{default:d(()=>[...a[5]||(a[5]=[v(" åˆ›å»ºæ–‡æ¡£ ",-1)])]),_:1},8,["loading"])])]),default:d(()=>[r(u,{ref_key:"formRef",ref:f,model:h,rules:_,"label-width":"100px","label-position":"top"},{default:d(()=>[r(t,{label:"æ–‡æ¡£æ ‡é¢˜",prop:"title"},{default:d(()=>[r(l,{modelValue:h.title,"onUpdate:modelValue":a[0]||(a[0]=e=>h.title=e),placeholder:"è¯·è¾“å…¥æ–‡æ¡£æ ‡é¢˜",maxlength:"200","show-word-limit":"",clearable:""},null,8,["modelValue"])]),_:1}),r(t,{label:"æ–‡æ¡£æ‘˜è¦ï¼ˆå¯é€‰ï¼‰",prop:"summary"},{default:d(()=>[r(l,{modelValue:h.summary,"onUpdate:modelValue":a[1]||(a[1]=e=>h.summary=e),type:"textarea",placeholder:"è¯·è¾“å…¥æ–‡æ¡£æ‘˜è¦",rows:3,maxlength:"500","show-word-limit":"",clearable:""},null,8,["modelValue"])]),_:1}),r(t,{label:"æ‰€å±æ–‡ä»¶å¤¹",prop:"folder_id"},{default:d(()=>[r(s,{modelValue:h.folder_id,"onUpdate:modelValue":a[2]||(a[2]=e=>h.folder_id=e),data:g.value,placeholder:"è¯·é€‰æ‹©æ–‡ä»¶å¤¹",props:w,"check-strictly":"","render-after-expand":!1,clearable:"",style:{width:"100%"}},null,8,["modelValue","data"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])}}},[["__scopeId","data-v-b5f803b2"]]),ia={class:"upload-history-container"},da={class:"history-header"},ra={class:"filter-bar"},ua={class:"stats-info"},ca={class:"stat-text"},pa={class:"stat-text"},va={key:0,class:"loading-container"},ma={key:1,class:"upload-list"},fa={class:"upload-info"},ya={class:"upload-header"},ga={class:"file-icon"},ha={class:"file-name"},_a={class:"upload-meta"},wa={class:"meta-item"},ka={class:"meta-item"},ba={key:0,class:"meta-item validation-msg"},Ca={class:"upload-actions"},xa={key:2,class:"empty-state"},za={key:3,class:"pagination-container"},Da=a({__name:"UploadHistory",emits:["create-document"],setup(e,{emit:a}){const t=a,s=l(!1),u=l([]),y=l(0),C=l(1),D=l(20),V=l(""),$=l({}),M=l(!1),F=l(null),I=async()=>{s.value=!0;try{const e={page:C.value,page_size:D.value};V.value&&(e.status_filter=V.value);const a=await function(e={}){return X({url:`${la}/uploads`,method:"get",params:{page:e.page||1,page_size:e.page_size||20,status_filter:e.status_filter}})}(e);u.value=a.files,y.value=a.total}catch(e){console.error("åŠ è½½ä¸Šä¼ å†å²å¤±è´¥:",e),m.error("åŠ è½½ä¸Šä¼ å†å²å¤±è´¥")}finally{s.value=!1}},B=async()=>{try{const e=await X({url:`${la}/stats`,method:"get"});$.value=e}catch(e){console.error("åŠ è½½ç»Ÿè®¡ä¿¡æ¯å¤±è´¥:",e)}},U=()=>{I()},R=()=>{C.value=1,I()},S=async e=>{try{await z.confirm(`ç¡®å®šè¦åˆ é™¤ä¸Šä¼ è®°å½•"${e.original_filename}"å—ï¼Ÿ`,"åˆ é™¤ç¡®è®¤",{confirmButtonText:"ç¡®å®š",cancelButtonText:"å–æ¶ˆ",type:"warning"}),await(a=e.id,X({url:`${la}/uploads/${a}`,method:"delete"})),m.success("åˆ é™¤æˆåŠŸ"),I(),B()}catch(l){"cancel"!==l&&(console.error("åˆ é™¤å¤±è´¥:",l),m.error(l.message||"åˆ é™¤å¤±è´¥"))}var a},j=()=>{m.success("æ–‡æ¡£åˆ›å»ºæˆåŠŸ"),I(),t("create-document")},T=e=>ta[e]||e,L=e=>{if(!e)return"";return new Date(e).toLocaleString("zh-CN")};return k(()=>{I(),B()}),(e,a)=>{const l=o("el-option"),t=o("el-select"),m=o("el-icon"),k=o("el-tag"),z=o("el-button"),B=o("el-empty"),P=o("el-pagination");return i(),p("div",ia,[c("div",da,[c("div",ra,[r(t,{modelValue:V.value,"onUpdate:modelValue":a[0]||(a[0]=e=>V.value=e),placeholder:"çŠ¶æ€ç­›é€‰",clearable:"",style:{width:"150px"},onChange:I},{default:d(()=>[r(l,{label:"å…¨éƒ¨",value:""}),r(l,{label:"å·²éªŒè¯",value:"validated"}),r(l,{label:"å¤±è´¥",value:"failed"})]),_:1},8,["modelValue"])]),c("div",ua,[c("span",ca,"æ€»ä¸Šä¼ ï¼š"+g($.value.total_uploads||0),1),c("span",pa,"æ€»å¤§å°ï¼š"+g($.value.total_size_mb?.toFixed(2)||0)+" MB",1)])]),s.value?(i(),p("div",va,[r(m,{class:"is-loading"},{default:d(()=>[r(b(x))]),_:1}),a[4]||(a[4]=c("span",null,"åŠ è½½ä¸­...",-1))])):u.value.length>0?(i(),p("div",ma,[(i(!0),p(_,null,w(u.value,e=>{return i(),p("div",{key:e.id,class:h(["upload-item",{"is-failed":"failed"===e.status}])},[c("div",fa,[c("div",ya,[c("span",ga,g((t=e.file_type,"pdf"===t?"ğŸ“•":"ğŸ“„")),1),c("h4",ha,g(e.original_filename),1),r(k,{type:(l=e.status,{validated:"success",failed:"danger",uploaded:"info"}[l]||""),size:"small"},{default:d(()=>[v(g(T(e.status)),1)]),_:2},1032,["type"])]),c("div",_a,[c("span",wa," ğŸ“ "+g(b(sa)(e.file_size)),1),c("span",ka," ğŸ• "+g(L(e.created_at)),1),e.validation_message?(i(),p("span",ba,g(e.validation_message),1)):f("",!0)])]),c("div",Ca,["validated"===e.status?(i(),n(z,{key:0,type:"primary",size:"small",onClick:a=>(e=>{F.value={upload_id:e.id,file_info:{original_filename:e.original_filename,file_size:e.file_size,file_type:e.file_type}},M.value=!0})(e)},{default:d(()=>[...a[5]||(a[5]=[v(" åˆ›å»ºæ–‡æ¡£ ",-1)])]),_:1},8,["onClick"])):f("",!0),r(z,{type:"text",size:"small",class:"delete-btn",onClick:a=>S(e)},{default:d(()=>[...a[6]||(a[6]=[v(" åˆ é™¤ ",-1)])]),_:1},8,["onClick"])])],2);var l,t}),128))])):(i(),p("div",xa,[r(B,{description:"æš‚æ— ä¸Šä¼ è®°å½•"})])),y.value>0?(i(),p("div",za,[r(P,{"current-page":C.value,"onUpdate:currentPage":a[1]||(a[1]=e=>C.value=e),"page-size":D.value,"onUpdate:pageSize":a[2]||(a[2]=e=>D.value=e),total:y.value,"page-sizes":[10,20,50],layout:"total, sizes, prev, pager, next",onSizeChange:R,onCurrentChange:U},null,8,["current-page","page-size","total"])])):f("",!0),r(na,{visible:M.value,"onUpdate:visible":a[3]||(a[3]=e=>M.value=e),"upload-result":F.value,onSuccess:j},null,8,["visible","upload-result"])])}}},[["__scopeId","data-v-cd9a33cb"]]),Va={class:"publish-status-container"},$a={class:"status-icon"},Ma={class:"status-text"},Fa={key:0,class:"review-detail"},Ia={class:"detail-section"},Ba={class:"detail-item"},Ua={class:"value"},Ra={class:"detail-item"},Sa={class:"detail-item"},ja={class:"value"},Ta={class:"detail-item"},La={class:"value"},Pa={key:0,class:"detail-section"},Aa={class:"failure-reason"},Ea={key:1,class:"detail-section"},Oa={class:"confidence-score"},qa={class:"score-text"},Na={key:1,class:"loading-detail"},Ha={class:"dialog-footer"},Ga=a({__name:"PublishStatus",props:{document:{type:Object,required:!0},showRefresh:{type:Boolean,default:!0}},emits:["status-updated","retry-review"],setup(e,{emit:a}){const u=e,_=a,w=l(!1),k=l(!1),C=l(null),z=l(!1),D=t(()=>{const e=u.document.status,a={draft:{text:"è‰ç¨¿",icon:"ğŸ“",type:"info",color:"#909399"},pending_review:{text:"å®¡æ ¸ä¸­",icon:"â³",type:"warning",color:"#E6A23C"},published:{text:"å·²å‘å¸ƒ",icon:"âœ…",type:"success",color:"#67C23A"},review_failed:{text:"å®¡æ ¸å¤±è´¥",icon:"âŒ",type:"danger",color:"#F56C6C"},update_failed:{text:"æ›´æ–°å¤±è´¥",icon:"âš ï¸",type:"warning",color:"#E6A23C"}};return"review_failed"===e&&u.document.publish_time?a.update_failed:a[e]||a.draft}),V=t(()=>u.showRefresh&&"pending_review"===u.document.status),$=t(()=>{const e=u.document.status,a="review_failed"===e&&u.document.publish_time;return"review_failed"===e||a}),M=async()=>{$.value&&"review_failed"===u.document.status&&(await B(),k.value=!0)},F=async()=>{w.value=!0;try{const e=await G(u.document.id);let a=u.document.status;"passed"===e.overall_status?a="published":"failed"===e.overall_status&&(a="review_failed"),a!==u.document.status?(_("status-updated",{documentId:u.document.id,oldStatus:u.document.status,newStatus:a,statusData:e}),m.success("çŠ¶æ€å·²æ›´æ–°")):m.info("çŠ¶æ€æ— å˜åŒ–")}catch(e){console.error("åˆ·æ–°çŠ¶æ€å¤±è´¥:",e),m.error("åˆ·æ–°çŠ¶æ€å¤±è´¥")}finally{w.value=!1}},B=async()=>{try{const e=await G(u.document.id);if(e.review_logs&&e.review_logs.length>0){const a=e.review_logs[e.review_logs.length-1];C.value=a}}catch(e){console.error("åŠ è½½å®¡æ ¸è¯¦æƒ…å¤±è´¥:",e),m.error("åŠ è½½å®¡æ ¸è¯¦æƒ…å¤±è´¥")}},U=async()=>{z.value=!0;try{await H(u.document.id),_("retry-review",{documentId:u.document.id,oldStatus:u.document.status,newStatus:"pending_review"}),m.success("å·²é‡æ–°æäº¤å®¡æ ¸"),k.value=!1}catch(e){console.error("é‡æ–°å®¡æ ¸å¤±è´¥:",e),m.error("é‡æ–°å®¡æ ¸å¤±è´¥")}finally{z.value=!1}},R=e=>{if(!e)return"";return new Date(e).toLocaleString("zh-CN")};return s(()=>u.document.id,()=>{C.value=null,k.value=!1}),(a,l)=>{const t=o("el-tag"),s=o("el-icon"),u=o("el-button"),m=o("el-progress"),_=o("el-dialog");return i(),p("div",Va,[c("div",{class:"status-display",onClick:y(M,["stop"])},[r(t,{type:D.value.type,size:"small",class:h(["status-tag",{clickable:$.value}])},{default:d(()=>[c("span",$a,g(D.value.icon),1),c("span",Ma,g(D.value.text),1)]),_:1},8,["type","class"]),V.value?(i(),n(u,{key:0,type:"text",size:"small",class:"refresh-btn",loading:w.value,onClick:y(F,["stop"]),title:"åˆ·æ–°çŠ¶æ€"},{default:d(()=>[r(s,null,{default:d(()=>[r(b(I))]),_:1})]),_:1},8,["loading"])):f("",!0)]),r(_,{modelValue:k.value,"onUpdate:modelValue":l[1]||(l[1]=e=>k.value=e),title:"å®¡æ ¸è¯¦æƒ…",width:"600px","close-on-click-modal":!1,"append-to-body":""},{footer:d(()=>[c("div",Ha,[r(u,{onClick:l[0]||(l[0]=e=>k.value=!1)},{default:d(()=>[...l[10]||(l[10]=[v("å…³é—­",-1)])]),_:1}),b(N)(e.document.status)?(i(),n(u,{key:0,type:"primary",onClick:U,loading:z.value},{default:d(()=>[...l[11]||(l[11]=[v(" é‡æ–°å®¡æ ¸ ",-1)])]),_:1},8,["loading"])):f("",!0)])]),default:d(()=>{return[C.value?(i(),p("div",Fa,[c("div",Ia,[l[6]||(l[6]=c("h4",null,"å®¡æ ¸ä¿¡æ¯",-1)),c("div",Ba,[l[2]||(l[2]=c("span",{class:"label"},"å®¡æ ¸ç±»å‹ï¼š",-1)),c("span",Ua,g(C.value.review_type||"å†…å®¹å®‰å…¨å®¡æ ¸"),1)]),c("div",Ra,[l[3]||(l[3]=c("span",{class:"label"},"å®¡æ ¸ç»“æœï¼š",-1)),r(t,{type:b(E)(C.value.review_result),size:"small"},{default:d(()=>[v(g(b(O)(C.value.review_result)),1)]),_:1},8,["type"])]),c("div",Sa,[l[4]||(l[4]=c("span",{class:"label"},"å®¡æ ¸æ—¶é•¿ï¼š",-1)),c("span",ja,g(b(q)(C.value.review_duration)),1)]),c("div",Ta,[l[5]||(l[5]=c("span",{class:"label"},"å®¡æ ¸æ—¶é—´ï¼š",-1)),c("span",La,g(R(C.value.created_at)),1)])]),C.value.failure_reason?(i(),p("div",Pa,[l[7]||(l[7]=c("h4",null,"å¤±è´¥åŸå› ",-1)),c("div",Aa,g(C.value.failure_reason),1)])):f("",!0),C.value.confidence_score?(i(),p("div",Ea,[l[8]||(l[8]=c("h4",null,"å®¡æ ¸ç½®ä¿¡åº¦",-1)),c("div",Oa,[r(m,{percentage:Math.round(100*C.value.confidence_score),color:(e=C.value.confidence_score,e>=.8?"#67C23A":e>=.6?"#E6A23C":"#F56C6C")},null,8,["percentage","color"]),c("span",qa,g((100*C.value.confidence_score).toFixed(1))+"%",1)])])):f("",!0)])):(i(),p("div",Na,[r(s,{class:"is-loading"},{default:d(()=>[r(b(x))]),_:1}),l[9]||(l[9]=c("span",null,"åŠ è½½å®¡æ ¸è¯¦æƒ…ä¸­...",-1))]))];var e}),_:1},8,["modelValue"])])}}},[["__scopeId","data-v-416f8c86"]]),Ka={class:"document-list-container"},Wa={class:"list-header"},Ja={class:"stats-bar"},Qa={class:"stat-item"},Xa={class:"stat-value"},Ya={class:"stat-item"},Za={class:"stat-value"},el={class:"stat-item"},al={class:"stat-value"},ll={class:"stat-item"},tl={class:"stat-value"},sl={class:"header-actions"},ol={key:0,class:"loading-container"},nl={key:1,class:"document-list"},il=["onClick"],dl={class:"doc-info"},rl={class:"doc-header"},ul={class:"doc-icon"},cl={class:"doc-title"},pl={class:"doc-meta"},vl={class:"meta-item"},ml={class:"meta-item"},fl={class:"meta-item"},yl={class:"publish-actions"},gl={class:"basic-actions"},hl={key:2,class:"empty-state"},_l={key:3,class:"pagination-container"},wl=a({__name:"DocumentList",props:{folderId:{type:Number,default:null},stats:{type:Object,default:()=>({})}},emits:["refresh-stats","open-upload"],setup(e,{expose:a,emit:u}){const h=D(),V=e,$=u,M=l("documents"),F=l(!1),I=l([]),S=l(0),j=l(1),T=l(20),L=l(!1),P=l(null),A=l(new Set),E=l(new Set),O=l(null),q=t(()=>I.value.filter(e=>"pending_review"===e.status).length),N=e=>{"documents"===e&&H()},H=async()=>{F.value=!0;try{const e={page:j.value,page_size:T.value};null!==V.folderId&&(e.folder_id=V.folderId);const a=await xe(e);I.value=a.documents,S.value=a.total,$("refresh-stats"),G()}catch(e){m.error("åŠ è½½æ–‡æ¡£åˆ—è¡¨å¤±è´¥"),console.error("åŠ è½½æ–‡æ¡£å¤±è´¥:",e)}finally{F.value=!1}},G=()=>{O.value&&clearInterval(O.value);I.value.some(e=>"pending_review"===e.status)&&"documents"===M.value&&(O.value=setInterval(()=>{Z()},3e4))},X=()=>{O.value&&(clearInterval(O.value),O.value=null)},Z=async()=>{const e=I.value.filter(e=>"pending_review"===e.status);if(0===e.length)return void X();console.log(`æ£€æŸ¥ ${e.length} ä¸ªå®¡æ ¸ä¸­æ–‡æ¡£çš„çŠ¶æ€...`);for(const l of e)try{const{getReviewStatus:e}=await R(async()=>{const{getReviewStatus:e}=await import("./index-Be_SmzdB.js").then(e=>e.m);return{getReviewStatus:e}},__vite__mapDeps([0,1,2,3])),a=await e(l.id);let t=l.status;if("passed"===a.overall_status?t="published":"failed"===a.overall_status&&(t="review_failed"),t!==l.status){console.log(`æ–‡æ¡£ ${l.title} çŠ¶æ€æ›´æ–°: ${l.status} â†’ ${t}`);const e=I.value.findIndex(e=>e.id===l.id);-1!==e&&(I.value[e].status=t),m.success(`æ–‡æ¡£"${l.title}"çŠ¶æ€å·²æ›´æ–°ä¸ºï¼š${"published"===t?"å·²å‘å¸ƒ":"å®¡æ ¸å¤±è´¥"}`)}}catch(a){console.error(`æ£€æŸ¥æ–‡æ¡£ ${l.id} çŠ¶æ€å¤±è´¥:`,a)}$("refresh-stats");I.value.some(e=>"pending_review"===e.status)||(console.log("æ²¡æœ‰å®¡æ ¸ä¸­æ–‡æ¡£ï¼Œåœæ­¢è½®è¯¢"),X())};s(()=>V.folderId,()=>{j.value=1,"documents"===M.value&&H()},{immediate:!0}),s(M,e=>{"documents"===e?G():X()});const ee=()=>{H()},ae=()=>{j.value=1,H()},le=async e=>{A.value.add(e.id);try{await Q({document_id:e.id,publish_reason:`å‘å¸ƒæ–‡æ¡£ï¼š${e.title}`}),m.success("æ–‡æ¡£å·²æäº¤å‘å¸ƒï¼Œæ­£åœ¨AIå®¡æ ¸ä¸­...");const a=I.value.findIndex(a=>a.id===e.id);-1!==a&&(I.value[a].status="pending_review"),G(),$("refresh-stats")}catch(a){console.error("å‘å¸ƒå¤±è´¥:",a),m.error(a.response?.data?.detail||"å‘å¸ƒå¤±è´¥")}finally{A.value.delete(e.id)}},te=e=>{const{documentId:a,newStatus:l}=e,t=I.value.findIndex(e=>e.id===a);-1!==t&&(I.value[t].status=l),$("refresh-stats"),G()},se=e=>{const{documentId:a,newStatus:l}=e,t=I.value.findIndex(e=>e.id===a);-1!==t&&(I.value[t].status=l),G(),$("refresh-stats")},oe=e=>"draft"===e.status?"å‘å¸ƒ":"review_failed"===e.status||"unpublished"===e.status?"é‡æ–°å‘å¸ƒ":"å‘å¸ƒ",ne=()=>{$("open-upload")},ie=()=>{const e={};null!==V.folderId&&(e.folder_id=V.folderId),h.push({path:"/document-editor",query:e})},de=()=>{M.value="documents",H()},re=e=>{if(!e)return"";const a=new Date(e),l=new Date-a;return l<6e4?"åˆšåˆš":l<36e5?`${Math.floor(l/6e4)}åˆ†é’Ÿå‰`:l<864e5?`${Math.floor(l/36e5)}å°æ—¶å‰`:l<6048e5?`${Math.floor(l/864e5)}å¤©å‰`:a.toLocaleDateString("zh-CN")},ue=e=>"pdf"===e?"æŸ¥çœ‹":"ç¼–è¾‘";return B(()=>{X()}),a({refresh:H}),k(()=>{H()}),(a,l)=>{const t=o("el-button"),s=o("el-icon"),u=o("el-empty"),k=o("el-pagination"),D=o("el-tab-pane"),V=o("el-tabs");return i(),p("div",Ka,[r(V,{modelValue:M.value,"onUpdate:modelValue":l[3]||(l[3]=e=>M.value=e),class:"list-tabs",onTabChange:N},{default:d(()=>[r(D,{label:"æˆ‘çš„æ–‡æ¡£",name:"documents"},{default:d(()=>[c("div",Wa,[c("div",Ja,[c("div",Qa,[l[5]||(l[5]=c("span",{class:"stat-label"},"æ€»æ–‡æ¡£ï¼š",-1)),c("span",Xa,g(e.stats.total_documents||0),1)]),c("div",Ya,[l[6]||(l[6]=c("span",{class:"stat-label"},"è‰ç¨¿ï¼š",-1)),c("span",Za,g(e.stats.documents_by_status?.draft||0),1)]),c("div",el,[l[7]||(l[7]=c("span",{class:"stat-label"},"å·²å‘å¸ƒï¼š",-1)),c("span",al,g(e.stats.documents_by_status?.published||0),1)]),c("div",ll,[l[8]||(l[8]=c("span",{class:"stat-label"},"å®¡æ ¸ä¸­ï¼š",-1)),c("span",tl,g(q.value),1)])]),c("div",sl,[r(t,{type:"primary",onClick:ne,icon:b(U)},{default:d(()=>[...l[9]||(l[9]=[v(" ä¸Šä¼ æ–‡ä»¶ ",-1)])]),_:1},8,["icon"]),r(t,{onClick:ie,icon:b(C)},{default:d(()=>[...l[10]||(l[10]=[v(" æ–°å»ºæ–‡æ¡£ ",-1)])]),_:1},8,["icon"])])]),F.value?(i(),p("div",ol,[r(s,{class:"is-loading"},{default:d(()=>[r(b(x))]),_:1}),l[11]||(l[11]=c("span",null,"åŠ è½½ä¸­...",-1))])):I.value.length>0?(i(),p("div",nl,[(i(!0),p(_,null,w(I.value,e=>{return i(),p("div",{key:e.id,class:"document-item",onClick:a=>(e=>{P.value=e,L.value=!0})(e)},[c("div",dl,[c("div",rl,[c("span",ul,g((a=e.file_type,"pdf"===a?"ğŸ“•":"ğŸ“„")),1),c("h4",cl,g(e.title),1),r(Ga,{document:e,"show-refresh":!0,onStatusUpdated:te,onRetryReview:se},null,8,["document"])]),c("div",pl,[c("span",vl," ğŸ“ "+g(e.folder_name||"æ ¹ç›®å½•"),1),c("span",ml," ğŸ“ "+g(b(Me)(e.file_size)),1),c("span",fl," ğŸ• "+g(re(e.updated_at)),1)])]),c("div",{class:"doc-actions",onClick:l[0]||(l[0]=y(()=>{},["stop"]))},[c("div",yl,[b(K)(e.status)?(i(),n(t,{key:0,type:"primary",size:"small",onClick:a=>le(e),loading:A.value.has(e.id)},{default:d(()=>[v(g(oe(e)),1)]),_:2},1032,["onClick","loading"])):f("",!0),"review_failed"===e.status?(i(),n(t,{key:1,type:"primary",size:"small",onClick:a=>le(e),loading:A.value.has(e.id)},{default:d(()=>[...l[12]||(l[12]=[v(" é‡æ–°å‘å¸ƒ ",-1)])]),_:1},8,["onClick","loading"])):f("",!0),"published"===e.status?(i(),p(_,{key:2},[r(t,{type:"primary",size:"small",onClick:a=>(async e=>{if(!A.value.has(e.id)){console.log("=== æ›´æ–°å·²å‘å¸ƒæ–‡æ¡£ ==="),A.value.add(e.id);try{const{getDocumentDetail:a}=await R(async()=>{const{getDocumentDetail:e}=await Promise.resolve().then(()=>Fe);return{getDocumentDetail:e}},void 0),l=await a(e.id),t={title:l.title,content:l.content,summary:l.summary,update_reason:`æ›´æ–°å‘å¸ƒï¼š${e.title}`},s=await W(e.id,t);console.log("æ›´æ–°æˆåŠŸ:",s),m.success("æ–‡æ¡£å·²æäº¤æ›´æ–°ï¼Œæ­£åœ¨AIå®¡æ ¸ä¸­...");const o=I.value.findIndex(a=>a.id===e.id);-1!==o&&(I.value[o].status="pending_review"),G(),$("refresh-stats")}catch(a){console.error("æ›´æ–°å‘å¸ƒå¤±è´¥:",a);const e=a.response?.data?.detail||a.response?.data?.message||a.message||"æ›´æ–°å‘å¸ƒå¤±è´¥";m.error(`æ›´æ–°å‘å¸ƒå¤±è´¥: ${e}`)}finally{A.value.delete(e.id)}}})(e),loading:A.value.has(e.id)},{default:d(()=>[...l[13]||(l[13]=[v(" æ›´æ–°å‘å¸ƒ ",-1)])]),_:1},8,["onClick","loading"]),r(t,{type:"danger",size:"small",onClick:a=>(async e=>{try{await z.confirm(`ç¡®å®šè¦å–æ¶ˆå‘å¸ƒæ–‡æ¡£"${e.title}"å—ï¼Ÿæ–‡æ¡£å°†ä»æŠ€æœ¯å¹¿åœºä¸‹æ¶ã€‚`,"å–æ¶ˆå‘å¸ƒç¡®è®¤",{confirmButtonText:"ç¡®å®š",cancelButtonText:"å–æ¶ˆ",type:"warning"}),E.value.add(e.id),await J(e.id,"ç”¨æˆ·ä¸»åŠ¨å–æ¶ˆå‘å¸ƒ"),m.success("æ–‡æ¡£å·²å–æ¶ˆå‘å¸ƒ");const a=I.value.findIndex(a=>a.id===e.id);-1!==a&&(I.value[a].status="draft"),$("refresh-stats")}catch(a){"cancel"!==a&&(console.error("å–æ¶ˆå‘å¸ƒå¤±è´¥:",a),m.error(a.response?.data?.detail||"å–æ¶ˆå‘å¸ƒå¤±è´¥"))}finally{E.value.delete(e.id)}})(e),loading:E.value.has(e.id)},{default:d(()=>[...l[14]||(l[14]=[v(" å–æ¶ˆå‘å¸ƒ ",-1)])]),_:1},8,["onClick","loading"])],64)):f("",!0)]),c("div",gl,[r(t,{type:"text",size:"small",onClick:a=>(async e=>{if("pdf"===e.file_type)try{const{getToken:a}=await R(async()=>{const{getToken:e}=await import("./index-mLi0s7WA.js").then(e=>e.a7);return{getToken:e}},__vite__mapDeps([2,3])),l=await fetch(`${Y}/v2/document_manager/documents/${e.id}/stream`,{headers:{Authorization:`Bearer ${a()}`}});if(!l.ok)throw new Error("è·å–PDFå¤±è´¥");const t=await l.blob(),s=window.URL.createObjectURL(t);window.open(s,"_blank"),setTimeout(()=>{window.URL.revokeObjectURL(s)},1e3)}catch(a){console.error("æŸ¥çœ‹PDFå¤±è´¥:",a),m.error("æŸ¥çœ‹PDFå¤±è´¥")}else h.push({path:"/document-editor",query:{id:e.id}})})(e)},{default:d(()=>[v(g(ue(e.file_type)),1)]),_:2},1032,["onClick"]),r(t,{type:"text",size:"small",onClick:a=>(async e=>{try{await z.confirm(`ç¡®å®šè¦åˆ é™¤æ–‡æ¡£"${e.title}"å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ¢å¤ã€‚`,"åˆ é™¤ç¡®è®¤",{confirmButtonText:"ç¡®å®š",cancelButtonText:"å–æ¶ˆ",type:"warning"}),await ze(e.id),m.success("æ–‡æ¡£åˆ é™¤æˆåŠŸ"),H()}catch(a){"cancel"!==a&&console.error("åˆ é™¤æ–‡æ¡£å¤±è´¥:",a)}})(e),class:"delete-btn"},{default:d(()=>[...l[15]||(l[15]=[v(" åˆ é™¤ ",-1)])]),_:1},8,["onClick"])])])],8,il);var a}),128))])):(i(),p("div",hl,[r(u,{description:"æš‚æ— æ–‡æ¡£"},{default:d(()=>[r(t,{type:"primary",onClick:ne},{default:d(()=>[...l[16]||(l[16]=[v(" ä¸Šä¼ æ–‡ä»¶ ",-1)])]),_:1})]),_:1})])),S.value>0?(i(),p("div",_l,[r(k,{"current-page":j.value,"onUpdate:currentPage":l[1]||(l[1]=e=>j.value=e),"page-size":T.value,"onUpdate:pageSize":l[2]||(l[2]=e=>T.value=e),total:S.value,"page-sizes":[10,20,50,100],layout:"total, sizes, prev, pager, next, jumper",onSizeChange:ae,onCurrentChange:ee},null,8,["current-page","page-size","total"])])):f("",!0)]),_:1}),r(D,{label:"ä¸Šä¼ å†å²",name:"uploads"},{default:d(()=>[r(Da,{onCreateDocument:de})]),_:1})]),_:1},8,["modelValue"]),r(aa,{modelValue:L.value,"onUpdate:modelValue":l[4]||(l[4]=e=>L.value=e),document:P.value,onRefresh:H},null,8,["modelValue","document"])])}}},[["__scopeId","data-v-61ae1af8"]]),kl=a({__name:"UploadArea",emits:["files-selected"],setup(e,{emit:a}){const t=l(null),s=l(!1),o=a,n=()=>{t.value?.click()},d=e=>{const a=Array.from(e.target.files);f(a),e.target.value=""},r=e=>{s.value=!1;const a=Array.from(e.dataTransfer.files);f(a)},u=()=>{s.value=!0},v=()=>{s.value=!1},f=e=>{if(!e||0===e.length)return;const a=[],l=[];e.forEach(e=>{const t=function(e){const a=e.name.toLowerCase();return[".md",".pdf"].some(e=>a.endsWith(e))?{valid:!0,message:""}:{valid:!1,message:"ä»…æ”¯æŒ MD å’Œ PDF æ ¼å¼æ–‡ä»¶"}}(e);if(!t.valid)return void l.push(`${e.name}: ${t.message}`);const s=function(e){const a=e.name.toLowerCase(),l=e.size/1048576;return a.endsWith(".md")&&l>20?{valid:!1,message:"MDæ–‡ä»¶ä¸èƒ½è¶…è¿‡20MB"}:a.endsWith(".pdf")&&l>100?{valid:!1,message:"PDFæ–‡ä»¶ä¸èƒ½è¶…è¿‡100MB"}:{valid:!0,message:""}}(e);s.valid?a.push(e):l.push(`${e.name}: ${s.message}`)}),l.length>0&&m.error({message:l.join("\n"),duration:5e3,showClose:!0}),a.length>0&&o("files-selected",a)};return(e,a)=>(i(),p("div",{class:h(["upload-area",{"is-dragover":s.value}]),onDrop:y(r,["prevent"]),onDragover:y(u,["prevent"]),onDragleave:y(v,["prevent"]),onClick:n},[c("input",{ref_key:"fileInputRef",ref:t,type:"file",multiple:"",accept:".md,.pdf",style:{display:"none"},onChange:d},null,544),a[0]||(a[0]=S('<div class="upload-icon" data-v-926eb51c><svg width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor" data-v-926eb51c><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" data-v-926eb51c></path><polyline points="17 8 12 3 7 8" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" data-v-926eb51c></polyline><line x1="12" y1="3" x2="12" y2="15" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" data-v-926eb51c></line></svg></div><div class="upload-text" data-v-926eb51c><p class="primary-text" data-v-926eb51c>æ‹–æ‹½æ–‡ä»¶åˆ°è¿™é‡Œ</p><p class="secondary-text" data-v-926eb51c>æˆ–ç‚¹å‡»é€‰æ‹©æ–‡ä»¶</p></div><div class="upload-hint" data-v-926eb51c><span class="hint-item" data-v-926eb51c>æ”¯æŒ MDã€PDF æ ¼å¼</span><span class="hint-divider" data-v-926eb51c>|</span><span class="hint-item" data-v-926eb51c>MDæœ€å¤§20MBï¼ŒPDFæœ€å¤§100MB</span></div>',3))],34))}},[["__scopeId","data-v-926eb51c"]]),bl={class:"upload-progress"},Cl={key:0,class:"file-list"},xl={class:"file-info"},zl={class:"file-icon"},Dl={key:0,class:"icon-loading",width:"20",height:"20",viewBox:"0 0 24 24"},Vl={key:1,width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"#52c41a"},$l={key:2,class:"icon-loading",width:"20",height:"20",viewBox:"0 0 24 24"},Ml={key:3,width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"#52c41a"},Fl={key:4,width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"#ff4d4f"},Il={key:5,width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"#656d76"},Bl={class:"file-details"},Ul={class:"file-name"},Rl={class:"file-meta"},Sl={class:"file-size"},jl={key:0,class:"file-status"},Tl={key:1,class:"file-status success"},Ll={key:2,class:"file-status"},Pl={key:3,class:"file-status success"},Al={key:4,class:"file-status error"},El={key:0,class:"progress-bar"},Ol={class:"file-actions"},ql=["onClick"],Nl={key:1,class:"empty-state"},Hl=a({__name:"UploadProgress",props:{fileList:{type:Array,required:!0,default:()=>[]}},emits:["remove-file"],setup(e,{emit:a}){const l=a;return(a,t)=>(i(),p("div",bl,[e.fileList.length>0?(i(),p("div",Cl,[(i(!0),p(_,null,w(e.fileList,e=>{return i(),p("div",{key:e.id,class:h(["file-item",{"is-error":"error"===e.status}])},[c("div",xl,[c("div",zl,["validating"===e.status?(i(),p("svg",Dl,[...t[0]||(t[0]=[c("circle",{cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"2",fill:"none",opacity:"0.25"},null,-1),c("path",{d:"M12 2 A10 10 0 0 1 22 12",stroke:"currentColor","stroke-width":"2",fill:"none","stroke-linecap":"round"},null,-1)])])):"validated"===e.status?(i(),p("svg",Vl,[...t[1]||(t[1]=[c("path",{d:"M20 6L9 17l-5-5","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},null,-1)])])):"uploading"===e.status?(i(),p("svg",$l,[...t[2]||(t[2]=[c("circle",{cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"2",fill:"none",opacity:"0.25"},null,-1),c("path",{d:"M12 2 A10 10 0 0 1 22 12",stroke:"currentColor","stroke-width":"2",fill:"none","stroke-linecap":"round"},null,-1)])])):"success"===e.status?(i(),p("svg",Ml,[...t[3]||(t[3]=[c("circle",{cx:"12",cy:"12",r:"10","stroke-width":"2"},null,-1),c("path",{d:"M9 12l2 2 4-4","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},null,-1)])])):"error"===e.status?(i(),p("svg",Fl,[...t[4]||(t[4]=[c("circle",{cx:"12",cy:"12",r:"10","stroke-width":"2"},null,-1),c("path",{d:"M15 9l-6 6M9 9l6 6","stroke-width":"2","stroke-linecap":"round"},null,-1)])])):(i(),p("svg",Il,[...t[5]||(t[5]=[c("path",{d:"M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z","stroke-width":"2"},null,-1),c("polyline",{points:"13 2 13 9 20 9","stroke-width":"2"},null,-1)])]))]),c("div",Bl,[c("div",Ul,g(e.file.name),1),c("div",Rl,[c("span",Sl,g((a=e.file.size,sa(a))),1),"validating"===e.status?(i(),p("span",jl,"éªŒè¯ä¸­...")):"validated"===e.status?(i(),p("span",Tl,"éªŒè¯é€šè¿‡")):"uploading"===e.status?(i(),p("span",Ll,"ä¸Šä¼ ä¸­ "+g(e.progress)+"%",1)):"success"===e.status?(i(),p("span",Pl,"ä¸Šä¼ æˆåŠŸ")):"error"===e.status?(i(),p("span",Al,g(e.errorMessage),1)):f("",!0)])])]),"uploading"===e.status?(i(),p("div",El,[c("div",{class:"progress-fill",style:j({width:e.progress+"%"})},null,4)])):f("",!0),c("div",Ol,["error"===e.status||"validated"===e.status?(i(),p("button",{key:0,class:"btn-remove",onClick:a=>{return t=e.id,void l("remove-file",t);var t}},[...t[6]||(t[6]=[c("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor"},[c("path",{d:"M18 6L6 18M6 6l12 12","stroke-width":"2","stroke-linecap":"round"})],-1)])],8,ql)):f("",!0)])],2);var a}),128))])):(i(),p("div",Nl,[...t[7]||(t[7]=[c("p",null,"æš‚æ— æ–‡ä»¶",-1)])]))]))}},[["__scopeId","data-v-faa51891"]]),Gl={key:0,class:"upload-section"},Kl={key:1,class:"progress-section"},Wl={class:"section-header"},Jl={class:"section-title"},Ql={key:0,class:"upload-stats"},Xl={class:"dialog-footer"},Yl=a({__name:"UploadDialog",props:{visible:{type:Boolean,required:!0}},emits:["update:visible","upload-success"],setup(e,{emit:a}){const u=e,y=a,h=l(!1),w=l([]),k=l(!1),b=l(!1),C=l(null),x=l(0),D=F({total:0,success:0,failed:0}),V=t(()=>w.value.some(e=>"validated"===e.status)),$=t(()=>w.value.filter(e=>"validated"===e.status).length);s(()=>u.visible,e=>{h.value=e,e&&M()}),s(h,e=>{e||y("update:visible",!1)});const M=()=>{w.value=[],k.value=!1,D.total=0,D.success=0,D.failed=0},I=async e=>{const a=e.map(e=>F({id:++x.value,file:e,status:"validating",progress:0,errorMessage:"",uploadResult:null}));w.value.push(...a);for(const l of a)await B(l)},B=async e=>{console.log("ğŸ” å¼€å§‹éªŒè¯æ–‡ä»¶:",e.file.name);try{console.log("ğŸ“¤ è°ƒç”¨éªŒè¯æ¥å£...");const a=await function(e){const a=new FormData;return a.append("file",e),X({url:`${la}/validate`,method:"post",data:a,headers:{"Content-Type":"multipart/form-data"}})}(e.file);console.log("âœ… éªŒè¯æ¥å£è¿”å›:",a),a.is_valid?(e.status="validated",console.log("âœ… æ–‡ä»¶éªŒè¯é€šè¿‡ï¼ŒçŠ¶æ€å·²æ›´æ–°ä¸º:",e.status)):(e.status="error",e.errorMessage=a.error_message||"éªŒè¯å¤±è´¥",console.log("âŒ æ–‡ä»¶éªŒè¯å¤±è´¥:",e.errorMessage))}catch(a){console.error("âŒ æ–‡ä»¶éªŒè¯å¼‚å¸¸:",a),console.error("é”™è¯¯è¯¦æƒ…:",{message:a.message,response:a.response,request:a.request}),e.status="error",e.errorMessage=a.message||"éªŒè¯å¤±è´¥"}},U=async()=>{const e=w.value.filter(e=>"validated"===e.status);if(0!==e.length){k.value=!0,D.total=e.length,D.success=0,D.failed=0;for(const a of e)await R(a);k.value=!1,D.success>0&&m.success(`æˆåŠŸä¸Šä¼  ${D.success} ä¸ªæ–‡ä»¶`),D.failed>0&&m.error(`${D.failed} ä¸ªæ–‡ä»¶ä¸Šä¼ å¤±è´¥`)}else m.warning("æ²¡æœ‰å¯ä¸Šä¼ çš„æ–‡ä»¶")},R=async e=>{e.status="uploading",e.progress=0;try{const a=await function(e,a){const l=new FormData;return l.append("file",e),X({url:`${la}/upload`,method:"post",data:l,headers:{"Content-Type":"multipart/form-data"},onUploadProgress:e=>{if(a&&e.total){const l=Math.round(100*e.loaded/e.total);a(l)}}})}(e.file,a=>{e.progress=a});a.success?(e.status="success",e.uploadResult=a,D.success++,C.value=a,b.value=!0,await new Promise(e=>{const a=s(b,l=>{l||(a(),e())})})):(e.status="error",e.errorMessage=a.message||"ä¸Šä¼ å¤±è´¥",D.failed++)}catch(a){console.error("æ–‡ä»¶ä¸Šä¼ å¤±è´¥:",a),e.status="error",e.errorMessage=a.message||"ä¸Šä¼ å¤±è´¥",D.failed++}},S=e=>{const a=w.value.findIndex(a=>a.id===e);-1!==a&&w.value.splice(a,1)},j=async()=>{try{await z.confirm("ç¡®å®šè¦æ¸…ç©ºæ‰€æœ‰æ–‡ä»¶å—ï¼Ÿ","æç¤º",{confirmButtonText:"ç¡®å®š",cancelButtonText:"å–æ¶ˆ",type:"warning"}),w.value=[]}catch{}},T=e=>{y("upload-success",e)},L=()=>{k.value&&m.info("æ–‡ä»¶æ­£åœ¨åå°ä¸Šä¼ "),h.value=!1};return(e,a)=>{const l=o("el-button"),t=o("el-dialog");return i(),p(_,null,[r(t,{modelValue:h.value,"onUpdate:modelValue":a[0]||(a[0]=e=>h.value=e),title:"ä¸Šä¼ æ–‡ä»¶",width:"700px","close-on-click-modal":!1,onClose:L},{footer:d(()=>[c("div",Xl,[r(l,{onClick:L},{default:d(()=>[v(g(k.value?"åå°ä¸Šä¼ ":"å–æ¶ˆ"),1)]),_:1}),!k.value&&V.value?(i(),n(l,{key:0,type:"primary",onClick:U},{default:d(()=>[v(" å¼€å§‹ä¸Šä¼  ("+g($.value)+") ",1)]),_:1})):f("",!0)])]),default:d(()=>[k.value||0!==w.value.length?f("",!0):(i(),p("div",Gl,[r(kl,{onFilesSelected:I})])),w.value.length>0?(i(),p("div",Kl,[c("div",Wl,[c("h3",Jl,[v(" å·²é€‰æ‹©æ–‡ä»¶ ("+g(w.value.length)+") ",1),D.total>0?(i(),p("span",Ql," - æˆåŠŸ: "+g(D.success)+" / å¤±è´¥: "+g(D.failed),1)):f("",!0)]),!k.value&&V.value?(i(),n(l,{key:0,text:"",onClick:j},{default:d(()=>[...a[2]||(a[2]=[v(" æ¸…ç©ºåˆ—è¡¨ ",-1)])]),_:1})):f("",!0)]),r(Hl,{"file-list":w.value,onRemoveFile:S},null,8,["file-list"])])):f("",!0)]),_:1},8,["modelValue"]),r(na,{visible:b.value,"onUpdate:visible":a[1]||(a[1]=e=>b.value=e),"upload-result":C.value,onSuccess:T},null,8,["visible","upload-result"])],64)}}},[["__scopeId","data-v-dd8451fb"]]),Zl={class:"document-manager-page"},et={class:"page-content"},at={class:"content-wrapper"},lt={class:"sidebar"},tt={class:"main-content"},st=a({__name:"index",setup(a){const t=l(null),s=l(null),o=l(null),n=l(!1),d=l({total_documents:0,total_folders:0,documents_by_status:{draft:0,published:0,review_failed:0}}),u=e=>{o.value=e},v=()=>{f()},f=async()=>{try{const e=await De();d.value=e}catch(e){console.error("åŠ è½½ç»Ÿè®¡ä¿¡æ¯å¤±è´¥:",e),m.error("åŠ è½½ç»Ÿè®¡ä¿¡æ¯å¤±è´¥")}},y=()=>{n.value=!0},g=()=>{s.value?.refresh(),f(),t.value?.refresh?.()};return k(()=>{f()}),(a,l)=>(i(),p("div",Zl,[r(e),c("div",et,[c("div",at,[c("aside",lt,[r(be,{ref_key:"folderTreeRef",ref:t,onFolderSelect:u,onTreeUpdate:v},null,512)]),c("main",tt,[r(wl,{ref_key:"documentListRef",ref:s,"folder-id":o.value,stats:d.value,onRefreshStats:f,onOpenUpload:y},null,8,["folder-id","stats"])])])]),r(Yl,{visible:n.value,"onUpdate:visible":l[0]||(l[0]=e=>n.value=e),onUploadSuccess:g},null,8,["visible"])]))}},[["__scopeId","data-v-ec40f105"]]);export{st as default};
