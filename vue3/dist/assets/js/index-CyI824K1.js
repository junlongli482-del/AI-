import{_ as a,r as s,p as e,a as t,k as l,v as c,E as o,c as n,f as i,b as u,t as r,w as d,i as v,g as p,F as m,e as y,j as h,u as k,o as f,h as _,q as b,s as g}from"./index-mLi0s7WA.js";import{A as x}from"./AppHeader-DG160XR7.js";import{g as w,a as j,b as C,c as q,f as z,d as $,s as A}from"./index-B9Vc6n1E.js";import{b as F,f as V}from"./index-CtoQaP6o.js";import{u as E}from"./user-DXv7J6WQ.js";import"./request-49VFfJMC.js";const U={class:"tech-square"},H={class:"main-content"},I={class:"page-header"},K={class:"header-stats"},O={class:"stat-card"},S={class:"stat-number"},B={class:"stat-card"},D={class:"stat-number"},G={class:"stat-card"},J={class:"stat-number"},L={class:"search-section"},M={class:"search-bar"},N={key:0,class:"tabs-section"},P={class:"tab-buttons"},Q=["onClick"],R={class:"tab-icon"},T={class:"tab-text"},W={key:1,class:"search-result-info"},X={class:"result-text"},Y={class:"documents-section"},Z={key:0,class:"loading-state"},aa={key:1,class:"empty-state"},sa={class:"empty-text"},ea={key:2,class:"documents-grid"},ta=["onClick"],la={class:"card-header"},ca={class:"file-type"},oa={class:"type-icon"},na={class:"type-text"},ia={key:0,class:"featured-tag"},ua={class:"card-content"},ra={class:"doc-title"},da={key:0,class:"doc-summary"},va={class:"card-footer"},pa={class:"author-info"},ma={class:"author-avatar"},ya={class:"author-name"},ha={class:"doc-stats"},ka={class:"stat-item"},fa={class:"stat-text"},_a={class:"stat-item"},ba={class:"stat-text"},ga={class:"card-time"},xa={key:3,class:"load-more"},wa=a({__name:"index",setup(a){const wa=k(),ja=E(),Ca=[{key:"hot",label:"çƒ­é—¨",icon:"ðŸ”¥"},{key:"latest",label:"æœ€æ–°",icon:"âš¡"},{key:"all",label:"å…¨éƒ¨",icon:"ðŸ“š"}],qa=s(!1),za=s(!1),$a=s("normal"),Aa=s("hot"),Fa=s(""),Va=s(0),Ea=s(1),Ua=s(20),Ha=s(0),Ia=e(()=>Ha.value>Oa.value.length),Ka=t({total_documents:0,total_views:0,today_published:0,featured_count:0}),Oa=s([]);l(()=>{Ga(),La("hot")}),c(()=>ja.token,a=>{a&&Oa.value.length>0&&Ja()});const Sa=a=>a>=1e4?`${(a/1e4).toFixed(1)}w`:a>=1e3?`${(a/1e3).toFixed(1)}k`:a.toString(),Ba=a=>Da(a).charAt(0).toUpperCase(),Da=a=>a?a.nickname||a.username||`ç”¨æˆ·${a.user_id}`:"æœªçŸ¥",Ga=async()=>{try{const a=await w();Object.assign(Ka,a)}catch(a){console.error("åŠ è½½ç»Ÿè®¡å¤±è´¥:",a)}},Ja=async()=>{if(ja.token&&0!==Oa.value.length)try{const a=Oa.value.map(a=>a.id),s=await F(a);Oa.value.forEach(a=>{const e=s[a.id];e&&(a.like_count=e.like_count,a.favorite_count=e.favorite_count,a.is_liked=e.is_liked,a.is_favorited=e.is_favorited)})}catch(a){console.warn("åŠ è½½äº’åŠ¨çŠ¶æ€å¤±è´¥:",a)}},La=async(a="latest",s=1,e=!1)=>{e?za.value=!0:qa.value=!0;try{const t={page:s,size:Ua.value,sort_by:"hot"===a?"popular":"all"===a?"latest":a},l=await j(t);e?Oa.value.push(...l.documents||[]):Oa.value=l.documents||[],Ha.value=l.total||0,Ea.value=l.page||1,ja.token&&await Ja()}catch(t){console.error("åŠ è½½æ–‡æ¡£å¤±è´¥:",t),o.error("åŠ è½½æ–‡æ¡£å¤±è´¥")}finally{qa.value=!1,za.value=!1}},Ma=async(a,s=1,e=!1)=>{if(a.trim()){e?za.value=!0:qa.value=!0;try{const t={keyword:a.trim(),page:s,size:Ua.value},l=await A(t);e?Oa.value.push(...l.documents||[]):Oa.value=l.documents||[],Ha.value=l.total||0,Va.value=l.total||0,Ea.value=l.page||1,ja.token&&await Ja()}catch(t){console.error("æœç´¢å¤±è´¥:",t),o.error("æœç´¢å¤±è´¥")}finally{qa.value=!1,za.value=!1}}},Na=()=>{const a=Fa.value.trim();a?($a.value="search",Ea.value=1,Ma(a)):Pa()},Pa=()=>{$a.value="normal",Fa.value="",Aa.value="hot",Ea.value=1,La("hot")},Qa=()=>{const a=Ea.value+1;"search"===$a.value?Ma(Fa.value,a,!0):La(Aa.value,a,!0)};return(a,s)=>{const e=p("el-button"),t=p("el-input"),l=p("el-skeleton");return f(),n("div",U,[i(x),u("div",H,[u("div",I,[s[4]||(s[4]=u("div",{class:"header-content"},[u("h1",{class:"page-title"},"æŠ€æœ¯å¹¿åœº"),u("p",{class:"page-subtitle"},"å‘çŽ°ä¼˜è´¨æŠ€æœ¯å†…å®¹ï¼Œåˆ†äº«å¼€å‘ç»éªŒ")],-1)),u("div",K,[u("div",O,[u("span",S,r(Sa(Ka.total_documents)),1),s[1]||(s[1]=u("span",{class:"stat-label"},"æ–‡æ¡£",-1))]),u("div",B,[u("span",D,r(Sa(Ka.total_views)),1),s[2]||(s[2]=u("span",{class:"stat-label"},"é˜…è¯»",-1))]),u("div",G,[u("span",J,r(Ka.today_published),1),s[3]||(s[3]=u("span",{class:"stat-label"},"ä»Šæ—¥å‘å¸ƒ",-1))])])]),u("div",L,[u("div",M,[i(t,{modelValue:Fa.value,"onUpdate:modelValue":s[0]||(s[0]=a=>Fa.value=a),placeholder:"æœç´¢æ–‡æ¡£...",size:"large",onKeyup:v(Na,["enter"]),clearable:""},{prefix:d(()=>[...s[5]||(s[5]=[u("span",{class:"search-icon"},"ðŸ”",-1)])]),append:d(()=>[i(e,{onClick:Na,type:"primary"},{default:d(()=>[...s[6]||(s[6]=[_("æœç´¢",-1)])]),_:1})]),_:1},8,["modelValue"])]),"normal"===$a.value?(f(),n("div",N,[u("div",P,[(f(),n(m,null,y(Ca,a=>u("button",{key:a.key,class:b(["tab-btn",{active:Aa.value===a.key}]),onClick:s=>(a=>{Aa.value=a,$a.value="normal",Fa.value="",Ea.value=1,La(a)})(a.key)},[u("span",R,r(a.icon),1),u("span",T,r(a.label),1)],10,Q)),64))])])):(f(),n("div",W,[u("span",X,"æ‰¾åˆ° "+r(Va.value)+" ä¸ªç›¸å…³æ–‡æ¡£",1),i(e,{onClick:Pa,text:"",type:"primary"},{default:d(()=>[...s[7]||(s[7]=[_("æ¸…ç©ºæœç´¢",-1)])]),_:1})]))]),u("div",Y,[qa.value?(f(),n("div",Z,[i(l,{rows:6,animated:""})])):0===Oa.value.length?(f(),n("div",aa,[s[8]||(s[8]=u("div",{class:"empty-icon"},"ðŸ“„",-1)),u("p",sa,r("search"===$a.value?"æ²¡æœ‰æ‰¾åˆ°ç›¸å…³æ–‡æ¡£":"æš‚æ— æ–‡æ¡£"),1)])):(f(),n("div",ea,[(f(!0),n(m,null,y(Oa.value,a=>(f(),n("div",{key:a.id,class:"document-card",onClick:s=>{return e=a.id,void wa.push(`/tech-square/document/${e}`);var e}},[u("div",la,[u("div",ca,[u("span",oa,r(g(C)(a.file_type)),1),u("span",na,r(g(q)(a.file_type)),1)]),a.is_featured?(f(),n("div",ia,"â­")):h("",!0)]),u("div",ua,[u("h3",ra,r(a.title),1),a.summary?(f(),n("p",da,r(a.summary),1)):h("",!0)]),u("div",va,[u("div",pa,[u("span",ma,r(Ba(a)),1),u("span",ya,r(Da(a)),1)]),u("div",ha,[u("span",ka,[s[9]||(s[9]=u("span",{class:"stat-icon"},"ðŸ‘€",-1)),u("span",fa,r(g(z)(a.view_count)),1)]),u("span",_a,[s[10]||(s[10]=u("span",{class:"stat-icon"},"â¤ï¸",-1)),u("span",ba,r(g(V)(a.like_count||0)),1)])])]),u("div",ga,r(g($)(a.publish_time)),1)],8,ta))),128))])),Ia.value&&!qa.value?(f(),n("div",xa,[i(e,{onClick:Qa,loading:za.value,size:"large",class:"load-more-btn"},{default:d(()=>[_(r(za.value?"åŠ è½½ä¸­...":"åŠ è½½æ›´å¤š"),1)]),_:1},8,["loading"])])):h("",!0)])])])}}},[["__scopeId","data-v-e84804c3"]]);export{wa as default};
